<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Entrega de Safra 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.0.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.2.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.25/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#5D5CDE',
                            '50': '#EEEEFF',
                            '100': '#D4D4F7',
                            '200': '#ACACEF',
                            '300': '#8584E7',
                            '400': '#5D5CDE',
                            '500': '#3635D5',
                            '600': '#2A29B0',
                            '700': '#211F8A',
                            '800': '#171664',
                            '900': '#0D0C3E'
                        },
                        secondary: {
                            DEFAULT: '#6B7280',
                            '50': '#F9FAFB',
                            '100': '#F3F4F6',
                            '200': '#E5E7EB',
                            '300': '#D1D5DB',
                            '400': '#9CA3AF',
                            '500': '#6B7280',
                            '600': '#4B5563',
                            '700': '#374151',
                            '800': '#1F2937',
                            '900': '#111827'
                        },
                        success: {
                            DEFAULT: '#10B981',
                            '50': '#ECFDF5',
                            '100': '#D1FAE5',
                            '200': '#A7F3D0',
                            '300': '#6EE7B7',
                            '400': '#34D399',
                            '500': '#10B981',
                            '600': '#059669',
                            '700': '#047857',
                            '800': '#065F46',
                            '900': '#064E3B'
                        },
                        warning: {
                            DEFAULT: '#F59E0B',
                            '50': '#FFFBEB',
                            '100': '#FEF3C7',
                            '200': '#FDE68A',
                            '300': '#FCD34D',
                            '400': '#FBBF24',
                            '500': '#F59E0B',
                            '600': '#D97706',
                            '700': '#B45309',
                            '800': '#92400E',
                            '900': '#78350F'
                        },
                        danger: {
                            DEFAULT: '#EF4444',
                            '50': '#FEF2F2',
                            '100': '#FEE2E2',
                            '200': '#FECACA',
                            '300': '#FCA5A5',
                            '400': '#F87171',
                            '500': '#EF4444',
                            '600': '#DC2626',
                            '700': '#B91C1C',
                            '800': '#991B1B',
                            '900': '#7F1D1D'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    },
                    boxShadow: {
                        'inner-sm': 'inset 0 1px 2px 0 rgba(0, 0, 0, 0.05)',
                        'soft': '0 2px 15px -3px rgba(0, 0, 0, 0.07), 0 10px 20px -2px rgba(0, 0, 0, 0.04)',
                        'card': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)'
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'progress': 'progress 1s ease-in-out infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'bounce-sm': 'bounce-sm 1s infinite',
                        'fadeIn': 'fadeIn 0.3s ease-in-out',
                        'fadeOut': 'fadeOut 0.3s ease-in-out',
                        'slideIn': 'slideIn 0.3s ease-in-out',
                        'slideOut': 'slideOut 0.3s ease-in-out'
                    },
                    keyframes: {
                        progress: {
                            '0%': { width: '0%' },
                            '100%': { width: '100%' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        'bounce-sm': {
                            '0%, 100%': {
                                transform: 'translateY(-2px)',
                                animationTimingFunction: 'cubic-bezier(0.8, 0, 1, 1)'
                            },
                            '50%': {
                                transform: 'translateY(0)',
                                animationTimingFunction: 'cubic-bezier(0, 0, 0.2, 1)'
                            }
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        fadeOut: {
                            '0%': { opacity: '1' },
                            '100%': { opacity: '0' }
                        },
                        slideIn: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(0)' }
                        },
                        slideOut: {
                            '0%': { transform: 'translateX(0)' },
                            '100%': { transform: 'translateX(-100%)' }
                        }
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <style>
        [x-cloak] { display: none !important; }
        .input-number {
            -moz-appearance: textfield;
            appearance: textfield;
        }
        .input-number::-webkit-outer-spin-button,
        .input-number::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        /* Skeleton loading effect */
        .skeleton {
            animation: skeleton-loading 1.5s infinite;
            background-image: linear-gradient(90deg, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0));
            background-size: 200px 100%;
            background-repeat: no-repeat;
            background-position: -200px 0;
        }
        
        @keyframes skeleton-loading {
            100% { background-position: 200px 0; }
        }
        
        .dark .skeleton {
            animation: skeleton-loading-dark 1.5s infinite;
            background-image: linear-gradient(90deg, rgba(50, 50, 50, 0), rgba(50, 50, 50, 0.4), rgba(50, 50, 50, 0));
            background-size: 200px 100%;
            background-repeat: no-repeat;
            background-position: -200px 0;
        }
        
        @keyframes skeleton-loading-dark {
            100% { background-position: 200px 0; }
        }
        
        /* Transitions */
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
        }
        .dark ::-webkit-scrollbar-track {
            background: #374151;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #4B5563;
        }
        .dark ::-webkit-scrollbar-thumb:hover {
            background: #6B7280;
        }
        
        /* Tooltip styles */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltip-text {
            visibility: hidden;
            width: auto;
            min-width: 120px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            white-space: nowrap;
        }
        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: rgba(0, 0, 0, 0.8) transparent transparent transparent;
        }
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        .dark .tooltip .tooltip-text {
            background-color: rgba(255, 255, 255, 0.8);
            color: #000;
        }
        .dark .tooltip .tooltip-text::after {
            border-color: rgba(255, 255, 255, 0.8) transparent transparent transparent;
        }

        /* Dashboard card hover effects */
        .dashboard-card {
            transition: all 0.3s ease;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        /* Calendar styles */
        .calendar-day {
            transition: all 0.2s ease;
        }
        
        .calendar-day:hover:not(.disabled) {
            background-color: rgba(93, 92, 222, 0.1);
        }
        
        .calendar-day.selected {
            background-color: rgba(93, 92, 222, 0.2);
            font-weight: bold;
        }
        
        .calendar-day.current {
            border: 2px solid #5D5CDE;
        }
        
        .calendar-day.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .calendar-day.has-data {
            position: relative;
        }
        
        .calendar-day.has-data::after {
            content: "";
            position: absolute;
            bottom: 3px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background-color: #5D5CDE;
            border-radius: 50%;
        }
        
        /* Print styles */
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                background-color: white !important;
                color: black !important;
            }
            
            .print-full-width {
                width: 100% !important;
                max-width: 100% !important;
            }
            
            .print-break-after {
                page-break-after: always;
            }
        }
        
        /* Touch area increase for mobile */
        @media (max-width: 768px) {
            .touch-target {
                min-height: 44px;
                min-width: 44px;
            }
        }
        
        /* Dark mode transition */
        .dark-transition {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        /* Focus ring accessibility */
        .focus-ring:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.5);
        }
        
        /* Front detail row hover effect */
        .front-detail-row {
            transition: all 0.2s ease;
        }
        
        .front-detail-row:hover {
            background-color: rgba(93, 92, 222, 0.05);
        }
        
        .dark .front-detail-row:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }
        
        /* Loading spinner */
        .loader {
            border-top-color: #5D5CDE;
            animation: spinner 0.6s linear infinite;
        }
        
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Date navigation styles */
        .date-nav-button {
            transition: all 0.2s ease;
        }
        
        .date-nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .date-nav-button:hover:not(:disabled) {
            background-color: rgba(93, 92, 222, 0.1);
        }
        
        .date-has-data {
            position: relative;
        }
        
        .date-has-data::after {
            content: "";
            position: absolute;
            top: -3px;
            right: -3px;
            width: 8px;
            height: 8px;
            background-color: #10B981;
            border-radius: 50%;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen transition-colors duration-200">
    <div class="drawer-wrapper relative">
        <!-- Left Side Drawer -->
        <div id="left-drawer" class="fixed left-0 top-0 h-full w-64 bg-white dark:bg-gray-800 shadow-lg transform -translate-x-full transition-transform duration-300 ease-in-out z-40">
            <div class="p-4 h-full flex flex-col">
                <!-- App Logo in Drawer -->
                <div class="flex items-center mb-8 mt-4">
                    <div class="h-10 w-10 rounded-md bg-primary flex items-center justify-center text-white font-bold text-xl shadow-md">GG</div>
                    <span class="ml-2 font-semibold text-xl text-gray-900 dark:text-gray-100">GGOMES-LOG</span>
                </div>
                
                <!-- Navigation Links -->
                <nav class="flex-1">
                    <ul class="space-y-1">
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md bg-primary text-white" data-page="dashboard">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                                </svg>
                                Dashboard
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="entrega-hora">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                </svg>
                                Entrega por Hora
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="relatorios">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                Análises e Relatórios
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="metas">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Metas e Desempenho
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="historico">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Histórico Diário
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="configuracoes">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                Configurações
                            </a>
                        </li>
                    </ul>
                </nav>
                
                <!-- User section -->
                <div class="border-t border-gray-200 dark:border-gray-700 pt-4 mt-4">
                    <div class="flex items-center">
                        <div class="h-9 w-9 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-800 dark:text-blue-200 font-medium">GG</div>
                        <div class="ml-3">
                            <div class="font-medium text-gray-700 dark:text-gray-300">Gutemberg Gomes</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">Gerente de Operações</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Drawer Backdrop -->
        <div id="drawer-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden transition-opacity duration-300"></div>
        
        <!-- Main Content -->
        <div class="min-h-screen flex flex-col">
            <!-- Top Navigation Bar -->
            <header class="bg-white dark:bg-gray-800 shadow-md sticky top-0 z-10">
                <div class="container mx-auto px-4 py-3">
                    <div class="flex justify-between items-center">
                        <!-- Left Side: Menu Button + Logo -->
                        <div class="flex items-center">
                            <button id="menu-button" class="mr-4 p-2 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary" aria-label="Menu">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                                </svg>
                            </button>
                            <div class="flex items-center">
                                <div class="h-8 w-8 rounded-md bg-primary flex items-center justify-center text-white font-bold text-lg shadow-md">GG</div>
                                <span class="ml-2 font-semibold text-xl text-gray-900 dark:text-gray-100 hidden sm:inline-block">GGOMES-LOG</span>
                            </div>
                        </div>
                        
                        <!-- Center: Date Selector -->
                        <div class="flex items-center space-x-2">
                            <button id="prev-date-btn" class="date-nav-button p-2 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                            </button>
                            <button id="date-selector-btn" class="flex items-center px-3 py-2 bg-gray-100 dark:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                                <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <span id="current-date-display" class="text-sm font-medium">Carregando...</span>
                            </button>
                            <button id="next-date-btn" class="date-nav-button p-2 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Right Side: Actions -->
                        <div class="flex items-center space-x-2 sm:space-x-4">
                            <!-- Current Date Display -->
                            <div class="hidden md:flex items-center mr-4 text-gray-600 dark:text-gray-300">
                                <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <span id="header-date" class="text-sm font-medium"></span>
                            </div>
                            
                            <!-- Search Button -->
                            <button id="search-button" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary" aria-label="Search">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </button>
                            
                            <!-- Notifications -->
                            <div class="relative">
                                <button id="notifications-button" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary" aria-label="Notifications">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                                    </svg>
                                    <span class="absolute top-0 right-0 h-4 w-4 bg-red-500 rounded-full text-xs text-white flex items-center justify-center">3</span>
                                </button>
                                
                                <!-- Notifications Dropdown -->
                                <div id="notifications-dropdown" class="absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-md shadow-lg z-20 hidden transform transition-all duration-300 scale-95 origin-top-right">
                                    <div class="p-3 border-b border-gray-200 dark:border-gray-700">
                                        <div class="flex justify-between items-center">
                                            <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300">Notificações</h3>
                                            <button class="text-xs text-primary hover:text-primary-600 dark:text-primary-300 dark:hover:text-primary-400">Marcar todas como lidas</button>
                                        </div>
                                    </div>
                                    <div class="max-h-80 overflow-y-auto">
                                        <a href="#" class="block p-3 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition duration-150">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-red-100 dark:bg-red-900 flex items-center justify-center text-red-500 dark:text-red-300">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                    </svg>
                                                </div>
                                                <div class="ml-3">
                                                    <p class="text-sm text-gray-700 dark:text-gray-300"><span class="font-medium">Alerta:</span> Entrega abaixo de 50% do potencial na Frente 4001</p>
                                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Há 10 minutos</p>
                                                </div>
                                            </div>
                                        </a>
                                        <a href="#" class="block p-3 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition duration-150">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-500 dark:text-blue-300">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
                                                    </svg>
                                                </div>
                                                <div class="ml-3">
                                                    <p class="text-sm text-gray-700 dark:text-gray-300"><span class="font-medium">Nova mensagem:</span> Carlos Mendes comentou sobre o período 14:00-16:00</p>
                                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Há 30 minutos</p>
                                                </div>
                                            </div>
                                        </a>
                                        <a href="#" class="block p-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition duration-150">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center text-green-500 dark:text-green-300">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                    </svg>
                                                </div>
                                                <div class="ml-3">
                                                    <p class="text-sm text-gray-700 dark:text-gray-300"><span class="font-medium">Meta atingida:</span> Frente 4012 superou a meta diária</p>
                                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Há 1 hora</p>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                    <div class="p-2 border-t border-gray-200 dark:border-gray-700">
                                        <a href="#" class="block text-center text-sm text-primary hover:text-primary-600 dark:text-primary-300 dark:hover:text-primary-400">Ver todas</a>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Theme Toggle -->
                            <button id="theme-toggle" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary" aria-label="Toggle theme">
                                <!-- Sun icon -->
                                <svg id="theme-toggle-light-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" />
                                </svg>
                                <!-- Moon icon -->
                                <svg id="theme-toggle-dark-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
                                </svg>
                            </button>
                            
                            <!-- Save Button -->
                            <button id="save-data" class="bg-primary hover:bg-primary-600 text-white px-3 py-2 rounded-md shadow transition duration-200 flex items-center focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                                <svg class="w-4 h-4 mr-1 sm:mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                                </svg>
                                <span class="hidden sm:inline">Salvar</span>
                            </button>
                            
                            <!-- User Menu -->
                            <div class="relative">
                                <button id="user-menu-button" class="flex text-sm bg-gray-100 dark:bg-gray-700 rounded-full focus:outline-none focus:ring-2 focus:ring-primary" aria-expanded="false" aria-haspopup="true">
                                    <div class="h-8 w-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-800 dark:text-blue-200 font-medium">GG</div>
                                </button>
                                
                                <!-- User Menu Dropdown -->
                                <div id="user-menu-dropdown" class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg z-20 hidden transform transition-all duration-300 scale-95 origin-top-right">
                                    <div class="py-1">
                                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150">Perfil</a>
                                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150">Configurações</a>
                                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150">Suporte</a>
                                        <div class="border-t border-gray-100 dark:border-gray-700"></div>
                                        <a href="#" class="block px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150">Sair</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Search Modal -->
            <div id="search-modal" class="fixed inset-0 z-50 overflow-y-auto hidden">
                <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                    <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                        <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
                    </div>
                    <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full">
                        <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                            <div class="sm:flex sm:items-start">
                                <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                                    <div class="flex items-center justify-between">
                                        <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Pesquisa Rápida</h3>
                                        <button id="close-search-modal" class="text-gray-400 hover:text-gray-500 focus:outline-none">
                                            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>
                                    <div class="mt-4">
                                        <div class="relative">
                                            <input type="text" id="global-search" class="w-full p-3 pl-10 text-gray-900 dark:text-gray-100 bg-gray-100 dark:bg-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-base" placeholder="Pesquisar frentes, períodos, relatórios..." autofocus>
                                            <div class="absolute left-3 top-3 text-gray-400">
                                                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                                </svg>
                                            </div>
                                        </div>
                                        <div class="mt-2 text-sm text-gray-500 dark:text-gray-400 flex items-center justify-between">
                                            <span>
                                                Pressione <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded">Enter</kbd> para pesquisar
                                            </span>
                                            <span>
                                                <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded">ESC</kbd> para fechar
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <!-- Search Results -->
                                    <div class="mt-4 max-h-96 overflow-y-auto">
                                        <h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Resultados Recentes</h4>
                                        <div id="search-results" class="space-y-2">
                                            <a href="#" class="block p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150">
                                                <div class="flex items-center">
                                                    <div class="flex-shrink-0 h-8 w-8 rounded-md bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-500 dark:text-blue-300">
                                                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                                        </svg>
                                                    </div>
                                                    <div class="ml-3">
                                                        <p class="text-sm font-medium text-gray-900 dark:text-gray-100">Frente 4001</p>
                                                        <p class="text-xs text-gray-500 dark:text-gray-400">Entrega por Hora > Período 06:00-08:00</p>
                                                    </div>
                                                </div>
                                            </a>
                                            <a href="#" class="block p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150">
                                                <div class="flex items-center">
                                                    <div class="flex-shrink-0 h-8 w-8 rounded-md bg-green-100 dark:bg-green-900 flex items-center justify-center text-green-500 dark:text-green-300">
                                                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                                        </svg>
                                                    </div>
                                                    <div class="ml-3">
                                                        <p class="text-sm font-medium text-gray-900 dark:text-gray-100">Relatório Mensal</p>
                                                        <p class="text-xs text-gray-500 dark:text-gray-400">Análises e Relatórios > Desempenho Mensal</p>
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                            <button type="button" id="search-execute" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary text-base font-medium text-white hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:ml-3 sm:w-auto sm:text-sm">
                                Pesquisar
                            </button>
                            <button type="button" id="search-cancel" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                                Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Date Selector Modal -->
            <div id="date-selector-modal" class="fixed inset-0 z-50 overflow-y-auto hidden">
                <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                    <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                        <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
                    </div>
                    <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full">
                        <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Selecionar Data</h3>
                                <button id="close-date-selector-modal" class="text-gray-400 hover:text-gray-500 focus:outline-none">
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            
                            <div class="flex justify-between items-center mb-4">
                                <button id="prev-month-btn" class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                    </svg>
                                </button>
                                <div id="date-selector-month-year" class="text-lg font-semibold text-gray-900 dark:text-gray-100">Julho 2025</div>
                                <button id="next-month-btn" class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                </button>
                            </div>
                            
                            <div class="grid grid-cols-7 gap-1 text-center text-xs font-medium text-gray-500 dark:text-gray-400">
                                <div>Dom</div>
                                <div>Seg</div>
                                <div>Ter</div>
                                <div>Qua</div>
                                <div>Qui</div>
                                <div>Sex</div>
                                <div>Sáb</div>
                            </div>
                            
                            <div id="date-selector-days" class="grid grid-cols-7 gap-1 mt-2">
                                <!-- Calendar days will be generated here -->
                            </div>
                            
                            <div class="mt-6 flex justify-between">
                                <button id="today-btn" class="px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition duration-200 focus:outline-none focus:ring-2 focus:ring-primary">
                                    Hoje
                                </button>
                                <button id="new-date-btn" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-600 transition duration-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                                    Nova Data
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content Container -->
            <main class="flex-1 p-4 container mx-auto">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-soft p-6 mb-6">
                    <div class="mb-6 flex flex-col md:flex-row md:justify-between md:items-center space-y-4 md:space-y-0">
                        <div>
                            <h1 id="page-title" class="text-2xl font-bold text-gray-900 dark:text-gray-100">Dashboard</h1>
                            <p id="page-subtitle" class="text-gray-600 dark:text-gray-400 mt-1">Visão geral do desempenho da safra 2025</p>
                        </div>
                        <div class="flex flex-wrap gap-2 items-center">
                            <div class="relative">
                                <select id="period-selector" class="appearance-none bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white dark:focus:bg-gray-800 focus:border-primary transition duration-150 text-base">
                                    <option value="daily">Hoje</option>
                                    <option value="weekly">Esta Semana</option>
                                    <option value="monthly">Este Mês</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300">
                                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                        <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                    </svg>
                                </div>
                            </div>
                            <button id="custom-date-button" class="hidden items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <span id="custom-date-range">Selecionar Datas</span>
                            </button>
                            <button id="export-dashboard" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150 focus:outline-none focus:ring-2 focus:ring-primary">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                                Exportar
                            </button>
                        </div>
                    </div>
                    
                    <!-- Dashboard Content -->
                    <div id="dashboard-content" class="page-content">
                        <!-- Dashboard Stats Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Entregue</p>
                                        <p class="text-2xl font-bold text-gray-900 dark:text-gray-100">3,245.8</p>
                                        <span class="inline-flex items-center text-sm font-medium text-green-600 dark:text-green-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                                            </svg>
                                            12.5% <span class="ml-1 text-gray-500 dark:text-gray-400">vs semana anterior</span>
                                        </span>
                                    </div>
                                    <div class="bg-primary-50 dark:bg-primary-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-primary-500 dark:text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-primary rounded-full h-2" style="width: 85%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">85% da meta mensal</p>
                                </div>
                            </div>
                            
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Eficiência Média</p>
                                        <p class="text-2xl font-bold text-gray-900 dark:text-gray-100">78.4%</p>
                                        <span class="inline-flex items-center text-sm font-medium text-red-600 dark:text-red-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
                                            </svg>
                                            3.2% <span class="ml-1 text-gray-500 dark:text-gray-400">vs semana anterior</span>
                                        </span>
                                    </div>
                                    <div class="bg-blue-50 dark:bg-blue-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-blue-500 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-blue-500 rounded-full h-2" style="width: 78.4%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Meta: 85%</p>
                                </div>
                            </div>
                            
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Viagens Realizadas</p>
                                        <p class="text-2xl font-bold text-gray-900 dark:text-gray-100">1,245</p>
                                        <span class="inline-flex items-center text-sm font-medium text-green-600 dark:text-green-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                                            </svg>
                                            8.7% <span class="ml-1 text-gray-500 dark:text-gray-400">vs semana anterior</span>
                                        </span>
                                    </div>
                                    <div class="bg-green-50 dark:bg-green-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-green-500 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-green-500 rounded-full h-2" style="width: 92%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">92% da meta mensal</p>
                                </div>
                            </div>
                            
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Densidade Média</p>
                                        <p class="text-2xl font-bold text-gray-900 dark:text-gray-100">68.92</p>
                                        <span class="inline-flex items-center text-sm font-medium text-green-600 dark:text-green-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                                            </svg>
                                            1.2% <span class="ml-1 text-gray-500 dark:text-gray-400">vs semana anterior</span>
                                        </span>
                                    </div>
                                    <div class="bg-purple-50 dark:bg-purple-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-purple-500 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-purple-500 rounded-full h-2" style="width: 88%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Meta: 65.00</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Dashboard Main Charts -->
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                            <div class="lg:col-span-2 bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Entrega por Período (06:00-06:00)</h3>
                                    <div class="flex space-x-2">
                                        <button class="period-chart-option px-2 py-1 text-xs font-medium rounded bg-primary text-white" data-period="day">Dia</button>
                                        <button class="period-chart-option px-2 py-1 text-xs font-medium rounded bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600" data-period="week">Semana</button>
                                        <button class="period-chart-option px-2 py-1 text-xs font-medium rounded bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600" data-period="month">Mês</button>
                                    </div>
                                </div>
                                <div class="h-80">
                                    <canvas id="deliveryByPeriodChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Desempenho por Frente</h3>
                                <div class="h-80">
                                    <canvas id="frontPerformanceChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Delivery By Front Chart -->
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm mb-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Total Entregue por Frente (Toneladas)</h3>
                                <div class="flex space-x-2">
                                    <select id="delivery-view-selector" class="text-sm bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded px-2 py-1 text-base">
                                        <option value="absolute">Valores Absolutos</option>
                                        <option value="percentage">Porcentagem do Total</option>
                                    </select>
                                </div>
                            </div>
                            <div class="h-80">
                                <canvas id="deliveryByFrontChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Dashboard Trips and Trucks per Hour -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Viagens por Frente</h3>
                                <div class="h-80">
                                    <canvas id="tripsByFrontChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Média de Caminhões/Hora por Frente</h3>
                                <div class="h-80">
                                    <canvas id="trucksPerHourChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Detailed Front Performance Table -->
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm mb-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Detalhamento por Frente</h3>
                                <button id="refresh-front-details" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-1 px-3 rounded text-sm transition duration-150 focus:outline-none focus:ring-2 focus:ring-primary">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    Atualizar
                                </button>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-800">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Frente</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Total Entregue</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Total Previsto</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Não Entregue</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Eficiência</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Viagens</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Densidade Média</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Progresso</th>
                                        </tr>
                                    </thead>
                                    <tbody id="front-details-table" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <!-- Table rows will be populated by JavaScript -->
                                    </tbody>
                                    <tfoot class="bg-gray-50 dark:bg-gray-700 font-semibold">
                                        <tr>
                                            <td class="px-4 py-3 whitespace-nowrap">TOTAL</td>
                                            <td id="total-entregue" class="px-4 py-3 whitespace-nowrap">0.00</td>
                                            <td id="total-potencial" class="px-4 py-3 whitespace-nowrap">0.00</td>
                                            <td id="total-nao-entregue" class="px-4 py-3 whitespace-nowrap text-danger-600 dark:text-danger-400">0.00</td>
                                            <td id="total-eficiencia" class="px-4 py-3 whitespace-nowrap">0%</td>
                                            <td id="total-viagens" class="px-4 py-3 whitespace-nowrap">0</td>
                                            <td id="total-densidade" class="px-4 py-3 whitespace-nowrap">0.00</td>
                                            <td class="px-4 py-3">
                                                <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5 relative overflow-hidden">
                                                    <div id="total-progress-bar" class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
                                                </div>
                                                <span id="total-progress-text" class="text-xs mt-1 block text-right">0%</span>
                                            </td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Entrega por Hora Content -->
                    <div id="entrega-hora-content" class="page-content hidden">
                        <div class="mb-6 flex flex-col md:flex-row md:justify-between md:items-center space-y-4 md:space-y-0">
                            <div>
                                <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100">Períodos de Entrega</h2>
                                <p class="text-gray-600 dark:text-gray-400 mt-1">Gerencie as entregas por períodos de 2 horas (06:00-06:00)</p>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <button id="manage-fronts" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150 focus:outline-none focus:ring-2 focus:ring-primary">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                    Gerenciar Frentes
                                </button>
                                <button id="clear-period" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150 focus:outline-none focus:ring-2 focus:ring-primary">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                    Limpar Período
                                </button>
                                <button id="copy-previous" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150 focus:outline-none focus:ring-2 focus:ring-primary">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                    </svg>
                                    Copiar Anterior
                                </button>
                                <div class="dropdown relative">
                                    <button id="export-dropdown-btn" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150 focus:outline-none focus:ring-2 focus:ring-primary">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                        </svg>
                                        Exportar
                                        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </button>
                                    <div id="export-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg z-20 transform transition-all duration-300 scale-95 origin-top-right">
                                        <div class="py-1">
                                            <button id="export-json" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150">Exportar JSON</button>
                                            <button id="export-csv" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150">Exportar CSV</button>
                                            <button id="export-pdf" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150">Exportar PDF</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Period Selection Tabs -->
                        <div class="mb-6 overflow-x-auto">
                            <div class="flex space-x-2 min-w-max">
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-primary text-white" data-period="06-08">06:00-08:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="08-10">08:00-10:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="10-12">10:00-12:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="12-14">12:00-14:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="14-16">14:00-16:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="16-18">16:00-18:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="18-20">18:00-20:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="20-22">20:00-22:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="22-00">22:00-00:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="00-02">00:00-02:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="02-04">02:00-04:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="04-06">04:00-06:00</button>
                            </div>
                        </div>
                        
                        <!-- Loading Indicator -->
                        <div id="loading-indicator" class="p-10 text-center hidden">
                            <div class="inline-block border-4 border-gray-300 dark:border-gray-600 border-t-primary h-12 w-12 rounded-full loader"></div>
                            <p class="mt-2 text-gray-600 dark:text-gray-400">Carregando dados...</p>
                        </div>
                        
                        <!-- Time Period Content -->
                        <div id="time-period-content">
                            <!-- Content will be generated dynamically by the generateTimePeriodHTML() function -->
                        </div>
                    </div>
                    
                    <!-- Relatórios Content -->
                    <div id="relatorios-content" class="page-content hidden">
                        <div class="text-center py-10">
                            <div class="inline-block p-6 bg-primary/10 dark:bg-primary/20 rounded-lg">
                                <svg class="w-16 h-16 mx-auto text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                <h2 class="mt-4 text-xl font-bold text-gray-900 dark:text-gray-100">Análises e Relatórios</h2>
                                <p class="mt-2 text-gray-600 dark:text-gray-400">Página em desenvolvimento. Relatórios detalhados e análises estarão disponíveis em breve.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Metas Content -->
                    <div id="metas-content" class="page-content hidden">
                        <div class="text-center py-10">
                            <div class="inline-block p-6 bg-primary/10 dark:bg-primary/20 rounded-lg">
                                <svg class="w-16 h-16 mx-auto text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <h2 class="mt-4 text-xl font-bold text-gray-900 dark:text-gray-100">Metas e Desempenho</h2>
                                <p class="mt-2 text-gray-600 dark:text-gray-400">Página em desenvolvimento. Acompanhamento de metas e desempenho estarão disponíveis em breve.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Histórico Diário Content -->
                    <div id="historico-content" class="page-content hidden">
                        <div class="mb-6">
                            <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100 mb-4">Histórico Diário de Entregas</h2>
                            <p class="text-gray-600 dark:text-gray-400 mb-6">Visualize o histórico de todos os dias com registros de entrega.</p>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                                <div class="flex justify-between items-center mb-6">
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">
                                        <span id="history-month-year">Julho 2025</span>
                                    </h3>
                                    <div class="flex items-center space-x-2">
                                        <button id="history-prev-month" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                            </svg>
                                        </button>
                                        <button id="history-next-month" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-7 gap-1 text-center text-xs font-medium text-gray-500 dark:text-gray-400 mb-2">
                                    <div>Dom</div>
                                    <div>Seg</div>
                                    <div>Ter</div>
                                    <div>Qua</div>
                                    <div>Qui</div>
                                    <div>Sex</div>
                                    <div>Sáb</div>
                                </div>
                                
                                <div id="history-calendar" class="grid grid-cols-7 gap-2">
                                    <!-- Calendar will be generated here -->
                                </div>
                                
                                <div class="mt-6 flex items-center justify-between">
                                    <div class="flex items-center space-x-6">
                                        <div class="flex items-center">
                                            <span class="inline-block w-3 h-3 rounded-full bg-primary mr-2"></span>
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Dia atual</span>
                                        </div>
                                        <div class="flex items-center">
                                            <span class="inline-block w-3 h-3 rounded-full bg-green-500 mr-2"></span>
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Com dados</span>
                                        </div>
                                    </div>
                                    <button id="export-history" class="flex items-center text-sm bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-3 rounded transition duration-150 focus:outline-none focus:ring-2 focus:ring-primary">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                        </svg>
                                        Exportar Histórico
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Daily Summary Table -->
                            <div class="mt-8 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                                <div class="flex justify-between items-center mb-6">
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Sumário de Entregas Diárias</h3>
                                    <select id="history-period-filter" class="text-sm bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded px-3 py-2 text-base">
                                        <option value="all">Todos os períodos</option>
                                        <option value="06-08">06:00-08:00</option>
                                        <option value="08-10">08:00-10:00</option>
                                        <option value="10-12">10:00-12:00</option>
                                        <option value="12-14">12:00-14:00</option>
                                        <option value="14-16">14:00-16:00</option>
                                        <option value="16-18">16:00-18:00</option>
                                        <option value="18-20">18:00-20:00</option>
                                        <option value="20-22">20:00-22:00</option>
                                        <option value="22-00">22:00-00:00</option>
                                        <option value="00-02">00:00-02:00</option>
                                        <option value="02-04">02:00-04:00</option>
                                        <option value="04-06">04:00-06:00</option>
                                    </select>
                                </div>
                                
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-800">
                                            <tr>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Data</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Total Entregue</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Total Previsto</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Eficiência</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Viagens</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Densidade Média</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="history-table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <!-- Table rows will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div id="history-empty-state" class="py-12 text-center">
                                    <svg class="w-16 h-16 mx-auto text-gray-300 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                    <p class="mt-4 text-gray-500 dark:text-gray-400">Nenhum registro de entrega encontrado para o período selecionado.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Configurações Content -->
                    <div id="configuracoes-content" class="page-content hidden">
                        <div class="max-w-2xl mx-auto">
                            <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100 mb-6">Configurações do Sistema</h2>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden mb-6">
                                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">Preferências Gerais</h3>
                                </div>
                                <div class="p-4 space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Salvar Automaticamente</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Salva automaticamente as alterações</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="auto-save-toggle" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Intervalo de Salvamento (minutos)</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Frequência do salvamento automático</p>
                                        </div>
                                        <div class="w-20">
                                            <input type="number" id="auto-save-interval" class="w-full px-3 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary text-base" min="1" max="60" value="5">
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Modo Escuro</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Alterna entre o tema claro e escuro</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="dark-mode-toggle" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden mb-6">
                                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">Notificações e Alertas</h3>
                                </div>
                                <div class="p-4 space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Limiar de Alerta (%)</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Porcentagem abaixo da meta para disparar alerta</p>
                                        </div>
                                        <div class="w-20">
                                            <input type="number" id="alert-threshold" class="w-full px-3 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary text-base" min="1" max="50" value="10">
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Alertas Sonoros</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Emite sons para alertas importantes</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="sound-alert-toggle" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Alertas Visuais</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Mostra notificações na interface</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="visual-alert-toggle" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-end space-x-3">
                                <button id="restore-defaults" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary transition duration-150">
                                    Restaurar Padrões
                                </button>
                                <button id="save-config" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition duration-150">
                                    Salvar Configurações
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            
            <!-- Footer -->
            <footer class="bg-white dark:bg-gray-800 shadow-md mt-auto">
                <div class="container mx-auto px-4 py-4">
                    <div class="flex flex-col md:flex-row justify-between items-center">
                        <div class="text-sm text-gray-600 dark:text-gray-400 mb-4 md:mb-0">
                            © 2025 GGOMES-LOG - Gestão de Entrega de Safra
                        </div>
                        <div class="flex space-x-4">
                            <a href="#" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary-300 transition-colors duration-150">Termos de Uso</a>
                            <a href="#" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary-300 transition-colors duration-150">Política de Privacidade</a>
                            <a href="#" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary-300 transition-colors duration-150">Suporte</a>
                            <span class="text-sm text-gray-400 dark:text-gray-500">Versão 5.0.0</span>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    
    <!-- Calendar Modal -->
    <div id="calendar-modal" class="fixed inset-0 z-50 overflow-y-auto hidden">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
            </div>
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Selecionar Período</h3>
                                <button id="close-calendar-modal" class="text-gray-400 hover:text-gray-500 focus:outline-none">
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="mt-4">
                                <div class="flex justify-between items-center mb-4">
                                    <button id="prev-month" class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                        </svg>
                                    </button>
                                    <div id="current-month-year" class="text-lg font-semibold text-gray-900 dark:text-gray-100">Julho 2024</div>
                                    <button id="next-month" class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                        </svg>
                                    </button>
                                </div>
                                
                                <div class="grid grid-cols-7 gap-1 text-center text-xs font-medium text-gray-500 dark:text-gray-400">
                                    <div>Dom</div>
                                    <div>Seg</div>
                                    <div>Ter</div>
                                    <div>Qua</div>
                                    <div>Qui</div>
                                    <div>Sex</div>
                                    <div>Sáb</div>
                                </div>
                                
                                <div id="calendar-days" class="grid grid-cols-7 gap-1 mt-2">
                                    <!-- Calendar days will be generated here -->
                                </div>
                                
                                <div class="mt-4">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Período Selecionado</span>
                                    </div>
                                    <div class="flex space-x-2">
                                        <div class="flex-1">
                                            <label for="start-date" class="block text-xs text-gray-500 dark:text-gray-400">Início</label>
                                            <input type="text" id="start-date" class="block w-full p-2 text-sm bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md text-base" readonly>
                                        </div>
                                        <div class="flex-1">
                                            <label for="end-date" class="block text-xs text-gray-500 dark:text-gray-400">Fim</label>
                                            <input type="text" id="end-date" class="block w-full p-2 text-sm bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md text-base" readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="apply-date-range" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary text-base font-medium text-white hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:ml-3 sm:w-auto sm:text-sm">
                        Aplicar
                    </button>
                    <button type="button" id="cancel-date-range" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Manage Fronts Modal -->
    <div id="manage-fronts-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-lg w-full relative z-10 shadow-lg transform transition-all duration-300 scale-95 opacity-0">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-gray-900 dark:text-gray-100">Gerenciar Frentes</h3>
                <button id="close-fronts-modal" class="text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary rounded">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="mb-6">
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Adicione ou remova frentes de entrega. Ao remover uma frente, todos os dados associados serão excluídos.</p>
                
                <!-- Add new front -->
                <div class="flex items-end space-x-2 mb-4">
                    <div class="flex-1">
                        <label for="new-front-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nova Frente</label>
                        <input type="text" id="new-front-input" placeholder="Ex: 4010" class="w-full px-3 py-2 text-base text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <button id="add-front-btn" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-600 transition duration-200 flex items-center focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        Adicionar
                    </button>
                </div>
                
                <!-- Current fronts list -->
                <div class="border border-gray-200 dark:border-gray-700 rounded-md overflow-hidden">
                    <div class="bg-gray-50 dark:bg-gray-700 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                        Frentes Atuais
                    </div>
                    <ul id="fronts-list" class="divide-y divide-gray-200 dark:divide-gray-700 max-h-60 overflow-y-auto">
                        <!-- Fronts will be added here dynamically -->
                    </ul>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3">
                <button id="cancel-fronts-modal" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition duration-200 focus:outline-none focus:ring-2 focus:ring-primary">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50 transition-opacity duration-300"></div>
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full relative z-10 shadow-lg transform transition-all duration-300 scale-95 opacity-0">
            <h3 id="modal-title" class="text-lg font-bold text-gray-900 dark:text-gray-100 mb-4">Confirmação</h3>
            <p id="modal-message" class="text-gray-700 dark:text-gray-300 mb-6">Tem certeza que deseja realizar esta ação?</p>
            <div class="flex justify-end space-x-3">
                <button id="modal-cancel" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition duration-200 focus:outline-none focus:ring-2 focus:ring-primary">
                    Cancelar
                </button>
                <button id="modal-confirm" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-600 transition duration-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 flex flex-col-reverse space-y-reverse space-y-2"></div>

    <script>
        // App Module Pattern
        const App = (function() {
            // Cache DOM elements for improved performance
            const elements = {};
            
            // State
            const state = {
                // Front data
                fronts: ['4001', '4002', '4007', '4009'],
                hours: [6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 0, 1, 2, 3, 4, 5],
                timePeriodsMap: {
                    '06-08': [6, 7],
                    '08-10': [8, 9],
                    '10-12': [10, 11],
                    '12-14': [12, 13],
                    '14-16': [14, 15],
                    '16-18': [16, 17],
                    '18-20': [18, 19],
                    '20-22': [20, 21],
                    '22-00': [22, 23],
                    '00-02': [0, 1],
                    '02-04': [2, 3],
                    '04-06': [4, 5]
                },
                
                // Date tracking
                currentDate: new Date().toISOString().split('T')[0], // Current date in YYYY-MM-DD format
                availableDates: [], // List of dates with data
                
                // Delivery data - organized by date
                density: {},
                trips: {},
                delivery: {},
                potential: {},
                
                // Period summaries - organized by date
                twoHourDelivery: {},
                twoHourPotential: {},
                difference: {},
                
                // Charts
                charts: {},
                
                // Current active period
                activePeriod: '06-08',
                currentPage: 'dashboard',
                
                // Config
                config: {
                    autoSave: true,
                    autoSaveInterval: 5, // minutes
                    darkMode: false,
                    alertThreshold: 10, // %
                    soundAlerts: false,
                    visualAlerts: true
                },
                
                // Date & calendar
                calendar: {
                    startDate: null,
                    endDate: null,
                    currentMonth: new Date().getMonth(),
                    currentYear: new Date().getFullYear()
                },
                
                // History
                history: [],
                
                // Analytics data
                analytics: {
                    periodData: {
                        day: {
                            // Initialize with all 12 periods for full 24-hour cycle (06:00-06:00)
                            labels: [
                                "06:00-08:00", "08:00-10:00", "10:00-12:00", "12:00-14:00", 
                                "14:00-16:00", "16:00-18:00", "18:00-20:00", "20:00-22:00", 
                                "22:00-00:00", "00:00-02:00", "02:00-04:00", "04:00-06:00"
                            ],
                            datasets: [
                                { label: "Entregas", data: [553, 621, 485, 392, 574, 483, 420, 380, 310, 270, 250, 290] },
                                { label: "Potencial", data: [650, 650, 650, 650, 650, 650, 500, 450, 400, 350, 300, 450] }
                            ]
                        },
                        week: {
                            labels: ["Segunda", "Terça", "Quarta", "Quinta", "Sexta", "Sábado", "Domingo"],
                            datasets: [
                                { label: "Entregas", data: [2850, 3100, 2950, 3200, 3400, 2900, 2600] },
                                { label: "Potencial", data: [3500, 3500, 3500, 3500, 3500, 3500, 3500] }
                            ]
                        },
                        month: {
                            labels: ["Semana 1", "Semana 2", "Semana 3", "Semana 4"],
                            datasets: [
                                { label: "Entregas", data: [18000, 19500, 20100, 21000] },
                                { label: "Potencial", data: [22000, 22000, 22000, 22000] }
                            ]
                        }
                    },
                    frontPerformance: {
                        labels: ["F4001", "F4002", "F4007", "F4009"],
                        datasets: [
                            { label: "Eficiência", data: [85, 72, 91, 68] }
                        ]
                    },
                    tripsByFront: {
                        labels: ["F4001", "F4002", "F4007", "F4009"],
                        datasets: [
                            { label: "Viagens", data: [250, 320, 180, 275] }
                        ]
                    },
                    trucksPerHour: {
                        labels: ["F4001", "F4002", "F4007", "F4009"],
                        datasets: [
                            { label: "Caminhões/Hora", data: [5.2, 6.7, 3.8, 5.7] }
                        ]
                    },
                    deliveryByFront: {
                        labels: ["F4001", "F4002", "F4007", "F4009"],
                        datasets: [
                            { 
                                label: "Total Entregue (ton)", 
                                data: [865.3, 932.8, 710.5, 737.2],
                                backgroundColor: [
                                    'rgba(93, 92, 222, 0.7)',
                                    'rgba(16, 185, 129, 0.7)',
                                    'rgba(245, 158, 11, 0.7)',
                                    'rgba(14, 165, 233, 0.7)'
                                ],
                                borderColor: [
                                    'rgba(93, 92, 222, 1)',
                                    'rgba(16, 185, 129, 1)',
                                    'rgba(245, 158, 11, 1)',
                                    'rgba(14, 165, 233, 1)'
                                ],
                                borderWidth: 1
                            }
                        ]
                    }
                }
            };
            
            // Auto save timer
            let autoSaveTimer = null;

            // Cache DOM elements for frequently used elements
            const cacheElements = () => {
                // Navigation elements
                elements.drawer = document.getElementById('left-drawer');
                elements.drawerBackdrop = document.getElementById('drawer-backdrop');
                elements.menuButton = document.getElementById('menu-button');
                elements.drawerLinks = document.querySelectorAll('.drawer-link');
                
                // Date navigation elements
                elements.currentDateDisplay = document.getElementById('current-date-display');
                elements.prevDateBtn = document.getElementById('prev-date-btn');
                elements.nextDateBtn = document.getElementById('next-date-btn');
                elements.dateSelectorBtn = document.getElementById('date-selector-btn');
                elements.dateSelectorModal = document.getElementById('date-selector-modal');
                elements.dateSelectorDays = document.getElementById('date-selector-days');
                elements.dateSelectorMonthYear = document.getElementById('date-selector-month-year');
                
                // Page elements
                elements.pageTitle = document.getElementById('page-title');
                elements.pageSubtitle = document.getElementById('page-subtitle');
                elements.pageContents = document.querySelectorAll('.page-content');
                
                // Dashboard elements
                elements.deliveryByPeriodChart = document.getElementById('deliveryByPeriodChart');
                elements.frontPerformanceChart = document.getElementById('frontPerformanceChart');
                elements.deliveryByFrontChart = document.getElementById('deliveryByFrontChart');
                elements.tripsByFrontChart = document.getElementById('tripsByFrontChart');
                elements.trucksPerHourChart = document.getElementById('trucksPerHourChart');
                elements.frontDetailsTable = document.getElementById('front-details-table');
                
                // Entrega por Hora elements
                elements.timePeriodContent = document.getElementById('time-period-content');
                elements.loadingIndicator = document.getElementById('loading-indicator');
                elements.timeTabButtons = document.querySelectorAll('.time-tab-btn');
                
                // History elements
                elements.historyCalendar = document.getElementById('history-calendar');
                elements.historyMonthYear = document.getElementById('history-month-year');
                elements.historyTableBody = document.getElementById('history-table-body');
                elements.historyEmptyState = document.getElementById('history-empty-state');
                
                // Modals
                elements.searchModal = document.getElementById('search-modal');
                elements.calendarModal = document.getElementById('calendar-modal');
                elements.manageFrontsModal = document.getElementById('manage-fronts-modal');
                elements.confirmationModal = document.getElementById('confirmation-modal');
                
                // Dropdowns
                elements.notificationsDropdown = document.getElementById('notifications-dropdown');
                elements.userMenuDropdown = document.getElementById('user-menu-dropdown');
                elements.exportDropdown = document.getElementById('export-dropdown');
                
                // Buttons
                elements.saveDataBtn = document.getElementById('save-data');
                elements.themeToggle = document.getElementById('theme-toggle');
                elements.searchButton = document.getElementById('search-button');
                elements.exportDashboardBtn = document.getElementById('export-dashboard');
                elements.refreshFrontDetailsBtn = document.getElementById('refresh-front-details');
                elements.manageFrontsBtn = document.getElementById('manage-fronts');
                elements.clearPeriodBtn = document.getElementById('clear-period');
                elements.copyPreviousBtn = document.getElementById('copy-previous');
                
                // Toast container
                elements.toastContainer = document.getElementById('toast-container');
            };
            
            // Initialize data structures
            const initializeDataStructures = () => {
                // Initialize date entry for current date if it doesn't exist
                if (!state.density[state.currentDate]) {
                    state.density[state.currentDate] = {};
                    state.trips[state.currentDate] = {};
                    state.delivery[state.currentDate] = {};
                    state.potential[state.currentDate] = {};
                    state.twoHourDelivery[state.currentDate] = {};
                    state.twoHourPotential[state.currentDate] = {};
                    state.difference[state.currentDate] = {};
                    
                    // Add to available dates
                    if (!state.availableDates.includes(state.currentDate)) {
                        state.availableDates.push(state.currentDate);
                        state.availableDates.sort();
                    }
                }
                
                // Initialize delivery data structures for current date
                for (const front of state.fronts) {
                    if (!state.density[state.currentDate][front]) {
                        state.density[state.currentDate][front] = {};
                    }
                    if (!state.trips[state.currentDate][front]) {
                        state.trips[state.currentDate][front] = {};
                    }
                    if (!state.delivery[state.currentDate][front]) {
                        state.delivery[state.currentDate][front] = {};
                    }
                    if (!state.potential[state.currentDate][front]) {
                        state.potential[state.currentDate][front] = {};
                    }
                    
                    for (const hour of state.hours) {
                        if (state.density[state.currentDate][front][hour] === undefined) {
                            state.density[state.currentDate][front][hour] = 0;
                        }
                        if (state.trips[state.currentDate][front][hour] === undefined) {
                            state.trips[state.currentDate][front][hour] = 0;
                        }
                        if (state.delivery[state.currentDate][front][hour] === undefined) {
                            state.delivery[state.currentDate][front][hour] = 0;
                        }
                        if (state.potential[state.currentDate][front][hour] === undefined) {
                            state.potential[state.currentDate][front][hour] = 0;
                        }
                    }
                }
                
                // Initialize period summaries for current date
                for (const period in state.timePeriodsMap) {
                    if (!state.twoHourDelivery[state.currentDate][period]) {
                        state.twoHourDelivery[state.currentDate][period] = {};
                    }
                    if (!state.twoHourPotential[state.currentDate][period]) {
                        state.twoHourPotential[state.currentDate][period] = {};
                    }
                    if (!state.difference[state.currentDate][period]) {
                        state.difference[state.currentDate][period] = {};
                    }
                    
                    for (const front of state.fronts) {
                        if (state.twoHourDelivery[state.currentDate][period][front] === undefined) {
                            state.twoHourDelivery[state.currentDate][period][front] = 0;
                        }
                        if (state.twoHourPotential[state.currentDate][period][front] === undefined) {
                            state.twoHourPotential[state.currentDate][period][front] = 0;
                        }
                        if (state.difference[state.currentDate][period][front] === undefined) {
                            state.difference[state.currentDate][period][front] = 0;
                        }
                    }
                }
            };

            // Setup event listeners
            const setupEventListeners = () => {
                // Menu toggle
                elements.menuButton?.addEventListener('click', () => toggleDrawer());
                elements.drawerBackdrop?.addEventListener('click', () => toggleDrawer(false));
                
                // Page navigation
                elements.drawerLinks.forEach(link => {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        const page = this.getAttribute('data-page');
                        showPage(page);
                        toggleDrawer(false);
                    });
                });
                
                // Theme toggle
                elements.themeToggle?.addEventListener('click', toggleDarkMode);
                
                // Save data
                elements.saveDataBtn?.addEventListener('click', () => {
                    saveData();
                    showToast('Dados salvos com sucesso!', 'success');
                });
                
                // Search button
                elements.searchButton?.addEventListener('click', () => toggleModal(elements.searchModal, true));
                
                // Export dashboard
                elements.exportDashboardBtn?.addEventListener('click', exportDashboard);
                
                // Refresh front details
                elements.refreshFrontDetailsBtn?.addEventListener('click', updateDetailedFrontTable);
                
                // Manage fronts
                elements.manageFrontsBtn?.addEventListener('click', showManageFrontsModal);
                
                // Clear period
                elements.clearPeriodBtn?.addEventListener('click', (e) => {
                    e.preventDefault();
                    showConfirmationModal(
                        'Limpar Período',
                        `Tem certeza que deseja limpar todos os dados do período ${state.activePeriod} para a data ${formatDateDisplay(state.currentDate)}?`,
                        clearCurrentPeriod
                    );
                });
                
                // Copy previous period
                elements.copyPreviousBtn?.addEventListener('click', (e) => {
                    e.preventDefault();
                    copyPreviousPeriod();
                });
                
                // Time tab buttons
                elements.timeTabButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const period = this.getAttribute('data-period');
                        switchTimePeriodTab(period);
                    });
                });
                
                // Period chart options
                document.querySelectorAll('.period-chart-option').forEach(option => {
                    option.addEventListener('click', function() {
                        const period = this.getAttribute('data-period');
                        updatePeriodChart(period);
                        
                        // Update active state
                        document.querySelectorAll('.period-chart-option').forEach(btn => {
                            btn.classList.remove('bg-primary', 'text-white');
                            btn.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                        });
                        this.classList.add('bg-primary', 'text-white');
                        this.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                    });
                });
                
                // Date selector button
                elements.dateSelectorBtn?.addEventListener('click', function() {
                    showDateSelectorModal();
                });
                
                // Previous date button
                elements.prevDateBtn?.addEventListener('click', function() {
                    navigateDate(-1);
                });
                
                // Next date button
                elements.nextDateBtn?.addEventListener('click', function() {
                    navigateDate(1);
                });
                
                // Date selector modal close button
                document.getElementById('close-date-selector-modal')?.addEventListener('click', function() {
                    toggleModal(elements.dateSelectorModal, false);
                });
                
                // Date selector month navigation
                document.getElementById('prev-month-btn')?.addEventListener('click', function() {
                    navigateDateSelectorMonth(-1);
                });
                
                document.getElementById('next-month-btn')?.addEventListener('click', function() {
                    navigateDateSelectorMonth(1);
                });
                
                // Today button
                document.getElementById('today-btn')?.addEventListener('click', function() {
                    const today = new Date().toISOString().split('T')[0];
                    changeCurrentDate(today);
                    toggleModal(elements.dateSelectorModal, false);
                });
                
                // New date button
                document.getElementById('new-date-btn')?.addEventListener('click', function() {
                    const date = new Date(state.calendar.currentYear, state.calendar.currentMonth, 1);
                    const newDate = date.toISOString().split('T')[0];
                    changeCurrentDate(newDate);
                    toggleModal(elements.dateSelectorModal, false);
                });
                
                // Custom date range
                document.getElementById('period-selector')?.addEventListener('change', function() {
                    const customDateButton = document.getElementById('custom-date-button');
                    if (this.value === 'custom' && customDateButton) {
                        customDateButton.classList.remove('hidden');
                        customDateButton.classList.add('flex');
                    } else if (customDateButton) {
                        customDateButton.classList.add('hidden');
                        customDateButton.classList.remove('flex');
                    }
                });
                
                // Custom date button
                document.getElementById('custom-date-button')?.addEventListener('click', function() {
                    generateCalendarDays();
                    toggleModal(elements.calendarModal, true);
                });
                
                // Calendar navigation
                document.getElementById('prev-month')?.addEventListener('click', function() {
                    state.calendar.currentMonth--;
                    if (state.calendar.currentMonth < 0) {
                        state.calendar.currentMonth = 11;
                        state.calendar.currentYear--;
                    }
                    generateCalendarDays();
                });
                
                document.getElementById('next-month')?.addEventListener('click', function() {
                    state.calendar.currentMonth++;
                    if (state.calendar.currentMonth > 11) {
                        state.calendar.currentMonth = 0;
                        state.calendar.currentYear++;
                    }
                    generateCalendarDays();
                });
                
                // Calendar modal buttons
                document.getElementById('close-calendar-modal')?.addEventListener('click', () => toggleModal(elements.calendarModal, false));
                document.getElementById('cancel-date-range')?.addEventListener('click', () => toggleModal(elements.calendarModal, false));
                document.getElementById('apply-date-range')?.addEventListener('click', function() {
                    if (state.calendar.startDate && state.calendar.endDate) {
                        const startDateStr = formatDate(state.calendar.startDate);
                        const endDateStr = formatDate(state.calendar.endDate);
                        
                        const customDateRangeEl = document.getElementById('custom-date-range');
                        if (customDateRangeEl) {
                            customDateRangeEl.textContent = `${startDateStr} - ${endDateStr}`;
                        }
                    }
                    
                    toggleModal(elements.calendarModal, false);
                });
                
                // Confirmation modal buttons
                document.getElementById('modal-cancel')?.addEventListener('click', () => toggleModal(elements.confirmationModal, false));
                
                // Manage fronts modal buttons
                document.getElementById('close-fronts-modal')?.addEventListener('click', () => toggleModal(elements.manageFrontsModal, false));
                document.getElementById('cancel-fronts-modal')?.addEventListener('click', () => toggleModal(elements.manageFrontsModal, false));
                document.getElementById('add-front-btn')?.addEventListener('click', addFront);
                
                // Export dropdown toggle
                document.getElementById('export-dropdown-btn')?.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    toggleDropdown(elements.exportDropdown);
                });
                
                // Export buttons
                document.getElementById('export-json')?.addEventListener('click', (e) => {
                    e.preventDefault();
                    exportJSON();
                    toggleDropdown(elements.exportDropdown, false);
                });
                
                document.getElementById('export-csv')?.addEventListener('click', (e) => {
                    e.preventDefault();
                    exportCSV();
                    toggleDropdown(elements.exportDropdown, false);
                });
                
                document.getElementById('export-pdf')?.addEventListener('click', (e) => {
                    e.preventDefault();
                    exportPDF();
                    toggleDropdown(elements.exportDropdown, false);
                });
                
                // Notifications dropdown toggle
                document.getElementById('notifications-button')?.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleDropdown(elements.notificationsDropdown);
                });
                
                // User menu dropdown toggle
                document.getElementById('user-menu-button')?.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleDropdown(elements.userMenuDropdown);
                });
                
                // Close dropdowns when clicking elsewhere
                document.addEventListener('click', function(e) {
                    const dropdowns = [elements.notificationsDropdown, elements.userMenuDropdown, elements.exportDropdown];
                    dropdowns.forEach(dropdown => {
                        if (dropdown && !dropdown.classList.contains('hidden')) {
                            toggleDropdown(dropdown, false);
                        }
                    });
                });
                
                // Search modal buttons
                document.getElementById('close-search-modal')?.addEventListener('click', () => toggleModal(elements.searchModal, false));
                document.getElementById('search-cancel')?.addEventListener('click', () => toggleModal(elements.searchModal, false));
                document.getElementById('search-execute')?.addEventListener('click', performSearch);
                
                // Global keyboard shortcuts
                document.addEventListener('keydown', function(e) {
                    // Ctrl + K for search
                    if (e.ctrlKey && e.key === 'k') {
                        e.preventDefault();
                        toggleModal(elements.searchModal, true);
                    }
                    
                    // Alt + M for menu
                    if (e.altKey && e.key === 'm') {
                        e.preventDefault();
                        toggleDrawer();
                    }
                    
                    // Ctrl + S for save
                    if (e.ctrlKey && e.key === 's') {
                        e.preventDefault();
                        saveData();
                        showToast('Dados salvos com sucesso!', 'success');
                    }
                    
                    // Alt + 1-6 for navigation
                    if (e.altKey && !isNaN(parseInt(e.key)) && parseInt(e.key) >= 1 && parseInt(e.key) <= 6) {
                        e.preventDefault();
                        const pages = ['dashboard', 'entrega-hora', 'relatorios', 'metas', 'historico', 'configuracoes'];
                        const index = parseInt(e.key) - 1;
                        
                        if (index < pages.length) {
                            showPage(pages[index]);
                        }
                    }
                    
                    // Ctrl + D for dark mode toggle
                    if (e.ctrlKey && e.key === 'd') {
                        e.preventDefault();
                        toggleDarkMode();
                    }
                    
                    // Alt + Left Arrow for previous day
                    if (e.altKey && e.key === 'ArrowLeft') {
                        e.preventDefault();
                        navigateDate(-1);
                    }
                    
                    // Alt + Right Arrow for next day
                    if (e.altKey && e.key === 'ArrowRight') {
                        e.preventDefault();
                        navigateDate(1);
                    }
                    
                    // Escape to close modals
                    if (e.key === 'Escape') {
                        const activeModals = document.querySelectorAll('.fixed.inset-0:not(.hidden)');
                        if (activeModals.length > 0) {
                            e.preventDefault();
                            activeModals.forEach(modal => {
                                if (modal.id === 'search-modal') toggleModal(elements.searchModal, false);
                                if (modal.id === 'calendar-modal') toggleModal(elements.calendarModal, false);
                                if (modal.id === 'date-selector-modal') toggleModal(elements.dateSelectorModal, false);
                                if (modal.id === 'manage-fronts-modal') toggleModal(elements.manageFrontsModal, false);
                                if (modal.id === 'confirmation-modal') toggleModal(elements.confirmationModal, false);
                            });
                        }
                    }
                });
                
                // Delivery view selector change
                document.getElementById('delivery-view-selector')?.addEventListener('change', function() {
                    updateDeliveryByFrontChart(this.value);
                });
                
                // Configuration form
                document.getElementById('save-config')?.addEventListener('click', function() {
                    updateConfigFromUI();
                    saveConfig();
                    showToast('Configurações salvas com sucesso!', 'success');
                });
                
                document.getElementById('restore-defaults')?.addEventListener('click', function() {
                    showConfirmationModal(
                        'Restaurar Padrões',
                        'Tem certeza que deseja restaurar todas as configurações para os valores padrão?',
                        restoreDefaultConfig
                    );
                });
                
                // New front input form
                const newFrontInput = document.getElementById('new-front-input');
                if (newFrontInput) {
                    newFrontInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            addFront();
                        }
                    });
                }
                
                // History navigation
                document.getElementById('history-prev-month')?.addEventListener('click', function() {
                    navigateHistoryMonth(-1);
                });
                
                document.getElementById('history-next-month')?.addEventListener('click', function() {
                    navigateHistoryMonth(1);
                });
                
                // History period filter
                document.getElementById('history-period-filter')?.addEventListener('change', function() {
                    updateHistoryTable();
                });
                
                // Export history
                document.getElementById('export-history')?.addEventListener('click', exportHistoryData);
                
                // Dark mode detection
                if (window.matchMedia) {
                    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                        if (event.matches) {
                            document.documentElement.classList.add('dark');
                            state.config.darkMode = true;
                        } else {
                            document.documentElement.classList.remove('dark');
                            state.config.darkMode = false;
                        }
                        
                        updateDarkModeToggle();
                        updateChartsTheme();
                    });
                }
            };
            
            // Toggle drawer visibility
            const toggleDrawer = (show) => {
                if (!elements.drawer || !elements.drawerBackdrop) return;
                
                if (show === undefined) {
                    show = elements.drawer.classList.contains('-translate-x-full');
                }
                
                if (show) {
                    elements.drawer.classList.remove('-translate-x-full');
                    elements.drawerBackdrop.classList.remove('hidden');
                    setTimeout(() => {
                        elements.drawerBackdrop.classList.add('bg-opacity-50');
                        elements.drawerBackdrop.classList.remove('bg-opacity-0');
                    }, 10);
                } else {
                    elements.drawer.classList.add('-translate-x-full');
                    elements.drawerBackdrop.classList.add('bg-opacity-0');
                    elements.drawerBackdrop.classList.remove('bg-opacity-50');
                    setTimeout(() => {
                        elements.drawerBackdrop.classList.add('hidden');
                    }, 300);
                }
            };
            
            // Toggle dropdown visibility
            const toggleDropdown = (dropdown, show) => {
                if (!dropdown) return;
                
                if (show === undefined) {
                    show = dropdown.classList.contains('hidden');
                }
                
                if (show) {
                    dropdown.classList.remove('hidden', 'scale-95', 'opacity-0');
                    dropdown.classList.add('block', 'scale-100', 'opacity-100');
                } else {
                    dropdown.classList.add('scale-95', 'opacity-0');
                    dropdown.classList.remove('scale-100', 'opacity-100');
                    setTimeout(() => {
                        dropdown.classList.add('hidden');
                        dropdown.classList.remove('block');
                    }, 200);
                }
            };
            
            // Toggle modal visibility with animation
            const toggleModal = (modal, show) => {
                if (!modal) return;
                
                if (show) {
                    modal.classList.remove('hidden');
                    
                    // If it's a fixed-position modal with inner content
                    const innerModal = modal.querySelector('.scale-95, .opacity-0');
                    if (innerModal) {
                        setTimeout(() => {
                            innerModal.classList.remove('scale-95', 'opacity-0');
                            innerModal.classList.add('scale-100', 'opacity-100');
                        }, 10);
                    }
                    
                    // Focus first input if exists
                    const firstInput = modal.querySelector('input:not([readonly])');
                    if (firstInput) {
                        setTimeout(() => firstInput.focus(), 100);
                    }
                } else {
                    // If it's a fixed-position modal with inner content
                    const innerModal = modal.querySelector('.scale-100, .opacity-100');
                    if (innerModal) {
                        innerModal.classList.remove('scale-100', 'opacity-100');
                        innerModal.classList.add('scale-95', 'opacity-0');
                        setTimeout(() => {
                            modal.classList.add('hidden');
                        }, 200);
                    } else {
                        modal.classList.add('hidden');
                    }
                }
            };
            
            // Show page
            const showPage = (page) => {
                state.currentPage = page;
                
                // Update page title and subtitle
                if (elements.pageTitle && elements.pageSubtitle) {
                    switch (page) {
                        case 'dashboard':
                            elements.pageTitle.textContent = 'Dashboard';
                            elements.pageSubtitle.textContent = 'Visão geral do desempenho da safra 2025';
                            break;
                        case 'entrega-hora':
                            elements.pageTitle.textContent = 'Entrega por Hora';
                            elements.pageSubtitle.textContent = 'Gerencie o registro de entregas por período';
                            break;
                        case 'relatorios':
                            elements.pageTitle.textContent = 'Análises e Relatórios';
                            elements.pageSubtitle.textContent = 'Relatórios detalhados e análises de desempenho';
                            break;
                        case 'metas':
                            elements.pageTitle.textContent = 'Metas e Desempenho';
                            elements.pageSubtitle.textContent = 'Acompanhe o progresso das metas estabelecidas';
                            break;
                        case 'historico':
                            elements.pageTitle.textContent = 'Histórico Diário';
                            elements.pageSubtitle.textContent = 'Visualize e compare dados de dias anteriores';
                            break;
                        case 'configuracoes':
                            elements.pageTitle.textContent = 'Configurações';
                            elements.pageSubtitle.textContent = 'Ajuste as configurações do sistema';
                            break;
                    }
                }
                
                // Hide all pages
                elements.pageContents.forEach(content => {
                    content.classList.add('hidden');
                });
                
                // Show selected page
                const pageContent = document.getElementById(`${page}-content`);
                if (pageContent) {
                    pageContent.classList.remove('hidden');
                    
                    // If showing the entrega-hora page, generate the time period HTML
                    if (page === 'entrega-hora') {
                        generateTimePeriodHTML();
                    }
                    
                    // If showing the dashboard, update the dashboard with current data
                    if (page === 'dashboard') {
                        updateDashboardCharts();
                        updateDetailedFrontTable();
                    }
                    
                    // If showing the history page, update the history calendar and table
                    if (page === 'historico') {
                        updateHistoryCalendar();
                        updateHistoryTable();
                    }
                } else {
                    // If page doesn't exist, show dashboard
                    const dashboardContent = document.getElementById('dashboard-content');
                    if (dashboardContent) dashboardContent.classList.remove('hidden');
                }
                
                // Update navigation active state
                elements.drawerLinks.forEach(link => {
                    link.classList.remove('bg-primary', 'text-white');
                    link.classList.add('text-gray-700', 'dark:text-gray-300');
                    
                    if (link.getAttribute('data-page') === page) {
                        link.classList.add('bg-primary', 'text-white');
                        link.classList.remove('text-gray-700', 'dark:text-gray-300');
                    }
                });
            };
            
            // Toggle dark mode
            const toggleDarkMode = () => {
                if (document.documentElement.classList.contains('dark')) {
                    document.documentElement.classList.remove('dark');
                    state.config.darkMode = false;
                } else {
                    document.documentElement.classList.add('dark');
                    state.config.darkMode = true;
                }
                
                updateDarkModeToggle();
                updateChartsTheme();
                saveConfig();
            };
            
            // Update dark mode toggle UI
            const updateDarkModeToggle = () => {
                const lightIcon = document.getElementById('theme-toggle-light-icon');
                const darkIcon = document.getElementById('theme-toggle-dark-icon');
                const darkModeCheckbox = document.getElementById('dark-mode-toggle');
                
                const isDark = document.documentElement.classList.contains('dark');
                
                if (lightIcon) lightIcon.classList.toggle('hidden', !isDark);
                if (darkIcon) darkIcon.classList.toggle('hidden', isDark);
                if (darkModeCheckbox) darkModeCheckbox.checked = isDark;
            };
            
            // Show date selector modal
            const showDateSelectorModal = () => {
                if (!elements.dateSelectorModal) return;
                
                // Set current month and year to match the currently selected date
                const [year, month] = state.currentDate.split('-');
                state.calendar.currentMonth = parseInt(month) - 1;
                state.calendar.currentYear = parseInt(year);
                
                // Generate days for date selector
                generateDateSelectorDays();
                
                // Show the modal
                toggleModal(elements.dateSelectorModal, true);
            };
            
            // Generate days for date selector calendar
            const generateDateSelectorDays = () => {
                if (!elements.dateSelectorDays || !elements.dateSelectorMonthYear) return;
                
                // Clear previous calendar
                elements.dateSelectorDays.innerHTML = '';
                
                // Set month and year display
                const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                elements.dateSelectorMonthYear.textContent = `${monthNames[state.calendar.currentMonth]} ${state.calendar.currentYear}`;
                
                // Get first day of month and number of days
                const firstDay = new Date(state.calendar.currentYear, state.calendar.currentMonth, 1).getDay();
                const daysInMonth = new Date(state.calendar.currentYear, state.calendar.currentMonth + 1, 0).getDate();
                
                // Add empty cells for days before the first day of month
                for (let i = 0; i < firstDay; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = 'h-10';
                    elements.dateSelectorDays.appendChild(emptyCell);
                }
                
                // Add days
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayCell = document.createElement('div');
                    const currentDate = new Date(state.calendar.currentYear, state.calendar.currentMonth, day);
                    currentDate.setHours(0, 0, 0, 0);
                    const dateStr = currentDate.toISOString().split('T')[0];
                    
                    dayCell.className = 'calendar-day h-10 flex items-center justify-center rounded-full cursor-pointer';
                    
                    // Highlight current date
                    if (dateStr === state.currentDate) {
                        dayCell.classList.add('bg-primary', 'text-white');
                    }
                    
                    // Highlight today
                    if (currentDate.getTime() === today.getTime()) {
                        dayCell.classList.add('border-2', 'border-primary');
                    }
                    
                    // Mark dates with data
                    if (state.availableDates.includes(dateStr)) {
                        dayCell.classList.add('has-data');
                    }
                    
                    dayCell.textContent = day;
                    dayCell.setAttribute('data-date', dateStr);
                    
                    // Add click event to select date
                    dayCell.addEventListener('click', function() {
                        const selectedDate = this.getAttribute('data-date');
                        if (selectedDate) {
                            changeCurrentDate(selectedDate);
                            toggleModal(elements.dateSelectorModal, false);
                        }
                    });
                    
                    elements.dateSelectorDays.appendChild(dayCell);
                }
            };
            
            // Navigate date selector month
            const navigateDateSelectorMonth = (direction) => {
                state.calendar.currentMonth += direction;
                if (state.calendar.currentMonth > 11) {
                    state.calendar.currentMonth = 0;
                    state.calendar.currentYear++;
                } else if (state.calendar.currentMonth < 0) {
                    state.calendar.currentMonth = 11;
                    state.calendar.currentYear--;
                }
                
                generateDateSelectorDays();
            };
            
            // Navigate to previous or next date
            const navigateDate = (direction) => {
                // Get current date as Date object
                const currentDate = new Date(state.currentDate);
                
                // Add or subtract days
                currentDate.setDate(currentDate.getDate() + direction);
                
                // Convert back to YYYY-MM-DD format
                const newDate = currentDate.toISOString().split('T')[0];
                
                // Change current date
                changeCurrentDate(newDate);
            };
            
            // Change current date
            const changeCurrentDate = (newDate) => {
                // Store the old date
                const oldDate = state.currentDate;
                
                // Update current date
                state.currentDate = newDate;
                
                // Initialize data structures for the new date if they don't exist
                initializeDataStructures();
                
                // Update date display
                updateDateDisplay();
                
                // Regenerate time period HTML if on that page
                if (state.currentPage === 'entrega-hora') {
                    generateTimePeriodHTML();
                }
                
                // Update dashboard if on that page
                if (state.currentPage === 'dashboard') {
                    updateDashboardCharts();
                    updateDetailedFrontTable();
                }
                
                // Update date navigation buttons
                updateDateNavigationButtons();
                
                // Show a toast notification
                if (oldDate !== newDate) {
                    const formattedDate = formatDateDisplay(newDate);
                    showToast(`Data alterada para ${formattedDate}`, 'info');
                }
            };
            
            // Update date display
            const updateDateDisplay = () => {
                if (elements.currentDateDisplay) {
                    elements.currentDateDisplay.textContent = formatDateDisplay(state.currentDate);
                }
                
                // Update header date (current system date)
                const headerDate = document.getElementById('header-date');
                if (headerDate) {
                    const now = new Date();
                    const dateOptions = { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' };
                    const formattedDate = now.toLocaleDateString('pt-BR', dateOptions);
                    headerDate.textContent = formattedDate;
                }
            };
            
            // Update date navigation buttons
            const updateDateNavigationButtons = () => {
                // Disable/enable previous date button based on available dates
                if (elements.prevDateBtn) {
                    const prevDate = new Date(state.currentDate);
                    prevDate.setDate(prevDate.getDate() - 1);
                    const prevDateStr = prevDate.toISOString().split('T')[0];
                    elements.prevDateBtn.disabled = false;
                }
                
                // Next date button should never go beyond today
                if (elements.nextDateBtn) {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    const currentDate = new Date(state.currentDate);
                    currentDate.setHours(0, 0, 0, 0);
                    
                    elements.nextDateBtn.disabled = currentDate >= today;
                }
            };
            
            // Format date for display (DD/MM/YYYY)
            const formatDateDisplay = (dateStr) => {
                if (!dateStr) return '';
                
                const date = new Date(dateStr);
                const day = date.getDate().toString().padStart(2, '0');
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const year = date.getFullYear();
                
                // Get day of week
                const weekdays = ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'];
                const dayOfWeek = weekdays[date.getDay()];
                
                return `${dayOfWeek}, ${day}/${month}/${year}`;
            };
            
            // Calculate delivery based on density and trips for the current date
            const calculateDelivery = () => {
                for (const front of state.fronts) {
                    for (const hour of state.hours) {
                        if (state.density[state.currentDate] && 
                            state.density[state.currentDate][front] && 
                            state.trips[state.currentDate] && 
                            state.trips[state.currentDate][front]) {
                            state.delivery[state.currentDate][front][hour] = 
                                state.density[state.currentDate][front][hour] * state.trips[state.currentDate][front][hour];
                        }
                    }
                }
            };
            
            // Calculate two-hour totals for periods for the current date
            const calculateTwoHourTotals = () => {
                for (const period in state.timePeriodsMap) {
                    const hours = state.timePeriodsMap[period];
                    
                    for (const front of state.fronts) {
                        // Calculate two-hour delivery total
                        state.twoHourDelivery[state.currentDate][period][front] = hours.reduce((sum, hour) => {
                            return sum + (state.delivery[state.currentDate][front][hour] || 0);
                        }, 0);
                        
                        // Calculate two-hour potential (use the odd hour's potential * 2)
                        const oddHour = hours.find(h => h % 2 !== 0) || hours[0];
                        state.twoHourPotential[state.currentDate][period][front] = 
                            (state.potential[state.currentDate][front][oddHour] || 0) * 2;
                        
                        // Calculate difference
                        state.difference[state.currentDate][period][front] = 
                            state.twoHourDelivery[state.currentDate][period][front] - 
                            state.twoHourPotential[state.currentDate][period][front];
                    }
                }
            };
            
            // Generate time period HTML
            const generateTimePeriodHTML = () => {
                showLoading(true);
                
                if (!elements.timePeriodContent) {
                    showLoading(false);
                    return;
                }
                
                elements.timePeriodContent.innerHTML = '';
                
                for (const period in state.timePeriodsMap) {
                    const hours = state.timePeriodsMap[period];
                    
                    const periodDiv = document.createElement('div');
                    periodDiv.id = `period-${period}`;
                    periodDiv.className = 'period-content' + (period === state.activePeriod ? '' : ' hidden');
                    
                    let periodHTML = `
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">`;
                    
                    for (const hour of hours) {
                        let hasPotencial = hour % 2 !== 0; // Only odd hours have potential
                        
                        periodHTML += `
                        <div class="overflow-hidden rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                            <div class="bg-gray-100 dark:bg-gray-700 py-2 px-4 flex justify-between items-center">
                                <h3 class="text-lg font-semibold text-primary dark:text-primary-300 flex items-center">
                                    <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    ${hour.toString().padStart(2, '0')}:00
                                </h3>
                                <div class="flex items-center text-sm">
                                    <span class="text-gray-600 dark:text-gray-400 flex items-center mr-3">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16" />
                                        </svg>
                                        <span class="total-viagens-badge" data-hour="${hour}">0</span> viagens
                                    </span>
                                    <span class="text-primary dark:text-primary-300 flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" />
                                        </svg>
                                        <span class="total-entrega-badge" data-hour="${hour}">0.00</span> ton
                                    </span>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-800">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Frentes</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Densid.</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Viagens</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Entrega</th>
                                            ${hasPotencial ? '<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Pot. Hora</th>' : ''}
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">`;
                        
                        for (const front of state.fronts) {
                            const densityValue = state.density[state.currentDate]?.[front]?.[hour] || 0;
                            const tripsValue = state.trips[state.currentDate]?.[front]?.[hour] || 0;
                            const deliveryValue = state.delivery[state.currentDate]?.[front]?.[hour] || 0;
                            const potentialValue = state.potential[state.currentDate]?.[front]?.[hour] || 0;
                            
                            periodHTML += `
                                        <tr>
                                            <td class="px-4 py-3 whitespace-nowrap">
                                                <span class="font-medium">F${front}</span>
                                            </td>
                                            <td class="px-4 py-3 whitespace-nowrap">
                                                <input type="number" class="input-number densidade w-20 text-right border rounded px-2 py-1 dark:bg-gray-700 text-base" data-hour="${hour}" data-front="${front}" value="${densityValue}" min="0" step="0.01">
                                            </td>
                                            <td class="px-4 py-3 whitespace-nowrap">
                                                <input type="number" class="input-number viagens w-20 text-right border rounded px-2 py-1 dark:bg-gray-700 text-base" data-hour="${hour}" data-front="${front}" value="${tripsValue}" min="0">
                                            </td>
                                            <td class="px-4 py-3 whitespace-nowrap">
                                                <span class="entrega font-medium ${deliveryValue > 0 ? 'text-success-600 dark:text-success-400' : ''}" data-hour="${hour}" data-front="${front}">${deliveryValue.toFixed(2)}</span>
                                            </td>
                                            ${hasPotencial ? `<td class="px-4 py-3 whitespace-nowrap">
                                                <input type="number" class="input-number potencial w-20 text-right border rounded px-2 py-1 dark:bg-gray-700 text-base" data-hour="${hour}" data-front="${front}" value="${potentialValue}" min="0">
                                            </td>` : ''}
                                        </tr>`;
                        }
                        
                        periodHTML += `
                                    </tbody>
                                    <tfoot class="bg-gray-50 dark:bg-gray-700 font-semibold">
                                        <tr>
                                            <td class="px-4 py-3 whitespace-nowrap">TOTAL</td>
                                            <td class="px-4 py-3 whitespace-nowrap"></td>
                                            <td class="px-4 py-3 whitespace-nowrap total-viagens" data-hour="${hour}">0</td>
                                            <td class="px-4 py-3 whitespace-nowrap total-entrega" data-hour="${hour}">0.00</td>
                                            ${hasPotencial ? `<td class="px-4 py-3 whitespace-nowrap total-potencial" data-hour="${hour}">0</td>` : ''}
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>`;
                    }
                    
                    periodHTML += `
                    </div>

                    <!-- Period Summary -->
                    <div class="mt-6 overflow-hidden rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                        <div class="bg-gray-100 dark:bg-gray-700 py-2 px-4">
                            <h3 class="text-lg font-semibold text-primary dark:text-primary-300 flex items-center">
                                <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                RESUMO DO PERÍODO (${period.substring(0, 2)}:00-${period.substring(3, 5)}:00)
                            </h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-800">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Frentes</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">2 Horas</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Potencial 2H</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Diferença</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">% Realizado</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">`;
                    
                    for (const front of state.fronts) {
                        const twoHourDelivery = state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0;
                        const twoHourPotential = state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0;
                        const difference = state.difference[state.currentDate]?.[period]?.[front] || 0;
                        const percentage = twoHourPotential > 0 ? (twoHourDelivery / twoHourPotential) * 100 : 0;
                        
                        periodHTML += `
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap font-semibold">F${front}</td>
                                        <td class="px-4 py-3 whitespace-nowrap duas-horas" data-period="${period}" data-front="${front}">${twoHourDelivery.toFixed(2)}</td>
                                        <td class="px-4 py-3 whitespace-nowrap potencial-2h" data-period="${period}" data-front="${front}">${twoHourPotential}</td>
                                        <td class="px-4 py-3 whitespace-nowrap diff ${difference < 0 ? 'text-red-600 dark:text-red-400' : (difference > 0 ? 'text-green-600 dark:text-green-400' : '')}" data-period="${period}" data-front="${front}">${difference.toFixed(2)}</td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5 relative overflow-hidden">
                                                <div class="percent-bar ${getProgressBarColor(percentage)} h-2.5 rounded-full" data-period="${period}" data-front="${front}" style="width: ${Math.min(100, percentage)}%"></div>
                                            </div>
                                            <span class="text-xs mt-1 block text-right percent-text" data-period="${period}" data-front="${front}">${percentage.toFixed(1)}%</span>
                                        </td>
                                    </tr>`;
                    }
                    
                    // Calculate period totals
                    let totalTwoHourDelivery = 0;
                    let totalTwoHourPotential = 0;
                    let totalDifference = 0;
                    
                    for (const front of state.fronts) {
                        totalTwoHourDelivery += state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0;
                        totalTwoHourPotential += state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0;
                        totalDifference += state.difference[state.currentDate]?.[period]?.[front] || 0;
                    }
                    
                    const totalPercentage = totalTwoHourPotential > 0 ? (totalTwoHourDelivery / totalTwoHourPotential) * 100 : 0;
                    
                    periodHTML += `
                                </tbody>
                                <tfoot class="bg-gray-50 dark:bg-gray-700 font-semibold">
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap">TOTAL</td>
                                        <td class="px-4 py-3 whitespace-nowrap total-duas-horas" data-period="${period}">${totalTwoHourDelivery.toFixed(2)}</td>
                                        <td class="px-4 py-3 whitespace-nowrap total-potencial-2h" data-period="${period}">${totalTwoHourPotential}</td>
                                        <td class="px-4 py-3 whitespace-nowrap total-diff ${totalDifference < 0 ? 'text-red-600 dark:text-red-400' : (totalDifference > 0 ? 'text-green-600 dark:text-green-400' : '')}" data-period="${period}">${totalDifference.toFixed(2)}</td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5 relative overflow-hidden">
                                                <div class="total-percent-bar ${getProgressBarColor(totalPercentage)} h-2.5 rounded-full" data-period="${period}" style="width: ${Math.min(100, totalPercentage)}%"></div>
                                            </div>
                                            <span class="text-xs mt-1 block text-right total-percent-text" data-period="${period}">${totalPercentage.toFixed(1)}%</span>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>`;
                    
                    periodDiv.innerHTML = periodHTML;
                    elements.timePeriodContent.appendChild(periodDiv);
                }
                
                // Add event listeners to newly generated elements
                setupDynamicEventListeners();
                
                // Update the UI with current data
                updateUI();
                
                showLoading(false);
            };
            
            // Setup dynamic event listeners for generated elements
            const setupDynamicEventListeners = () => {
                // Input changes for delivery data
                document.querySelectorAll('.densidade, .viagens, .potencial').forEach(input => {
                    input.addEventListener('input', handleDeliveryDataChange);
                    
                    // Add number input controls
                    input.addEventListener('keydown', function(e) {
                        if (e.key === 'ArrowUp') {
                            e.preventDefault();
                            const step = this.classList.contains('densidade') ? 0.01 : 1;
                            this.value = (parseFloat(this.value) + step).toFixed(this.classList.contains('densidade') ? 2 : 0);
                            this.dispatchEvent(new Event('input'));
                        } else if (e.key === 'ArrowDown') {
                            e.preventDefault();
                            const step = this.classList.contains('densidade') ? 0.01 : 1;
                            const newValue = Math.max(0, parseFloat(this.value) - step);
                            this.value = newValue.toFixed(this.classList.contains('densidade') ? 2 : 0);
                            this.dispatchEvent(new Event('input'));
                        }
                    });
                });
            };
            
            // Handle delivery data change
            const handleDeliveryDataChange = (e) => {
                const hour = parseInt(e.target.getAttribute('data-hour'));
                const front = e.target.getAttribute('data-front');
                const value = parseFloat(e.target.value) || 0;
                
                if (e.target.classList.contains('densidade')) {
                    state.density[state.currentDate][front][hour] = value;
                } else if (e.target.classList.contains('viagens')) {
                    state.trips[state.currentDate][front][hour] = value;
                } else if (e.target.classList.contains('potencial')) {
                    state.potential[state.currentDate][front][hour] = value;
                }
                
                calculateDelivery();
                calculateTwoHourTotals();
                updateUI();
                
                // Add current date to available dates if not already there
                if (!state.availableDates.includes(state.currentDate)) {
                    state.availableDates.push(state.currentDate);
                    state.availableDates.sort();
                }
                
                // Add to history for undo/redo
                addToHistory('data-change', { date: state.currentDate, hour, front, field: e.target.classList[1], value });
            };
            
            // Update UI
            const updateUI = () => {
                updateDeliveryUI();
                updateCharts();
                
                // Update the detailed front table if on dashboard
                if (state.currentPage === 'dashboard') {
                    updateDetailedFrontTable();
                }
            };
            
            // Update delivery UI elements
            const updateDeliveryUI = () => {
                // Update delivery values for all hours
                document.querySelectorAll('.entrega').forEach(element => {
                    const hour = parseInt(element.getAttribute('data-hour'));
                    const front = element.getAttribute('data-front');
                    const value = state.delivery[state.currentDate]?.[front]?.[hour] || 0;
                    element.textContent = value.toFixed(2);
                    
                    // Add color based on value
                    element.classList.remove('text-success-600', 'dark:text-success-400', 'text-danger-600', 'dark:text-danger-400');
                    if (value > 0) {
                        element.classList.add('text-success-600', 'dark:text-success-400');
                    }
                });
                
                // Update total trips and delivery per hour
                for (const hour of state.hours) {
                    const totalTripsElement = document.querySelector(`.total-viagens[data-hour="${hour}"]`);
                    const totalDeliveryElement = document.querySelector(`.total-entrega[data-hour="${hour}"]`);
                    const totalPotentialElement = document.querySelector(`.total-potencial[data-hour="${hour}"]`);
                    
                    const totalTripsBadge = document.querySelector(`.total-viagens-badge[data-hour="${hour}"]`);
                    const totalEntregaBadge = document.querySelector(`.total-entrega-badge[data-hour="${hour}"]`);
                    
                    let totalTrips = 0;
                    let totalDelivery = 0;
                    let totalPotential = 0;
                    
                    for (const front of state.fronts) {
                        totalTrips += state.trips[state.currentDate]?.[front]?.[hour] || 0;
                        totalDelivery += state.delivery[state.currentDate]?.[front]?.[hour] || 0;
                        if (hour % 2 !== 0) { // Only odd hours have potential
                            totalPotential += state.potential[state.currentDate]?.[front]?.[hour] || 0;
                        }
                    }
                    
                    if (totalTripsElement || totalTripsBadge) {
                        if (totalTripsElement) totalTripsElement.textContent = totalTrips;
                        if (totalTripsBadge) totalTripsBadge.textContent = totalTrips;
                    }
                    
                    if (totalDeliveryElement || totalEntregaBadge) {
                        if (totalDeliveryElement) totalDeliveryElement.textContent = totalDelivery.toFixed(2);
                        if (totalEntregaBadge) totalEntregaBadge.textContent = totalDelivery.toFixed(2);
                    }
                    
                    if (totalPotentialElement && hour % 2 !== 0) { // Only odd hours have potential
                        totalPotentialElement.textContent = totalPotential;
                    }
                }
                
                // Update two-hour summaries for all periods
                for (const period in state.timePeriodsMap) {
                    for (const front of state.fronts) {
                        const duasHorasElement = document.querySelector(`.duas-horas[data-period="${period}"][data-front="${front}"]`);
                        const potencial2hElement = document.querySelector(`.potencial-2h[data-period="${period}"][data-front="${front}"]`);
                        const diffElement = document.querySelector(`.diff[data-period="${period}"][data-front="${front}"]`);
                        const percentBar = document.querySelector(`.percent-bar[data-period="${period}"][data-front="${front}"]`);
                        const percentText = document.querySelector(`.percent-text[data-period="${period}"][data-front="${front}"]`);
                        
                        const twoHourDelivery = state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0;
                        const twoHourPotential = state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0;
                        const difference = state.difference[state.currentDate]?.[period]?.[front] || 0;
                        
                        if (duasHorasElement && potencial2hElement && diffElement) {
                            duasHorasElement.textContent = twoHourDelivery.toFixed(2);
                            potencial2hElement.textContent = twoHourPotential;
                            diffElement.textContent = difference.toFixed(2);
                            
                            // Color-code differences
                            diffElement.classList.remove('text-red-600', 'dark:text-red-400', 'text-green-600', 'dark:text-green-400');
                            if (difference < 0) {
                                diffElement.classList.add('text-red-600', 'dark:text-red-400');
                            } else if (difference > 0) {
                                diffElement.classList.add('text-green-600', 'dark:text-green-400');
                            }
                            
                            // Update percentage bar
                            if (percentBar && percentText) {
                                const percentage = twoHourPotential > 0 ? (twoHourDelivery / twoHourPotential) * 100 : 0;
                                
                                percentBar.style.width = `${Math.min(percentage, 100)}%`;
                                percentText.textContent = `${percentage.toFixed(1)}%`;
                                
                                // Update color based on percentage
                                percentBar.className = `percent-bar ${getProgressBarColor(percentage)} h-2.5 rounded-full`;
                            }
                        }
                    }
                    
                    // Update two-hour totals
                    const totalDuasHorasElement = document.querySelector(`.total-duas-horas[data-period="${period}"]`);
                    const totalPotencial2hElement = document.querySelector(`.total-potencial-2h[data-period="${period}"]`);
                    const totalDiffElement = document.querySelector(`.total-diff[data-period="${period}"]`);
                    const totalPercentBar = document.querySelector(`.total-percent-bar[data-period="${period}"]`);
                    const totalPercentText = document.querySelector(`.total-percent-text[data-period="${period}"]`);
                    
                    if (totalDuasHorasElement && totalPotencial2hElement && totalDiffElement) {
                        let totalDuasHoras = 0;
                        let totalPotencial2h = 0;
                        
                        for (const front of state.fronts) {
                            totalDuasHoras += state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0;
                            totalPotencial2h += state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0;
                        }
                        
                        const totalDiff = totalDuasHoras - totalPotencial2h;
                        
                        totalDuasHorasElement.textContent = totalDuasHoras.toFixed(2);
                        totalPotencial2hElement.textContent = totalPotencial2h;
                        totalDiffElement.textContent = totalDiff.toFixed(2);
                        
                        // Color-code total difference
                        totalDiffElement.classList.remove('text-red-600', 'dark:text-red-400', 'text-green-600', 'dark:text-green-400');
                        if (totalDiff < 0) {
                            totalDiffElement.classList.add('text-red-600', 'dark:text-red-400');
                        } else if (totalDiff > 0) {
                            totalDiffElement.classList.add('text-green-600', 'dark:text-green-400');
                        }
                        
                        // Update total percentage bar
                        if (totalPercentBar && totalPercentText) {
                            const percentage = totalPotencial2h > 0 ? (totalDuasHoras / totalPotencial2h) * 100 : 0;
                            
                            totalPercentBar.style.width = `${Math.min(percentage, 100)}%`;
                            totalPercentText.textContent = `${percentage.toFixed(1)}%`;
                            
                            // Update color based on percentage
                            totalPercentBar.className = `total-percent-bar ${getProgressBarColor(percentage)} h-2.5 rounded-full`;
                        }
                    }
                }
            };
            
            // Initialize charts
            const initializeCharts = () => {
                // Check if Chart.js is loaded
                if (typeof Chart === 'undefined') {
                    console.error('Chart.js is not loaded. Charts will not be initialized.');
                    return;
                }
                
                // Check if the ChartDataLabels plugin is loaded
                if (typeof ChartDataLabels !== 'undefined') {
                    // Register Chart.js plugins
                    Chart.register(ChartDataLabels);
                }
                
                // Default chart options
                const defaultOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderWidth: 0,
                            cornerRadius: 4,
                            padding: 10,
                            displayColors: true
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    family: 'Inter, system-ui, sans-serif',
                                    size: 12
                                },
                                usePointStyle: true,
                                padding: 15
                            }
                        }
                    },
                    elements: {
                        line: {
                            tension: 0.4
                        },
                        point: {
                            radius: 4,
                            hitRadius: 10,
                            hoverRadius: 6
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)',
                                drawBorder: false
                            },
                            ticks: {
                                font: {
                                    family: 'Inter, system-ui, sans-serif',
                                    size: 10
                                },
                                padding: 8,
                                maxRotation: 45, // Rotate labels for better fit with more periods
                                minRotation: 45
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)',
                                drawBorder: false
                            },
                            ticks: {
                                font: {
                                    family: 'Inter, system-ui, sans-serif',
                                    size: 11
                                },
                                padding: 8
                            },
                            beginAtZero: true
                        }
                    }
                };
                
                // Create each chart
                createDeliveryByPeriodChart(defaultOptions);
                createFrontPerformanceChart(defaultOptions);
                createDeliveryByFrontChart(defaultOptions);
                createTripsByFrontChart(defaultOptions);
                createTrucksPerHourChart(defaultOptions);
                
                // Apply dark mode to charts if needed
                if (document.documentElement.classList.contains('dark')) {
                    updateChartsTheme();
                }
            };
            
            // Create delivery by period chart
            const createDeliveryByPeriodChart = (defaultOptions) => {
                const ctx = elements.deliveryByPeriodChart?.getContext('2d');
                if (!ctx) return;
                
                const periodLabels = state.analytics.periodData.day.labels;
                const deliveryData = state.analytics.periodData.day.datasets[0].data;
                const potentialData = state.analytics.periodData.day.datasets[1].data;
                
                state.charts.deliveryByPeriod = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: periodLabels,
                        datasets: [
                            {
                                label: 'Entregas',
                                data: deliveryData,
                                backgroundColor: 'rgba(93, 92, 222, 0.7)',
                                borderColor: 'rgba(93, 92, 222, 1)',
                                borderWidth: 1,
                                barPercentage: 0.7,
                                categoryPercentage: 0.9,
                                order: 2
                            },
                            {
                                label: 'Potencial',
                                data: potentialData,
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                borderColor: 'rgba(16, 185, 129, 1)',
                                borderWidth: 1,
                                borderDash: [5, 5],
                                type: 'line',
                                fill: false,
                                pointStyle: 'rectRounded',
                                pointRadius: 5,
                                pointHoverRadius: 7,
                                tension: 0.4,
                                order: 1
                            }
                        ]
                    },
                    options: {
                        ...defaultOptions,
                        scales: {
                            ...defaultOptions.scales,
                            y: {
                                ...defaultOptions.scales.y,
                                title: {
                                    display: true,
                                    text: 'Toneladas'
                                }
                            },
                            x: {
                                ...defaultOptions.scales.x,
                                title: {
                                    display: true,
                                    text: 'Períodos'
                                }
                            }
                        },
                        plugins: {
                            ...defaultOptions.plugins,
                            tooltip: {
                                ...defaultOptions.plugins.tooltip,
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.raw.toFixed(2)} ton`;
                                    }
                                }
                            },
                            datalabels: {
                                display: function(context) {
                                    // Only show data labels for the bar dataset
                                    return context.datasetIndex === 0;
                                },
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value.toFixed(0) + ' t',
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold',
                                    size: 10 // Smaller font for more periods
                                }
                            }
                        }
                    }
                });
            };
            
            // Create front performance chart
            const createFrontPerformanceChart = (defaultOptions) => {
                const ctx = elements.frontPerformanceChart?.getContext('2d');
                if (!ctx) return;
                
                const frontLabels = state.analytics.frontPerformance.labels;
                const efficiencyData = state.analytics.frontPerformance.datasets[0].data;
                
                state.charts.frontPerformance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: frontLabels,
                        datasets: [
                            {
                                label: 'Eficiência (%)',
                                data: efficiencyData,
                                backgroundColor: efficiencyData.map(value => getEfficiencyColorGradient(value)),
                                borderWidth: 0,
                                borderRadius: 4,
                                barPercentage: 0.6,
                                categoryPercentage: 0.8
                            }
                        ]
                    },
                    options: {
                        ...defaultOptions,
                        scales: {
                            ...defaultOptions.scales,
                            y: {
                                ...defaultOptions.scales.y,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Eficiência (%)'
                                }
                            }
                        },
                        plugins: {
                            ...defaultOptions.plugins,
                            legend: {
                                display: false
                            },
                            tooltip: {
                                ...defaultOptions.plugins.tooltip,
                                callbacks: {
                                    label: function(context) {
                                        return `Eficiência: ${context.raw}%`;
                                    }
                                }
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value + '%',
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            };
            
            // Create delivery by front chart
            const createDeliveryByFrontChart = (defaultOptions) => {
                const ctx = elements.deliveryByFrontChart?.getContext('2d');
                if (!ctx) return;
                
                const frontLabels = state.analytics.deliveryByFront.labels;
                const deliveryData = state.analytics.deliveryByFront.datasets[0].data;
                const backgroundColors = state.analytics.deliveryByFront.datasets[0].backgroundColor;
                
                state.charts.deliveryByFront = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: frontLabels,
                        datasets: [
                            {
                                label: 'Total Entregue (ton)',
                                data: deliveryData,
                                backgroundColor: backgroundColors,
                                borderColor: state.analytics.deliveryByFront.datasets[0].borderColor,
                                borderWidth: 1,
                                borderRadius: 4,
                                barPercentage: 0.6,
                                categoryPercentage: 0.8
                            }
                        ]
                    },
                    options: {
                        ...defaultOptions,
                        scales: {
                            ...defaultOptions.scales,
                            y: {
                                ...defaultOptions.scales.y,
                                title: {
                                    display: true,
                                    text: 'Toneladas'
                                }
                            }
                        },
                        plugins: {
                            ...defaultOptions.plugins,
                            legend: {
                                display: false
                            },
                            tooltip: {
                                ...defaultOptions.plugins.tooltip,
                                callbacks: {
                                    label: function(context) {
                                        if (document.getElementById('delivery-view-selector')?.value === 'percentage') {
                                            return `Contribuição: ${context.raw.toFixed(1)}%`;
                                        } else {
                                            return `Total Entregue: ${context.raw.toFixed(2)} ton`;
                                        }
                                    }
                                }
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: function(value, context) {
                                    if (document.getElementById('delivery-view-selector')?.value === 'percentage') {
                                        return value.toFixed(1) + '%';
                                    } else {
                                        return value.toFixed(1) + ' t';
                                    }
                                },
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            };
            
            // Create trips by front chart
            const createTripsByFrontChart = (defaultOptions) => {
                const ctx = elements.tripsByFrontChart?.getContext('2d');
                if (!ctx) return;
                
                const frontLabels = state.analytics.tripsByFront.labels;
                const tripsData = state.analytics.tripsByFront.datasets[0].data;
                
                state.charts.tripsByFront = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: frontLabels,
                        datasets: [
                            {
                                label: 'Viagens Entregues',
                                data: tripsData,
                                backgroundColor: 'rgba(14, 165, 233, 0.7)', // Sky blue color
                                borderColor: 'rgba(14, 165, 233, 1)',
                                borderWidth: 1,
                                borderRadius: 4,
                                barPercentage: 0.6,
                                categoryPercentage: 0.8
                            }
                        ]
                    },
                    options: {
                        ...defaultOptions,
                        scales: {
                            ...defaultOptions.scales,
                            y: {
                                ...defaultOptions.scales.y,
                                title: {
                                    display: true,
                                    text: 'Número de Viagens'
                                }
                            }
                        },
                        plugins: {
                            ...defaultOptions.plugins,
                            legend: {
                                display: false
                            },
                            tooltip: {
                                ...defaultOptions.plugins.tooltip,
                                callbacks: {
                                    label: function(context) {
                                        return `Viagens: ${context.raw}`;
                                    }
                                }
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value,
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            };
            
            // Create trucks per hour chart
            const createTrucksPerHourChart = (defaultOptions) => {
                const ctx = elements.trucksPerHourChart?.getContext('2d');
                if (!ctx) return;
                
                const frontLabels = state.analytics.trucksPerHour.labels;
                const trucksData = state.analytics.trucksPerHour.datasets[0].data;
                
                state.charts.trucksPerHour = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: frontLabels,
                        datasets: [
                            {
                                label: 'Caminhões por Hora',
                                data: trucksData,
                                backgroundColor: 'rgba(249, 115, 22, 0.7)', // Orange color
                                borderColor: 'rgba(249, 115, 22, 1)',
                                borderWidth: 1,
                                borderRadius: 4,
                                barPercentage: 0.6,
                                categoryPercentage: 0.8
                            }
                        ]
                    },
                    options: {
                        ...defaultOptions,
                        scales: {
                            ...defaultOptions.scales,
                            y: {
                                ...defaultOptions.scales.y,
                                title: {
                                    display: true,
                                    text: 'Caminhões/Hora'
                                }
                            }
                        },
                        plugins: {
                            ...defaultOptions.plugins,
                            legend: {
                                display: false
                            },
                            tooltip: {
                                ...defaultOptions.plugins.tooltip,
                                callbacks: {
                                    label: function(context) {
                                        return `Média: ${context.raw.toFixed(1)} caminhões/h`;
                                    }
                                }
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value.toFixed(1),
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            };
            
            // Get efficiency color for charts
            const getEfficiencyColorGradient = (value) => {
                if (value >= 90) {
                    return 'rgba(16, 185, 129, 0.7)';  // Green
                } else if (value >= 75) {
                    return 'rgba(93, 92, 222, 0.7)';   // Primary
                } else if (value >= 50) {
                    return 'rgba(245, 158, 11, 0.7)';  // Yellow
                } else {
                    return 'rgba(239, 68, 68, 0.7)';   // Red
                }
            };
            
            // Update delivery by front chart view (absolute or percentage)
            const updateDeliveryByFrontChart = (viewMode) => {
                if (!state.charts.deliveryByFront) return;
                
                const frontLabels = state.fronts.map(front => `F${front}`);
                let chartData;
                
                if (viewMode === 'percentage') {
                    // Calculate total delivery for current date
                    const totalDelivery = state.fronts.reduce((total, front) => {
                        let frontTotal = 0;
                        for (const hour of state.hours) {
                            frontTotal += state.delivery[state.currentDate]?.[front]?.[hour] || 0;
                        }
                        return total + frontTotal;
                    }, 0);
                    
                    // Calculate percentage for each front
                    chartData = state.fronts.map(front => {
                        let frontTotal = 0;
                        for (const hour of state.hours) {
                            frontTotal += state.delivery[state.currentDate]?.[front]?.[hour] || 0;
                        }
                        return totalDelivery > 0 ? (frontTotal / totalDelivery) * 100 : 0;
                    });
                    
                    // Update y-axis title
                    state.charts.deliveryByFront.options.scales.y.title.text = 'Porcentagem do Total (%)';
                } else {
                    // Use absolute values
                    chartData = state.fronts.map(front => {
                        let frontTotal = 0;
                        for (const hour of state.hours) {
                            frontTotal += state.delivery[state.currentDate]?.[front]?.[hour] || 0;
                        }
                        return frontTotal;
                    });
                    
                    // Update y-axis title
                    state.charts.deliveryByFront.options.scales.y.title.text = 'Toneladas';
                }
                
                // Update chart data
                state.charts.deliveryByFront.data.labels = frontLabels;
                state.charts.deliveryByFront.data.datasets[0].data = chartData;
                
                // Update chart
                state.charts.deliveryByFront.update();
            };
            
            // Update period chart when switching between day, week, month
            const updatePeriodChart = (period) => {
                if (!state.charts.deliveryByPeriod) return;
                
                // Update chart data based on selected period
                const periodData = state.analytics.periodData[period];
                
                state.charts.deliveryByPeriod.data.labels = periodData.labels;
                state.charts.deliveryByPeriod.data.datasets[0].data = periodData.datasets[0].data;
                state.charts.deliveryByPeriod.data.datasets[1].data = periodData.datasets[1].data;
                
                state.charts.deliveryByPeriod.update();
            };
            
            // Update chart themes for dark mode
            const updateChartsTheme = () => {
                const charts = [
                    state.charts.deliveryByPeriod,
                    state.charts.frontPerformance,
                    state.charts.deliveryByFront,
                    state.charts.tripsByFront,
                    state.charts.trucksPerHour
                ];
                
                const isDark = document.documentElement.classList.contains('dark');
                const textColor = isDark ? '#E5E7EB' : '#374151';
                const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.05)';
                
                charts.forEach(chart => {
                    if (!chart) return;
                    
                    // Update tooltip styles
                    chart.options.plugins.tooltip.backgroundColor = isDark ? 'rgba(255, 255, 255, 0.8)' : 'rgba(0, 0, 0, 0.8)';
                    chart.options.plugins.tooltip.titleColor = isDark ? '#000' : '#fff';
                    chart.options.plugins.tooltip.bodyColor = isDark ? '#000' : '#fff';
                    
                    // Update scales
                    if (chart.options.scales.x) {
                        chart.options.scales.x.grid.color = gridColor;
                        chart.options.scales.x.ticks.color = textColor;
                    }
                    
                    if (chart.options.scales.y) {
                        chart.options.scales.y.grid.color = gridColor;
                        chart.options.scales.y.ticks.color = textColor;
                    }
                    
                    // Update legend
                    if (chart.options.plugins.legend && chart.options.plugins.legend.labels) {
                        chart.options.plugins.legend.labels.color = textColor;
                    }
                    
                    chart.update();
                });
            };
            
            // Update all charts with current data
            const updateCharts = () => {
                if (state.currentPage === 'dashboard') {
                    updateDashboardCharts();
                }
            };
            
            // Update dashboard charts with actual data
            const updateDashboardCharts = () => {
                // Update delivery by period chart on dashboard
                if (state.charts.deliveryByPeriod) {
                    // Get real data from the delivery state for each period
                    const periods = Object.keys(state.timePeriodsMap);
                    const periodLabels = periods.map(period => {
                        return `${period.substring(0, 2)}:00-${period.substring(3, 5)}:00`;
                    });
                    
                    const deliveryData = periods.map(period => {
                        return state.fronts.reduce((sum, front) => {
                            return sum + (state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0);
                        }, 0);
                    });
                    
                    const potentialData = periods.map(period => {
                        return state.fronts.reduce((sum, front) => {
                            return sum + (state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0);
                        }, 0);
                    });
                    
                    // Update analytics data with real data
                    state.analytics.periodData.day.labels = periodLabels;
                    state.analytics.periodData.day.datasets[0].data = deliveryData;
                    state.analytics.periodData.day.datasets[1].data = potentialData;
                    
                    // Update chart with new data
                    state.charts.deliveryByPeriod.data.labels = periodLabels;
                    state.charts.deliveryByPeriod.data.datasets[0].data = deliveryData;
                    state.charts.deliveryByPeriod.data.datasets[1].data = potentialData;
                    state.charts.deliveryByPeriod.update();
                }
                
                // Update front performance chart on dashboard
                if (state.charts.frontPerformance) {
                    const frontLabels = state.fronts.map(front => `F${front}`);
                    
                    const efficiencyData = state.fronts.map(front => {
                        let totalDelivery = 0;
                        let totalPotential = 0;
                        
                        // Calculate total delivery for all periods
                        for (const period in state.timePeriodsMap) {
                            // Sum delivery for this period
                            totalDelivery += state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0;
                            
                            // Sum potential for this period
                            totalPotential += state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0;
                        }
                        
                        return totalPotential > 0 ? Math.round((totalDelivery / totalPotential) * 100) : 0;
                    });
                    
                    // Update analytics data with real data
                    state.analytics.frontPerformance.labels = frontLabels;
                    state.analytics.frontPerformance.datasets[0].data = efficiencyData;
                    
                    // Update chart with new data
                    state.charts.frontPerformance.data.labels = frontLabels;
                    state.charts.frontPerformance.data.datasets[0].data = efficiencyData;
                    state.charts.frontPerformance.data.datasets[0].backgroundColor = 
                        efficiencyData.map(value => getEfficiencyColorGradient(value));
                    state.charts.frontPerformance.update();
                }
                
                // Update trips by front chart
                if (state.charts.tripsByFront) {
                    const frontLabels = state.fronts.map(front => `F${front}`);
                    
                    // Calculate total trips for each front
                    const tripsData = state.fronts.map(front => {
                        return state.hours.reduce((sum, hour) => {
                            return sum + (state.trips[state.currentDate]?.[front]?.[hour] || 0);
                        }, 0);
                    });
                    
                    // Update analytics data
                    state.analytics.tripsByFront.labels = frontLabels;
                    state.analytics.tripsByFront.datasets[0].data = tripsData;
                    
                    // Update chart
                    state.charts.tripsByFront.data.labels = frontLabels;
                    state.charts.tripsByFront.data.datasets[0].data = tripsData;
                    state.charts.tripsByFront.update();
                }
                
                // Update trucks per hour chart
                if (state.charts.trucksPerHour) {
                    const frontLabels = state.fronts.map(front => `F${front}`);
                    
                    // Calculate average trucks per hour for each front
                    const trucksData = state.fronts.map(front => {
                        const totalTrips = state.hours.reduce((sum, hour) => {
                            return sum + (state.trips[state.currentDate]?.[front]?.[hour] || 0);
                        }, 0);
                        // Assuming 24 active hours for the average calculation
                        const activeHours = state.hours.filter(hour => (state.trips[state.currentDate]?.[front]?.[hour] || 0) > 0).length || 1;
                        return totalTrips / activeHours;
                    });
                    
                    // Update analytics data
                    state.analytics.trucksPerHour.labels = frontLabels;
                    state.analytics.trucksPerHour.datasets[0].data = trucksData;
                    
                    // Update chart
                    state.charts.trucksPerHour.data.labels = frontLabels;
                    state.charts.trucksPerHour.data.datasets[0].data = trucksData;
                    state.charts.trucksPerHour.update();
                }
                
                // Update delivery by front chart
                if (state.charts.deliveryByFront) {
                    const viewMode = document.getElementById('delivery-view-selector')?.value || 'absolute';
                    updateDeliveryByFrontChart(viewMode);
                }
                
                // Update dashboard stats cards
                updateDashboardStatsCards();
            };
            
            // Update dashboard stats cards with real data
            const updateDashboardStatsCards = () => {
                // Calculate total delivery across all fronts and hours for current date
                const totalDelivery = Object.keys(state.delivery[state.currentDate] || {}).reduce((frontSum, front) => {
                    return frontSum + Object.keys(state.delivery[state.currentDate][front] || {}).reduce((hourSum, hour) => {
                        return hourSum + (state.delivery[state.currentDate][front][hour] || 0);
                    }, 0);
                }, 0);
                
                // Calculate total potential for current date
                const totalPotential = Object.keys(state.twoHourPotential[state.currentDate] || {}).reduce((periodSum, period) => {
                    return periodSum + Object.keys(state.twoHourPotential[state.currentDate][period] || {}).reduce((frontSum, front) => {
                        return frontSum + (state.twoHourPotential[state.currentDate][period][front] || 0);
                    }, 0);
                }, 0);
                
                // Calculate efficiency
                const efficiency = totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
                
                // Calculate total trips for current date
                const totalTrips = Object.keys(state.trips[state.currentDate] || {}).reduce((frontSum, front) => {
                    return frontSum + Object.keys(state.trips[state.currentDate][front] || {}).reduce((hourSum, hour) => {
                        return hourSum + (state.trips[state.currentDate][front][hour] || 0);
                    }, 0);
                }, 0);
                
                // Calculate average density for current date
                let densitySum = 0;
                let densityCount = 0;
                
                for (const front in state.density[state.currentDate] || {}) {
                    for (const hour in state.density[state.currentDate][front] || {}) {
                        if ((state.density[state.currentDate][front][hour] || 0) > 0) {
                            densitySum += state.density[state.currentDate][front][hour];
                            densityCount++;
                        }
                    }
                }
                
                const avgDensity = densityCount > 0 ? densitySum / densityCount : 0;
                
                // Update dashboard cards
                const dashboardCards = document.querySelectorAll('.dashboard-card');
                if (dashboardCards.length >= 4) {
                    // Total delivered
                    const deliveredCard = dashboardCards[0];
                    const deliveredValue = deliveredCard.querySelector('.text-2xl');
                    const deliveredProgress = deliveredCard.querySelector('.bg-primary');
                    
                    if (deliveredValue) deliveredValue.textContent = totalDelivery.toFixed(1);
                    if (deliveredProgress) {
                        const progressPercentage = totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
                        deliveredProgress.style.width = `${Math.min(100, progressPercentage)}%`;
                    }
                    
                    // Efficiency
                    const efficiencyCard = dashboardCards[1];
                    const efficiencyValue = efficiencyCard.querySelector('.text-2xl');
                    const efficiencyProgress = efficiencyCard.querySelector('.bg-blue-500');
                    
                    if (efficiencyValue) efficiencyValue.textContent = `${efficiency.toFixed(1)}%`;
                    if (efficiencyProgress) efficiencyProgress.style.width = `${Math.min(100, efficiency)}%`;
                    
                    // Trips
                    const tripsCard = dashboardCards[2];
                    const tripsValue = tripsCard.querySelector('.text-2xl');
                    const tripsProgress = tripsCard.querySelector('.bg-green-500');
                    
                    if (tripsValue) tripsValue.textContent = totalTrips.toString();
                    if (tripsProgress) {
                        // Assume a target of 1,500 trips for the progress bar
                        const targetTrips = 1500;
                        const tripsPercentage = (totalTrips / targetTrips) * 100;
                        tripsProgress.style.width = `${Math.min(100, tripsPercentage)}%`;
                    }
                    
                    // Density
                    const densityCard = dashboardCards[3];
                    const densityValue = densityCard.querySelector('.text-2xl');
                    const densityProgress = densityCard.querySelector('.bg-purple-500');
                    
                    if (densityValue) densityValue.textContent = avgDensity.toFixed(2);
                    if (densityProgress) {
                        // Assume a target density of 65.00
                        const targetDensity = 65.00;
                        const densityPercentage = (avgDensity / targetDensity) * 100;
                        densityProgress.style.width = `${Math.min(100, densityPercentage)}%`;
                    }
                }
            };
            
            // Update the detailed front table with real data including non-delivered amount
            const updateDetailedFrontTable = () => {
                if (!elements.frontDetailsTable) return;
                
                // Clear the table
                elements.frontDetailsTable.innerHTML = '';
                
                // Variables for totals
                let totalEntregue = 0;
                let totalPotencial = 0;
                let totalViagens = 0;
                let totalDensidadeSum = 0;
                let totalDensidadeCount = 0;
                let totalNaoEntregue = 0;
                
                // Add rows for each front
                state.fronts.forEach(front => {
                    // Calculate front total delivery for current date
                    let frontDelivery = 0;
                    let frontPotential = 0;
                    let frontTrips = 0;
                    let frontDensitySum = 0;
                    let frontDensityCount = 0;
                    
                    // Calculate totals across all periods for current date
                    for (const period in state.timePeriodsMap) {
                        // Sum delivery for this period
                        frontDelivery += state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0;
                        
                        // Sum potential for this period
                        frontPotential += state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0;
                    }
                    
                    // Calculate trips and density for current date
                    for (const hour of state.hours) {
                        frontTrips += state.trips[state.currentDate]?.[front]?.[hour] || 0;
                        
                        if ((state.density[state.currentDate]?.[front]?.[hour] || 0) > 0) {
                            frontDensitySum += state.density[state.currentDate][front][hour];
                            frontDensityCount++;
                        }
                    }
                    
                    // Calculate efficiency percentage
                    const efficiency = frontPotential > 0 ? (frontDelivery / frontPotential) * 100 : 0;
                    
                    // Calculate average density
                    const avgDensity = frontDensityCount > 0 ? frontDensitySum / frontDensityCount : 0;
                    
                    // Calculate non-delivered amount (negative value showing what was not delivered)
                    const naoEntregue = frontPotential - frontDelivery;
                    
                    // Create row
                    const row = document.createElement('tr');
                    row.className = 'front-detail-row';
                    
                    // Get appropriate color for efficiency
                    const efficiencyColor = getEfficiencyTextColor(efficiency);
                    
                    row.innerHTML = `
                        <td class="px-4 py-3 whitespace-nowrap font-semibold">F${front}</td>
                        <td class="px-4 py-3 whitespace-nowrap font-medium text-success-600 dark:text-success-400">${frontDelivery.toFixed(2)} ton</td>
                        <td class="px-4 py-3 whitespace-nowrap">${frontPotential.toFixed(2)} ton</td>
                        <td class="px-4 py-3 whitespace-nowrap font-medium ${naoEntregue > 0 ? 'text-danger-600 dark:text-danger-400' : 'text-success-600 dark:text-success-400'}">${naoEntregue > 0 ? '-' + naoEntregue.toFixed(2) : '0.00'} ton</td>
                        <td class="px-4 py-3 whitespace-nowrap font-medium ${efficiencyColor}">${efficiency.toFixed(1)}%</td>
                        <td class="px-4 py-3 whitespace-nowrap">${frontTrips}</td>
                        <td class="px-4 py-3 whitespace-nowrap">${avgDensity.toFixed(2)}</td>
                        <td class="px-4 py-3">
                            <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5 relative overflow-hidden">
                                <div class="bg-${getProgressBarColor(efficiency, true)} h-2.5 rounded-full" style="width: ${Math.min(100, efficiency)}%"></div>
                            </div>
                            <span class="text-xs mt-1 block text-right">${efficiency.toFixed(1)}%</span>
                        </td>
                    `;
                    
                    elements.frontDetailsTable.appendChild(row);
                    
                    // Add to totals
                    totalEntregue += frontDelivery;
                    totalPotencial += frontPotential;
                    totalViagens += frontTrips;
                    totalNaoEntregue += naoEntregue;
                    
                    if (frontDensityCount > 0) {
                        totalDensidadeSum += frontDensitySum;
                        totalDensidadeCount += frontDensityCount;
                    }
                });
                
                // Calculate total efficiency and average density
                const totalEfficiency = totalPotencial > 0 ? (totalEntregue / totalPotencial) * 100 : 0;
                const avgTotalDensity = totalDensidadeCount > 0 ? totalDensidadeSum / totalDensidadeCount : 0;
                
                // Update total fields
                const totalEntregueEl = document.getElementById('total-entregue');
                const totalPotencialEl = document.getElementById('total-potencial');
                const totalNaoEntregueEl = document.getElementById('total-nao-entregue');
                const totalEficienciaEl = document.getElementById('total-eficiencia');
                const totalViagensEl = document.getElementById('total-viagens');
                const totalDensidadeEl = document.getElementById('total-densidade');
                const totalProgressBar = document.getElementById('total-progress-bar');
                const totalProgressText = document.getElementById('total-progress-text');
                
                if (totalEntregueEl) totalEntregueEl.textContent = `${totalEntregue.toFixed(2)} ton`;
                if (totalPotencialEl) totalPotencialEl.textContent = `${totalPotencial.toFixed(2)} ton`;
                if (totalNaoEntregueEl) {
                    totalNaoEntregueEl.textContent = totalNaoEntregue > 0 ? `-${totalNaoEntregue.toFixed(2)} ton` : '0.00 ton';
                    totalNaoEntregueEl.className = `px-4 py-3 whitespace-nowrap font-medium ${totalNaoEntregue > 0 ? 'text-danger-600 dark:text-danger-400' : 'text-success-600 dark:text-success-400'}`;
                }
                if (totalEficienciaEl) {
                    totalEficienciaEl.textContent = `${totalEfficiency.toFixed(1)}%`;
                    totalEficienciaEl.className = `px-4 py-3 whitespace-nowrap font-medium ${getEfficiencyTextColor(totalEfficiency)}`;
                }
                if (totalViagensEl) totalViagensEl.textContent = totalViagens.toString();
                if (totalDensidadeEl) totalDensidadeEl.textContent = avgTotalDensity.toFixed(2);
                
                if (totalProgressBar && totalProgressText) {
                    totalProgressBar.style.width = `${Math.min(100, totalEfficiency)}%`;
                    totalProgressBar.className = `bg-${getProgressBarColor(totalEfficiency, true)} h-2.5 rounded-full`;
                    totalProgressText.textContent = `${totalEfficiency.toFixed(1)}%`;
                }
            };
            
            // Get efficiency text color based on value
            const getEfficiencyTextColor = (value) => {
                if (value >= 90) {
                    return 'text-green-600 dark:text-green-400';
                } else if (value >= 75) {
                    return 'text-primary-600 dark:text-primary-400';
                } else if (value >= 50) {
                    return 'text-yellow-600 dark:text-yellow-400';
                } else {
                    return 'text-red-600 dark:text-red-400';
                }
            };
            
            // Get progress bar color based on percentage
            const getProgressBarColor = (percentage, returnClass = false) => {
                let color;
                
                if (percentage >= 90) {
                    color = returnClass ? 'green-500' : 'bg-green-500';
                } else if (percentage >= 75) {
                    color = returnClass ? 'primary' : 'bg-primary';
                } else if (percentage >= 50) {
                    color = returnClass ? 'yellow-500' : 'bg-yellow-500';
                } else {
                    color = returnClass ? 'red-500' : 'bg-red-500';
                }
                
                return color;
            };
            
            // Switch time period tab
            const switchTimePeriodTab = (period) => {
                state.activePeriod = period;
                
                // Update tab button states
                elements.timeTabButtons.forEach(button => {
                    button.classList.remove('bg-primary', 'text-white');
                    button.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                    
                    if (button.getAttribute('data-period') === period) {
                        button.classList.add('bg-primary', 'text-white');
                        button.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                    }
                });
                
                // Show/hide period content
                document.querySelectorAll('.period-content').forEach(content => {
                    content.classList.add('hidden');
                });
                
                const activePeriodContent = document.getElementById(`period-${period}`);
                if (activePeriodContent) {
                    activePeriodContent.classList.remove('hidden');
                }
            };
            
            // Show/hide loading indicator
            const showLoading = (show = true) => {
                if (!elements.loadingIndicator) return;
                
                if (show) {
                    elements.loadingIndicator.classList.remove('hidden');
                } else {
                    elements.loadingIndicator.classList.add('hidden');
                }
            };
            
            // Clear current period data
            const clearCurrentPeriod = () => {
                const period = state.activePeriod;
                
                // Clear data for the current active period and current date
                const hours = state.timePeriodsMap[period];
                
                for (const front of state.fronts) {
                    for (const hour of hours) {
                        if (state.density[state.currentDate] && state.density[state.currentDate][front]) {
                            state.density[state.currentDate][front][hour] = 0;
                        }
                        if (state.trips[state.currentDate] && state.trips[state.currentDate][front]) {
                            state.trips[state.currentDate][front][hour] = 0;
                        }
                        if (state.delivery[state.currentDate] && state.delivery[state.currentDate][front]) {
                            state.delivery[state.currentDate][front][hour] = 0;
                        }
                        if (state.potential[state.currentDate] && state.potential[state.currentDate][front]) {
                            // Only clear potential for odd hours
                            if (hour % 2 !== 0) {
                                state.potential[state.currentDate][front][hour] = 0;
                            }
                        }
                    }
                }
                
                // Recalculate two-hour totals
                calculateTwoHourTotals();
                
                // Update UI
                generateTimePeriodHTML();
                
                // Add to history
                addToHistory('clear-period', { period, date: state.currentDate });
                
                showToast(`Período ${period} limpo com sucesso`, 'success');
            };
            
            // Copy previous period data
            const copyPreviousPeriod = () => {
                const currentPeriod = state.activePeriod;
                
                // Find the previous period in the time periods map
                const periods = Object.keys(state.timePeriodsMap);
                const currentIndex = periods.indexOf(currentPeriod);
                const previousIndex = currentIndex > 0 ? currentIndex - 1 : periods.length - 1;
                const previousPeriod = periods[previousIndex];
                
                // Check if previous period has data
                let hasData = false;
                for (const front of state.fronts) {
                    const delivery = state.twoHourDelivery[state.currentDate]?.[previousPeriod]?.[front] || 0;
                    const potential = state.twoHourPotential[state.currentDate]?.[previousPeriod]?.[front] || 0;
                    if (delivery > 0 || potential > 0) {
                        hasData = true;
                        break;
                    }
                }
                
                if (!hasData) {
                    showToast(`Período anterior (${previousPeriod}) não possui dados para copiar`, 'warning');
                    return;
                }
                
                // Copy data from previous period to current period
                const currentHours = state.timePeriodsMap[currentPeriod];
                const previousHours = state.timePeriodsMap[previousPeriod];
                
                for (const front of state.fronts) {
                    // Copy hour data
                    for (let i = 0; i < currentHours.length; i++) {
                        const currentHour = currentHours[i];
                        const previousHour = previousHours[i];
                        
                        // Copy density
                        if (state.density[state.currentDate]?.[front]?.[previousHour] !== undefined) {
                            state.density[state.currentDate][front][currentHour] = 
                                state.density[state.currentDate][front][previousHour];
                        }
                        
                        // Copy trips
                        if (state.trips[state.currentDate]?.[front]?.[previousHour] !== undefined) {
                            state.trips[state.currentDate][front][currentHour] = 
                                state.trips[state.currentDate][front][previousHour];
                        }
                        
                        // Copy potential (only for odd hours)
                        if (currentHour % 2 !== 0 && state.potential[state.currentDate]?.[front]?.[previousHour] !== undefined) {
                            state.potential[state.currentDate][front][currentHour] = 
                                state.potential[state.currentDate][front][previousHour];
                        }
                    }
                }
                
                // Recalculate delivery and two-hour totals
                calculateDelivery();
                calculateTwoHourTotals();
                
                // Update UI
                updateUI();
                
                // Add to history
                addToHistory('copy-period', { 
                    from: previousPeriod, 
                    to: currentPeriod, 
                    date: state.currentDate 
                });
                
                showToast(`Dados do período ${previousPeriod} copiados para ${currentPeriod}`, 'success');
            };
            
            // Export functions
            const exportJSON = () => {
                const dataToExport = {
                    date: state.currentDate,
                    period: state.activePeriod,
                    density: state.density[state.currentDate] || {},
                    trips: state.trips[state.currentDate] || {},
                    delivery: state.delivery[state.currentDate] || {},
                    potential: state.potential[state.currentDate] || {},
                    twoHourDelivery: state.twoHourDelivery[state.currentDate] || {},
                    twoHourPotential: state.twoHourPotential[state.currentDate] || {},
                    difference: state.difference[state.currentDate] || {},
                    fronts: state.fronts,
                    exportedAt: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(dataToExport, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                
                a.href = url;
                a.download = `entrega-safra-${state.currentDate}-${state.activePeriod}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('Dados exportados em JSON com sucesso!', 'success');
            };
            
            const exportCSV = () => {
                if (typeof Papa === 'undefined') {
                    showToast('Biblioteca Papa Parse não carregada. Não é possível exportar CSV.', 'error');
                    return;
                }
                
                const csvData = [];
                
                // Add header
                csvData.push([
                    'Data',
                    'Período',
                    'Frente',
                    'Hora',
                    'Densidade',
                    'Viagens',
                    'Entrega',
                    'Potencial'
                ]);
                
                // Add data for current date
                for (const front of state.fronts) {
                    for (const hour of state.hours) {
                        const density = state.density[state.currentDate]?.[front]?.[hour] || 0;
                        const trips = state.trips[state.currentDate]?.[front]?.[hour] || 0;
                        const delivery = state.delivery[state.currentDate]?.[front]?.[hour] || 0;
                        const potential = state.potential[state.currentDate]?.[front]?.[hour] || 0;
                        
                        csvData.push([
                            state.currentDate,
                            state.activePeriod,
                            `F${front}`,
                            `${hour.toString().padStart(2, '0')}:00`,
                            density.toFixed(2),
                            trips,
                            delivery.toFixed(2),
                            potential
                        ]);
                    }
                }
                
                const csv = Papa.unparse(csvData);
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                
                a.href = url;
                a.download = `entrega-safra-${state.currentDate}-${state.activePeriod}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('Dados exportados em CSV com sucesso!', 'success');
            };
            
            const exportPDF = () => {
                if (typeof jsPDF === 'undefined') {
                    showToast('Biblioteca jsPDF não carregada. Não é possível exportar PDF.', 'error');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add title
                doc.setFontSize(16);
                doc.text('Relatório de Entrega de Safra 2025', 20, 20);
                
                // Add date and period info
                doc.setFontSize(12);
                doc.text(`Data: ${formatDateDisplay(state.currentDate)}`, 20, 35);
                doc.text(`Período: ${state.activePeriod}`, 20, 45);
                
                // Prepare table data
                const tableData = [];
                
                // Add header
                const headers = ['Frente', 'Densidade Média', 'Total Viagens', 'Total Entregue', 'Eficiência (%)'];
                
                // Add data for each front
                for (const front of state.fronts) {
                    let frontDelivery = 0;
                    let frontPotential = 0;
                    let frontTrips = 0;
                    let frontDensitySum = 0;
                    let frontDensityCount = 0;
                    
                    // Calculate totals for the current period
                    for (const period in state.timePeriodsMap) {
                        frontDelivery += state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0;
                        frontPotential += state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0;
                    }
                    
                    // Calculate trips and density
                    for (const hour of state.hours) {
                        frontTrips += state.trips[state.currentDate]?.[front]?.[hour] || 0;
                        
                        if ((state.density[state.currentDate]?.[front]?.[hour] || 0) > 0) {
                            frontDensitySum += state.density[state.currentDate][front][hour];
                            frontDensityCount++;
                        }
                    }
                    
                    const efficiency = frontPotential > 0 ? (frontDelivery / frontPotential) * 100 : 0;
                    const avgDensity = frontDensityCount > 0 ? frontDensitySum / frontDensityCount : 0;
                    
                    tableData.push([
                        `F${front}`,
                        avgDensity.toFixed(2),
                        frontTrips.toString(),
                        frontDelivery.toFixed(2) + ' ton',
                        efficiency.toFixed(1) + '%'
                    ]);
                }
                
                // Add table using autoTable
                if (doc.autoTable) {
                    doc.autoTable({
                        head: [headers],
                        body: tableData,
                        startY: 60,
                        theme: 'grid',
                        styles: {
                            fontSize: 10,
                            cellPadding: 3
                        },
                        headStyles: {
                            fillColor: [93, 92, 222],
                            textColor: 255
                        }
                    });
                } else {
                    // Fallback if autoTable is not available
                    let yPosition = 60;
                    doc.setFontSize(10);
                    
                    // Add headers
                    headers.forEach((header, index) => {
                        doc.text(header, 20 + (index * 35), yPosition);
                    });
                    
                    yPosition += 10;
                    
                    // Add data
                    tableData.forEach(row => {
                        row.forEach((cell, index) => {
                            doc.text(cell, 20 + (index * 35), yPosition);
                        });
                        yPosition += 8;
                    });
                }
                
                // Add footer
                const pageHeight = doc.internal.pageSize.height;
                doc.setFontSize(8);
                doc.text(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, 20, pageHeight - 20);
                doc.text('GGOMES-LOG - Gestão de Entrega de Safra', 20, pageHeight - 10);
                
                // Save the PDF
                doc.save(`entrega-safra-${state.currentDate}-${state.activePeriod}.pdf`);
                
                showToast('Relatório PDF gerado com sucesso!', 'success');
            };
            
            // Export dashboard
            const exportDashboard = () => {
                if (typeof jsPDF === 'undefined') {
                    showToast('Biblioteca jsPDF não carregada. Não é possível exportar dashboard.', 'error');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add title
                doc.setFontSize(18);
                doc.text('Dashboard - Gestão de Entrega de Safra 2025', 20, 20);
                
                // Add date info
                doc.setFontSize(12);
                doc.text(`Data: ${formatDateDisplay(state.currentDate)}`, 20, 35);
                doc.text(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, 20, 45);
                
                // Calculate summary data
                let totalDelivery = 0;
                let totalPotential = 0;
                let totalTrips = 0;
                let totalDensitySum = 0;
                let totalDensityCount = 0;
                
                for (const front of state.fronts) {
                    // Calculate delivery and potential
                    for (const period in state.timePeriodsMap) {
                        totalDelivery += state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0;
                        totalPotential += state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0;
                    }
                    
                    // Calculate trips and density
                    for (const hour of state.hours) {
                        totalTrips += state.trips[state.currentDate]?.[front]?.[hour] || 0;
                        
                        if ((state.density[state.currentDate]?.[front]?.[hour] || 0) > 0) {
                            totalDensitySum += state.density[state.currentDate][front][hour];
                            totalDensityCount++;
                        }
                    }
                }
                
                const totalEfficiency = totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
                const avgDensity = totalDensityCount > 0 ? totalDensitySum / totalDensityCount : 0;
                
                // Add summary section
                doc.setFontSize(14);
                doc.text('Resumo Geral', 20, 65);
                
                doc.setFontSize(11);
                doc.text(`Total Entregue: ${totalDelivery.toFixed(2)} toneladas`, 20, 80);
                doc.text(`Total Previsto: ${totalPotential.toFixed(2)} toneladas`, 20, 90);
                doc.text(`Eficiência Geral: ${totalEfficiency.toFixed(1)}%`, 20, 100);
                doc.text(`Total de Viagens: ${totalTrips}`, 20, 110);
                doc.text(`Densidade Média: ${avgDensity.toFixed(2)}`, 20, 120);
                
                // Add detailed front table
                const tableHeaders = ['Frente', 'Entregue (ton)', 'Previsto (ton)', 'Eficiência (%)', 'Viagens'];
                const tableData = [];
                
                state.fronts.forEach(front => {
                    let frontDelivery = 0;
                    let frontPotential = 0;
                    let frontTrips = 0;
                    
                    // Calculate totals for this front
                    for (const period in state.timePeriodsMap) {
                        frontDelivery += state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0;
                        frontPotential += state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0;
                    }
                    
                    for (const hour of state.hours) {
                        frontTrips += state.trips[state.currentDate]?.[front]?.[hour] || 0;
                    }
                    
                    const efficiency = frontPotential > 0 ? (frontDelivery / frontPotential) * 100 : 0;
                    
                    tableData.push([
                        `F${front}`,
                        frontDelivery.toFixed(2),
                        frontPotential.toFixed(2),
                        efficiency.toFixed(1) + '%',
                        frontTrips.toString()
                    ]);
                });
                
                // Add table
                if (doc.autoTable) {
                    doc.autoTable({
                        head: [tableHeaders],
                        body: tableData,
                        startY: 140,
                        theme: 'grid',
                        styles: {
                            fontSize: 10,
                            cellPadding: 3
                        },
                        headStyles: {
                            fillColor: [93, 92, 222],
                            textColor: 255
                        }
                    });
                }
                
                // Add footer
                const pageHeight = doc.internal.pageSize.height;
                doc.setFontSize(8);
                doc.text('GGOMES-LOG - Sistema de Gestão de Entrega de Safra', 20, pageHeight - 10);
                
                // Save the PDF
                doc.save(`dashboard-${state.currentDate}.pdf`);
                
                showToast('Dashboard exportado em PDF com sucesso!', 'success');
            };
            
            // Show manage fronts modal
            const showManageFrontsModal = () => {
                if (!elements.manageFrontsModal) return;
                
                updateFrontsList();
                
                // Show modal with animation
                elements.manageFrontsModal.classList.remove('hidden');
                const innerModal = elements.manageFrontsModal.querySelector('.transform');
                if (innerModal) {
                    setTimeout(() => {
                        innerModal.classList.remove('scale-95', 'opacity-0');
                        innerModal.classList.add('scale-100', 'opacity-100');
                    }, 10);
                }
                
                // Focus on input
                const input = document.getElementById('new-front-input');
                if (input) {
                    setTimeout(() => input.focus(), 100);
                }
            };
            
            // Update fronts list in modal
            const updateFrontsList = () => {
                const frontsList = document.getElementById('fronts-list');
                if (!frontsList) return;
                
                frontsList.innerHTML = '';
                
                state.fronts.forEach(front => {
                    const listItem = document.createElement('li');
                    listItem.className = 'px-4 py-3 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
                    
                    listItem.innerHTML = `
                        <div class="flex items-center">
                            <div class="h-8 w-8 rounded-full bg-primary flex items-center justify-center text-white text-sm font-bold mr-3">
                                F
                            </div>
                            <span class="font-medium text-gray-900 dark:text-gray-100">Frente ${front}</span>
                        </div>
                        <button class="remove-front-btn text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 p-1 rounded" data-front="${front}" title="Remover frente">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    `;
                    
                    frontsList.appendChild(listItem);
                });
                
                // Add event listeners to remove buttons
                document.querySelectorAll('.remove-front-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const front = this.getAttribute('data-front');
                        showConfirmationModal(
                            'Remover Frente',
                            `Tem certeza que deseja remover a Frente ${front}? Todos os dados associados serão perdidos.`,
                            () => removeFront(front)
                        );
                    });
                });
            };
            
            // Add new front
            const addFront = () => {
                const input = document.getElementById('new-front-input');
                if (!input) return;
                
                const frontValue = input.value.trim();
                
                if (!frontValue) {
                    showToast('Digite um número para a frente', 'warning');
                    return;
                }
                
                if (state.fronts.includes(frontValue)) {
                    showToast('Esta frente já existe', 'warning');
                    return;
                }
                
                // Add to fronts array
                state.fronts.push(frontValue);
                state.fronts.sort(); // Keep fronts sorted
                
                // Initialize data structures for the new front
                initializeDataStructures();
                
                // Update fronts list
                updateFrontsList();
                
                // Clear input
                input.value = '';
                
                // Regenerate time period HTML if on that page
                if (state.currentPage === 'entrega-hora') {
                    generateTimePeriodHTML();
                }
                
                // Update charts if on dashboard
                if (state.currentPage === 'dashboard') {
                    updateDashboardCharts();
                }
                
                showToast(`Frente ${frontValue} adicionada com sucesso`, 'success');
                
                // Add to history
                addToHistory('add-front', { front: frontValue });
            };
            
            // Remove front
            const removeFront = (front) => {
                const frontIndex = state.fronts.indexOf(front);
                if (frontIndex === -1) return;
                
                // Remove from fronts array
                state.fronts.splice(frontIndex, 1);
                
                // Remove all data for this front from all dates
                Object.keys(state.density).forEach(date => {
                    if (state.density[date][front]) delete state.density[date][front];
                });
                
                Object.keys(state.trips).forEach(date => {
                    if (state.trips[date][front]) delete state.trips[date][front];
                });
                
                Object.keys(state.delivery).forEach(date => {
                    if (state.delivery[date][front]) delete state.delivery[date][front];
                });
                
                Object.keys(state.potential).forEach(date => {
                    if (state.potential[date][front]) delete state.potential[date][front];
                });
                
                Object.keys(state.twoHourDelivery).forEach(date => {
                    Object.keys(state.twoHourDelivery[date]).forEach(period => {
                        if (state.twoHourDelivery[date][period][front]) delete state.twoHourDelivery[date][period][front];
                    });
                });
                
                Object.keys(state.twoHourPotential).forEach(date => {
                    Object.keys(state.twoHourPotential[date]).forEach(period => {
                        if (state.twoHourPotential[date][period][front]) delete state.twoHourPotential[date][period][front];
                    });
                });
                
                Object.keys(state.difference).forEach(date => {
                    Object.keys(state.difference[date]).forEach(period => {
                        if (state.difference[date][period][front]) delete state.difference[date][period][front];
                    });
                });
                
                // Update fronts list
                updateFrontsList();
                
                // Regenerate time period HTML if on that page
                if (state.currentPage === 'entrega-hora') {
                    generateTimePeriodHTML();
                }
                
                // Update charts if on dashboard
                if (state.currentPage === 'dashboard') {
                    updateDashboardCharts();
                }
                
                showToast(`Frente ${front} removida com sucesso`, 'success');
                
                // Add to history
                addToHistory('remove-front', { front });
            };
            
            // Show confirmation modal
            const showConfirmationModal = (title, message, onConfirm) => {
                if (!elements.confirmationModal) return;
                
                const modalTitle = document.getElementById('modal-title');
                const modalMessage = document.getElementById('modal-message');
                const modalConfirm = document.getElementById('modal-confirm');
                
                if (modalTitle) modalTitle.textContent = title;
                if (modalMessage) modalMessage.textContent = message;
                
                // Remove previous event listeners
                const newConfirmButton = modalConfirm?.cloneNode(true);
                if (modalConfirm && newConfirmButton) {
                    modalConfirm.parentNode?.replaceChild(newConfirmButton, modalConfirm);
                    
                    // Add new event listener
                    newConfirmButton.addEventListener('click', () => {
                        onConfirm();
                        toggleModal(elements.confirmationModal, false);
                    });
                }
                
                // Show modal with animation
                elements.confirmationModal.classList.remove('hidden');
                const innerModal = elements.confirmationModal.querySelector('.transform');
                if (innerModal) {
                    setTimeout(() => {
                        innerModal.classList.remove('scale-95', 'opacity-0');
                        innerModal.classList.add('scale-100', 'opacity-100');
                    }, 10);
                }
            };
            
            // Show toast notification
            const showToast = (message, type = 'info', duration = 4000) => {
                if (!elements.toastContainer) return;
                
                const toast = document.createElement('div');
                toast.className = `transform transition-all duration-500 ease-in-out translate-x-full opacity-0 max-w-xs bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden`;
                
                const colors = {
                    success: 'border-l-4 border-l-green-500',
                    error: 'border-l-4 border-l-red-500',
                    warning: 'border-l-4 border-l-yellow-500',
                    info: 'border-l-4 border-l-blue-500'
                };
                
                const icons = {
                    success: `<svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`,
                    error: `<svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`,
                    warning: `<svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`,
                    info: `<svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`
                };
                
                toast.classList.add(colors[type]);
                
                toast.innerHTML = `
                    <div class="p-4">
                        <div class="flex items-start">
                            <div class="flex-shrink-0">
                                ${icons[type]}
                            </div>
                            <div class="ml-3 w-0 flex-1 pt-0.5">
                                <p class="text-sm font-medium text-gray-900 dark:text-gray-100">${message}</p>
                            </div>
                            <div class="ml-4 flex-shrink-0 flex">
                                <button class="close-toast bg-white dark:bg-gray-800 rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    <span class="sr-only">Fechar</span>
                                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                elements.toastContainer.appendChild(toast);
                
                // Show toast with animation
                setTimeout(() => {
                    toast.classList.remove('translate-x-full', 'opacity-0');
                    toast.classList.add('translate-x-0', 'opacity-100');
                }, 100);
                
                // Auto remove toast
                const removeToast = () => {
                    toast.classList.add('translate-x-full', 'opacity-0');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            elements.toastContainer.removeChild(toast);
                        }
                    }, 500);
                };
                
                // Add close button event
                const closeButton = toast.querySelector('.close-toast');
                if (closeButton) {
                    closeButton.addEventListener('click', removeToast);
                }
                
                // Auto remove after duration
                setTimeout(removeToast, duration);
            };
            
            // Save data to localStorage
            const saveData = () => {
                try {
                    const dataToSave = {
                        fronts: state.fronts,
                        currentDate: state.currentDate,
                        availableDates: state.availableDates,
                        density: state.density,
                        trips: state.trips,
                        delivery: state.delivery,
                        potential: state.potential,
                        twoHourDelivery: state.twoHourDelivery,
                        twoHourPotential: state.twoHourPotential,
                        difference: state.difference,
                        config: state.config,
                        lastSaved: new Date().toISOString()
                    };
                    
                    localStorage.setItem('ggomes-log-data', JSON.stringify(dataToSave));
                    return true;
                } catch (error) {
                    console.error('Erro ao salvar dados:', error);
                    showToast('Erro ao salvar dados', 'error');
                    return false;
                }
            };
            
            // Load data from localStorage
            const loadData = () => {
                try {
                    const savedData = localStorage.getItem('ggomes-log-data');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        
                        // Restore state
                        if (data.fronts) state.fronts = data.fronts;
                        if (data.currentDate) state.currentDate = data.currentDate;
                        if (data.availableDates) state.availableDates = data.availableDates;
                        if (data.density) state.density = data.density;
                        if (data.trips) state.trips = data.trips;
                        if (data.delivery) state.delivery = data.delivery;
                        if (data.potential) state.potential = data.potential;
                        if (data.twoHourDelivery) state.twoHourDelivery = data.twoHourDelivery;
                        if (data.twoHourPotential) state.twoHourPotential = data.twoHourPotential;
                        if (data.difference) state.difference = data.difference;
                        if (data.config) state.config = { ...state.config, ...data.config };
                        
                        console.log('Dados carregados com sucesso');
                        return true;
                    }
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                    showToast('Erro ao carregar dados salvos', 'error');
                }
                return false;
            };
            
            // Save configuration
            const saveConfig = () => {
                try {
                    localStorage.setItem('ggomes-log-config', JSON.stringify(state.config));
                } catch (error) {
                    console.error('Erro ao salvar configurações:', error);
                }
            };
            
            // Load configuration
            const loadConfig = () => {
                try {
                    const savedConfig = localStorage.getItem('ggomes-log-config');
                    if (savedConfig) {
                        const config = JSON.parse(savedConfig);
                        state.config = { ...state.config, ...config };
                    }
                } catch (error) {
                    console.error('Erro ao carregar configurações:', error);
                }
            };
            
            // Update config from UI
            const updateConfigFromUI = () => {
                const autoSaveToggle = document.getElementById('auto-save-toggle');
                const autoSaveInterval = document.getElementById('auto-save-interval');
                const darkModeToggle = document.getElementById('dark-mode-toggle');
                const alertThreshold = document.getElementById('alert-threshold');
                const soundAlertToggle = document.getElementById('sound-alert-toggle');
                const visualAlertToggle = document.getElementById('visual-alert-toggle');
                
                if (autoSaveToggle) state.config.autoSave = autoSaveToggle.checked;
                if (autoSaveInterval) state.config.autoSaveInterval = parseInt(autoSaveInterval.value) || 5;
                if (darkModeToggle) state.config.darkMode = darkModeToggle.checked;
                if (alertThreshold) state.config.alertThreshold = parseInt(alertThreshold.value) || 10;
                if (soundAlertToggle) state.config.soundAlerts = soundAlertToggle.checked;
                if (visualAlertToggle) state.config.visualAlerts = visualAlertToggle.checked;
                
                // Apply dark mode setting
                if (state.config.darkMode !== document.documentElement.classList.contains('dark')) {
                    toggleDarkMode();
                }
                
                // Update auto save
                if (state.config.autoSave) {
                    startAutoSave();
                } else {
                    stopAutoSave();
                }
            };
            
            // Restore default configuration
            const restoreDefaultConfig = () => {
                state.config = {
                    autoSave: true,
                    autoSaveInterval: 5,
                    darkMode: false,
                    alertThreshold: 10,
                    soundAlerts: false,
                    visualAlerts: true
                };
                
                updateConfigUI();
                saveConfig();
                
                // Apply settings
                if (document.documentElement.classList.contains('dark')) {
                    toggleDarkMode();
                }
                
                startAutoSave();
                
                showToast('Configurações restauradas para o padrão', 'success');
            };
            
            // Update config UI elements
            const updateConfigUI = () => {
                const autoSaveToggle = document.getElementById('auto-save-toggle');
                const autoSaveInterval = document.getElementById('auto-save-interval');
                const darkModeToggle = document.getElementById('dark-mode-toggle');
                const alertThreshold = document.getElementById('alert-threshold');
                const soundAlertToggle = document.getElementById('sound-alert-toggle');
                const visualAlertToggle = document.getElementById('visual-alert-toggle');
                
                if (autoSaveToggle) autoSaveToggle.checked = state.config.autoSave;
                if (autoSaveInterval) autoSaveInterval.value = state.config.autoSaveInterval;
                if (darkModeToggle) darkModeToggle.checked = state.config.darkMode;
                if (alertThreshold) alertThreshold.value = state.config.alertThreshold;
                if (soundAlertToggle) soundAlertToggle.checked = state.config.soundAlerts;
                if (visualAlertToggle) visualAlertToggle.checked = state.config.visualAlerts;
            };
            
            // Auto save functionality
            const startAutoSave = () => {
                stopAutoSave(); // Clear any existing timer
                
                if (state.config.autoSave) {
                    autoSaveTimer = setInterval(() => {
                        saveData();
                        console.log('Auto save completed');
                    }, state.config.autoSaveInterval * 60 * 1000); // Convert minutes to milliseconds
                }
            };
            
            const stopAutoSave = () => {
                if (autoSaveTimer) {
                    clearInterval(autoSaveTimer);
                    autoSaveTimer = null;
                }
            };
            
            // History management
            const addToHistory = (action, data) => {
                const historyItem = {
                    id: Date.now(),
                    action,
                    data,
                    timestamp: new Date().toISOString()
                };
                
                state.history.push(historyItem);
                
                // Keep only last 50 actions
                if (state.history.length > 50) {
                    state.history = state.history.slice(-50);
                }
            };
            
            // Format date for history display
            const formatDate = (dateString) => {
                const date = new Date(dateString);
                return date.toLocaleDateString('pt-BR');
            };
            
            // History calendar and table functions
            const updateHistoryCalendar = () => {
                if (!elements.historyCalendar) return;
                
                elements.historyCalendar.innerHTML = '';
                
                // Set current month/year for history
                const now = new Date();
                const currentMonth = now.getMonth();
                const currentYear = now.getFullYear();
                
                // Update month/year display
                const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                if (elements.historyMonthYear) {
                    elements.historyMonthYear.textContent = `${monthNames[currentMonth]} ${currentYear}`;
                }
                
                // Get first day of month and number of days
                const firstDay = new Date(currentYear, currentMonth, 1).getDay();
                const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
                
                // Add empty cells for days before the first day of month
                for (let i = 0; i < firstDay; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = 'h-10';
                    elements.historyCalendar.appendChild(emptyCell);
                }
                
                // Add days
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayCell = document.createElement('div');
                    const currentDate = new Date(currentYear, currentMonth, day);
                    currentDate.setHours(0, 0, 0, 0);
                    const dateStr = currentDate.toISOString().split('T')[0];
                    
                    dayCell.className = 'calendar-day h-10 flex items-center justify-center rounded cursor-pointer border border-transparent hover:border-primary transition-colors';
                    
                    // Highlight today
                    if (currentDate.getTime() === today.getTime()) {
                        dayCell.classList.add('border-2', 'border-primary', 'font-bold');
                    }
                    
                    // Mark dates with data
                    if (state.availableDates.includes(dateStr)) {
                        dayCell.classList.add('bg-green-100', 'dark:bg-green-900', 'text-green-800', 'dark:text-green-200');
                    }
                    
                    dayCell.textContent = day;
                    dayCell.setAttribute('data-date', dateStr);
                    
                    // Add click event to view day data
                    dayCell.addEventListener('click', function() {
                        const selectedDate = this.getAttribute('data-date');
                        if (selectedDate && state.availableDates.includes(selectedDate)) {
                            changeCurrentDate(selectedDate);
                            showPage('entrega-hora');
                        }
                    });
                    
                    elements.historyCalendar.appendChild(dayCell);
                }
            };
            
            // Navigate history month
            const navigateHistoryMonth = (direction) => {
                // For now, this just shows the current month
                // In a full implementation, you would track the displayed month
                updateHistoryCalendar();
            };
            
            // Update history table
            const updateHistoryTable = () => {
                if (!elements.historyTableBody) return;
                
                elements.historyTableBody.innerHTML = '';
                
                const periodFilter = document.getElementById('history-period-filter')?.value || 'all';
                
                // Get data for available dates
                const historyData = [];
                
                state.availableDates.forEach(date => {
                    let totalDelivery = 0;
                    let totalPotential = 0;
                    let totalTrips = 0;
                    let densitySum = 0;
                    let densityCount = 0;
                    
                    if (periodFilter === 'all') {
                        // Calculate for all periods
                        for (const period in state.timePeriodsMap) {
                            for (const front of state.fronts) {
                                totalDelivery += state.twoHourDelivery[date]?.[period]?.[front] || 0;
                                totalPotential += state.twoHourPotential[date]?.[period]?.[front] || 0;
                            }
                        }
                        
                        for (const front of state.fronts) {
                            for (const hour of state.hours) {
                                totalTrips += state.trips[date]?.[front]?.[hour] || 0;
                                
                                if ((state.density[date]?.[front]?.[hour] || 0) > 0) {
                                    densitySum += state.density[date][front][hour];
                                    densityCount++;
                                }
                            }
                        }
                    } else {
                        // Calculate for specific period
                        for (const front of state.fronts) {
                            totalDelivery += state.twoHourDelivery[date]?.[periodFilter]?.[front] || 0;
                            totalPotential += state.twoHourPotential[date]?.[periodFilter]?.[front] || 0;
                        }
                        
                        const hours = state.timePeriodsMap[periodFilter];
                        for (const front of state.fronts) {
                            for (const hour of hours) {
                                totalTrips += state.trips[date]?.[front]?.[hour] || 0;
                                
                                if ((state.density[date]?.[front]?.[hour] || 0) > 0) {
                                    densitySum += state.density[date][front][hour];
                                    densityCount++;
                                }
                            }
                        }
                    }
                    
                    const efficiency = totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
                    const avgDensity = densityCount > 0 ? densitySum / densityCount : 0;
                    
                    historyData.push({
                        date,
                        totalDelivery,
                        totalPotential,
                        efficiency,
                        totalTrips,
                        avgDensity
                    });
                });
                
                // Sort by date (most recent first)
                historyData.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Display data or empty state
                if (historyData.length === 0) {
                    elements.historyEmptyState?.classList.remove('hidden');
                    return;
                } else {
                    elements.historyEmptyState?.classList.add('hidden');
                }
                
                // Add rows to table
                historyData.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
                    
                    const efficiencyColor = getEfficiencyTextColor(row.efficiency);
                    
                    tr.innerHTML = `
                        <td class="px-4 py-3 whitespace-nowrap font-medium">${formatDateDisplay(row.date)}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-success-600 dark:text-success-400">${row.totalDelivery.toFixed(2)} ton</td>
                        <td class="px-4 py-3 whitespace-nowrap">${row.totalPotential.toFixed(2)} ton</td>
                        <td class="px-4 py-3 whitespace-nowrap ${efficiencyColor}">${row.efficiency.toFixed(1)}%</td>
                        <td class="px-4 py-3 whitespace-nowrap">${row.totalTrips}</td>
                        <td class="px-4 py-3 whitespace-nowrap">${row.avgDensity.toFixed(2)}</td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="flex space-x-2">
                                <button class="view-day-btn text-primary hover:text-primary-600 text-sm font-medium" data-date="${row.date}">
                                    Ver
                                </button>
                                <button class="export-day-btn text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 text-sm" data-date="${row.date}">
                                    Exportar
                                </button>
                            </div>
                        </td>
                    `;
                    
                    elements.historyTableBody.appendChild(tr);
                });
                
                // Add event listeners for action buttons
                document.querySelectorAll('.view-day-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const date = this.getAttribute('data-date');
                        changeCurrentDate(date);
                        showPage('entrega-hora');
                    });
                });
                
                document.querySelectorAll('.export-day-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const date = this.getAttribute('data-date');
                        exportDayData(date);
                    });
                });
            };
            
            // Export day data
            const exportDayData = (date) => {
                const oldCurrentDate = state.currentDate;
                state.currentDate = date;
                
                exportJSON();
                
                state.currentDate = oldCurrentDate;
            };
            
            // Export history data
            const exportHistoryData = () => {
                if (typeof jsPDF === 'undefined') {
                    showToast('Biblioteca jsPDF não carregada. Não é possível exportar histórico.', 'error');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add title
                doc.setFontSize(16);
                doc.text('Histórico de Entregas - Safra 2025', 20, 20);
                
                // Add generation info
                doc.setFontSize(10);
                doc.text(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, 20, 30);
                
                // Prepare table data
                const tableData = [];
                const headers = ['Data', 'Total Entregue (ton)', 'Total Previsto (ton)', 'Eficiência (%)', 'Viagens', 'Densidade Média'];
                
                // Get all available dates data
                state.availableDates.forEach(date => {
                    let totalDelivery = 0;
                    let totalPotential = 0;
                    let totalTrips = 0;
                    let densitySum = 0;
                    let densityCount = 0;
                    
                    // Calculate totals for this date
                    for (const period in state.timePeriodsMap) {
                        for (const front of state.fronts) {
                            totalDelivery += state.twoHourDelivery[date]?.[period]?.[front] || 0;
                            totalPotential += state.twoHourPotential[date]?.[period]?.[front] || 0;
                        }
                    }
                    
                    for (const front of state.fronts) {
                        for (const hour of state.hours) {
                            totalTrips += state.trips[date]?.[front]?.[hour] || 0;
                            
                            if ((state.density[date]?.[front]?.[hour] || 0) > 0) {
                                densitySum += state.density[date][front][hour];
                                densityCount++;
                            }
                        }
                    }
                    
                    const efficiency = totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
                    const avgDensity = densityCount > 0 ? densitySum / densityCount : 0;
                    
                    tableData.push([
                        formatDate(date),
                        totalDelivery.toFixed(2),
                        totalPotential.toFixed(2),
                        efficiency.toFixed(1) + '%',
                        totalTrips.toString(),
                        avgDensity.toFixed(2)
                    ]);
                });
                
                // Add table
                if (doc.autoTable) {
                    doc.autoTable({
                        head: [headers],
                        body: tableData,
                        startY: 40,
                        theme: 'grid',
                        styles: {
                            fontSize: 8,
                            cellPadding: 2
                        },
                        headStyles: {
                            fillColor: [93, 92, 222],
                            textColor: 255
                        }
                    });
                }
                
                // Add footer
                const pageHeight = doc.internal.pageSize.height;
                doc.setFontSize(8);
                doc.text('GGOMES-LOG - Sistema de Gestão de Entrega de Safra', 20, pageHeight - 10);
                
                // Save the PDF
                doc.save(`historico-entregas-${new Date().toISOString().split('T')[0]}.pdf`);
                
                showToast('Histórico exportado em PDF com sucesso!', 'success');
            };
            
            // Perform search
            const performSearch = () => {
                const searchInput = document.getElementById('global-search');
                if (!searchInput) return;
                
                const query = searchInput.value.trim().toLowerCase();
                if (!query) {
                    showToast('Digite algo para pesquisar', 'warning');
                    return;
                }
                
                // Simple search implementation
                // In a real app, this would be more sophisticated
                
                let found = false;
                
                // Search in fronts
                if (query.includes('frente') || query.match(/\d{4}/)) {
                    const frontMatch = query.match(/\d{4}/);
                    if (frontMatch && state.fronts.includes(frontMatch[0])) {
                        showPage('entrega-hora');
                        found = true;
                    }
                }
                
                // Search in periods
                const periodMatches = {
                    '06': '06-08', '08': '08-10', '10': '10-12', '12': '12-14',
                    '14': '14-16', '16': '16-18', '18': '18-20', '20': '20-22',
                    '22': '22-00', '00': '00-02', '02': '02-04', '04': '04-06'
                };
                
                for (const [hour, period] of Object.entries(periodMatches)) {
                    if (query.includes(hour)) {
                        showPage('entrega-hora');
                        switchTimePeriodTab(period);
                        found = true;
                        break;
                    }
                }
                
                // Search for dashboard
                if (query.includes('dashboard') || query.includes('resumo') || query.includes('visão geral')) {
                    showPage('dashboard');
                    found = true;
                }
                
                // Search for reports
                if (query.includes('relatório') || query.includes('análise')) {
                    showPage('relatorios');
                    found = true;
                }
                
                // Search for history
                if (query.includes('histórico') || query.includes('anterior')) {
                    showPage('historico');
                    found = true;
                }
                
                if (found) {
                    toggleModal(elements.searchModal, false);
                    showToast('Resultado da pesquisa exibido', 'success');
                } else {
                    showToast('Nenhum resultado encontrado para "' + query + '"', 'info');
                }
            };
            
            // Generate calendar days for date range picker
            const generateCalendarDays = () => {
                const calendarDays = document.getElementById('calendar-days');
                if (!calendarDays) return;
                
                calendarDays.innerHTML = '';
                
                // Update month/year display
                const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                const currentMonthYear = document.getElementById('current-month-year');
                if (currentMonthYear) {
                    currentMonthYear.textContent = `${monthNames[state.calendar.currentMonth]} ${state.calendar.currentYear}`;
                }
                
                // Get first day of month and number of days
                const firstDay = new Date(state.calendar.currentYear, state.calendar.currentMonth, 1).getDay();
                const daysInMonth = new Date(state.calendar.currentYear, state.calendar.currentMonth + 1, 0).getDate();
                
                // Add empty cells for days before the first day of month
                for (let i = 0; i < firstDay; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = 'h-10';
                    calendarDays.appendChild(emptyCell);
                }
                
                // Add days
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayCell = document.createElement('div');
                    const currentDate = new Date(state.calendar.currentYear, state.calendar.currentMonth, day);
                    
                    dayCell.className = 'calendar-day h-10 flex items-center justify-center rounded cursor-pointer hover:bg-primary/10 transition-colors';
                    dayCell.textContent = day;
                    
                    // Handle date selection for range
                    dayCell.addEventListener('click', function() {
                        const selectedDate = new Date(state.calendar.currentYear, state.calendar.currentMonth, day);
                        
                        if (!state.calendar.startDate || (state.calendar.startDate && state.calendar.endDate)) {
                            // Start new selection
                            state.calendar.startDate = selectedDate;
                            state.calendar.endDate = null;
                        } else if (selectedDate >= state.calendar.startDate) {
                            // Set end date
                            state.calendar.endDate = selectedDate;
                        } else {
                            // Selected date is before start date, make it the new start
                            state.calendar.endDate = state.calendar.startDate;
                            state.calendar.startDate = selectedDate;
                        }
                        
                        updateDateInputs();
                        highlightSelectedRange();
                    });
                    
                    calendarDays.appendChild(dayCell);
                }
                
                highlightSelectedRange();
            };
            
            // Update date inputs in calendar modal
            const updateDateInputs = () => {
                const startDateInput = document.getElementById('start-date');
                const endDateInput = document.getElementById('end-date');
                
                if (startDateInput && state.calendar.startDate) {
                    startDateInput.value = formatDate(state.calendar.startDate.toISOString().split('T')[0]);
                }
                
                if (endDateInput && state.calendar.endDate) {
                    endDateInput.value = formatDate(state.calendar.endDate.toISOString().split('T')[0]);
                }
            };
            
            // Highlight selected date range
            const highlightSelectedRange = () => {
                const dayElements = document.querySelectorAll('.calendar-day');
                
                dayElements.forEach(dayEl => {
                    const day = parseInt(dayEl.textContent);
                    const dayDate = new Date(state.calendar.currentYear, state.calendar.currentMonth, day);
                    
                    // Remove previous styling
                    dayEl.classList.remove('bg-primary', 'text-white', 'bg-primary/20');
                    
                    if (state.calendar.startDate && dayDate.getTime() === state.calendar.startDate.getTime()) {
                        dayEl.classList.add('bg-primary', 'text-white');
                    } else if (state.calendar.endDate && dayDate.getTime() === state.calendar.endDate.getTime()) {
                        dayEl.classList.add('bg-primary', 'text-white');
                    } else if (state.calendar.startDate && state.calendar.endDate && 
                               dayDate > state.calendar.startDate && dayDate < state.calendar.endDate) {
                        dayEl.classList.add('bg-primary/20');
                    }
                });
            };
            
            // Initialize the application
            const init = () => {
                // Cache DOM elements
                cacheElements();
                
                // Load configuration and data
                loadConfig();
                const dataLoaded = loadData();
                
                // Initialize data structures
                initializeDataStructures();
                
                // Setup event listeners
                setupEventListeners();
                
                // Initialize UI
                updateDateDisplay();
                updateDateNavigationButtons();
                updateDarkModeToggle();
                updateConfigUI();
                
                // Initialize charts after a short delay to ensure DOM is ready
                setTimeout(() => {
                    initializeCharts();
                }, 100);
                
                // Show initial page
                showPage('dashboard');
                
                // Start auto save if enabled
                if (state.config.autoSave) {
                    startAutoSave();
                }
                
                // Show welcome message
                if (!dataLoaded) {
                    showToast('Bem-vindo ao GGOMES-LOG! Sistema iniciado com sucesso.', 'success', 5000);
                } else {
                    showToast('Dados carregados com sucesso!', 'success');
                }
                
                // Apply dark mode from system preference if not set by user
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches && !localStorage.getItem('ggomes-log-config')) {
                    document.documentElement.classList.add('dark');
                    state.config.darkMode = true;
                    updateDarkModeToggle();
                    updateChartsTheme();
                }
                
                console.log('GGOMES-LOG initialized successfully');
            };
            
            // Public API
            return {
                init,
                showPage,
                saveData,
                loadData,
                showToast,
                // Expose some utilities for debugging
                state: () => state,
                elements: () => elements
            };
        })();
        
        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            App.init();
        });
        
        // Handle page visibility for auto-save
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'hidden') {
                // Page is being hidden, save data
                App.saveData();
            }
        });
        
        // Handle beforeunload for data saving
        window.addEventListener('beforeunload', function(e) {
            App.saveData();
        });
    </script>
</body>
</html>
