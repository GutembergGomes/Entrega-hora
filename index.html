<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gest√£o de Entrega de Safra 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.0.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.2.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.25/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#5D5CDE',
                            '50': '#EEEEFF',
                            '100': '#D4D4F7',
                            '200': '#ACACEF',
                            '300': '#8584E7',
                            '400': '#5D5CDE',
                            '500': '#3635D5',
                            '600': '#2A29B0',
                            '700': '#211F8A',
                            '800': '#171664',
                            '900': '#0D0C3E'
                        },
                        secondary: {
                            DEFAULT: '#6B7280',
                            '50': '#F9FAFB',
                            '100': '#F3F4F6',
                            '200': '#E5E7EB',
                            '300': '#D1D5DB',
                            '400': '#9CA3AF',
                            '500': '#6B7280',
                            '600': '#4B5563',
                            '700': '#374151',
                            '800': '#1F2937',
                            '900': '#111827'
                        },
                        success: {
                            DEFAULT: '#10B981',
                            '50': '#ECFDF5',
                            '100': '#D1FAE5',
                            '200': '#A7F3D0',
                            '300': '#6EE7B7',
                            '400': '#34D399',
                            '500': '#10B981',
                            '600': '#059669',
                            '700': '#047857',
                            '800': '#065F46',
                            '900': '#064E3B'
                        },
                        warning: {
                            DEFAULT: '#F59E0B',
                            '50': '#FFFBEB',
                            '100': '#FEF3C7',
                            '200': '#FDE68A',
                            '300': '#FCD34D',
                            '400': '#FBBF24',
                            '500': '#F59E0B',
                            '600': '#D97706',
                            '700': '#B45309',
                            '800': '#92400E',
                            '900': '#78350F'
                        },
                        danger: {
                            DEFAULT: '#EF4444',
                            '50': '#FEF2F2',
                            '100': '#FEE2E2',
                            '200': '#FECACA',
                            '300': '#FCA5A5',
                            '400': '#F87171',
                            '500': '#EF4444',
                            '600': '#DC2626',
                            '700': '#B91C1C',
                            '800': '#991B1B',
                            '900': '#7F1D1D'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    },
                    boxShadow: {
                        'inner-sm': 'inset 0 1px 2px 0 rgba(0, 0, 0, 0.05)',
                        'soft': '0 2px 15px -3px rgba(0, 0, 0, 0.07), 0 10px 20px -2px rgba(0, 0, 0, 0.04)',
                        'card': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)'
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'progress': 'progress 1s ease-in-out infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'bounce-sm': 'bounce-sm 1s infinite',
                        'fadeIn': 'fadeIn 0.3s ease-in-out',
                        'fadeOut': 'fadeOut 0.3s ease-in-out',
                        'slideIn': 'slideIn 0.3s ease-in-out',
                        'slideOut': 'slideOut 0.3s ease-in-out'
                    },
                    keyframes: {
                        progress: {
                            '0%': { width: '0%' },
                            '100%': { width: '100%' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        'bounce-sm': {
                            '0%, 100%': {
                                transform: 'translateY(-2px)',
                                animationTimingFunction: 'cubic-bezier(0.8, 0, 1, 1)'
                            },
                            '50%': {
                                transform: 'translateY(0)',
                                animationTimingFunction: 'cubic-bezier(0, 0, 0.2, 1)'
                            }
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        fadeOut: {
                            '0%': { opacity: '1' },
                            '100%': { opacity: '0' }
                        },
                        slideIn: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(0)' }
                        },
                        slideOut: {
                            '0%': { transform: 'translateX(0)' },
                            '100%': { transform: 'translateX(-100%)' }
                        }
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <style>
        [x-cloak] { display: none !important; }
        .input-number {
            -moz-appearance: textfield;
            appearance: textfield;
        }
        .input-number::-webkit-outer-spin-button,
        .input-number::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* Skeleton loading effect */
        .skeleton {
            animation: skeleton-loading 1.5s infinite;
            background-image: linear-gradient(90deg, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0));
            background-size: 200px 100%;
            background-repeat: no-repeat;
            background-position: -200px 0;
        }
        
        @keyframes skeleton-loading {
            100% { background-position: 200px 0; }
        }
        
        .dark .skeleton {
            animation: skeleton-loading-dark 1.5s infinite;
            background-image: linear-gradient(90deg, rgba(50, 50, 50, 0), rgba(50, 50, 50, 0.4), rgba(50, 50, 50, 0));
            background-size: 200px 100%;
            background-repeat: no-repeat;
            background-position: -200px 0;
        }
        
        @keyframes skeleton-loading-dark {
            100% { background-position: 200px 0; }
        }
        
        /* Transitions */
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
        }
        .dark ::-webkit-scrollbar-track {
            background: #374151;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #4B5563;
        }
        .dark ::-webkit-scrollbar-thumb:hover {
            background: #6B7280;
        }
        
        /* Tooltip styles */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltip-text {
            visibility: hidden;
            width: auto;
            min-width: 120px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            white-space: nowrap;
        }
        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: rgba(0, 0, 0, 0.8) transparent transparent transparent;
        }
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        .dark .tooltip .tooltip-text {
            background-color: rgba(255, 255, 255, 0.8);
            color: #000;
        }
        .dark .tooltip .tooltip-text::after {
            border-color: rgba(255, 255, 255, 0.8) transparent transparent transparent;
        }

        /* Dashboard card hover effects */
        .dashboard-card {
            transition: all 0.3s ease;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        /* Calendar styles */
        .calendar-day {
            transition: all 0.2s ease;
        }
        
        .calendar-day:hover:not(.disabled) {
            background-color: rgba(93, 92, 222, 0.1);
        }
        
        .calendar-day.selected {
            background-color: rgba(93, 92, 222, 0.2);
            font-weight: bold;
        }
        
        .calendar-day.current {
            border: 2px solid #5D5CDE;
        }
        
        .calendar-day.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .calendar-day.has-data {
            position: relative;
        }
        
        .calendar-day.has-data::after {
            content: "";
            position: absolute;
            bottom: 3px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background-color: #5D5CDE;
            border-radius: 50%;
        }
        
        /* Print styles */
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                background-color: white !important;
                color: black !important;
            }
            
            .print-full-width {
                width: 100% !important;
                max-width: 100% !important;
            }
            
            .print-break-after {
                page-break-after: always;
            }
        }
        
        /* Touch area increase for mobile */
        @media (max-width: 768px) {
            .touch-target {
                min-height: 44px;
                min-width: 44px;
            }
        }
        
        /* Dark mode transition */
        .dark-transition {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        /* Focus ring accessibility */
        .focus-ring:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.5);
        }
        
        /* Front detail row hover effect */
        .front-detail-row {
            transition: all 0.2s ease;
        }
        
        .front-detail-row:hover {
            background-color: rgba(93, 92, 222, 0.05);
        }
        
        .dark .front-detail-row:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }
        
        /* Loading spinner */
        .loader {
            border-top-color: #5D5CDE;
            animation: spinner 0.6s linear infinite;
        }
        
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Date navigation styles */
        .date-nav-button {
            transition: all 0.2s ease;
        }
        
        .date-nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .date-nav-button:hover:not(:disabled) {
            background-color: rgba(93, 92, 222, 0.1);
        }
        
        .date-has-data {
            position: relative;
        }
        
        .date-has-data::after {
            content: "";
            position: absolute;
            top: -3px;
            right: -3px;
            width: 8px;
            height: 8px;
            background-color: #10B981;
            border-radius: 50%;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen transition-colors duration-200">
    <div class="drawer-wrapper relative">
        <!-- Left Side Drawer -->
        <div id="left-drawer" class="fixed left-0 top-0 h-full w-64 bg-white dark:bg-gray-800 shadow-lg transform -translate-x-full transition-transform duration-300 ease-in-out z-40">
            <div class="p-4 h-full flex flex-col">
                <!-- App Logo in Drawer -->
                <div class="flex items-center mb-8 mt-4">
                    <div class="h-10 w-10 rounded-md bg-primary flex items-center justify-center text-white font-bold text-xl shadow-md">GG</div>
                    <span class="ml-2 font-semibold text-xl text-gray-900 dark:text-gray-100">GGOMES-LOG</span>
                </div>
                
                <!-- Navigation Links -->
                <nav class="flex-1">
                    <ul class="space-y-1">
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md bg-primary text-white" data-page="dashboard">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                                </svg>
                                Dashboard
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="entrega-hora">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                </svg>
                                Entrega por Hora
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="relatorios">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                An√°lises e Relat√≥rios
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="metas">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Metas e Desempenho
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="historico">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Hist√≥rico Di√°rio
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="configuracoes">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                Configura√ß√µes
                            </a>
                        </li>
                    </ul>
                </nav>
                
                <!-- User section -->
                <div class="border-t border-gray-200 dark:border-gray-700 pt-4 mt-4">
                    <div class="flex items-center">
                        <div class="h-9 w-9 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-800 dark:text-blue-200 font-medium">GG</div>
                        <div class="ml-3">
                            <div class="font-medium text-gray-700 dark:text-gray-300">Gutemberg Gomes</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">Gerente de Opera√ß√µes</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Drawer Backdrop -->
        <div id="drawer-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden transition-opacity duration-300"></div>
        
        <!-- Main Content -->
        <div class="min-h-screen flex flex-col">
            <!-- Top Navigation Bar -->
            <header class="bg-white dark:bg-gray-800 shadow-md sticky top-0 z-10">
                <div class="container mx-auto px-4 py-3">
                    <div class="flex justify-between items-center">
                        <!-- Left Side: Menu Button + Logo -->
                        <div class="flex items-center">
                            <button id="menu-button" class="mr-4 p-2 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary" aria-label="Menu">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                                </svg>
                            </button>
                            <div class="flex items-center">
                                <div class="h-8 w-8 rounded-md bg-primary flex items-center justify-center text-white font-bold text-lg shadow-md">GG</div>
                                <span class="ml-2 font-semibold text-xl text-gray-900 dark:text-gray-100 hidden sm:inline-block">GGOMES-LOG</span>
                            </div>
                        </div>
                        
                        <!-- Center: Date Selector -->
                        <div class="flex items-center space-x-2">
                            <button id="prev-date-btn" class="date-nav-button p-2 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                            </button>
                            <button id="date-selector-btn" class="flex items-center px-3 py-2 bg-gray-100 dark:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                                <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <span id="current-date-display" class="text-sm font-medium">Carregando...</span>
                            </button>
                            <button id="next-date-btn" class="date-nav-button p-2 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Right Side: Actions -->
                        <div class="flex items-center space-x-2 sm:space-x-4">
                            <!-- Current Date Display -->
                            <div class="hidden md:flex items-center mr-4 text-gray-600 dark:text-gray-300">
                                <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <span id="header-date" class="text-sm font-medium"></span>
                            </div>
                            
                            <!-- Search Button -->
                            <button id="search-button" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary" aria-label="Search">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </button>
                            
                            <!-- Notifications -->
                            <div class="relative">
                                <button id="notifications-button" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary" aria-label="Notifications">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                                    </svg>
                                    <span class="absolute top-0 right-0 h-4 w-4 bg-red-500 rounded-full text-xs text-white flex items-center justify-center">3</span>
                                </button>
                                
                                <!-- Notifications Dropdown -->
                                <div id="notifications-dropdown" class="absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-md shadow-lg z-20 hidden transform transition-all duration-300 scale-95 origin-top-right">
                                    <div class="p-3 border-b border-gray-200 dark:border-gray-700">
                                        <div class="flex justify-between items-center">
                                            <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300">Notifica√ß√µes</h3>
                                            <button class="text-xs text-primary hover:text-primary-600 dark:text-primary-300 dark:hover:text-primary-400">Marcar todas como lidas</button>
                                        </div>
                                    </div>
                                    <div class="max-h-80 overflow-y-auto">
                                        <a href="#" class="block p-3 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition duration-150">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-red-100 dark:bg-red-900 flex items-center justify-center text-red-500 dark:text-red-300">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                    </svg>
                                                </div>
                                                <div class="ml-3">
                                                    <p class="text-sm text-gray-700 dark:text-gray-300"><span class="font-medium">Alerta:</span> Entrega abaixo de 50% do potencial na Frente 4001</p>
                                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">H√° 10 minutos</p>
                                                </div>
                                            </div>
                                        </a>
                                        <a href="#" class="block p-3 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition duration-150">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-500 dark:text-blue-300">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
                                                    </svg>
                                                </div>
                                                <div class="ml-3">
                                                    <p class="text-sm text-gray-700 dark:text-gray-300"><span class="font-medium">Nova mensagem:</span> Carlos Mendes comentou sobre o per√≠odo 14:00-16:00</p>
                                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">H√° 30 minutos</p>
                                                </div>
                                            </div>
                                        </a>
                                        <a href="#" class="block p-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition duration-150">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center text-green-500 dark:text-green-300">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                    </svg>
                                                </div>
                                                <div class="ml-3">
                                                    <p class="text-sm text-gray-700 dark:text-gray-300"><span class="font-medium">Meta atingida:</span> Frente 4012 superou a meta di√°ria</p>
                                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">H√° 1 hora</p>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                    <div class="p-2 border-t border-gray-200 dark:border-gray-700">
                                        <a href="#" class="block text-center text-sm text-primary hover:text-primary-600 dark:text-primary-300 dark:hover:text-primary-400">Ver todas</a>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Theme Toggle -->
                            <button id="theme-toggle" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary" aria-label="Toggle theme">
                                <!-- Sun icon -->
                                <svg id="theme-toggle-light-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" />
                                </svg>
                                <!-- Moon icon -->
                                <svg id="theme-toggle-dark-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
                                </svg>
                            </button>
                            
                            <!-- Save Button -->
                            <button id="save-data" class="bg-primary hover:bg-primary-600 text-white px-3 py-2 rounded-md shadow transition duration-200 flex items-center focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                                <svg class="w-4 h-4 mr-1 sm:mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                                </svg>
                                <span class="hidden sm:inline">Salvar</span>
                            </button>
                            
                            <!-- User Menu -->
                            <div class="relative">
                                <button id="user-menu-button" class="flex text-sm bg-gray-100 dark:bg-gray-700 rounded-full focus:outline-none focus:ring-2 focus:ring-primary" aria-expanded="false" aria-haspopup="true">
                                    <div class="h-8 w-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-800 dark:text-blue-200 font-medium">GG</div>
                                </button>
                                
                                <!-- User Menu Dropdown -->
                                <div id="user-menu-dropdown" class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg z-20 hidden transform transition-all duration-300 scale-95 origin-top-right">
                                    <div class="py-1">
                                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150">Perfil</a>
                                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150">Configura√ß√µes</a>
                                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150">Suporte</a>
                                        <div class="border-t border-gray-100 dark:border-gray-700"></div>
                                        <a href="#" class="block px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150">Sair</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Search Modal -->
            <div id="search-modal" class="fixed inset-0 z-50 overflow-y-auto hidden">
                <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                    <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                        <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
                    </div>
                    <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full">
                        <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                            <div class="sm:flex sm:items-start">
                                <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                                    <div class="flex items-center justify-between">
                                        <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Pesquisa R√°pida</h3>
                                        <button id="close-search-modal" class="text-gray-400 hover:text-gray-500 focus:outline-none">
                                            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>
                                    <div class="mt-4">
                                        <div class="relative">
                                            <input type="text" id="global-search" class="w-full p-3 pl-10 text-gray-900 dark:text-gray-100 bg-gray-100 dark:bg-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-base" placeholder="Pesquisar frentes, per√≠odos, relat√≥rios..." autofocus>
                                            <div class="absolute left-3 top-3 text-gray-400">
                                                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                                </svg>
                                            </div>
                                        </div>
                                        <div class="mt-2 text-sm text-gray-500 dark:text-gray-400 flex items-center justify-between">
                                            <span>
                                                Pressione <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded">Enter</kbd> para pesquisar
                                            </span>
                                            <span>
                                                <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded">ESC</kbd> para fechar
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <!-- Search Results -->
                                    <div class="mt-4 max-h-96 overflow-y-auto">
                                        <h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Resultados Recentes</h4>
                                        <div id="search-results" class="space-y-2">
                                            <a href="#" class="block p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150">
                                                <div class="flex items-center">
                                                    <div class="flex-shrink-0 h-8 w-8 rounded-md bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-500 dark:text-blue-300">
                                                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                                        </svg>
                                                    </div>
                                                    <div class="ml-3">
                                                        <p class="text-sm font-medium text-gray-900 dark:text-gray-100">Frente 4001</p>
                                                        <p class="text-xs text-gray-500 dark:text-gray-400">Entrega por Hora > Per√≠odo 06:00-08:00</p>
                                                    </div>
                                                </div>
                                            </a>
                                            <a href="#" class="block p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150">
                                                <div class="flex items-center">
                                                    <div class="flex-shrink-0 h-8 w-8 rounded-md bg-green-100 dark:bg-green-900 flex items-center justify-center text-green-500 dark:text-green-300">
                                                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                                        </svg>
                                                    </div>
                                                    <div class="ml-3">
                                                        <p class="text-sm font-medium text-gray-900 dark:text-gray-100">Relat√≥rio Mensal</p>
                                                        <p class="text-xs text-gray-500 dark:text-gray-400">An√°lises e Relat√≥rios > Desempenho Mensal</p>
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                            <button type="button" id="search-execute" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary text-base font-medium text-white hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:ml-3 sm:w-auto sm:text-sm">
                                Pesquisar
                            </button>
                            <button type="button" id="search-cancel" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                                Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Date Selector Modal -->
            <div id="date-selector-modal" class="fixed inset-0 z-50 overflow-y-auto hidden">
                <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                    <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                        <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
                    </div>
                    <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full">
                        <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Selecionar Data</h3>
                                <button id="close-date-selector-modal" class="text-gray-400 hover:text-gray-500 focus:outline-none">
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            
                            <div class="flex justify-between items-center mb-4">
                                <button id="prev-month-btn" class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                    </svg>
                                </button>
                                <div id="date-selector-month-year" class="text-lg font-semibold text-gray-900 dark:text-gray-100">Julho 2025</div>
                                <button id="next-month-btn" class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                </button>
                            </div>
                            
                            <div class="grid grid-cols-7 gap-1 text-center text-xs font-medium text-gray-500 dark:text-gray-400">
                                <div>Dom</div>
                                <div>Seg</div>
                                <div>Ter</div>
                                <div>Qua</div>
                                <div>Qui</div>
                                <div>Sex</div>
                                <div>S√°b</div>
                            </div>
                            
                            <div id="date-selector-days" class="grid grid-cols-7 gap-1 mt-2">
                                <!-- Calendar days will be generated here -->
                            </div>
                            
                            <div class="mt-6 flex justify-between">
                                <button id="today-btn" class="px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition duration-200 focus:outline-none focus:ring-2 focus:ring-primary">
                                    Hoje
                                </button>
                                <button id="new-date-btn" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-600 transition duration-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                                    Nova Data
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content Container -->
            <main class="flex-1 p-4 container mx-auto">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-soft p-6 mb-6">
                    <div class="mb-6 flex flex-col md:flex-row md:justify-between md:items-center space-y-4 md:space-y-0">
                        <div>
                            <h1 id="page-title" class="text-2xl font-bold text-gray-900 dark:text-gray-100">Dashboard</h1>
                            <p id="page-subtitle" class="text-gray-600 dark:text-gray-400 mt-1">Vis√£o geral do desempenho da safra 2025</p>
                        </div>
                        <div class="flex flex-wrap gap-2 items-center">
                            <div class="relative">
                                <select id="period-selector" class="appearance-none bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white dark:focus:bg-gray-800 focus:border-primary transition duration-150 text-base">
                                    <option value="daily">Hoje</option>
                                    <option value="weekly">Esta Semana</option>
                                    <option value="monthly">Este M√™s</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300">
                                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                        <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                    </svg>
                                </div>
                            </div>
                            <button id="custom-date-button" class="hidden items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <span id="custom-date-range">Selecionar Datas</span>
                            </button>
                            <button id="export-dashboard" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150 focus:outline-none focus:ring-2 focus:ring-primary">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                                Exportar
                            </button>
                        </div>
                    </div>
                    
                    <!-- Dashboard Content -->
                    <div id="dashboard-content" class="page-content">
                        <!-- Dashboard Stats Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Entregue</p>
                                        <p class="text-2xl font-bold text-gray-900 dark:text-gray-100">3,245.8</p>
                                        <span class="inline-flex items-center text-sm font-medium text-green-600 dark:text-green-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                                            </svg>
                                            12.5% <span class="ml-1 text-gray-500 dark:text-gray-400">vs semana anterior</span>
                                        </span>
                                    </div>
                                    <div class="bg-primary-50 dark:bg-primary-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-primary-500 dark:text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-primary rounded-full h-2" style="width: 85%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">85% da meta mensal</p>
                                </div>
                            </div>
                            
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Efici√™ncia M√©dia</p>
                                        <p class="text-2xl font-bold text-gray-900 dark:text-gray-100">78.4%</p>
                                        <span class="inline-flex items-center text-sm font-medium text-red-600 dark:text-red-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
                                            </svg>
                                            3.2% <span class="ml-1 text-gray-500 dark:text-gray-400">vs semana anterior</span>
                                        </span>
                                    </div>
                                    <div class="bg-blue-50 dark:bg-blue-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-blue-500 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-blue-500 rounded-full h-2" style="width: 78.4%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Meta: 85%</p>
                                </div>
                            </div>
                            
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Viagens Realizadas</p>
                                        <p class="text-2xl font-bold text-gray-900 dark:text-gray-100">1,245</p>
                                        <span class="inline-flex items-center text-sm font-medium text-green-600 dark:text-green-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                                            </svg>
                                            8.7% <span class="ml-1 text-gray-500 dark:text-gray-400">vs semana anterior</span>
                                        </span>
                                    </div>
                                    <div class="bg-green-50 dark:bg-green-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-green-500 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-green-500 rounded-full h-2" style="width: 92%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">92% da meta mensal</p>
                                </div>
                            </div>
                            
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Densidade M√©dia</p>
                                        <p class="text-2xl font-bold text-gray-900 dark:text-gray-100">68.92</p>
                                        <span class="inline-flex items-center text-sm font-medium text-green-600 dark:text-green-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                                            </svg>
                                            1.2% <span class="ml-1 text-gray-500 dark:text-gray-400">vs semana anterior</span>
                                        </span>
                                    </div>
                                    <div class="bg-purple-50 dark:bg-purple-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-purple-500 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-purple-500 rounded-full h-2" style="width: 88%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Meta: 65.00</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Dashboard Main Charts -->
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                            <div class="lg:col-span-2 bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Entrega por Per√≠odo (06:00-06:00)</h3>
                                    <div class="flex space-x-2">
                                        <button class="period-chart-option px-2 py-1 text-xs font-medium rounded bg-primary text-white" data-period="day">Dia</button>
                                        <button class="period-chart-option px-2 py-1 text-xs font-medium rounded bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600" data-period="week">Semana</button>
                                        <button class="period-chart-option px-2 py-1 text-xs font-medium rounded bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600" data-period="month">M√™s</button>
                                    </div>
                                </div>
                                <div class="h-80">
                                    <canvas id="deliveryByPeriodChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Desempenho por Frente</h3>
                                <div class="h-80">
                                    <canvas id="frontPerformanceChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Delivery By Front Chart -->
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm mb-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Total Entregue por Frente (Toneladas)</h3>
                                <div class="flex space-x-2">
                                    <select id="delivery-view-selector" class="text-sm bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded px-2 py-1 text-base">
                                        <option value="absolute">Valores Absolutos</option>
                                        <option value="percentage">Porcentagem do Total</option>
                                    </select>
                                </div>
                            </div>
                            <div class="h-80">
                                <canvas id="deliveryByFrontChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Dashboard Trips and Trucks per Hour -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Viagens por Frente</h3>
                                <div class="h-80">
                                    <canvas id="tripsByFrontChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">M√©dia de Caminh√µes/Hora por Frente</h3>
                                <div class="h-80">
                                    <canvas id="trucksPerHourChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Detailed Front Performance Table -->
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm mb-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Detalhamento por Frente</h3>
                                <button id="refresh-front-details" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-1 px-3 rounded text-sm transition duration-150 focus:outline-none focus:ring-2 focus:ring-primary">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    Atualizar
                                </button>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-800">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Frente</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Total Entregue</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Total Previsto</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">N√£o Entregue</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Efici√™ncia</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Viagens</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Densidade M√©dia</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Progresso</th>
                                        </tr>
                                    </thead>
                                    <tbody id="front-details-table" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <!-- Table rows will be populated by JavaScript -->
                                    </tbody>
                                    <tfoot class="bg-gray-50 dark:bg-gray-700 font-semibold">
                                        <tr>
                                            <td class="px-4 py-3 whitespace-nowrap">TOTAL</td>
                                            <td id="total-entregue" class="px-4 py-3 whitespace-nowrap">0.00</td>
                                            <td id="total-potencial" class="px-4 py-3 whitespace-nowrap">0.00</td>
                                            <td id="total-nao-entregue" class="px-4 py-3 whitespace-nowrap text-danger-600 dark:text-danger-400">0.00</td>
                                            <td id="total-eficiencia" class="px-4 py-3 whitespace-nowrap">0%</td>
                                            <td id="total-viagens" class="px-4 py-3 whitespace-nowrap">0</td>
                                            <td id="total-densidade" class="px-4 py-3 whitespace-nowrap">0.00</td>
                                            <td class="px-4 py-3">
                                                <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5 relative overflow-hidden">
                                                    <div id="total-progress-bar" class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
                                                </div>
                                                <span id="total-progress-text" class="text-xs mt-1 block text-right">0%</span>
                                            </td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Entrega por Hora Content -->
                    <div id="entrega-hora-content" class="page-content hidden">
                        <div class="mb-6 flex flex-col md:flex-row md:justify-between md:items-center space-y-4 md:space-y-0">
                            <div>
                                <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100">Per√≠odos de Entrega</h2>
                                <p class="text-gray-600 dark:text-gray-400 mt-1">Gerencie as entregas por per√≠odos de 2 horas (06:00-06:00)</p>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <button id="manage-fronts" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150 focus:outline-none focus:ring-2 focus:ring-primary">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                    Gerenciar Frentes
                                </button>
                                <button id="clear-period" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150 focus:outline-none focus:ring-2 focus:ring-primary">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                    Limpar Per√≠odo
                                </button>
                                <button id="copy-previous" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150 focus:outline-none focus:ring-2 focus:ring-primary">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                    </svg>
                                    Copiar Anterior
                                </button>
                                <div class="dropdown relative">
                                    <button id="export-dropdown-btn" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150 focus:outline-none focus:ring-2 focus:ring-primary">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                        </svg>
                                        Exportar
                                    </button>
                                    <div id="export-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg z-20 transform transition-all duration-300 scale-95 origin-top-right">
                                        <div class="py-1">
                                            <a href="#" id="export-json" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150">Exportar JSON</a>
                                            <a href="#" id="export-csv" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150">Exportar CSV</a>
                                            <a href="#" id="export-pdf" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150">Exportar PDF</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Period Selection Tabs -->
                        <div class="mb-6 overflow-x-auto">
                            <div class="flex space-x-2 min-w-max">
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-primary text-white" data-period="06-08">06:00-08:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="08-10">08:00-10:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="10-12">10:00-12:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="12-14">12:00-14:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="14-16">14:00-16:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="16-18">16:00-18:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="18-20">18:00-20:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="20-22">20:00-22:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="22-00">22:00-00:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="00-02">00:00-02:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="02-04">02:00-04:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="04-06">04:00-06:00</button>
                            </div>
                        </div>
                        
                        <!-- Loading Indicator -->
                        <div id="loading-indicator" class="p-10 text-center hidden">
                            <div class="inline-block border-4 border-gray-300 dark:border-gray-600 border-t-primary h-12 w-12 rounded-full loader"></div>
                            <p class="mt-2 text-gray-600 dark:text-gray-400">Carregando dados...</p>
                        </div>
                        
                        <!-- Time Period Content -->
                        <div id="time-period-content">
                            <!-- Content will be generated dynamically by the generateTimePeriodHTML() function -->
                        </div>
                    </div>
                    
                    <!-- Relat√≥rios Content -->
                    <div id="relatorios-content" class="page-content hidden">
                        <div class="text-center py-10">
                            <div class="inline-block p-6 bg-primary/10 dark:bg-primary/20 rounded-lg">
                                <svg class="w-16 h-16 mx-auto text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                <h2 class="mt-4 text-xl font-bold text-gray-900 dark:text-gray-100">An√°lises e Relat√≥rios</h2>
                                <p class="mt-2 text-gray-600 dark:text-gray-400">P√°gina em desenvolvimento. Relat√≥rios detalhados e an√°lises estar√£o dispon√≠veis em breve.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Metas Content -->
                    <div id="metas-content" class="page-content hidden">
                        <div class="text-center py-10">
                            <div class="inline-block p-6 bg-primary/10 dark:bg-primary/20 rounded-lg">
                                <svg class="w-16 h-16 mx-auto text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <h2 class="mt-4 text-xl font-bold text-gray-900 dark:text-gray-100">Metas e Desempenho</h2>
                                <p class="mt-2 text-gray-600 dark:text-gray-400">P√°gina em desenvolvimento. Acompanhamento de metas e desempenho estar√£o dispon√≠veis em breve.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Hist√≥rico Di√°rio Content -->
                    <div id="historico-content" class="page-content hidden">
                        <div class="mb-6">
                            <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100 mb-4">Hist√≥rico Di√°rio de Entregas</h2>
                            <p class="text-gray-600 dark:text-gray-400 mb-6">Visualize o hist√≥rico de todos os dias com registros de entrega.</p>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                                <div class="flex justify-between items-center mb-6">
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">
                                        <span id="history-month-year">Julho 2025</span>
                                    </h3>
                                    <div class="flex items-center space-x-2">
                                        <button id="history-prev-month" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                            </svg>
                                        </button>
                                        <button id="history-next-month" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-7 gap-1 text-center text-xs font-medium text-gray-500 dark:text-gray-400 mb-2">
                                    <div>Dom</div>
                                    <div>Seg</div>
                                    <div>Ter</div>
                                    <div>Qua</div>
                                    <div>Qui</div>
                                    <div>Sex</div>
                                    <div>S√°b</div>
                                </div>
                                
                                <div id="history-calendar" class="grid grid-cols-7 gap-2">
                                    <!-- Calendar will be generated here -->
                                </div>
                                
                                <div class="mt-6 flex items-center justify-between">
                                    <div class="flex items-center space-x-6">
                                        <div class="flex items-center">
                                            <span class="inline-block w-3 h-3 rounded-full bg-primary mr-2"></span>
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Dia atual</span>
                                        </div>
                                        <div class="flex items-center">
                                            <span class="inline-block w-3 h-3 rounded-full bg-green-500 mr-2"></span>
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Com dados</span>
                                        </div>
                                    </div>
                                    <button id="export-history" class="flex items-center text-sm bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-3 rounded transition duration-150 focus:outline-none focus:ring-2 focus:ring-primary">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                        </svg>
                                        Exportar Hist√≥rico
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Daily Summary Table -->
                            <div class="mt-8 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                                <div class="flex justify-between items-center mb-6">
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Sum√°rio de Entregas Di√°rias</h3>
                                    <select id="history-period-filter" class="text-sm bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded px-3 py-2 text-base">
                                        <option value="all">Todos os per√≠odos</option>
                                        <option value="06-08">06:00-08:00</option>
                                        <option value="08-10">08:00-10:00</option>
                                        <option value="10-12">10:00-12:00</option>
                                        <option value="12-14">12:00-14:00</option>
                                        <option value="14-16">14:00-16:00</option>
                                        <option value="16-18">16:00-18:00</option>
                                        <option value="18-20">18:00-20:00</option>
                                        <option value="20-22">20:00-22:00</option>
                                        <option value="22-00">22:00-00:00</option>
                                        <option value="00-02">00:00-02:00</option>
                                        <option value="02-04">02:00-04:00</option>
                                        <option value="04-06">04:00-06:00</option>
                                    </select>
                                </div>
                                
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-800">
                                            <tr>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Data</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Total Entregue</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Total Previsto</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Efici√™ncia</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Viagens</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Densidade M√©dia</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">A√ß√µes</th>
                                            </tr>
                                        </thead>
                                        <tbody id="history-table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <!-- Table rows will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div id="history-empty-state" class="py-12 text-center">
                                    <svg class="w-16 h-16 mx-auto text-gray-300 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                    <p class="mt-4 text-gray-500 dark:text-gray-400">Nenhum registro de entrega encontrado para o per√≠odo selecionado.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Configura√ß√µes Content -->
                    <div id="configuracoes-content" class="page-content hidden">
                        <div class="max-w-2xl mx-auto">
                            <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100 mb-6">Configura√ß√µes do Sistema</h2>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden mb-6">
                                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">Prefer√™ncias Gerais</h3>
                                </div>
                                <div class="p-4 space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Salvar Automaticamente</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Salva automaticamente as altera√ß√µes</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="auto-save-toggle" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Intervalo de Salvamento (minutos)</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Frequ√™ncia do salvamento autom√°tico</p>
                                        </div>
                                        <div class="w-20">
                                            <input type="number" id="auto-save-interval" class="w-full px-3 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary text-base" min="1" max="60" value="5">
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Modo Escuro</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Alterna entre o tema claro e escuro</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="dark-mode-toggle" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden mb-6">
                                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">Notifica√ß√µes e Alertas</h3>
                                </div>
                                <div class="p-4 space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Limiar de Alerta (%)</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Porcentagem abaixo da meta para disparar alerta</p>
                                        </div>
                                        <div class="w-20">
                                            <input type="number" id="alert-threshold" class="w-full px-3 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary text-base" min="1" max="50" value="10">
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Alertas Sonoros</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Emite sons para alertas importantes</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="sound-alert-toggle" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Alertas Visuais</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Mostra notifica√ß√µes na interface</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="visual-alert-toggle" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-end space-x-3">
                                <button id="restore-defaults" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary transition duration-150">
                                    Restaurar Padr√µes
                                </button>
                                <button id="save-config" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition duration-150">
                                    Salvar Configura√ß√µes
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            
            <!-- Footer -->
            <footer class="bg-white dark:bg-gray-800 shadow-md mt-auto">
                <div class="container mx-auto px-4 py-4">
                    <div class="flex flex-col md:flex-row justify-between items-center">
                        <div class="text-sm text-gray-600 dark:text-gray-400 mb-4 md:mb-0">
                            ¬© 2025 GGOMES-LOG - Gest√£o de Entrega de Safra
                        </div>
                        <div class="flex space-x-4">
                            <a href="#" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary-300 transition-colors duration-150">Termos de Uso</a>
                            <a href="#" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary-300 transition-colors duration-150">Pol√≠tica de Privacidade</a>
                            <a href="#" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary-300 transition-colors duration-150">Suporte</a>
                            <span class="text-sm text-gray-400 dark:text-gray-500">Vers√£o 5.0.0</span>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    
    <!-- Calendar Modal -->
    <div id="calendar-modal" class="fixed inset-0 z-50 overflow-y-auto hidden">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
            </div>
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Selecionar Per√≠odo</h3>
                                <button id="close-calendar-modal" class="text-gray-400 hover:text-gray-500 focus:outline-none">
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="mt-4">
                                <div class="flex justify-between items-center mb-4">
                                    <button id="prev-month" class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                        </svg>
                                    </button>
                                    <div id="current-month-year" class="text-lg font-semibold text-gray-900 dark:text-gray-100">Julho 2024</div>
                                    <button id="next-month" class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                        </svg>
                                    </button>
                                </div>
                                
                                <div class="grid grid-cols-7 gap-1 text-center text-xs font-medium text-gray-500 dark:text-gray-400">
                                    <div>Dom</div>
                                    <div>Seg</div>
                                    <div>Ter</div>
                                    <div>Qua</div>
                                    <div>Qui</div>
                                    <div>Sex</div>
                                    <div>S√°b</div>
                                </div>
                                
                                <div id="calendar-days" class="grid grid-cols-7 gap-1 mt-2">
                                    <!-- Calendar days will be generated here -->
                                </div>
                                
                                <div class="mt-4">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Per√≠odo Selecionado</span>
                                    </div>
                                    <div class="flex space-x-2">
                                        <div class="flex-1">
                                            <label for="start-date" class="block text-xs text-gray-500 dark:text-gray-400">In√≠cio</label>
                                            <input type="text" id="start-date" class="block w-full p-2 text-sm bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md text-base" readonly>
                                        </div>
                                        <div class="flex-1">
                                            <label for="end-date" class="block text-xs text-gray-500 dark:text-gray-400">Fim</label>
                                            <input type="text" id="end-date" class="block w-full p-2 text-sm bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md text-base" readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="apply-date-range" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary text-base font-medium text-white hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:ml-3 sm:w-auto sm:text-sm">
                        Aplicar
                    </button>
                    <button type="button" id="cancel-date-range" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Manage Fronts Modal -->
    <div id="manage-fronts-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-lg w-full relative z-10 shadow-lg transform transition-all duration-300 scale-95 opacity-0">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-gray-900 dark:text-gray-100">Gerenciar Frentes</h3>
                <button id="close-fronts-modal" class="text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary rounded">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="mb-6">
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Adicione ou remova frentes de entrega. Ao remover uma frente, todos os dados associados ser√£o exclu√≠dos.</p>
                
                <!-- Add new front -->
                <div class="flex items-end space-x-2 mb-4">
                    <div class="flex-1">
                        <label for="new-front-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nova Frente</label>
                        <input type="text" id="new-front-input" placeholder="Ex: 4010" class="w-full px-3 py-2 text-base text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <button id="add-front-btn" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-600 transition duration-200 flex items-center focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        Adicionar
                    </button>
                </div>
                
                <!-- Current fronts list -->
                <div class="border border-gray-200 dark:border-gray-700 rounded-md overflow-hidden">
                    <div class="bg-gray-50 dark:bg-gray-700 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                        Frentes Atuais
                    </div>
                    <ul id="fronts-list" class="divide-y divide-gray-200 dark:divide-gray-700 max-h-60 overflow-y-auto">
                        <!-- Fronts will be added here dynamically -->
                    </ul>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3">
                <button id="cancel-fronts-modal" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition duration-200 focus:outline-none focus:ring-2 focus:ring-primary">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50 transition-opacity duration-300"></div>
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full relative z-10 shadow-lg transform transition-all duration-300 scale-95 opacity-0">
            <h3 id="modal-title" class="text-lg font-bold text-gray-900 dark:text-gray-100 mb-4">Confirma√ß√£o</h3>
            <p id="modal-message" class="text-gray-700 dark:text-gray-300 mb-6">Tem certeza que deseja realizar esta a√ß√£o?</p>
            <div class="flex justify-end space-x-3">
                <button id="modal-cancel" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition duration-200 focus:outline-none focus:ring-2 focus:ring-primary">
                    Cancelar
                </button>
                <button id="modal-confirm" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-600 transition duration-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 flex flex-col-reverse space-y-reverse space-y-2"></div>

    <script>
        // App Module Pattern
        const App = (function() {
            // Cache DOM elements for improved performance
            const elements = {};
            
            // State
            const state = {
                // Front data
                fronts: ['4001', '4002', '4007', '4009'],
                hours: [6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 0, 1, 2, 3, 4, 5],
                timePeriodsMap: {
                    '06-08': [6, 7],
                    '08-10': [8, 9],
                    '10-12': [10, 11],
                    '12-14': [12, 13],
                    '14-16': [14, 15],
                    '16-18': [16, 17],
                    '18-20': [18, 19],
                    '20-22': [20, 21],
                    '22-00': [22, 23],
                    '00-02': [0, 1],
                    '02-04': [2, 3],
                    '04-06': [4, 5]
                },
                
                // Date tracking
                currentDate: new Date().toISOString().split('T')[0], // Current date in YYYY-MM-DD format
                availableDates: [], // List of dates with data
                
                // Delivery data - organized by date
                density: {},
                trips: {},
                delivery: {},
                potential: {},
                
                // Period summaries - organized by date
                twoHourDelivery: {},
                twoHourPotential: {},
                difference: {},
                
                // Charts
                charts: {},
                
                // Current active period
                activePeriod: '06-08',
                currentPage: 'dashboard',
                
                // Config
                config: {
                    autoSave: true,
                    autoSaveInterval: 5, // minutes
                    darkMode: false,
                    alertThreshold: 10, // %
                    soundAlerts: false,
                    visualAlerts: true
                },
                
                // Date & calendar
                calendar: {
                    startDate: null,
                    endDate: null,
                    currentMonth: new Date().getMonth(),
                    currentYear: new Date().getFullYear()
                },
                
                // History
                history: [],
                
                // Analytics data
                analytics: {
                    periodData: {
                        day: {
                            // Initialize with all 12 periods for full 24-hour cycle (06:00-06:00)
                            labels: [
                                "06:00-08:00", "08:00-10:00", "10:00-12:00", "12:00-14:00", 
                                "14:00-16:00", "16:00-18:00", "18:00-20:00", "20:00-22:00", 
                                "22:00-00:00", "00:00-02:00", "02:00-04:00", "04:00-06:00"
                            ],
                            datasets: [
                                { label: "Entregas", data: [553, 621, 485, 392, 574, 483, 420, 380, 310, 270, 250, 290] },
                                { label: "Potencial", data: [650, 650, 650, 650, 650, 650, 500, 450, 400, 350, 300, 450] }
                            ]
                        },
                        week: {
                            labels: ["Segunda", "Ter√ßa", "Quarta", "Quinta", "Sexta", "S√°bado", "Domingo"],
                            datasets: [
                                { label: "Entregas", data: [2850, 3100, 2950, 3200, 3400, 2900, 2600] },
                                { label: "Potencial", data: [3500, 3500, 3500, 3500, 3500, 3500, 3500] }
                            ]
                        },
                        month: {
                            labels: ["Semana 1", "Semana 2", "Semana 3", "Semana 4"],
                            datasets: [
                                { label: "Entregas", data: [18000, 19500, 20100, 21000] },
                                { label: "Potencial", data: [22000, 22000, 22000, 22000] }
                            ]
                        }
                    },
                    frontPerformance: {
                        labels: ["F4001", "F4002", "F4007", "F4009"],
                        datasets: [
                            { label: "Efici√™ncia", data: [85, 72, 91, 68] }
                        ]
                    },
                    tripsByFront: {
                        labels: ["F4001", "F4002", "F4007", "F4009"],
                        datasets: [
                            { label: "Viagens", data: [250, 320, 180, 275] }
                        ]
                    },
                    trucksPerHour: {
                        labels: ["F4001", "F4002", "F4007", "F4009"],
                        datasets: [
                            { label: "Caminh√µes/Hora", data: [5.2, 6.7, 3.8, 5.7] }
                        ]
                    },
                    deliveryByFront: {
                        labels: ["F4001", "F4002", "F4007", "F4009"],
                        datasets: [
                            { 
                                label: "Total Entregue (ton)", 
                                data: [865.3, 932.8, 710.5, 737.2],
                                backgroundColor: [
                                    'rgba(93, 92, 222, 0.7)',
                                    'rgba(16, 185, 129, 0.7)',
                                    'rgba(245, 158, 11, 0.7)',
                                    'rgba(14, 165, 233, 0.7)'
                                ],
                                borderColor: [
                                    'rgba(93, 92, 222, 1)',
                                    'rgba(16, 185, 129, 1)',
                                    'rgba(245, 158, 11, 1)',
                                    'rgba(14, 165, 233, 1)'
                                ],
                                borderWidth: 1
                            }
                        ]
                    }
                }
            };
            
            // Auto save timer
            let autoSaveTimer = null;

            // Cache DOM elements for frequently used elements
            const cacheElements = () => {
                // Navigation elements
                elements.drawer = document.getElementById('left-drawer');
                elements.drawerBackdrop = document.getElementById('drawer-backdrop');
                elements.menuButton = document.getElementById('menu-button');
                elements.drawerLinks = document.querySelectorAll('.drawer-link');
                
                // Date navigation elements
                elements.currentDateDisplay = document.getElementById('current-date-display');
                elements.prevDateBtn = document.getElementById('prev-date-btn');
                elements.nextDateBtn = document.getElementById('next-date-btn');
                elements.dateSelectorBtn = document.getElementById('date-selector-btn');
                elements.dateSelectorModal = document.getElementById('date-selector-modal');
                elements.dateSelectorDays = document.getElementById('date-selector-days');
                elements.dateSelectorMonthYear = document.getElementById('date-selector-month-year');
                
                // Page elements
                elements.pageTitle = document.getElementById('page-title');
                elements.pageSubtitle = document.getElementById('page-subtitle');
                elements.pageContents = document.querySelectorAll('.page-content');
                
                // Dashboard elements
                elements.deliveryByPeriodChart = document.getElementById('deliveryByPeriodChart');
                elements.frontPerformanceChart = document.getElementById('frontPerformanceChart');
                elements.deliveryByFrontChart = document.getElementById('deliveryByFrontChart');
                elements.tripsByFrontChart = document.getElementById('tripsByFrontChart');
                elements.trucksPerHourChart = document.getElementById('trucksPerHourChart');
                elements.frontDetailsTable = document.getElementById('front-details-table');
                
                // Entrega por Hora elements
                elements.timePeriodContent = document.getElementById('time-period-content');
                elements.loadingIndicator = document.getElementById('loading-indicator');
                elements.timeTabButtons = document.querySelectorAll('.time-tab-btn');
                
                // History elements
                elements.historyCalendar = document.getElementById('history-calendar');
                elements.historyMonthYear = document.getElementById('history-month-year');
                elements.historyTableBody = document.getElementById('history-table-body');
                elements.historyEmptyState = document.getElementById('history-empty-state');
                
                // Modals
                elements.searchModal = document.getElementById('search-modal');
                elements.calendarModal = document.getElementById('calendar-modal');
                elements.manageFrontsModal = document.getElementById('manage-fronts-modal');
                elements.confirmationModal = document.getElementById('confirmation-modal');
                
                // Dropdowns
                elements.notificationsDropdown = document.getElementById('notifications-dropdown');
                elements.userMenuDropdown = document.getElementById('user-menu-dropdown');
                elements.exportDropdown = document.getElementById('export-dropdown');
                
                // Buttons
                elements.saveDataBtn = document.getElementById('save-data');
                elements.themeToggle = document.getElementById('theme-toggle');
                elements.searchButton = document.getElementById('search-button');
                elements.exportDashboardBtn = document.getElementById('export-dashboard');
                elements.refreshFrontDetailsBtn = document.getElementById('refresh-front-details');
                elements.manageFrontsBtn = document.getElementById('manage-fronts');
                elements.clearPeriodBtn = document.getElementById('clear-period');
                elements.copyPreviousBtn = document.getElementById('copy-previous');
                
                // Toast container
                elements.toastContainer = document.getElementById('toast-container');
            };
            
            // Initialize data structures
            const initializeDataStructures = () => {
                // Initialize date entry for current date if it doesn't exist
                if (!state.density[state.currentDate]) {
                    state.density[state.currentDate] = {};
                    state.trips[state.currentDate] = {};
                    state.delivery[state.currentDate] = {};
                    state.potential[state.currentDate] = {};
                    state.twoHourDelivery[state.currentDate] = {};
                    state.twoHourPotential[state.currentDate] = {};
                    state.difference[state.currentDate] = {};
                    
                    // Add to available dates
                    if (!state.availableDates.includes(state.currentDate)) {
                        state.availableDates.push(state.currentDate);
                        state.availableDates.sort();
                    }
                }
                
                // Initialize delivery data structures for current date
                for (const front of state.fronts) {
                    if (!state.density[state.currentDate][front]) {
                        state.density[state.currentDate][front] = {};
                    }
                    if (!state.trips[state.currentDate][front]) {
                        state.trips[state.currentDate][front] = {};
                    }
                    if (!state.delivery[state.currentDate][front]) {
                        state.delivery[state.currentDate][front] = {};
                    }
                    if (!state.potential[state.currentDate][front]) {
                        state.potential[state.currentDate][front] = {};
                    }
                    
                    for (const hour of state.hours) {
                        if (state.density[state.currentDate][front][hour] === undefined) {
                            state.density[state.currentDate][front][hour] = 0;
                        }
                        if (state.trips[state.currentDate][front][hour] === undefined) {
                            state.trips[state.currentDate][front][hour] = 0;
                        }
                        if (state.delivery[state.currentDate][front][hour] === undefined) {
                            state.delivery[state.currentDate][front][hour] = 0;
                        }
                        if (state.potential[state.currentDate][front][hour] === undefined) {
                            state.potential[state.currentDate][front][hour] = 0;
                        }
                    }
                }
                
                // Initialize period summaries for current date
                for (const period in state.timePeriodsMap) {
                    if (!state.twoHourDelivery[state.currentDate][period]) {
                        state.twoHourDelivery[state.currentDate][period] = {};
                    }
                    if (!state.twoHourPotential[state.currentDate][period]) {
                        state.twoHourPotential[state.currentDate][period] = {};
                    }
                    if (!state.difference[state.currentDate][period]) {
                        state.difference[state.currentDate][period] = {};
                    }
                    
                    for (const front of state.fronts) {
                        if (state.twoHourDelivery[state.currentDate][period][front] === undefined) {
                            state.twoHourDelivery[state.currentDate][period][front] = 0;
                        }
                        if (state.twoHourPotential[state.currentDate][period][front] === undefined) {
                            state.twoHourPotential[state.currentDate][period][front] = 0;
                        }
                        if (state.difference[state.currentDate][period][front] === undefined) {
                            state.difference[state.currentDate][period][front] = 0;
                        }
                    }
                }
            };

            // Setup event listeners
            const setupEventListeners = () => {
                // Menu toggle
                elements.menuButton?.addEventListener('click', () => toggleDrawer());
                elements.drawerBackdrop?.addEventListener('click', () => toggleDrawer(false));
                
                // Page navigation
                elements.drawerLinks.forEach(link => {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        const page = this.getAttribute('data-page');
                        showPage(page);
                        toggleDrawer(false);
                    });
                });
                
                // Theme toggle
                elements.themeToggle?.addEventListener('click', toggleDarkMode);
                
                // Save data
                elements.saveDataBtn?.addEventListener('click', () => {
                    saveData();
                    showToast('Dados salvos com sucesso!', 'success');
                });
                
                // Search button
                elements.searchButton?.addEventListener('click', () => toggleModal(elements.searchModal, true));
                
                // Export dashboard
                elements.exportDashboardBtn?.addEventListener('click', exportDashboard);
                
                // Refresh front details
                elements.refreshFrontDetailsBtn?.addEventListener('click', updateDetailedFrontTable);
                
                // Manage fronts
                elements.manageFrontsBtn?.addEventListener('click', showManageFrontsModal);
                
                // Clear period
                elements.clearPeriodBtn?.addEventListener('click', () => {
                    showConfirmationModal(
                        'Limpar Per√≠odo',
                        `Tem certeza que deseja limpar todos os dados do per√≠odo ${state.activePeriod} para a data ${formatDateDisplay(state.currentDate)}?`,
                        clearCurrentPeriod
                    );
                });
                
                // Copy previous period
                elements.copyPreviousBtn?.addEventListener('click', copyPreviousPeriod);
                
                // Time tab buttons
                elements.timeTabButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const period = this.getAttribute('data-period');
                        switchTimePeriodTab(period);
                    });
                });
                
                // Period chart options
                document.querySelectorAll('.period-chart-option').forEach(option => {
                    option.addEventListener('click', function() {
                        const period = this.getAttribute('data-period');
                        updatePeriodChart(period);
                        
                        // Update active state
                        document.querySelectorAll('.period-chart-option').forEach(btn => {
                            btn.classList.remove('bg-primary', 'text-white');
                            btn.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                        });
                        this.classList.add('bg-primary', 'text-white');
                        this.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                    });
                });
                
                // Date selector button
                elements.dateSelectorBtn?.addEventListener('click', function() {
                    showDateSelectorModal();
                });
                
                // Previous date button
                elements.prevDateBtn?.addEventListener('click', function() {
                    navigateDate(-1);
                });
                
                // Next date button
                elements.nextDateBtn?.addEventListener('click', function() {
                    navigateDate(1);
                });
                
                // Date selector modal close button
                document.getElementById('close-date-selector-modal')?.addEventListener('click', function() {
                    toggleModal(elements.dateSelectorModal, false);
                });
                
                // Date selector month navigation
                document.getElementById('prev-month-btn')?.addEventListener('click', function() {
                    navigateDateSelectorMonth(-1);
                });
                
                document.getElementById('next-month-btn')?.addEventListener('click', function() {
                    navigateDateSelectorMonth(1);
                });
                
                // Today button
                document.getElementById('today-btn')?.addEventListener('click', function() {
                    const today = new Date().toISOString().split('T')[0];
                    changeCurrentDate(today);
                    toggleModal(elements.dateSelectorModal, false);
                });
                
                // New date button
                document.getElementById('new-date-btn')?.addEventListener('click', function() {
                    const date = new Date(state.calendar.currentYear, state.calendar.currentMonth, 1);
                    const newDate = date.toISOString().split('T')[0];
                    changeCurrentDate(newDate);
                    toggleModal(elements.dateSelectorModal, false);
                });
                
                // Custom date range
                document.getElementById('period-selector')?.addEventListener('change', function() {
                    const customDateButton = document.getElementById('custom-date-button');
                    if (this.value === 'custom' && customDateButton) {
                        customDateButton.classList.remove('hidden');
                        customDateButton.classList.add('flex');
                    } else if (customDateButton) {
                        customDateButton.classList.add('hidden');
                        customDateButton.classList.remove('flex');
                    }
                });
                
                // Custom date button
                document.getElementById('custom-date-button')?.addEventListener('click', function() {
                    generateCalendarDays();
                    toggleModal(elements.calendarModal, true);
                });
                
                // Calendar navigation
                document.getElementById('prev-month')?.addEventListener('click', function() {
                    state.calendar.currentMonth--;
                    if (state.calendar.currentMonth < 0) {
                        state.calendar.currentMonth = 11;
                        state.calendar.currentYear--;
                    }
                    generateCalendarDays();
                });
                
                document.getElementById('next-month')?.addEventListener('click', function() {
                    state.calendar.currentMonth++;
                    if (state.calendar.currentMonth > 11) {
                        state.calendar.currentMonth = 0;
                        state.calendar.currentYear++;
                    }
                    generateCalendarDays();
                });
                
                // Calendar modal buttons
                document.getElementById('close-calendar-modal')?.addEventListener('click', () => toggleModal(elements.calendarModal, false));
                document.getElementById('cancel-date-range')?.addEventListener('click', () => toggleModal(elements.calendarModal, false));
                document.getElementById('apply-date-range')?.addEventListener('click', function() {
                    if (state.calendar.startDate && state.calendar.endDate) {
                        const startDateStr = formatDate(state.calendar.startDate);
                        const endDateStr = formatDate(state.calendar.endDate);
                        
                        const customDateRangeEl = document.getElementById('custom-date-range');
                        if (customDateRangeEl) {
                            customDateRangeEl.textContent = `${startDateStr} - ${endDateStr}`;
                        }
                    }
                    
                    toggleModal(elements.calendarModal, false);
                });
                
                // Confirmation modal buttons
                document.getElementById('modal-cancel')?.addEventListener('click', () => toggleModal(elements.confirmationModal, false));
                
                // Manage fronts modal buttons
                document.getElementById('close-fronts-modal')?.addEventListener('click', () => toggleModal(elements.manageFrontsModal, false));
                document.getElementById('cancel-fronts-modal')?.addEventListener('click', () => toggleModal(elements.manageFrontsModal, false));
                document.getElementById('add-front-btn')?.addEventListener('click', addFront);
                
                // Export dropdown toggle
                document.getElementById('export-dropdown-btn')?.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleDropdown(elements.exportDropdown);
                });
                
                // Export buttons
                document.getElementById('export-json')?.addEventListener('click', exportJSON);
                document.getElementById('export-csv')?.addEventListener('click', exportCSV);
                document.getElementById('export-pdf')?.addEventListener('click', exportPDF);
                
                // Notifications dropdown toggle
                document.getElementById('notifications-button')?.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleDropdown(elements.notificationsDropdown);
                });
                
                // User menu dropdown toggle
                document.getElementById('user-menu-button')?.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleDropdown(elements.userMenuDropdown);
                });
                
                // Close dropdowns when clicking elsewhere
                document.addEventListener('click', function(e) {
                    const dropdowns = [elements.notificationsDropdown, elements.userMenuDropdown, elements.exportDropdown];
                    dropdowns.forEach(dropdown => {
                        if (dropdown && !dropdown.classList.contains('hidden')) {
                            toggleDropdown(dropdown, false);
                        }
                    });
                });
                
                // Search modal buttons
                document.getElementById('close-search-modal')?.addEventListener('click', () => toggleModal(elements.searchModal, false));
                document.getElementById('search-cancel')?.addEventListener('click', () => toggleModal(elements.searchModal, false));
                document.getElementById('search-execute')?.addEventListener('click', performSearch);
                
                // Global keyboard shortcuts
                document.addEventListener('keydown', function(e) {
                    // Ctrl + K for search
                    if (e.ctrlKey && e.key === 'k') {
                        e.preventDefault();
                        toggleModal(elements.searchModal, true);
                    }
                    
                    // Alt + M for menu
                    if (e.altKey && e.key === 'm') {
                        e.preventDefault();
                        toggleDrawer();
                    }
                    
                    // Ctrl + S for save
                    if (e.ctrlKey && e.key === 's') {
                        e.preventDefault();
                        saveData();
                        showToast('Dados salvos com sucesso!', 'success');
                    }
                    
                    // Alt + 1-6 for navigation
                    if (e.altKey && !isNaN(parseInt(e.key)) && parseInt(e.key) >= 1 && parseInt(e.key) <= 6) {
                        e.preventDefault();
                        const pages = ['dashboard', 'entrega-hora', 'relatorios', 'metas', 'historico', 'configuracoes'];
                        const index = parseInt(e.key) - 1;
                        
                        if (index < pages.length) {
                            showPage(pages[index]);
                        }
                    }
                    
                    // Ctrl + D for dark mode toggle
                    if (e.ctrlKey && e.key === 'd') {
                        e.preventDefault();
                        toggleDarkMode();
                    }
                    
                    // Alt + Left Arrow for previous day
                    if (e.altKey && e.key === 'ArrowLeft') {
                        e.preventDefault();
                        navigateDate(-1);
                    }
                    
                    // Alt + Right Arrow for next day
                    if (e.altKey && e.key === 'ArrowRight') {
                        e.preventDefault();
                        navigateDate(1);
                    }
                    
                    // Escape to close modals
                    if (e.key === 'Escape') {
                        const activeModals = document.querySelectorAll('.fixed.inset-0:not(.hidden)');
                        if (activeModals.length > 0) {
                            e.preventDefault();
                            activeModals.forEach(modal => {
                                if (modal.id === 'search-modal') toggleModal(elements.searchModal, false);
                                if (modal.id === 'calendar-modal') toggleModal(elements.calendarModal, false);
                                if (modal.id === 'date-selector-modal') toggleModal(elements.dateSelectorModal, false);
                                if (modal.id === 'manage-fronts-modal') toggleModal(elements.manageFrontsModal, false);
                                if (modal.id === 'confirmation-modal') toggleModal(elements.confirmationModal, false);
                            });
                        }
                    }
                });
                
                // Delivery view selector change
                document.getElementById('delivery-view-selector')?.addEventListener('change', function() {
                    updateDeliveryByFrontChart(this.value);
                });
                
                // Configuration form
                document.getElementById('save-config')?.addEventListener('click', function() {
                    updateConfigFromUI();
                    saveConfig();
                    showToast('Configura√ß√µes salvas com sucesso!', 'success');
                });
                
                document.getElementById('restore-defaults')?.addEventListener('click', function() {
                    showConfirmationModal(
                        'Restaurar Padr√µes',
                        'Tem certeza que deseja restaurar todas as configura√ß√µes para os valores padr√£o?',
                        restoreDefaultConfig
                    );
                });
                
                // New front input form
                const newFrontInput = document.getElementById('new-front-input');
                if (newFrontInput) {
                    newFrontInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            addFront();
                        }
                    });
                }
                
                // History navigation
                document.getElementById('history-prev-month')?.addEventListener('click', function() {
                    navigateHistoryMonth(-1);
                });
                
                document.getElementById('history-next-month')?.addEventListener('click', function() {
                    navigateHistoryMonth(1);
                });
                
                // History period filter
                document.getElementById('history-period-filter')?.addEventListener('change', function() {
                    updateHistoryTable();
                });
                
                // Export history
                document.getElementById('export-history')?.addEventListener('click', exportHistoryData);
                
                // Dark mode detection
                if (window.matchMedia) {
                    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                        if (event.matches) {
                            document.documentElement.classList.add('dark');
                            state.config.darkMode = true;
                        } else {
                            document.documentElement.classList.remove('dark');
                            state.config.darkMode = false;
                        }
                        
                        updateDarkModeToggle();
                        updateChartsTheme();
                    });
                }
            };
            
            // Toggle drawer visibility
            const toggleDrawer = (show) => {
                if (!elements.drawer || !elements.drawerBackdrop) return;
                
                if (show === undefined) {
                    show = elements.drawer.classList.contains('-translate-x-full');
                }
                
                if (show) {
                    elements.drawer.classList.remove('-translate-x-full');
                    elements.drawerBackdrop.classList.remove('hidden');
                    setTimeout(() => {
                        elements.drawerBackdrop.classList.add('bg-opacity-50');
                        elements.drawerBackdrop.classList.remove('bg-opacity-0');
                    }, 10);
                } else {
                    elements.drawer.classList.add('-translate-x-full');
                    elements.drawerBackdrop.classList.add('bg-opacity-0');
                    elements.drawerBackdrop.classList.remove('bg-opacity-50');
                    setTimeout(() => {
                        elements.drawerBackdrop.classList.add('hidden');
                    }, 300);
                }
            };
            
            // Toggle dropdown visibility
            const toggleDropdown = (dropdown, show) => {
                if (!dropdown) return;
                
                if (show === undefined) {
                    show = dropdown.classList.contains('hidden');
                }
                
                if (show) {
                    dropdown.classList.remove('hidden', 'scale-95', 'opacity-0');
                    dropdown.classList.add('block', 'scale-100', 'opacity-100');
                } else {
                    dropdown.classList.add('scale-95', 'opacity-0');
                    dropdown.classList.remove('scale-100', 'opacity-100');
                    setTimeout(() => {
                        dropdown.classList.add('hidden');
                        dropdown.classList.remove('block');
                    }, 200);
                }
            };
            
            // Toggle modal visibility with animation
            const toggleModal = (modal, show) => {
                if (!modal) return;
                
                if (show) {
                    modal.classList.remove('hidden');
                    
                    // If it's a fixed-position modal with inner content
                    const innerModal = modal.querySelector('.scale-95, .opacity-0');
                    if (innerModal) {
                        setTimeout(() => {
                            innerModal.classList.remove('scale-95', 'opacity-0');
                            innerModal.classList.add('scale-100', 'opacity-100');
                        }, 10);
                    }
                    
                    // Focus first input if exists
                    const firstInput = modal.querySelector('input:not([readonly])');
                    if (firstInput) {
                        setTimeout(() => firstInput.focus(), 100);
                    }
                } else {
                    // If it's a fixed-position modal with inner content
                    const innerModal = modal.querySelector('.scale-100, .opacity-100');
                    if (innerModal) {
                        innerModal.classList.remove('scale-100', 'opacity-100');
                        innerModal.classList.add('scale-95', 'opacity-0');
                        setTimeout(() => {
                            modal.classList.add('hidden');
                        }, 200);
                    } else {
                        modal.classList.add('hidden');
                    }
                }
            };
            
            // Show page
            const showPage = (page) => {
                state.currentPage = page;
                
                // Update page title and subtitle
                if (elements.pageTitle && elements.pageSubtitle) {
                    switch (page) {
                        case 'dashboard':
                            elements.pageTitle.textContent = 'Dashboard';
                            elements.pageSubtitle.textContent = 'Vis√£o geral do desempenho da safra 2025';
                            break;
                        case 'entrega-hora':
                            elements.pageTitle.textContent = 'Entrega por Hora';
                            elements.pageSubtitle.textContent = 'Gerencie o registro de entregas por per√≠odo';
                            break;
                        case 'relatorios':
                            elements.pageTitle.textContent = 'An√°lises e Relat√≥rios';
                            elements.pageSubtitle.textContent = 'Relat√≥rios detalhados e an√°lises de desempenho';
                            break;
                        case 'metas':
                            elements.pageTitle.textContent = 'Metas e Desempenho';
                            elements.pageSubtitle.textContent = 'Acompanhe o progresso das metas estabelecidas';
                            break;
                        case 'historico':
                            elements.pageTitle.textContent = 'Hist√≥rico Di√°rio';
                            elements.pageSubtitle.textContent = 'Visualize e compare dados de dias anteriores';
                            break;
                        case 'configuracoes':
                            elements.pageTitle.textContent = 'Configura√ß√µes';
                            elements.pageSubtitle.textContent = 'Ajuste as configura√ß√µes do sistema';
                            break;
                    }
                }
                
                // Hide all pages
                elements.pageContents.forEach(content => {
                    content.classList.add('hidden');
                });
                
                // Show selected page
                const pageContent = document.getElementById(`${page}-content`);
                if (pageContent) {
                    pageContent.classList.remove('hidden');
                    
                    // If showing the entrega-hora page, generate the time period HTML
                    if (page === 'entrega-hora') {
                        generateTimePeriodHTML();
                    }
                    
                    // If showing the dashboard, update the dashboard with current data
                    if (page === 'dashboard') {
                        updateDashboardCharts();
                        updateDetailedFrontTable();
                    }
                    
                    // If showing the history page, update the history calendar and table
                    if (page === 'historico') {
                        updateHistoryCalendar();
                        updateHistoryTable();
                    }
                } else {
                    // If page doesn't exist, show dashboard
                    const dashboardContent = document.getElementById('dashboard-content');
                    if (dashboardContent) dashboardContent.classList.remove('hidden');
                }
                
                // Update navigation active state
                elements.drawerLinks.forEach(link => {
                    link.classList.remove('bg-primary', 'text-white');
                    link.classList.add('text-gray-700', 'dark:text-gray-300');
                    
                    if (link.getAttribute('data-page') === page) {
                        link.classList.add('bg-primary', 'text-white');
                        link.classList.remove('text-gray-700', 'dark:text-gray-300');
                    }
                });
            };
            
            // Toggle dark mode
            const toggleDarkMode = () => {
                if (document.documentElement.classList.contains('dark')) {
                    document.documentElement.classList.remove('dark');
                    state.config.darkMode = false;
                } else {
                    document.documentElement.classList.add('dark');
                    state.config.darkMode = true;
                }
                
                updateDarkModeToggle();
                updateChartsTheme();
                saveConfig();
            };
            
            // Update dark mode toggle UI
            const updateDarkModeToggle = () => {
                const lightIcon = document.getElementById('theme-toggle-light-icon');
                const darkIcon = document.getElementById('theme-toggle-dark-icon');
                const darkModeCheckbox = document.getElementById('dark-mode-toggle');
                
                const isDark = document.documentElement.classList.contains('dark');
                
                if (lightIcon) lightIcon.classList.toggle('hidden', !isDark);
                if (darkIcon) darkIcon.classList.toggle('hidden', isDark);
                if (darkModeCheckbox) darkModeCheckbox.checked = isDark;
            };
            
            // Show date selector modal
            const showDateSelectorModal = () => {
                if (!elements.dateSelectorModal) return;
                
                // Set current month and year to match the currently selected date
                const [year, month] = state.currentDate.split('-');
                state.calendar.currentMonth = parseInt(month) - 1;
                state.calendar.currentYear = parseInt(year);
                
                // Generate days for date selector
                generateDateSelectorDays();
                
                // Show the modal
                toggleModal(elements.dateSelectorModal, true);
            };
            
            // Generate days for date selector calendar
            const generateDateSelectorDays = () => {
                if (!elements.dateSelectorDays || !elements.dateSelectorMonthYear) return;
                
                // Clear previous calendar
                elements.dateSelectorDays.innerHTML = '';
                
                // Set month and year display
                const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                elements.dateSelectorMonthYear.textContent = `${monthNames[state.calendar.currentMonth]} ${state.calendar.currentYear}`;
                
                // Get first day of month and number of days
                const firstDay = new Date(state.calendar.currentYear, state.calendar.currentMonth, 1).getDay();
                const daysInMonth = new Date(state.calendar.currentYear, state.calendar.currentMonth + 1, 0).getDate();
                
                // Add empty cells for days before the first day of month
                for (let i = 0; i < firstDay; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = 'h-10';
                    elements.dateSelectorDays.appendChild(emptyCell);
                }
                
                // Add days
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayCell = document.createElement('div');
                    const currentDate = new Date(state.calendar.currentYear, state.calendar.currentMonth, day);
                    currentDate.setHours(0, 0, 0, 0);
                    const dateStr = currentDate.toISOString().split('T')[0];
                    
                    dayCell.className = 'calendar-day h-10 flex items-center justify-center rounded-full cursor-pointer';
                    
                    // Highlight current date
                    if (dateStr === state.currentDate) {
                        dayCell.classList.add('bg-primary', 'text-white');
                    }
                    
                    // Highlight today
                    if (currentDate.getTime() === today.getTime()) {
                        dayCell.classList.add('border-2', 'border-primary');
                    }
                    
                    // Mark dates with data
                    if (state.availableDates.includes(dateStr)) {
                        dayCell.classList.add('has-data');
                    }
                    
                    dayCell.textContent = day;
                    dayCell.setAttribute('data-date', dateStr);
                    
                    // Add click event to select date
                    dayCell.addEventListener('click', function() {
                        const selectedDate = this.getAttribute('data-date');
                        if (selectedDate) {
                            changeCurrentDate(selectedDate);
                            toggleModal(elements.dateSelectorModal, false);
                        }
                    });
                    
                    elements.dateSelectorDays.appendChild(dayCell);
                }
            };
            
            // Navigate date selector month
            const navigateDateSelectorMonth = (direction) => {
                state.calendar.currentMonth += direction;
                if (state.calendar.currentMonth > 11) {
                    state.calendar.currentMonth = 0;
                    state.calendar.currentYear++;
                } else if (state.calendar.currentMonth < 0) {
                    state.calendar.currentMonth = 11;
                    state.calendar.currentYear--;
                }
                
                generateDateSelectorDays();
            };
            
            // Navigate to previous or next date
            const navigateDate = (direction) => {
                // Get current date as Date object
                const currentDate = new Date(state.currentDate);
                
                // Add or subtract days
                currentDate.setDate(currentDate.getDate() + direction);
                
                // Convert back to YYYY-MM-DD format
                const newDate = currentDate.toISOString().split('T')[0];
                
                // Change current date
                changeCurrentDate(newDate);
            };
            
            // Change current date
            const changeCurrentDate = (newDate) => {
                // Store the old date
                const oldDate = state.currentDate;
                
                // Update current date
                state.currentDate = newDate;
                
                // Initialize data structures for the new date if they don't exist
                initializeDataStructures();
                
                // Update date display
                updateDateDisplay();
                
                // Regenerate time period HTML if on that page
                if (state.currentPage === 'entrega-hora') {
                    generateTimePeriodHTML();
                }
                
                // Update dashboard if on that page
                if (state.currentPage === 'dashboard') {
                    updateDashboardCharts();
                    updateDetailedFrontTable();
                }
                
                // Update date navigation buttons
                updateDateNavigationButtons();
                
                // Show a toast notification
                if (oldDate !== newDate) {
                    const formattedDate = formatDateDisplay(newDate);
                    showToast(`Data alterada para ${formattedDate}`, 'info');
                }
            };
            
            // Update date display
            const updateDateDisplay = () => {
                if (elements.currentDateDisplay) {
                    elements.currentDateDisplay.textContent = formatDateDisplay(state.currentDate);
                }
                
                // Update header date (current system date)
                const headerDate = document.getElementById('header-date');
                if (headerDate) {
                    const now = new Date();
                    const dateOptions = { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' };
                    const formattedDate = now.toLocaleDateString('pt-BR', dateOptions);
                    headerDate.textContent = formattedDate;
                }
            };
            
            // Update date navigation buttons
            const updateDateNavigationButtons = () => {
                // Disable/enable previous date button based on available dates
                if (elements.prevDateBtn) {
                    const prevDate = new Date(state.currentDate);
                    prevDate.setDate(prevDate.getDate() - 1);
                    const prevDateStr = prevDate.toISOString().split('T')[0];
                    elements.prevDateBtn.disabled = false;
                }
                
                // Next date button should never go beyond today
                if (elements.nextDateBtn) {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    const currentDate = new Date(state.currentDate);
                    currentDate.setHours(0, 0, 0, 0);
                    
                    elements.nextDateBtn.disabled = currentDate >= today;
                }
            };
            
            // Format date for display (DD/MM/YYYY)
            const formatDateDisplay = (dateStr) => {
                if (!dateStr) return '';
                
                const date = new Date(dateStr);
                const day = date.getDate().toString().padStart(2, '0');
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const year = date.getFullYear();
                
                // Get day of week
                const weekdays = ['Domingo', 'Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado'];
                const dayOfWeek = weekdays[date.getDay()];
                
                return `${dayOfWeek}, ${day}/${month}/${year}`;
            };
            
            // Calculate delivery based on density and trips for the current date
            const calculateDelivery = () => {
                for (const front of state.fronts) {
                    for (const hour of state.hours) {
                        if (state.density[state.currentDate] && 
                            state.density[state.currentDate][front] && 
                            state.trips[state.currentDate] && 
                            state.trips[state.currentDate][front]) {
                            state.delivery[state.currentDate][front][hour] = 
                                state.density[state.currentDate][front][hour] * state.trips[state.currentDate][front][hour];
                        }
                    }
                }
            };
            
            // Calculate two-hour totals for periods for the current date
            const calculateTwoHourTotals = () => {
                for (const period in state.timePeriodsMap) {
                    const hours = state.timePeriodsMap[period];
                    
                    for (const front of state.fronts) {
                        // Calculate two-hour delivery total
                        state.twoHourDelivery[state.currentDate][period][front] = hours.reduce((sum, hour) => {
                            return sum + (state.delivery[state.currentDate][front][hour] || 0);
                        }, 0);
                        
                        // Calculate two-hour potential (use the odd hour's potential * 2)
                        const oddHour = hours.find(h => h % 2 !== 0) || hours[0];
                        state.twoHourPotential[state.currentDate][period][front] = 
                            (state.potential[state.currentDate][front][oddHour] || 0) * 2;
                        
                        // Calculate difference
                        state.difference[state.currentDate][period][front] = 
                            state.twoHourDelivery[state.currentDate][period][front] - 
                            state.twoHourPotential[state.currentDate][period][front];
                    }
                }
            };
            
            // Generate time period HTML
            const generateTimePeriodHTML = () => {
                showLoading(true);
                
                if (!elements.timePeriodContent) {
                    showLoading(false);
                    return;
                }
                
                elements.timePeriodContent.innerHTML = '';
                
                for (const period in state.timePeriodsMap) {
                    const hours = state.timePeriodsMap[period];
                    
                    const periodDiv = document.createElement('div');
                    periodDiv.id = `period-${period}`;
                    periodDiv.className = 'period-content' + (period === state.activePeriod ? '' : ' hidden');
                    
                    let periodHTML = `
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">`;
                    
                    for (const hour of hours) {
                        let hasPotencial = hour % 2 !== 0; // Only odd hours have potential
                        
                        periodHTML += `
                        <div class="overflow-hidden rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                            <div class="bg-gray-100 dark:bg-gray-700 py-2 px-4 flex justify-between items-center">
                                <h3 class="text-lg font-semibold text-primary dark:text-primary-300 flex items-center">
                                    <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    ${hour.toString().padStart(2, '0')}:00
                                </h3>
                                <div class="flex items-center text-sm">
                                    <span class="text-gray-600 dark:text-gray-400 flex items-center mr-3">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16" />
                                        </svg>
                                        <span class="total-viagens-badge" data-hour="${hour}">0</span> viagens
                                    </span>
                                    <span class="text-primary dark:text-primary-300 flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" />
                                        </svg>
                                        <span class="total-entrega-badge" data-hour="${hour}">0.00</span> ton
                                    </span>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-800">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Frentes</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Densid.</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Viagens</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Entrega</th>
                                            ${hasPotencial ? '<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Pot. Hora</th>' : ''}
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">`;
                        
                        for (const front of state.fronts) {
                            const densityValue = state.density[state.currentDate]?.[front]?.[hour] || 0;
                            const tripsValue = state.trips[state.currentDate]?.[front]?.[hour] || 0;
                            const deliveryValue = state.delivery[state.currentDate]?.[front]?.[hour] || 0;
                            const potentialValue = state.potential[state.currentDate]?.[front]?.[hour] || 0;
                            
                            periodHTML += `
                                        <tr>
                                            <td class="px-4 py-3 whitespace-nowrap">
                                                <span class="font-medium">F${front}</span>
                                            </td>
                                            <td class="px-4 py-3 whitespace-nowrap">
                                                <input type="number" class="input-number densidade w-20 text-right border rounded px-2 py-1 dark:bg-gray-700 text-base" data-hour="${hour}" data-front="${front}" value="${densityValue}" min="0" step="0.01">
                                            </td>
                                            <td class="px-4 py-3 whitespace-nowrap">
                                                <input type="number" class="input-number viagens w-20 text-right border rounded px-2 py-1 dark:bg-gray-700 text-base" data-hour="${hour}" data-front="${front}" value="${tripsValue}" min="0">
                                            </td>
                                            <td class="px-4 py-3 whitespace-nowrap">
                                                <span class="entrega font-medium ${deliveryValue > 0 ? 'text-success-600 dark:text-success-400' : ''}" data-hour="${hour}" data-front="${front}">${deliveryValue.toFixed(2)}</span>
                                            </td>
                                            ${hasPotencial ? `<td class="px-4 py-3 whitespace-nowrap">
                                                <input type="number" class="input-number potencial w-20 text-right border rounded px-2 py-1 dark:bg-gray-700 text-base" data-hour="${hour}" data-front="${front}" value="${potentialValue}" min="0">
                                            </td>` : ''}
                                        </tr>`;
                        }
                        
                        periodHTML += `
                                    </tbody>
                                    <tfoot class="bg-gray-50 dark:bg-gray-700 font-semibold">
                                        <tr>
                                            <td class="px-4 py-3 whitespace-nowrap">TOTAL</td>
                                            <td class="px-4 py-3 whitespace-nowrap"></td>
                                            <td class="px-4 py-3 whitespace-nowrap total-viagens" data-hour="${hour}">0</td>
                                            <td class="px-4 py-3 whitespace-nowrap total-entrega" data-hour="${hour}">0.00</td>
                                            ${hasPotencial ? `<td class="px-4 py-3 whitespace-nowrap total-potencial" data-hour="${hour}">0</td>` : ''}
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>`;
                    }
                    
                    periodHTML += `
                    </div>

                    <!-- Period Summary -->
                    <div class="mt-6 overflow-hidden rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                        <div class="bg-gray-100 dark:bg-gray-700 py-2 px-4">
                            <h3 class="text-lg font-semibold text-primary dark:text-primary-300 flex items-center">
                                <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                RESUMO DO PER√çODO (${period.substring(0, 2)}:00-${period.substring(3, 5)}:00)
                            </h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-800">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Frentes</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">2 Horas</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Potencial 2H</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Diferen√ßa</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">% Realizado</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">`;
                    
                    for (const front of state.fronts) {
                        const twoHourDelivery = state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0;
                        const twoHourPotential = state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0;
                        const difference = state.difference[state.currentDate]?.[period]?.[front] || 0;
                        const percentage = twoHourPotential > 0 ? (twoHourDelivery / twoHourPotential) * 100 : 0;
                        
                        periodHTML += `
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap font-semibold">F${front}</td>
                                        <td class="px-4 py-3 whitespace-nowrap duas-horas" data-period="${period}" data-front="${front}">${twoHourDelivery.toFixed(2)}</td>
                                        <td class="px-4 py-3 whitespace-nowrap potencial-2h" data-period="${period}" data-front="${front}">${twoHourPotential}</td>
                                        <td class="px-4 py-3 whitespace-nowrap diff ${difference < 0 ? 'text-red-600 dark:text-red-400' : (difference > 0 ? 'text-green-600 dark:text-green-400' : '')}" data-period="${period}" data-front="${front}">${difference.toFixed(2)}</td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5 relative overflow-hidden">
                                                <div class="percent-bar ${getProgressBarColor(percentage)} h-2.5 rounded-full" data-period="${period}" data-front="${front}" style="width: ${Math.min(100, percentage)}%"></div>
                                            </div>
                                            <span class="text-xs mt-1 block text-right percent-text" data-period="${period}" data-front="${front}">${percentage.toFixed(1)}%</span>
                                        </td>
                                    </tr>`;
                    }
                    
                    // Calculate period totals
                    let totalTwoHourDelivery = 0;
                    let totalTwoHourPotential = 0;
                    let totalDifference = 0;
                    
                    for (const front of state.fronts) {
                        totalTwoHourDelivery += state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0;
                        totalTwoHourPotential += state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0;
                        totalDifference += state.difference[state.currentDate]?.[period]?.[front] || 0;
                    }
                    
                    const totalPercentage = totalTwoHourPotential > 0 ? (totalTwoHourDelivery / totalTwoHourPotential) * 100 : 0;
                    
                    periodHTML += `
                                </tbody>
                                <tfoot class="bg-gray-50 dark:bg-gray-700 font-semibold">
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap">TOTAL</td>
                                        <td class="px-4 py-3 whitespace-nowrap total-duas-horas" data-period="${period}">${totalTwoHourDelivery.toFixed(2)}</td>
                                        <td class="px-4 py-3 whitespace-nowrap total-potencial-2h" data-period="${period}">${totalTwoHourPotential}</td>
                                        <td class="px-4 py-3 whitespace-nowrap total-diff ${totalDifference < 0 ? 'text-red-600 dark:text-red-400' : (totalDifference > 0 ? 'text-green-600 dark:text-green-400' : '')}" data-period="${period}">${totalDifference.toFixed(2)}</td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5 relative overflow-hidden">
                                                <div class="total-percent-bar ${getProgressBarColor(totalPercentage)} h-2.5 rounded-full" data-period="${period}" style="width: ${Math.min(100, totalPercentage)}%"></div>
                                            </div>
                                            <span class="text-xs mt-1 block text-right total-percent-text" data-period="${period}">${totalPercentage.toFixed(1)}%</span>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>`;
                    
                    periodDiv.innerHTML = periodHTML;
                    elements.timePeriodContent.appendChild(periodDiv);
                }
                
                // Add event listeners to newly generated elements
                setupDynamicEventListeners();
                
                // Update the UI with current data
                updateUI();
                
                showLoading(false);
            };
            
            // Setup dynamic event listeners for generated elements
            const setupDynamicEventListeners = () => {
                // Input changes for delivery data
                document.querySelectorAll('.densidade, .viagens, .potencial').forEach(input => {
                    input.addEventListener('input', handleDeliveryDataChange);
                    
                    // Add number input controls
                    input.addEventListener('keydown', function(e) {
                        if (e.key === 'ArrowUp') {
                            e.preventDefault();
                            const step = this.classList.contains('densidade') ? 0.01 : 1;
                            this.value = (parseFloat(this.value) + step).toFixed(this.classList.contains('densidade') ? 2 : 0);
                            this.dispatchEvent(new Event('input'));
                        } else if (e.key === 'ArrowDown') {
                            e.preventDefault();
                            const step = this.classList.contains('densidade') ? 0.01 : 1;
                            const newValue = Math.max(0, parseFloat(this.value) - step);
                            this.value = newValue.toFixed(this.classList.contains('densidade') ? 2 : 0);
                            this.dispatchEvent(new Event('input'));
                        }
                    });
                });
            };
            
            // Handle delivery data change
            const handleDeliveryDataChange = (e) => {
                const hour = parseInt(e.target.getAttribute('data-hour'));
                const front = e.target.getAttribute('data-front');
                const value = parseFloat(e.target.value) || 0;
                
                if (e.target.classList.contains('densidade')) {
                    state.density[state.currentDate][front][hour] = value;
                } else if (e.target.classList.contains('viagens')) {
                    state.trips[state.currentDate][front][hour] = value;
                } else if (e.target.classList.contains('potencial')) {
                    state.potential[state.currentDate][front][hour] = value;
                }
                
                calculateDelivery();
                calculateTwoHourTotals();
                updateUI();
                
                // Add current date to available dates if not already there
                if (!state.availableDates.includes(state.currentDate)) {
                    state.availableDates.push(state.currentDate);
                    state.availableDates.sort();
                }
                
                // Add to history for undo/redo
                addToHistory('data-change', { date: state.currentDate, hour, front, field: e.target.classList[1], value });
            };
            
            // Update UI
            const updateUI = () => {
                updateDeliveryUI();
                updateCharts();
                
                // Update the detailed front table if on dashboard
                if (state.currentPage === 'dashboard') {
                    updateDetailedFrontTable();
                }
            };
            
            // Update delivery UI elements
            const updateDeliveryUI = () => {
                // Update delivery values for all hours
                document.querySelectorAll('.entrega').forEach(element => {
                    const hour = parseInt(element.getAttribute('data-hour'));
                    const front = element.getAttribute('data-front');
                    const value = state.delivery[state.currentDate]?.[front]?.[hour] || 0;
                    element.textContent = value.toFixed(2);
                    
                    // Add color based on value
                    element.classList.remove('text-success-600', 'dark:text-success-400', 'text-danger-600', 'dark:text-danger-400');
                    if (value > 0) {
                        element.classList.add('text-success-600', 'dark:text-success-400');
                    }
                });
                
                // Update total trips and delivery per hour
                for (const hour of state.hours) {
                    const totalTripsElement = document.querySelector(`.total-viagens[data-hour="${hour}"]`);
                    const totalDeliveryElement = document.querySelector(`.total-entrega[data-hour="${hour}"]`);
                    const totalPotentialElement = document.querySelector(`.total-potencial[data-hour="${hour}"]`);
                    
                    const totalTripsBadge = document.querySelector(`.total-viagens-badge[data-hour="${hour}"]`);
                    const totalEntregaBadge = document.querySelector(`.total-entrega-badge[data-hour="${hour}"]`);
                    
                    let totalTrips = 0;
                    let totalDelivery = 0;
                    let totalPotential = 0;
                    
                    for (const front of state.fronts) {
                        totalTrips += state.trips[state.currentDate]?.[front]?.[hour] || 0;
                        totalDelivery += state.delivery[state.currentDate]?.[front]?.[hour] || 0;
                        if (hour % 2 !== 0) { // Only odd hours have potential
                            totalPotential += state.potential[state.currentDate]?.[front]?.[hour] || 0;
                        }
                    }
                    
                    if (totalTripsElement || totalTripsBadge) {
                        if (totalTripsElement) totalTripsElement.textContent = totalTrips;
                        if (totalTripsBadge) totalTripsBadge.textContent = totalTrips;
                    }
                    
                    if (totalDeliveryElement || totalEntregaBadge) {
                        if (totalDeliveryElement) totalDeliveryElement.textContent = totalDelivery.toFixed(2);
                        if (totalEntregaBadge) totalEntregaBadge.textContent = totalDelivery.toFixed(2);
                    }
                    
                    if (totalPotentialElement && hour % 2 !== 0) { // Only odd hours have potential
                        totalPotentialElement.textContent = totalPotential;
                    }
                }
                
                // Update two-hour summaries for all periods
                for (const period in state.timePeriodsMap) {
                    for (const front of state.fronts) {
                        const duasHorasElement = document.querySelector(`.duas-horas[data-period="${period}"][data-front="${front}"]`);
                        const potencial2hElement = document.querySelector(`.potencial-2h[data-period="${period}"][data-front="${front}"]`);
                        const diffElement = document.querySelector(`.diff[data-period="${period}"][data-front="${front}"]`);
                        const percentBar = document.querySelector(`.percent-bar[data-period="${period}"][data-front="${front}"]`);
                        const percentText = document.querySelector(`.percent-text[data-period="${period}"][data-front="${front}"]`);
                        
                        const twoHourDelivery = state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0;
                        const twoHourPotential = state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0;
                        const difference = state.difference[state.currentDate]?.[period]?.[front] || 0;
                        
                        if (duasHorasElement && potencial2hElement && diffElement) {
                            duasHorasElement.textContent = twoHourDelivery.toFixed(2);
                            potencial2hElement.textContent = twoHourPotential;
                            diffElement.textContent = difference.toFixed(2);
                            
                            // Color-code differences
                            diffElement.classList.remove('text-red-600', 'dark:text-red-400', 'text-green-600', 'dark:text-green-400');
                            if (difference < 0) {
                                diffElement.classList.add('text-red-600', 'dark:text-red-400');
                            } else if (difference > 0) {
                                diffElement.classList.add('text-green-600', 'dark:text-green-400');
                            }
                            
                            // Update percentage bar
                            if (percentBar && percentText) {
                                const percentage = twoHourPotential > 0 ? (twoHourDelivery / twoHourPotential) * 100 : 0;
                                
                                percentBar.style.width = `${Math.min(percentage, 100)}%`;
                                percentText.textContent = `${percentage.toFixed(1)}%`;
                                
                                // Update color based on percentage
                                percentBar.className = `percent-bar ${getProgressBarColor(percentage)} h-2.5 rounded-full`;
                            }
                        }
                    }
                    
                    // Update two-hour totals
                    const totalDuasHorasElement = document.querySelector(`.total-duas-horas[data-period="${period}"]`);
                    const totalPotencial2hElement = document.querySelector(`.total-potencial-2h[data-period="${period}"]`);
                    const totalDiffElement = document.querySelector(`.total-diff[data-period="${period}"]`);
                    const totalPercentBar = document.querySelector(`.total-percent-bar[data-period="${period}"]`);
                    const totalPercentText = document.querySelector(`.total-percent-text[data-period="${period}"]`);
                    
                    if (totalDuasHorasElement && totalPotencial2hElement && totalDiffElement) {
                        let totalDuasHoras = 0;
                        let totalPotencial2h = 0;
                        
                        for (const front of state.fronts) {
                            totalDuasHoras += state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0;
                            totalPotencial2h += state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0;
                        }
                        
                        const totalDiff = totalDuasHoras - totalPotencial2h;
                        
                        totalDuasHorasElement.textContent = totalDuasHoras.toFixed(2);
                        totalPotencial2hElement.textContent = totalPotencial2h;
                        totalDiffElement.textContent = totalDiff.toFixed(2);
                        
                        // Color-code total difference
                        totalDiffElement.classList.remove('text-red-600', 'dark:text-red-400', 'text-green-600', 'dark:text-green-400');
                        if (totalDiff < 0) {
                            totalDiffElement.classList.add('text-red-600', 'dark:text-red-400');
                        } else if (totalDiff > 0) {
                            totalDiffElement.classList.add('text-green-600', 'dark:text-green-400');
                        }
                        
                        // Update total percentage bar
                        if (totalPercentBar && totalPercentText) {
                            const percentage = totalPotencial2h > 0 ? (totalDuasHoras / totalPotencial2h) * 100 : 0;
                            
                            totalPercentBar.style.width = `${Math.min(percentage, 100)}%`;
                            totalPercentText.textContent = `${percentage.toFixed(1)}%`;
                            
                            // Update color based on percentage
                            totalPercentBar.className = `total-percent-bar ${getProgressBarColor(percentage)} h-2.5 rounded-full`;
                        }
                    }
                }
            };
            
            // Initialize charts
            const initializeCharts = () => {
                // Check if Chart.js is loaded
                if (typeof Chart === 'undefined') {
                    console.error('Chart.js is not loaded. Charts will not be initialized.');
                    return;
                }
                
                // Check if the ChartDataLabels plugin is loaded
                if (typeof ChartDataLabels !== 'undefined') {
                    // Register Chart.js plugins
                    Chart.register(ChartDataLabels);
                }
                
                // Default chart options
                const defaultOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderWidth: 0,
                            cornerRadius: 4,
                            padding: 10,
                            displayColors: true
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    family: 'Inter, system-ui, sans-serif',
                                    size: 12
                                },
                                usePointStyle: true,
                                padding: 15
                            }
                        }
                    },
                    elements: {
                        line: {
                            tension: 0.4
                        },
                        point: {
                            radius: 4,
                            hitRadius: 10,
                            hoverRadius: 6
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)',
                                drawBorder: false
                            },
                            ticks: {
                                font: {
                                    family: 'Inter, system-ui, sans-serif',
                                    size: 10
                                },
                                padding: 8,
                                maxRotation: 45, // Rotate labels for better fit with more periods
                                minRotation: 45
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)',
                                drawBorder: false
                            },
                            ticks: {
                                font: {
                                    family: 'Inter, system-ui, sans-serif',
                                    size: 11
                                },
                                padding: 8
                            },
                            beginAtZero: true
                        }
                    }
                };
                
                // Create each chart
                createDeliveryByPeriodChart(defaultOptions);
                createFrontPerformanceChart(defaultOptions);
                createDeliveryByFrontChart(defaultOptions);
                createTripsByFrontChart(defaultOptions);
                createTrucksPerHourChart(defaultOptions);
                
                // Apply dark mode to charts if needed
                if (document.documentElement.classList.contains('dark')) {
                    updateChartsTheme();
                }
            };
            
            // Create delivery by period chart
            const createDeliveryByPeriodChart = (defaultOptions) => {
                const ctx = elements.deliveryByPeriodChart?.getContext('2d');
                if (!ctx) return;
                
                const periodLabels = state.analytics.periodData.day.labels;
                const deliveryData = state.analytics.periodData.day.datasets[0].data;
                const potentialData = state.analytics.periodData.day.datasets[1].data;
                
                state.charts.deliveryByPeriod = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: periodLabels,
                        datasets: [
                            {
                                label: 'Entregas',
                                data: deliveryData,
                                backgroundColor: 'rgba(93, 92, 222, 0.7)',
                                borderColor: 'rgba(93, 92, 222, 1)',
                                borderWidth: 1,
                                barPercentage: 0.7,
                                categoryPercentage: 0.9,
                                order: 2
                            },
                            {
                                label: 'Potencial',
                                data: potentialData,
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                borderColor: 'rgba(16, 185, 129, 1)',
                                borderWidth: 1,
                                borderDash: [5, 5],
                                type: 'line',
                                fill: false,
                                pointStyle: 'rectRounded',
                                pointRadius: 5,
                                pointHoverRadius: 7,
                                tension: 0.4,
                                order: 1
                            }
                        ]
                    },
                    options: {
                        ...defaultOptions,
                        scales: {
                            ...defaultOptions.scales,
                            y: {
                                ...defaultOptions.scales.y,
                                title: {
                                    display: true,
                                    text: 'Toneladas'
                                }
                            },
                            x: {
                                ...defaultOptions.scales.x,
                                title: {
                                    display: true,
                                    text: 'Per√≠odos'
                                }
                            }
                        },
                        plugins: {
                            ...defaultOptions.plugins,
                            tooltip: {
                                ...defaultOptions.plugins.tooltip,
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.raw.toFixed(2)} ton`;
                                    }
                                }
                            },
                            datalabels: {
                                display: function(context) {
                                    // Only show data labels for the bar dataset
                                    return context.datasetIndex === 0;
                                },
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value.toFixed(0) + ' t',
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold',
                                    size: 10 // Smaller font for more periods
                                }
                            }
                        }
                    }
                });
            };
            
            // Create front performance chart
            const createFrontPerformanceChart = (defaultOptions) => {
                const ctx = elements.frontPerformanceChart?.getContext('2d');
                if (!ctx) return;
                
                const frontLabels = state.analytics.frontPerformance.labels;
                const efficiencyData = state.analytics.frontPerformance.datasets[0].data;
                
                state.charts.frontPerformance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: frontLabels,
                        datasets: [
                            {
                                label: 'Efici√™ncia (%)',
                                data: efficiencyData,
                                backgroundColor: efficiencyData.map(value => getEfficiencyColorGradient(value)),
                                borderWidth: 0,
                                borderRadius: 4,
                                barPercentage: 0.6,
                                categoryPercentage: 0.8
                            }
                        ]
                    },
                    options: {
                        ...defaultOptions,
                        scales: {
                            ...defaultOptions.scales,
                            y: {
                                ...defaultOptions.scales.y,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Efici√™ncia (%)'
                                }
                            }
                        },
                        plugins: {
                            ...defaultOptions.plugins,
                            legend: {
                                display: false
                            },
                            tooltip: {
                                ...defaultOptions.plugins.tooltip,
                                callbacks: {
                                    label: function(context) {
                                        return `Efici√™ncia: ${context.raw}%`;
                                    }
                                }
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value + '%',
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            };
            
            // Create delivery by front chart
            const createDeliveryByFrontChart = (defaultOptions) => {
                const ctx = elements.deliveryByFrontChart?.getContext('2d');
                if (!ctx) return;
                
                const frontLabels = state.analytics.deliveryByFront.labels;
                const deliveryData = state.analytics.deliveryByFront.datasets[0].data;
                const backgroundColors = state.analytics.deliveryByFront.datasets[0].backgroundColor;
                
                state.charts.deliveryByFront = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: frontLabels,
                        datasets: [
                            {
                                label: 'Total Entregue (ton)',
                                data: deliveryData,
                                backgroundColor: backgroundColors,
                                borderColor: state.analytics.deliveryByFront.datasets[0].borderColor,
                                borderWidth: 1,
                                borderRadius: 4,
                                barPercentage: 0.6,
                                categoryPercentage: 0.8
                            }
                        ]
                    },
                    options: {
                        ...defaultOptions,
                        scales: {
                            ...defaultOptions.scales,
                            y: {
                                ...defaultOptions.scales.y,
                                title: {
                                    display: true,
                                    text: 'Toneladas'
                                }
                            }
                        },
                        plugins: {
                            ...defaultOptions.plugins,
                            legend: {
                                display: false
                            },
                            tooltip: {
                                ...defaultOptions.plugins.tooltip,
                                callbacks: {
                                    label: function(context) {
                                        if (document.getElementById('delivery-view-selector')?.value === 'percentage') {
                                            return `Contribui√ß√£o: ${context.raw.toFixed(1)}%`;
                                        } else {
                                            return `Total Entregue: ${context.raw.toFixed(2)} ton`;
                                        }
                                    }
                                }
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: function(value, context) {
                                    if (document.getElementById('delivery-view-selector')?.value === 'percentage') {
                                        return value.toFixed(1) + '%';
                                    } else {
                                        return value.toFixed(1) + ' t';
                                    }
                                },
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            };
            
            // Create trips by front chart
            const createTripsByFrontChart = (defaultOptions) => {
                const ctx = elements.tripsByFrontChart?.getContext('2d');
                if (!ctx) return;
                
                const frontLabels = state.analytics.tripsByFront.labels;
                const tripsData = state.analytics.tripsByFront.datasets[0].data;
                
                state.charts.tripsByFront = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: frontLabels,
                        datasets: [
                            {
                                label: 'Viagens Entregues',
                                data: tripsData,
                                backgroundColor: 'rgba(14, 165, 233, 0.7)', // Sky blue color
                                borderColor: 'rgba(14, 165, 233, 1)',
                                borderWidth: 1,
                                borderRadius: 4,
                                barPercentage: 0.6,
                                categoryPercentage: 0.8
                            }
                        ]
                    },
                    options: {
                        ...defaultOptions,
                        scales: {
                            ...defaultOptions.scales,
                            y: {
                                ...defaultOptions.scales.y,
                                title: {
                                    display: true,
                                    text: 'N√∫mero de Viagens'
                                }
                            }
                        },
                        plugins: {
                            ...defaultOptions.plugins,
                            legend: {
                                display: false
                            },
                            tooltip: {
                                ...defaultOptions.plugins.tooltip,
                                callbacks: {
                                    label: function(context) {
                                        return `Viagens: ${context.raw}`;
                                    }
                                }
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value,
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            };
            
            // Create trucks per hour chart
            const createTrucksPerHourChart = (defaultOptions) => {
                const ctx = elements.trucksPerHourChart?.getContext('2d');
                if (!ctx) return;
                
                const frontLabels = state.analytics.trucksPerHour.labels;
                const trucksData = state.analytics.trucksPerHour.datasets[0].data;
                
                state.charts.trucksPerHour = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: frontLabels,
                        datasets: [
                            {
                                label: 'Caminh√µes por Hora',
                                data: trucksData,
                                backgroundColor: 'rgba(249, 115, 22, 0.7)', // Orange color
                                borderColor: 'rgba(249, 115, 22, 1)',
                                borderWidth: 1,
                                borderRadius: 4,
                                barPercentage: 0.6,
                                categoryPercentage: 0.8
                            }
                        ]
                    },
                    options: {
                        ...defaultOptions,
                        scales: {
                            ...defaultOptions.scales,
                            y: {
                                ...defaultOptions.scales.y,
                                title: {
                                    display: true,
                                    text: 'Caminh√µes/Hora'
                                }
                            }
                        },
                        plugins: {
                            ...defaultOptions.plugins,
                            legend: {
                                display: false
                            },
                            tooltip: {
                                ...defaultOptions.plugins.tooltip,
                                callbacks: {
                                    label: function(context) {
                                        return `M√©dia: ${context.raw.toFixed(1)} caminh√µes/h`;
                                    }
                                }
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value.toFixed(1),
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            };
            
            // Get efficiency color for charts
            const getEfficiencyColorGradient = (value) => {
                if (value >= 90) {
                    return 'rgba(16, 185, 129, 0.7)';  // Green
                } else if (value >= 75) {
                    return 'rgba(93, 92, 222, 0.7)';   // Primary
                } else if (value >= 50) {
                    return 'rgba(245, 158, 11, 0.7)';  // Yellow
                } else {
                    return 'rgba(239, 68, 68, 0.7)';   // Red
                }
            };
            
            // Update delivery by front chart view (absolute or percentage)
            const updateDeliveryByFrontChart = (viewMode) => {
                if (!state.charts.deliveryByFront) return;
                
                const frontLabels = state.fronts.map(front => `F${front}`);
                let chartData;
                
                if (viewMode === 'percentage') {
                    // Calculate total delivery for current date
                    const totalDelivery = state.fronts.reduce((total, front) => {
                        let frontTotal = 0;
                        for (const hour of state.hours) {
                            frontTotal += state.delivery[state.currentDate]?.[front]?.[hour] || 0;
                        }
                        return total + frontTotal;
                    }, 0);
                    
                    // Calculate percentage for each front
                    chartData = state.fronts.map(front => {
                        let frontTotal = 0;
                        for (const hour of state.hours) {
                            frontTotal += state.delivery[state.currentDate]?.[front]?.[hour] || 0;
                        }
                        return totalDelivery > 0 ? (frontTotal / totalDelivery) * 100 : 0;
                    });
                    
                    // Update y-axis title
                    state.charts.deliveryByFront.options.scales.y.title.text = 'Porcentagem do Total (%)';
                } else {
                    // Use absolute values
                    chartData = state.fronts.map(front => {
                        let frontTotal = 0;
                        for (const hour of state.hours) {
                            frontTotal += state.delivery[state.currentDate]?.[front]?.[hour] || 0;
                        }
                        return frontTotal;
                    });
                    
                    // Update y-axis title
                    state.charts.deliveryByFront.options.scales.y.title.text = 'Toneladas';
                }
                
                // Update chart data
                state.charts.deliveryByFront.data.labels = frontLabels;
                state.charts.deliveryByFront.data.datasets[0].data = chartData;
                
                // Update chart
                state.charts.deliveryByFront.update();
            };
            
            // Update period chart when switching between day, week, month
            const updatePeriodChart = (period) => {
                if (!state.charts.deliveryByPeriod) return;
                
                // Update chart data based on selected period
                const periodData = state.analytics.periodData[period];
                
                state.charts.deliveryByPeriod.data.labels = periodData.labels;
                state.charts.deliveryByPeriod.data.datasets[0].data = periodData.datasets[0].data;
                state.charts.deliveryByPeriod.data.datasets[1].data = periodData.datasets[1].data;
                
                state.charts.deliveryByPeriod.update();
            };
            
            // Update chart themes for dark mode
            const updateChartsTheme = () => {
                const charts = [
                    state.charts.deliveryByPeriod,
                    state.charts.frontPerformance,
                    state.charts.deliveryByFront,
                    state.charts.tripsByFront,
                    state.charts.trucksPerHour
                ];
                
                const isDark = document.documentElement.classList.contains('dark');
                const textColor = isDark ? '#E5E7EB' : '#374151';
                const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.05)';
                
                charts.forEach(chart => {
                    if (!chart) return;
                    
                    // Update tooltip styles
                    chart.options.plugins.tooltip.backgroundColor = isDark ? 'rgba(255, 255, 255, 0.8)' : 'rgba(0, 0, 0, 0.8)';
                    chart.options.plugins.tooltip.titleColor = isDark ? '#000' : '#fff';
                    chart.options.plugins.tooltip.bodyColor = isDark ? '#000' : '#fff';
                    
                    // Update scales
                    if (chart.options.scales.x) {
                        chart.options.scales.x.grid.color = gridColor;
                        chart.options.scales.x.ticks.color = textColor;
                    }
                    
                    if (chart.options.scales.y) {
                        chart.options.scales.y.grid.color = gridColor;
                        chart.options.scales.y.ticks.color = textColor;
                    }
                    
                    // Update legend
                    if (chart.options.plugins.legend && chart.options.plugins.legend.labels) {
                        chart.options.plugins.legend.labels.color = textColor;
                    }
                    
                    chart.update();
                });
            };
            
            // Update all charts with current data
            const updateCharts = () => {
                if (state.currentPage === 'dashboard') {
                    updateDashboardCharts();
                }
            };
            
            // Update dashboard charts with actual data
            const updateDashboardCharts = () => {
                // Update delivery by period chart on dashboard
                if (state.charts.deliveryByPeriod) {
                    // Get real data from the delivery state for each period
                    const periods = Object.keys(state.timePeriodsMap);
                    const periodLabels = periods.map(period => {
                        return `${period.substring(0, 2)}:00-${period.substring(3, 5)}:00`;
                    });
                    
                    const deliveryData = periods.map(period => {
                        return state.fronts.reduce((sum, front) => {
                            return sum + (state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0);
                        }, 0);
                    });
                    
                    const potentialData = periods.map(period => {
                        return state.fronts.reduce((sum, front) => {
                            return sum + (state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0);
                        }, 0);
                    });
                    
                    // Update analytics data with real data
                    state.analytics.periodData.day.labels = periodLabels;
                    state.analytics.periodData.day.datasets[0].data = deliveryData;
                    state.analytics.periodData.day.datasets[1].data = potentialData;
                    
                    // Update chart with new data
                    state.charts.deliveryByPeriod.data.labels = periodLabels;
                    state.charts.deliveryByPeriod.data.datasets[0].data = deliveryData;
                    state.charts.deliveryByPeriod.data.datasets[1].data = potentialData;
                    state.charts.deliveryByPeriod.update();
                }
                
                // Update front performance chart on dashboard
                if (state.charts.frontPerformance) {
                    const frontLabels = state.fronts.map(front => `F${front}`);
                    
                    const efficiencyData = state.fronts.map(front => {
                        let totalDelivery = 0;
                        let totalPotential = 0;
                        
                        // Calculate total delivery for all periods
                        for (const period in state.timePeriodsMap) {
                            // Sum delivery for this period
                            totalDelivery += state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0;
                            
                            // Sum potential for this period
                            totalPotential += state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0;
                        }
                        
                        return totalPotential > 0 ? Math.round((totalDelivery / totalPotential) * 100) : 0;
                    });
                    
                    // Update analytics data with real data
                    state.analytics.frontPerformance.labels = frontLabels;
                    state.analytics.frontPerformance.datasets[0].data = efficiencyData;
                    
                    // Update chart with new data
                    state.charts.frontPerformance.data.labels = frontLabels;
                    state.charts.frontPerformance.data.datasets[0].data = efficiencyData;
                    state.charts.frontPerformance.data.datasets[0].backgroundColor = 
                        efficiencyData.map(value => getEfficiencyColorGradient(value));
                    state.charts.frontPerformance.update();
                }
                
                // Update trips by front chart
                if (state.charts.tripsByFront) {
                    const frontLabels = state.fronts.map(front => `F${front}`);
                    
                    // Calculate total trips for each front
                    const tripsData = state.fronts.map(front => {
                        return state.hours.reduce((sum, hour) => {
                            return sum + (state.trips[state.currentDate]?.[front]?.[hour] || 0);
                        }, 0);
                    });
                    
                    // Update analytics data
                    state.analytics.tripsByFront.labels = frontLabels;
                    state.analytics.tripsByFront.datasets[0].data = tripsData;
                    
                    // Update chart
                    state.charts.tripsByFront.data.labels = frontLabels;
                    state.charts.tripsByFront.data.datasets[0].data = tripsData;
                    state.charts.tripsByFront.update();
                }
                
                // Update trucks per hour chart
                if (state.charts.trucksPerHour) {
                    const frontLabels = state.fronts.map(front => `F${front}`);
                    
                    // Calculate average trucks per hour for each front
                    const trucksData = state.fronts.map(front => {
                        const totalTrips = state.hours.reduce((sum, hour) => {
                            return sum + (state.trips[state.currentDate]?.[front]?.[hour] || 0);
                        }, 0);
                        // Assuming 24 active hours for the average calculation
                        const activeHours = state.hours.filter(hour => (state.trips[state.currentDate]?.[front]?.[hour] || 0) > 0).length || 1;
                        return totalTrips / activeHours;
                    });
                    
                    // Update analytics data
                    state.analytics.trucksPerHour.labels = frontLabels;
                    state.analytics.trucksPerHour.datasets[0].data = trucksData;
                    
                    // Update chart
                    state.charts.trucksPerHour.data.labels = frontLabels;
                    state.charts.trucksPerHour.data.datasets[0].data = trucksData;
                    state.charts.trucksPerHour.update();
                }
                
                // Update delivery by front chart
                if (state.charts.deliveryByFront) {
                    const viewMode = document.getElementById('delivery-view-selector')?.value || 'absolute';
                    updateDeliveryByFrontChart(viewMode);
                }
                
                // Update dashboard stats cards
                updateDashboardStatsCards();
            };
            
            // Update dashboard stats cards with real data
            const updateDashboardStatsCards = () => {
                // Calculate total delivery across all fronts and hours for current date
                const totalDelivery = Object.keys(state.delivery[state.currentDate] || {}).reduce((frontSum, front) => {
                    return frontSum + Object.keys(state.delivery[state.currentDate][front] || {}).reduce((hourSum, hour) => {
                        return hourSum + (state.delivery[state.currentDate][front][hour] || 0);
                    }, 0);
                }, 0);
                
                // Calculate total potential for current date
                const totalPotential = Object.keys(state.twoHourPotential[state.currentDate] || {}).reduce((periodSum, period) => {
                    return periodSum + Object.keys(state.twoHourPotential[state.currentDate][period] || {}).reduce((frontSum, front) => {
                        return frontSum + (state.twoHourPotential[state.currentDate][period][front] || 0);
                    }, 0);
                }, 0);
                
                // Calculate efficiency
                const efficiency = totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
                
                // Calculate total trips for current date
                const totalTrips = Object.keys(state.trips[state.currentDate] || {}).reduce((frontSum, front) => {
                    return frontSum + Object.keys(state.trips[state.currentDate][front] || {}).reduce((hourSum, hour) => {
                        return hourSum + (state.trips[state.currentDate][front][hour] || 0);
                    }, 0);
                }, 0);
                
                // Calculate average density for current date
                let densitySum = 0;
                let densityCount = 0;
                
                for (const front in state.density[state.currentDate] || {}) {
                    for (const hour in state.density[state.currentDate][front] || {}) {
                        if ((state.density[state.currentDate][front][hour] || 0) > 0) {
                            densitySum += state.density[state.currentDate][front][hour];
                            densityCount++;
                        }
                    }
                }
                
                const avgDensity = densityCount > 0 ? densitySum / densityCount : 0;
                
                // Update dashboard cards
                const dashboardCards = document.querySelectorAll('.dashboard-card');
                if (dashboardCards.length >= 4) {
                    // Total delivered
                    const deliveredCard = dashboardCards[0];
                    const deliveredValue = deliveredCard.querySelector('.text-2xl');
                    const deliveredProgress = deliveredCard.querySelector('.bg-primary');
                    
                    if (deliveredValue) deliveredValue.textContent = totalDelivery.toFixed(1);
                    if (deliveredProgress) {
                        const progressPercentage = totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
                        deliveredProgress.style.width = `${Math.min(100, progressPercentage)}%`;
                    }
                    
                    // Efficiency
                    const efficiencyCard = dashboardCards[1];
                    const efficiencyValue = efficiencyCard.querySelector('.text-2xl');
                    const efficiencyProgress = efficiencyCard.querySelector('.bg-blue-500');
                    
                    if (efficiencyValue) efficiencyValue.textContent = `${efficiency.toFixed(1)}%`;
                    if (efficiencyProgress) efficiencyProgress.style.width = `${Math.min(100, efficiency)}%`;
                    
                    // Trips
                    const tripsCard = dashboardCards[2];
                    const tripsValue = tripsCard.querySelector('.text-2xl');
                    const tripsProgress = tripsCard.querySelector('.bg-green-500');
                    
                    if (tripsValue) tripsValue.textContent = totalTrips.toString();
                    if (tripsProgress) {
                        // Assume a target of 1,500 trips for the progress bar
                        const targetTrips = 1500;
                        const tripsPercentage = (totalTrips / targetTrips) * 100;
                        tripsProgress.style.width = `${Math.min(100, tripsPercentage)}%`;
                    }
                    
                    // Density
                    const densityCard = dashboardCards[3];
                    const densityValue = densityCard.querySelector('.text-2xl');
                    const densityProgress = densityCard.querySelector('.bg-purple-500');
                    
                    if (densityValue) densityValue.textContent = avgDensity.toFixed(2);
                    if (densityProgress) {
                        // Assume a target density of 65.00
                        const targetDensity = 65.00;
                        const densityPercentage = (avgDensity / targetDensity) * 100;
                        densityProgress.style.width = `${Math.min(100, densityPercentage)}%`;
                    }
                }
            };
            
            // Update the detailed front table with real data including non-delivered amount
            const updateDetailedFrontTable = () => {
                if (!elements.frontDetailsTable) return;
                
                // Clear the table
                elements.frontDetailsTable.innerHTML = '';
                
                // Variables for totals
                let totalEntregue = 0;
                let totalPotencial = 0;
                let totalViagens = 0;
                let totalDensidadeSum = 0;
                let totalDensidadeCount = 0;
                let totalNaoEntregue = 0;
                
                // Add rows for each front
                state.fronts.forEach(front => {
                    // Calculate front total delivery for current date
                    let frontDelivery = 0;
                    let frontPotential = 0;
                    let frontTrips = 0;
                    let frontDensitySum = 0;
                    let frontDensityCount = 0;
                    
                    // Calculate totals across all periods for current date
                    for (const period in state.timePeriodsMap) {
                        // Sum delivery for this period
                        frontDelivery += state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0;
                        
                        // Sum potential for this period
                        frontPotential += state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0;
                    }
                    
                    // Calculate trips and density for current date
                    for (const hour of state.hours) {
                        frontTrips += state.trips[state.currentDate]?.[front]?.[hour] || 0;
                        
                        if ((state.density[state.currentDate]?.[front]?.[hour] || 0) > 0) {
                            frontDensitySum += state.density[state.currentDate][front][hour];
                            frontDensityCount++;
                        }
                    }
                    
                    // Calculate efficiency percentage
                    const efficiency = frontPotential > 0 ? (frontDelivery / frontPotential) * 100 : 0;
                    
                    // Calculate average density
                    const avgDensity = frontDensityCount > 0 ? frontDensitySum / frontDensityCount : 0;
                    
                    // Calculate non-delivered amount (negative value showing what was not delivered)
                    const naoEntregue = frontPotential - frontDelivery;
                    
                    // Create row
                    const row = document.createElement('tr');
                    row.className = 'front-detail-row';
                    
                    // Get appropriate color for efficiency
                    const efficiencyColor = getEfficiencyTextColor(efficiency);
                    
                    row.innerHTML = `
                        <td class="px-4 py-3 whitespace-nowrap font-semibold">F${front}</td>
                        <td class="px-4 py-3 whitespace-nowrap font-medium text-success-600 dark:text-success-400">${frontDelivery.toFixed(2)} ton</td>
                        <td class="px-4 py-3 whitespace-nowrap">${frontPotential.toFixed(2)} ton</td>
                        <td class="px-4 py-3 whitespace-nowrap font-medium ${naoEntregue > 0 ? 'text-danger-600 dark:text-danger-400' : 'text-success-600 dark:text-success-400'}">${naoEntregue > 0 ? '-' + naoEntregue.toFixed(2) : '0.00'} ton</td>
                        <td class="px-4 py-3 whitespace-nowrap font-medium ${efficiencyColor}">${efficiency.toFixed(1)}%</td>
                        <td class="px-4 py-3 whitespace-nowrap">${frontTrips}</td>
                        <td class="px-4 py-3 whitespace-nowrap">${avgDensity.toFixed(2)}</td>
                        <td class="px-4 py-3">
                            <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5 relative overflow-hidden">
                                <div class="${getProgressBarColor(efficiency)} h-2.5 rounded-full" style="width: ${Math.min(100, efficiency)}%"></div>
                            </div>
                            <span class="text-xs mt-1 block text-right">${efficiency.toFixed(1)}%</span>
                        </td>
                    `;
                    
                    elements.frontDetailsTable.appendChild(row);
                    
                    // Add to totals
                    totalEntregue += frontDelivery;
                    totalPotencial += frontPotential;
                    totalViagens += frontTrips;
                    totalDensidadeSum += frontDensitySum;
                    totalDensidadeCount += frontDensityCount;
                    totalNaoEntregue += naoEntregue;
                });
                
                // Update totals in footer
                const totalEficiencia = totalPotencial > 0 ? (totalEntregue / totalPotencial) * 100 : 0;
                const totalDensidadeAvg = totalDensidadeCount > 0 ? totalDensidadeSum / totalDensidadeCount : 0;
                
                // Update total elements
                const totalEntregueElement = document.getElementById('total-entregue');
                const totalPotencialElement = document.getElementById('total-potencial');
                const totalNaoEntregueElement = document.getElementById('total-nao-entregue');
                const totalEficienciaElement = document.getElementById('total-eficiencia');
                const totalViagensElement = document.getElementById('total-viagens');
                const totalDensidadeElement = document.getElementById('total-densidade');
                const totalProgressBar = document.getElementById('total-progress-bar');
                const totalProgressText = document.getElementById('total-progress-text');
                
                if (totalEntregueElement) totalEntregueElement.textContent = totalEntregue.toFixed(2);
                if (totalPotencialElement) totalPotencialElement.textContent = totalPotencial.toFixed(2);
                if (totalNaoEntregueElement) {
                    totalNaoEntregueElement.textContent = totalNaoEntregue > 0 ? `-${totalNaoEntregue.toFixed(2)}` : '0.00';
                    totalNaoEntregueElement.className = totalNaoEntregue > 0 ? 
                        'px-4 py-3 whitespace-nowrap text-danger-600 dark:text-danger-400' : 
                        'px-4 py-3 whitespace-nowrap text-success-600 dark:text-success-400';
                }
                if (totalEficienciaElement) totalEficienciaElement.textContent = totalEficiencia.toFixed(1) + '%';
                if (totalViagensElement) totalViagensElement.textContent = totalViagens.toString();
                if (totalDensidadeElement) totalDensidadeElement.textContent = totalDensidadeAvg.toFixed(2);
                
                if (totalProgressBar && totalProgressText) {
                    totalProgressBar.style.width = `${Math.min(100, totalEficiencia)}%`;
                    totalProgressBar.className = `bg-primary h-2.5 rounded-full ${getProgressBarColor(totalEficiencia)}`;
                    totalProgressText.textContent = totalEficiencia.toFixed(1) + '%';
                }
            };
            
            // Get efficiency text color based on percentage
            const getEfficiencyTextColor = (percentage) => {
                if (percentage >= 90) {
                    return 'text-success-600 dark:text-success-400';
                } else if (percentage >= 75) {
                    return 'text-primary dark:text-primary-300';
                } else if (percentage >= 50) {
                    return 'text-warning-600 dark:text-warning-400';
                } else {
                    return 'text-danger-600 dark:text-danger-400';
                }
            };
            
            // Get progress bar color based on percentage
            const getProgressBarColor = (percentage) => {
                if (percentage >= 90) {
                    return 'bg-success-500';
                } else if (percentage >= 75) {
                    return 'bg-primary';
                } else if (percentage >= 50) {
                    return 'bg-warning-500';
                } else {
                    return 'bg-danger-500';
                }
            };
            
            // Switch time period tab
            const switchTimePeriodTab = (period) => {
                state.activePeriod = period;
                
                // Update tab states
                elements.timeTabButtons.forEach(button => {
                    if (button.getAttribute('data-period') === period) {
                        button.classList.add('bg-primary', 'text-white');
                        button.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                    } else {
                        button.classList.remove('bg-primary', 'text-white');
                        button.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                    }
                });
                
                // Show/hide period content
                document.querySelectorAll('.period-content').forEach(content => {
                    if (content.id === `period-${period}`) {
                        content.classList.remove('hidden');
                    } else {
                        content.classList.add('hidden');
                    }
                });
            };
            
            // Show/hide loading indicator
            const showLoading = (show) => {
                if (elements.loadingIndicator) {
                    if (show) {
                        elements.loadingIndicator.classList.remove('hidden');
                    } else {
                        elements.loadingIndicator.classList.add('hidden');
                    }
                }
            };
            
            // Confirmation modal functions
            let confirmationCallback = null;
            
            const showConfirmationModal = (title, message, callback) => {
                const modalTitle = document.getElementById('modal-title');
                const modalMessage = document.getElementById('modal-message');
                const modalConfirm = document.getElementById('modal-confirm');
                
                if (modalTitle) modalTitle.textContent = title;
                if (modalMessage) modalMessage.textContent = message;
                
                confirmationCallback = callback;
                
                // Add confirmation callback
                if (modalConfirm) {
                    modalConfirm.onclick = () => {
                        if (confirmationCallback) {
                            confirmationCallback();
                            confirmationCallback = null;
                        }
                        toggleModal(elements.confirmationModal, false);
                    };
                }
                
                toggleModal(elements.confirmationModal, true);
            };
            
            // Clear current period
            const clearCurrentPeriod = () => {
                const hours = state.timePeriodsMap[state.activePeriod];
                
                for (const front of state.fronts) {
                    for (const hour of hours) {
                        state.density[state.currentDate][front][hour] = 0;
                        state.trips[state.currentDate][front][hour] = 0;
                        state.delivery[state.currentDate][front][hour] = 0;
                        if (hour % 2 !== 0) { // Only odd hours have potential
                            state.potential[state.currentDate][front][hour] = 0;
                        }
                    }
                }
                
                calculateDelivery();
                calculateTwoHourTotals();
                updateUI();
                
                showToast(`Per√≠odo ${state.activePeriod} limpo com sucesso!`, 'success');
            };
            
            // Copy previous period
            const copyPreviousPeriod = () => {
                // Get the previous date
                const currentDate = new Date(state.currentDate);
                currentDate.setDate(currentDate.getDate() - 1);
                const prevDate = currentDate.toISOString().split('T')[0];
                
                // Check if previous date has data
                if (!state.density[prevDate] || !state.trips[prevDate] || !state.potential[prevDate]) {
                    showToast('N√£o h√° dados do dia anterior para copiar.', 'warning');
                    return;
                }
                
                const hours = state.timePeriodsMap[state.activePeriod];
                
                for (const front of state.fronts) {
                    for (const hour of hours) {
                        // Copy data from previous date
                        state.density[state.currentDate][front][hour] = state.density[prevDate]?.[front]?.[hour] || 0;
                        state.trips[state.currentDate][front][hour] = state.trips[prevDate]?.[front]?.[hour] || 0;
                        if (hour % 2 !== 0) { // Only odd hours have potential
                            state.potential[state.currentDate][front][hour] = state.potential[prevDate]?.[front]?.[hour] || 0;
                        }
                    }
                }
                
                calculateDelivery();
                calculateTwoHourTotals();
                updateUI();
                
                const prevDateFormatted = formatDateDisplay(prevDate);
                showToast(`Dados do per√≠odo ${state.activePeriod} copiados de ${prevDateFormatted}!`, 'success');
            };
            
            // Manage fronts modal
            const showManageFrontsModal = () => {
                updateFrontsList();
                toggleModal(elements.manageFrontsModal, true);
            };
            
            // Update fronts list in modal
            const updateFrontsList = () => {
                const frontsList = document.getElementById('fronts-list');
                if (!frontsList) return;
                
                frontsList.innerHTML = '';
                
                state.fronts.forEach(front => {
                    const listItem = document.createElement('li');
                    listItem.className = 'flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition duration-150';
                    
                    listItem.innerHTML = `
                        <div class="flex items-center">
                            <div class="h-10 w-10 rounded-md bg-primary flex items-center justify-center text-white font-bold text-sm mr-3">F${front}</div>
                            <div>
                                <div class="font-medium text-gray-900 dark:text-gray-100">Frente ${front}</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">Frente de entrega</div>
                            </div>
                        </div>
                        <button class="remove-front-btn text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 p-1 rounded focus:outline-none focus:ring-2 focus:ring-red-500" data-front="${front}">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    `;
                    
                    // Add remove button functionality
                    const removeBtn = listItem.querySelector('.remove-front-btn');
                    removeBtn.addEventListener('click', function() {
                        const frontToRemove = this.getAttribute('data-front');
                        showConfirmationModal(
                            'Remover Frente',
                            `Tem certeza que deseja remover a Frente ${frontToRemove}? Todos os dados associados ser√£o perdidos.`,
                            () => removeFront(frontToRemove)
                        );
                    });
                    
                    frontsList.appendChild(listItem);
                });
            };
            
            // Add new front
            const addFront = () => {
                const newFrontInput = document.getElementById('new-front-input');
                if (!newFrontInput) return;
                
                const newFront = newFrontInput.value.trim();
                
                if (!newFront) {
                    showToast('Por favor, insira um n√∫mero para a frente.', 'warning');
                    return;
                }
                
                if (state.fronts.includes(newFront)) {
                    showToast('Esta frente j√° existe.', 'warning');
                    return;
                }
                
                // Add to fronts array
                state.fronts.push(newFront);
                state.fronts.sort();
                
                // Initialize data structures for new front
                initializeDataStructures();
                
                // Clear input
                newFrontInput.value = '';
                
                // Update fronts list
                updateFrontsList();
                
                // Regenerate time period HTML if on that page
                if (state.currentPage === 'entrega-hora') {
                    generateTimePeriodHTML();
                }
                
                // Update dashboard if on that page
                if (state.currentPage === 'dashboard') {
                    updateDashboardCharts();
                    updateDetailedFrontTable();
                }
                
                showToast(`Frente ${newFront} adicionada com sucesso!`, 'success');
            };
            
            // Remove front
            const removeFront = (frontToRemove) => {
                // Remove from fronts array
                state.fronts = state.fronts.filter(front => front !== frontToRemove);
                
                // Remove data for this front from all dates
                for (const date in state.density) {
                    if (state.density[date][frontToRemove]) {
                        delete state.density[date][frontToRemove];
                    }
                    if (state.trips[date][frontToRemove]) {
                        delete state.trips[date][frontToRemove];
                    }
                    if (state.delivery[date][frontToRemove]) {
                        delete state.delivery[date][frontToRemove];
                    }
                    if (state.potential[date][frontToRemove]) {
                        delete state.potential[date][frontToRemove];
                    }
                    
                    for (const period in state.twoHourDelivery[date] || {}) {
                        if (state.twoHourDelivery[date][period][frontToRemove] !== undefined) {
                            delete state.twoHourDelivery[date][period][frontToRemove];
                        }
                        if (state.twoHourPotential[date][period][frontToRemove] !== undefined) {
                            delete state.twoHourPotential[date][period][frontToRemove];
                        }
                        if (state.difference[date][period][frontToRemove] !== undefined) {
                            delete state.difference[date][period][frontToRemove];
                        }
                    }
                }
                
                // Update fronts list
                updateFrontsList();
                
                // Regenerate time period HTML if on that page
                if (state.currentPage === 'entrega-hora') {
                    generateTimePeriodHTML();
                }
                
                // Update dashboard if on that page
                if (state.currentPage === 'dashboard') {
                    updateDashboardCharts();
                    updateDetailedFrontTable();
                }
                
                showToast(`Frente ${frontToRemove} removida com sucesso!`, 'success');
            };
            
            // Export functions
            const exportJSON = () => {
                const dataToExport = {
                    currentDate: state.currentDate,
                    fronts: state.fronts,
                    density: state.density,
                    trips: state.trips,
                    delivery: state.delivery,
                    potential: state.potential,
                    twoHourDelivery: state.twoHourDelivery,
                    twoHourPotential: state.twoHourPotential,
                    difference: state.difference,
                    exportDate: new Date().toISOString()
                };
                
                const jsonString = JSON.stringify(dataToExport, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `entrega-safra-${state.currentDate}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('Dados exportados em JSON com sucesso!', 'success');
            };
            
            const exportCSV = () => {
                if (typeof Papa === 'undefined') {
                    showToast('Biblioteca de CSV n√£o carregada. Usando export b√°sico.', 'warning');
                    exportCSVBasic();
                    return;
                }
                
                const csvData = [];
                
                // Add header
                csvData.push([
                    'Data', 'Frente', 'Periodo', 'Entrega_2H', 'Potencial_2H', 'Diferenca', 'Eficiencia_%'
                ]);
                
                // Add data for current date
                for (const period in state.timePeriodsMap) {
                    for (const front of state.fronts) {
                        const entrega = state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0;
                        const potencial = state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0;
                        const diferenca = entrega - potencial;
                        const eficiencia = potencial > 0 ? (entrega / potencial) * 100 : 0;
                        
                        csvData.push([
                            state.currentDate,
                            `F${front}`,
                            period,
                            entrega.toFixed(2),
                            potencial.toFixed(2),
                            diferenca.toFixed(2),
                            eficiencia.toFixed(1)
                        ]);
                    }
                }
                
                const csv = Papa.unparse(csvData);
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `entrega-safra-${state.currentDate}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('Dados exportados em CSV com sucesso!', 'success');
            };
            
            const exportCSVBasic = () => {
                let csvContent = 'Data,Frente,Periodo,Entrega_2H,Potencial_2H,Diferenca,Eficiencia_%\n';
                
                for (const period in state.timePeriodsMap) {
                    for (const front of state.fronts) {
                        const entrega = state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0;
                        const potencial = state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0;
                        const diferenca = entrega - potencial;
                        const eficiencia = potencial > 0 ? (entrega / potencial) * 100 : 0;
                        
                        csvContent += `${state.currentDate},F${front},${period},${entrega.toFixed(2)},${potencial.toFixed(2)},${diferenca.toFixed(2)},${eficiencia.toFixed(1)}\n`;
                    }
                }
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `entrega-safra-${state.currentDate}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };
            
            const exportPDF = () => {
                if (typeof jsPDF === 'undefined') {
                    showToast('Biblioteca de PDF n√£o carregada.', 'error');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add title
                doc.setFontSize(20);
                doc.text('Relat√≥rio de Entrega de Safra', 20, 20);
                
                // Add date
                doc.setFontSize(12);
                doc.text(`Data: ${formatDateDisplay(state.currentDate)}`, 20, 35);
                
                // Prepare table data
                const tableData = [];
                
                // Add header
                const headers = ['Frente', 'Per√≠odo', 'Entrega 2H', 'Potencial 2H', 'Diferen√ßa', 'Efici√™ncia %'];
                
                // Add data
                for (const period in state.timePeriodsMap) {
                    for (const front of state.fronts) {
                        const entrega = state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0;
                        const potencial = state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0;
                        const diferenca = entrega - potencial;
                        const eficiencia = potencial > 0 ? (entrega / potencial) * 100 : 0;
                        
                        tableData.push([
                            `F${front}`,
                            period,
                            entrega.toFixed(2),
                            potencial.toFixed(2),
                            diferenca.toFixed(2),
                            eficiencia.toFixed(1) + '%'
                        ]);
                    }
                }
                
                // Add table
                if (doc.autoTable) {
                    doc.autoTable({
                        head: [headers],
                        body: tableData,
                        startY: 50,
                        styles: { fontSize: 8 },
                        headStyles: { fillColor: [93, 92, 222] }
                    });
                } else {
                    // Fallback if autoTable is not available
                    let y = 50;
                    doc.setFontSize(10);
                    
                    // Add headers
                    let x = 20;
                    headers.forEach(header => {
                        doc.text(header, x, y);
                        x += 30;
                    });
                    y += 10;
                    
                    // Add data
                    tableData.forEach(row => {
                        x = 20;
                        row.forEach(cell => {
                            doc.text(cell.toString(), x, y);
                            x += 30;
                        });
                        y += 8;
                    });
                }
                
                // Save PDF
                doc.save(`entrega-safra-${state.currentDate}.pdf`);
                
                showToast('PDF exportado com sucesso!', 'success');
            };
            
            const exportDashboard = () => {
                if (typeof jsPDF === 'undefined') {
                    showToast('Biblioteca de PDF n√£o carregada.', 'error');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add title
                doc.setFontSize(20);
                doc.text('Dashboard - Gest√£o de Entrega de Safra', 20, 20);
                
                // Add date
                doc.setFontSize(12);
                doc.text(`Data: ${formatDateDisplay(state.currentDate)}`, 20, 35);
                
                // Add summary statistics
                let y = 55;
                doc.setFontSize(14);
                doc.text('Resumo Estat√≠stico:', 20, y);
                y += 15;
                
                doc.setFontSize(10);
                
                // Calculate totals
                const totalDelivery = Object.keys(state.delivery[state.currentDate] || {}).reduce((frontSum, front) => {
                    return frontSum + Object.keys(state.delivery[state.currentDate][front] || {}).reduce((hourSum, hour) => {
                        return hourSum + (state.delivery[state.currentDate][front][hour] || 0);
                    }, 0);
                }, 0);
                
                const totalPotential = Object.keys(state.twoHourPotential[state.currentDate] || {}).reduce((periodSum, period) => {
                    return periodSum + Object.keys(state.twoHourPotential[state.currentDate][period] || {}).reduce((frontSum, front) => {
                        return frontSum + (state.twoHourPotential[state.currentDate][period][front] || 0);
                    }, 0);
                }, 0);
                
                const efficiency = totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
                
                doc.text(`Total Entregue: ${totalDelivery.toFixed(2)} toneladas`, 20, y);
                y += 8;
                doc.text(`Total Potencial: ${totalPotential.toFixed(2)} toneladas`, 20, y);
                y += 8;
                doc.text(`Efici√™ncia Geral: ${efficiency.toFixed(1)}%`, 20, y);
                y += 15;
                
                // Add detailed table
                doc.setFontSize(12);
                doc.text('Detalhamento por Frente:', 20, y);
                y += 10;
                
                const tableData = [];
                const headers = ['Frente', 'Total Entregue', 'Total Previsto', 'N√£o Entregue', 'Efici√™ncia %', 'Viagens'];
                
                state.fronts.forEach(front => {
                    let frontDelivery = 0;
                    let frontPotential = 0;
                    let frontTrips = 0;
                    
                    // Calculate totals for this front
                    for (const period in state.timePeriodsMap) {
                        frontDelivery += state.twoHourDelivery[state.currentDate]?.[period]?.[front] || 0;
                        frontPotential += state.twoHourPotential[state.currentDate]?.[period]?.[front] || 0;
                    }
                    
                    for (const hour of state.hours) {
                        frontTrips += state.trips[state.currentDate]?.[front]?.[hour] || 0;
                    }
                    
                    const frontEfficiency = frontPotential > 0 ? (frontDelivery / frontPotential) * 100 : 0;
                    const naoEntregue = frontPotential - frontDelivery;
                    
                    tableData.push([
                        `F${front}`,
                        frontDelivery.toFixed(2),
                        frontPotential.toFixed(2),
                        naoEntregue > 0 ? `-${naoEntregue.toFixed(2)}` : '0.00',
                        frontEfficiency.toFixed(1) + '%',
                        frontTrips.toString()
                    ]);
                });
                
                if (doc.autoTable) {
                    doc.autoTable({
                        head: [headers],
                        body: tableData,
                        startY: y,
                        styles: { fontSize: 8 },
                        headStyles: { fillColor: [93, 92, 222] }
                    });
                }
                
                doc.save(`dashboard-${state.currentDate}.pdf`);
                showToast('Dashboard exportado em PDF com sucesso!', 'success');
            };
            
            // Search function
            const performSearch = () => {
                const searchTerm = document.getElementById('global-search')?.value.toLowerCase().trim();
                
                if (!searchTerm) {
                    showToast('Digite um termo para pesquisar.', 'warning');
                    return;
                }
                
                // Simple search logic - in a real app this would be more sophisticated
                let results = [];
                
                // Search in fronts
                state.fronts.forEach(front => {
                    if (front.includes(searchTerm) || `f${front}`.includes(searchTerm) || `frente${front}`.includes(searchTerm)) {
                        results.push({
                            type: 'front',
                            title: `Frente ${front}`,
                            description: 'Dados de entrega por hora',
                            action: () => {
                                showPage('entrega-hora');
                                toggleModal(elements.searchModal, false);
                            }
                        });
                    }
                });
                
                // Search in periods
                Object.keys(state.timePeriodsMap).forEach(period => {
                    if (period.includes(searchTerm) || period.replace('-', ':').includes(searchTerm)) {
                        results.push({
                            type: 'period',
                            title: `Per√≠odo ${period.substring(0, 2)}:00-${period.substring(3, 5)}:00`,
                            description: 'Dados de entrega do per√≠odo',
                            action: () => {
                                showPage('entrega-hora');
                                switchTimePeriodTab(period);
                                toggleModal(elements.searchModal, false);
                            }
                        });
                    }
                });
                
                // Search in pages
                const pages = [
                    { key: 'dashboard', name: 'Dashboard', desc: 'Vis√£o geral do desempenho' },
                    { key: 'entrega-hora', name: 'Entrega por Hora', desc: 'Registro de entregas por per√≠odo' },
                    { key: 'relatorios', name: 'Relat√≥rios', desc: 'An√°lises e relat√≥rios detalhados' },
                    { key: 'metas', name: 'Metas', desc: 'Acompanhamento de metas' },
                    { key: 'historico', name: 'Hist√≥rico', desc: 'Dados de dias anteriores' },
                    { key: 'configuracoes', name: 'Configura√ß√µes', desc: 'Configura√ß√µes do sistema' }
                ];
                
                pages.forEach(page => {
                    if (page.name.toLowerCase().includes(searchTerm) || page.key.includes(searchTerm)) {
                        results.push({
                            type: 'page',
                            title: page.name,
                            description: page.desc,
                            action: () => {
                                showPage(page.key);
                                toggleModal(elements.searchModal, false);
                            }
                        });
                    }
                });
                
                if (results.length === 0) {
                    showToast('Nenhum resultado encontrado.', 'info');
                } else {
                    showToast(`${results.length} resultado(s) encontrado(s).`, 'success');
                    
                    // Execute first result if only one found
                    if (results.length === 1) {
                        results[0].action();
                    }
                }
            };
            
            // Calendar functions for date range selection
            const generateCalendarDays = () => {
                const calendarDays = document.getElementById('calendar-days');
                const currentMonthYear = document.getElementById('current-month-year');
                
                if (!calendarDays || !currentMonthYear) return;
                
                calendarDays.innerHTML = '';
                
                const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                currentMonthYear.textContent = `${monthNames[state.calendar.currentMonth]} ${state.calendar.currentYear}`;
                
                const firstDay = new Date(state.calendar.currentYear, state.calendar.currentMonth, 1).getDay();
                const daysInMonth = new Date(state.calendar.currentYear, state.calendar.currentMonth + 1, 0).getDate();
                
                // Add empty cells for days before the first day of month
                for (let i = 0; i < firstDay; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = 'h-10';
                    calendarDays.appendChild(emptyCell);
                }
                
                // Add days
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayCell = document.createElement('div');
                    const cellDate = new Date(state.calendar.currentYear, state.calendar.currentMonth, day);
                    
                    dayCell.className = 'calendar-day h-10 flex items-center justify-center rounded-full cursor-pointer';
                    dayCell.textContent = day;
                    dayCell.setAttribute('data-date', cellDate.toISOString().split('T')[0]);
                    
                    // Add click event
                    dayCell.addEventListener('click', function() {
                        const clickedDate = new Date(this.getAttribute('data-date'));
                        
                        if (!state.calendar.startDate || (state.calendar.startDate && state.calendar.endDate)) {
                            // First selection or reset
                            state.calendar.startDate = clickedDate;
                            state.calendar.endDate = null;
                            
                            // Clear previous selections
                            document.querySelectorAll('.calendar-day').forEach(cell => {
                                cell.classList.remove('selected', 'in-range');
                            });
                            
                            this.classList.add('selected');
                        } else if (clickedDate < state.calendar.startDate) {
                            // Clicked date is before start date, make it the new start date
                            state.calendar.startDate = clickedDate;
                            
                            // Clear previous selections
                            document.querySelectorAll('.calendar-day').forEach(cell => {
                                cell.classList.remove('selected', 'in-range');
                            });
                            
                            this.classList.add('selected');
                        } else {
                            // Second selection - set end date
                            state.calendar.endDate = clickedDate;
                            
                            // Clear previous range styles
                            document.querySelectorAll('.calendar-day').forEach(cell => {
                                cell.classList.remove('in-range');
                            });
                            
                            // Mark range
                            document.querySelectorAll('.calendar-day').forEach(cell => {
                                const cellDate = new Date(cell.getAttribute('data-date'));
                                if (cellDate >= state.calendar.startDate && cellDate <= state.calendar.endDate) {
                                    cell.classList.add('in-range');
                                }
                            });
                        }
                        
                        updateDateRangeInputs();
                    });
                    
                    calendarDays.appendChild(dayCell);
                }
            };
            
            // Update date range inputs
            const updateDateRangeInputs = () => {
                const startDateInput = document.getElementById('start-date');
                const endDateInput = document.getElementById('end-date');
                
                if (startDateInput && state.calendar.startDate) {
                    startDateInput.value = formatDate(state.calendar.startDate);
                }
                
                if (endDateInput && state.calendar.endDate) {
                    endDateInput.value = formatDate(state.calendar.endDate);
                } else if (endDateInput) {
                    endDateInput.value = '';
                }
            };
            
            // Format date for display
            const formatDate = (date) => {
                if (!date) return '';
                
                const day = date.getDate().toString().padStart(2, '0');
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const year = date.getFullYear();
                
                return `${day}/${month}/${year}`;
            };
            
            // History functions
            const updateHistoryCalendar = () => {
                if (!elements.historyCalendar || !elements.historyMonthYear) return;
                
                // Clear calendar
                elements.historyCalendar.innerHTML = '';
                
                // Set month and year display
                const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                elements.historyMonthYear.textContent = `${monthNames[state.calendar.currentMonth]} ${state.calendar.currentYear}`;
                
                // Generate calendar
                const firstDay = new Date(state.calendar.currentYear, state.calendar.currentMonth, 1).getDay();
                const daysInMonth = new Date(state.calendar.currentYear, state.calendar.currentMonth + 1, 0).getDate();
                
                // Add empty cells for days before the first day of month
                for (let i = 0; i < firstDay; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = 'h-12';
                    elements.historyCalendar.appendChild(emptyCell);
                }
                
                // Add days
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayCell = document.createElement('div');
                    const currentDate = new Date(state.calendar.currentYear, state.calendar.currentMonth, day);
                    currentDate.setHours(0, 0, 0, 0);
                    const dateStr = currentDate.toISOString().split('T')[0];
                    
                    dayCell.className = 'h-12 flex items-center justify-center rounded-lg cursor-pointer border-2 border-transparent transition-all duration-200 hover:border-primary';
                    
                    // Highlight current date
                    if (currentDate.getTime() === today.getTime()) {
                        dayCell.classList.add('bg-primary', 'text-white');
                    }
                    
                    // Mark dates with data
                    if (state.availableDates.includes(dateStr)) {
                        dayCell.classList.add('bg-green-100', 'dark:bg-green-900', 'text-green-800', 'dark:text-green-200');
                    }
                    
                    dayCell.textContent = day;
                    dayCell.setAttribute('data-date', dateStr);
                    
                    // Add click event to view date data
                    dayCell.addEventListener('click', function() {
                        const selectedDate = this.getAttribute('data-date');
                        if (selectedDate && state.availableDates.includes(selectedDate)) {
                            changeCurrentDate(selectedDate);
                            showPage('entrega-hora');
                        }
                    });
                    
                    elements.historyCalendar.appendChild(dayCell);
                }
            };
            
            const navigateHistoryMonth = (direction) => {
                state.calendar.currentMonth += direction;
                if (state.calendar.currentMonth > 11) {
                    state.calendar.currentMonth = 0;
                    state.calendar.currentYear++;
                } else if (state.calendar.currentMonth < 0) {
                    state.calendar.currentMonth = 11;
                    state.calendar.currentYear--;
                }
                
                updateHistoryCalendar();
            };
            
            const updateHistoryTable = () => {
                if (!elements.historyTableBody || !elements.historyEmptyState) return;
                
                // Clear table
                elements.historyTableBody.innerHTML = '';
                
                // Get filter selection
                const periodFilter = document.getElementById('history-period-filter')?.value || 'all';
                
                // Get all available dates and sort them in descending order (newest first)
                const sortedDates = [...state.availableDates].sort().reverse();
                
                if (sortedDates.length === 0) {
                    elements.historyEmptyState.classList.remove('hidden');
                    return;
                } else {
                    elements.historyEmptyState.classList.add('hidden');
                }
                
                // Process each date
                sortedDates.forEach(date => {
                    // Calculate totals for this date
                    let totalDelivery = 0;
                    let totalPotential = 0;
                    let totalTrips = 0;
                    let densitySum = 0;
                    let densityCount = 0;
                    
                    if (periodFilter === 'all') {
                        // Calculate for all periods
                        for (const period in state.timePeriodsMap) {
                            for (const front of state.fronts) {
                                totalDelivery += state.twoHourDelivery[date]?.[period]?.[front] || 0;
                                totalPotential += state.twoHourPotential[date]?.[period]?.[front] || 0;
                            }
                        }
                        
                        for (const hour of state.hours) {
                            for (const front of state.fronts) {
                                totalTrips += state.trips[date]?.[front]?.[hour] || 0;
                                
                                if ((state.density[date]?.[front]?.[hour] || 0) > 0) {
                                    densitySum += state.density[date][front][hour];
                                    densityCount++;
                                }
                            }
                        }
                    } else {
                        // Calculate for specific period
                        for (const front of state.fronts) {
                            totalDelivery += state.twoHourDelivery[date]?.[periodFilter]?.[front] || 0;
                            totalPotential += state.twoHourPotential[date]?.[periodFilter]?.[front] || 0;
                        }
                        
                        const hours = state.timePeriodsMap[periodFilter];
                        for (const hour of hours) {
                            for (const front of state.fronts) {
                                totalTrips += state.trips[date]?.[front]?.[hour] || 0;
                                
                                if ((state.density[date]?.[front]?.[hour] || 0) > 0) {
                                    densitySum += state.density[date][front][hour];
                                    densityCount++;
                                }
                            }
                        }
                    }
                    
                    const efficiency = totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
                    const avgDensity = densityCount > 0 ? densitySum / densityCount : 0;
                    
                    // Create table row
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition duration-150';
                    
                    row.innerHTML = `
                        <td class="px-4 py-3 whitespace-nowrap font-medium">${formatDateDisplay(date)}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-success-600 dark:text-success-400">${totalDelivery.toFixed(2)} ton</td>
                        <td class="px-4 py-3 whitespace-nowrap">${totalPotential.toFixed(2)} ton</td>
                        <td class="px-4 py-3 whitespace-nowrap ${getEfficiencyTextColor(efficiency)}">${efficiency.toFixed(1)}%</td>
                        <td class="px-4 py-3 whitespace-nowrap">${totalTrips}</td>
                        <td class="px-4 py-3 whitespace-nowrap">${avgDensity.toFixed(2)}</td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="flex space-x-2">
                                <button class="text-primary hover:text-primary-600 dark:text-primary-300 dark:hover:text-primary-400 text-sm" onclick="viewHistoryDate('${date}')">Ver</button>
                                <button class="text-green-600 hover:text-green-700 dark:text-green-400 dark:hover:text-green-300 text-sm" onclick="copyHistoryDate('${date}')">Copiar</button>
                            </div>
                        </td>
                    `;
                    
                    elements.historyTableBody.appendChild(row);
                });
            };
            
            const exportHistoryData = () => {
                if (state.availableDates.length === 0) {
                    showToast('N√£o h√° dados hist√≥ricos para exportar.', 'warning');
                    return;
                }
                
                const historyData = {
                    exportDate: new Date().toISOString(),
                    availableDates: state.availableDates,
                    fronts: state.fronts,
                    data: {}
                };
                
                // Export data for all available dates
                state.availableDates.forEach(date => {
                    historyData.data[date] = {
                        density: state.density[date] || {},
                        trips: state.trips[date] || {},
                        delivery: state.delivery[date] || {},
                        potential: state.potential[date] || {},
                        twoHourDelivery: state.twoHourDelivery[date] || {},
                        twoHourPotential: state.twoHourPotential[date] || {},
                        difference: state.difference[date] || {}
                    };
                });
                
                const jsonString = JSON.stringify(historyData, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `historico-entrega-safra.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('Hist√≥rico exportado com sucesso!', 'success');
            };
            
            // Global functions for history actions
            window.viewHistoryDate = (date) => {
                changeCurrentDate(date);
                showPage('entrega-hora');
            };
            
            window.copyHistoryDate = (date) => {
                if (!state.density[date] || !state.trips[date] || !state.potential[date]) {
                    showToast('Dados n√£o encontrados para esta data.', 'error');
                    return;
                }
                
                // Copy data from the selected date to current date
                state.density[state.currentDate] = JSON.parse(JSON.stringify(state.density[date]));
                state.trips[state.currentDate] = JSON.parse(JSON.stringify(state.trips[date]));
                state.delivery[state.currentDate] = JSON.parse(JSON.stringify(state.delivery[date]));
                state.potential[state.currentDate] = JSON.parse(JSON.stringify(state.potential[date]));
                state.twoHourDelivery[state.currentDate] = JSON.parse(JSON.stringify(state.twoHourDelivery[date]));
                state.twoHourPotential[state.currentDate] = JSON.parse(JSON.stringify(state.twoHourPotential[date]));
                state.difference[state.currentDate] = JSON.parse(JSON.stringify(state.difference[date]));
                
                // Add current date to available dates if not already there
                if (!state.availableDates.includes(state.currentDate)) {
                    state.availableDates.push(state.currentDate);
                    state.availableDates.sort();
                }
                
                // Update UI
                if (state.currentPage === 'entrega-hora') {
                    generateTimePeriodHTML();
                } else if (state.currentPage === 'dashboard') {
                    updateDashboardCharts();
                    updateDetailedFrontTable();
                }
                
                const sourceDateFormatted = formatDateDisplay(date);
                const targetDateFormatted = formatDateDisplay(state.currentDate);
                showToast(`Dados copiados de ${sourceDateFormatted} para ${targetDateFormatted}!`, 'success');
            };
            
            // Configuration functions
            const updateConfigFromUI = () => {
                const autoSaveToggle = document.getElementById('auto-save-toggle');
                const autoSaveInterval = document.getElementById('auto-save-interval');
                const darkModeToggle = document.getElementById('dark-mode-toggle');
                const alertThreshold = document.getElementById('alert-threshold');
                const soundAlertToggle = document.getElementById('sound-alert-toggle');
                const visualAlertToggle = document.getElementById('visual-alert-toggle');
                
                if (autoSaveToggle) state.config.autoSave = autoSaveToggle.checked;
                if (autoSaveInterval) state.config.autoSaveInterval = parseInt(autoSaveInterval.value) || 5;
                if (darkModeToggle) state.config.darkMode = darkModeToggle.checked;
                if (alertThreshold) state.config.alertThreshold = parseInt(alertThreshold.value) || 10;
                if (soundAlertToggle) state.config.soundAlerts = soundAlertToggle.checked;
                if (visualAlertToggle) state.config.visualAlerts = visualAlertToggle.checked;
                
                // Apply dark mode setting
                if (state.config.darkMode !== document.documentElement.classList.contains('dark')) {
                    toggleDarkMode();
                }
            };
            
            const loadConfigToUI = () => {
                const autoSaveToggle = document.getElementById('auto-save-toggle');
                const autoSaveInterval = document.getElementById('auto-save-interval');
                const darkModeToggle = document.getElementById('dark-mode-toggle');
                const alertThreshold = document.getElementById('alert-threshold');
                const soundAlertToggle = document.getElementById('sound-alert-toggle');
                const visualAlertToggle = document.getElementById('visual-alert-toggle');
                
                if (autoSaveToggle) autoSaveToggle.checked = state.config.autoSave;
                if (autoSaveInterval) autoSaveInterval.value = state.config.autoSaveInterval;
                if (darkModeToggle) darkModeToggle.checked = state.config.darkMode;
                if (alertThreshold) alertThreshold.value = state.config.alertThreshold;
                if (soundAlertToggle) soundAlertToggle.checked = state.config.soundAlerts;
                if (visualAlertToggle) visualAlertToggle.checked = state.config.visualAlerts;
            };
            
            const restoreDefaultConfig = () => {
                state.config = {
                    autoSave: true,
                    autoSaveInterval: 5,
                    darkMode: false,
                    alertThreshold: 10,
                    soundAlerts: false,
                    visualAlerts: true
                };
                
                loadConfigToUI();
                saveConfig();
                
                showToast('Configura√ß√µes restauradas para os valores padr√£o!', 'success');
            };
            
            const saveConfig = () => {
                try {
                    localStorage.setItem('ggomes-log-config', JSON.stringify(state.config));
                } catch (e) {
                    console.warn('Could not save config to localStorage:', e);
                }
            };
            
            const loadConfig = () => {
                try {
                    const savedConfig = localStorage.getItem('ggomes-log-config');
                    if (savedConfig) {
                        state.config = { ...state.config, ...JSON.parse(savedConfig) };
                    }
                } catch (e) {
                    console.warn('Could not load config from localStorage:', e);
                }
                
                // Apply dark mode if configured
                if (state.config.darkMode) {
                    document.documentElement.classList.add('dark');
                }
                
                loadConfigToUI();
            };
            
            // Data persistence functions
            const saveData = () => {
                try {
                    const dataToSave = {
                        currentDate: state.currentDate,
                        availableDates: state.availableDates,
                        fronts: state.fronts,
                        density: state.density,
                        trips: state.trips,
                        delivery: state.delivery,
                        potential: state.potential,
                        twoHourDelivery: state.twoHourDelivery,
                        twoHourPotential: state.twoHourPotential,
                        difference: state.difference,
                        lastSaved: new Date().toISOString()
                    };
                    
                    localStorage.setItem('ggomes-log-data', JSON.stringify(dataToSave));
                    return true;
                } catch (e) {
                    console.error('Could not save data to localStorage:', e);
                    showToast('Erro ao salvar dados. Espa√ßo de armazenamento pode estar cheio.', 'error');
                    return false;
                }
            };
            
            const loadData = () => {
                try {
                    const savedData = localStorage.getItem('ggomes-log-data');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        
                        // Restore state
                        state.currentDate = data.currentDate || state.currentDate;
                        state.availableDates = data.availableDates || [];
                        state.fronts = data.fronts || ['4001', '4002', '4007', '4009'];
                        state.density = data.density || {};
                        state.trips = data.trips || {};
                        state.delivery = data.delivery || {};
                        state.potential = data.potential || {};
                        state.twoHourDelivery = data.twoHourDelivery || {};
                        state.twoHourPotential = data.twoHourPotential || {};
                        state.difference = data.difference || {};
                        
                        return true;
                    }
                } catch (e) {
                    console.error('Could not load data from localStorage:', e);
                    showToast('Erro ao carregar dados salvos.', 'error');
                }
                
                return false;
            };
            
            // Auto save functionality
            const setupAutoSave = () => {
                if (autoSaveTimer) {
                    clearInterval(autoSaveTimer);
                }
                
                if (state.config.autoSave) {
                    autoSaveTimer = setInterval(() => {
                        if (saveData()) {
                            console.log('Auto-save completed');
                        }
                    }, state.config.autoSaveInterval * 60 * 1000); // Convert minutes to milliseconds
                }
            };
            
            // History management
            const addToHistory = (type, data) => {
                state.history.push({
                    type,
                    data,
                    timestamp: new Date().toISOString()
                });
                
                // Limit history to last 100 actions
                if (state.history.length > 100) {
                    state.history = state.history.slice(-100);
                }
            };
            
            // Toast notification system
            const showToast = (message, type = 'info', duration = 3000) => {
                if (!elements.toastContainer) return;
                
                const toast = document.createElement('div');
                toast.className = `mb-2 max-w-sm w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 transform transition-all duration-300 translate-x-full`;
                
                const colors = {
                    success: 'text-green-800 dark:text-green-200 bg-green-50 dark:bg-green-900/50',
                    error: 'text-red-800 dark:text-red-200 bg-red-50 dark:bg-red-900/50',
                    warning: 'text-yellow-800 dark:text-yellow-200 bg-yellow-50 dark:bg-yellow-900/50',
                    info: 'text-blue-800 dark:text-blue-200 bg-blue-50 dark:bg-blue-900/50'
                };
                
                const icons = {
                    success: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>`,
                    error: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>`,
                    warning: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>`,
                    info: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>`
                };
                
                toast.innerHTML = `
                    <div class="p-4">
                        <div class="flex items-start">
                            <div class="flex-shrink-0 ${colors[type]} p-2 rounded-full">
                                ${icons[type]}
                            </div>
                            <div class="ml-3 w-0 flex-1 pt-0.5">
                                <p class="text-sm font-medium text-gray-900 dark:text-gray-100">${message}</p>
                            </div>
                            <div class="ml-4 flex-shrink-0 flex">
                                <button class="close-toast bg-white dark:bg-gray-800 rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                                    <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                elements.toastContainer.appendChild(toast);
                
                // Animate in
                setTimeout(() => {
                    toast.classList.remove('translate-x-full');
                    toast.classList.add('translate-x-0');
                }, 100);
                
                // Auto remove
                const removeToast = () => {
                    toast.classList.add('translate-x-full');
                    setTimeout(() => {
                        if (elements.toastContainer.contains(toast)) {
                            elements.toastContainer.removeChild(toast);
                        }
                    }, 300);
                };
                
                // Add close button functionality
                const closeBtn = toast.querySelector('.close-toast');
                if (closeBtn) {
                    closeBtn.addEventListener('click', removeToast);
                }
                
                // Auto remove after duration
                setTimeout(removeToast, duration);
            };
            
            // Initialize the application
            const init = () => {
                // Cache DOM elements
                cacheElements();
                
                // Load configuration and data
                loadConfig();
                loadData();
                
                // Initialize data structures
                initializeDataStructures();
                
                // Setup event listeners
                setupEventListeners();
                
                // Initialize charts
                initializeCharts();
                
                // Update date display
                updateDateDisplay();
                
                // Update date navigation buttons
                updateDateNavigationButtons();
                
                // Update dark mode toggle
                updateDarkModeToggle();
                
                // Setup auto save
                setupAutoSave();
                
                // Initialize the current page
                if (state.currentPage === 'entrega-hora') {
                    generateTimePeriodHTML();
                } else if (state.currentPage === 'dashboard') {
                    updateDashboardCharts();
                    updateDetailedFrontTable();
                }
                
                // Show success message
                showToast('Sistema inicializado com sucesso!', 'success');
                
                console.log('GGOMES-LOG System initialized successfully');
            };
            
            // Public API
            return {
                init,
                showToast,
                saveData,
                loadData,
                state
            };
        })();
        
        // Initialize the application when the DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Check if theme preference exists
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            
            // Initialize the app
            App.init();
        });
        
        // Handle page visibility changes for auto-save
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'hidden') {
                // Save data before page becomes hidden
                App.saveData();
            }
        });
        
        // Handle beforeunload for emergency save
        window.addEventListener('beforeunload', function(e) {
            App.saveData();
        });
    </script>
</body>
</html>
