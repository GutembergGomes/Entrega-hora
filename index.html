<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gest√£o de Entrega de Safra 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.0.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.2.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.25/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#5D5CDE',
                            '50': '#EEEEFF',
                            '100': '#D4D4F7',
                            '200': '#ACACEF',
                            '300': '#8584E7',
                            '400': '#5D5CDE',
                            '500': '#3635D5',
                            '600': '#2A29B0',
                            '700': '#211F8A',
                            '800': '#171664',
                            '900': '#0D0C3E'
                        },
                        secondary: {
                            DEFAULT: '#6B7280',
                            '50': '#F9FAFB',
                            '100': '#F3F4F6',
                            '200': '#E5E7EB',
                            '300': '#D1D5DB',
                            '400': '#9CA3AF',
                            '500': '#6B7280',
                            '600': '#4B5563',
                            '700': '#374151',
                            '800': '#1F2937',
                            '900': '#111827'
                        },
                        success: {
                            DEFAULT: '#10B981',
                            '50': '#ECFDF5',
                            '100': '#D1FAE5',
                            '200': '#A7F3D0',
                            '300': '#6EE7B7',
                            '400': '#34D399',
                            '500': '#10B981',
                            '600': '#059669',
                            '700': '#047857',
                            '800': '#065F46',
                            '900': '#064E3B'
                        },
                        warning: {
                            DEFAULT: '#F59E0B',
                            '50': '#FFFBEB',
                            '100': '#FEF3C7',
                            '200': '#FDE68A',
                            '300': '#FCD34D',
                            '400': '#FBBF24',
                            '500': '#F59E0B',
                            '600': '#D97706',
                            '700': '#B45309',
                            '800': '#92400E',
                            '900': '#78350F'
                        },
                        danger: {
                            DEFAULT: '#EF4444',
                            '50': '#FEF2F2',
                            '100': '#FEE2E2',
                            '200': '#FECACA',
                            '300': '#FCA5A5',
                            '400': '#F87171',
                            '500': '#EF4444',
                            '600': '#DC2626',
                            '700': '#B91C1C',
                            '800': '#991B1B',
                            '900': '#7F1D1D'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    },
                    boxShadow: {
                        'inner-sm': 'inset 0 1px 2px 0 rgba(0, 0, 0, 0.05)',
                        'soft': '0 2px 15px -3px rgba(0, 0, 0, 0.07), 0 10px 20px -2px rgba(0, 0, 0, 0.04)',
                        'card': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)'
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'progress': 'progress 1s ease-in-out infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'bounce-sm': 'bounce-sm 1s infinite'
                    },
                    keyframes: {
                        progress: {
                            '0%': { width: '0%' },
                            '100%': { width: '100%' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        'bounce-sm': {
                            '0%, 100%': {
                                transform: 'translateY(-2px)',
                                animationTimingFunction: 'cubic-bezier(0.8, 0, 1, 1)'
                            },
                            '50%': {
                                transform: 'translateY(0)',
                                animationTimingFunction: 'cubic-bezier(0, 0, 0.2, 1)'
                            }
                        }
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <style>
        [x-cloak] { display: none !important; }
        .input-number {
            -moz-appearance: textfield;
            appearance: textfield;
        }
        .input-number::-webkit-outer-spin-button,
        .input-number::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* Skeleton loading effect */
        .skeleton {
            animation: skeleton-loading 1.5s infinite;
            background-image: linear-gradient(90deg, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0));
            background-size: 200px 100%;
            background-repeat: no-repeat;
            background-position: -200px 0;
        }
        
        @keyframes skeleton-loading {
            100% { background-position: 200px 0; }
        }
        
        .dark .skeleton {
            animation: skeleton-loading-dark 1.5s infinite;
            background-image: linear-gradient(90deg, rgba(50, 50, 50, 0), rgba(50, 50, 50, 0.4), rgba(50, 50, 50, 0));
            background-size: 200px 100%;
            background-repeat: no-repeat;
            background-position: -200px 0;
        }
        
        @keyframes skeleton-loading-dark {
            100% { background-position: 200px 0; }
        }
        
        /* Transitions */
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
        }
        .dark ::-webkit-scrollbar-track {
            background: #374151;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #4B5563;
        }
        .dark ::-webkit-scrollbar-thumb:hover {
            background: #6B7280;
        }
        
        /* Tooltip styles */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltip-text {
            visibility: hidden;
            width: auto;
            min-width: 120px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            white-space: nowrap;
        }
        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: rgba(0, 0, 0, 0.8) transparent transparent transparent;
        }
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        .dark .tooltip .tooltip-text {
            background-color: rgba(255, 255, 255, 0.8);
            color: #000;
        }
        .dark .tooltip .tooltip-text::after {
            border-color: rgba(255, 255, 255, 0.8) transparent transparent transparent;
        }

        /* Dashboard card hover effects */
        .dashboard-card {
            transition: all 0.3s ease;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        /* Calendar styles */
        .calendar-day {
            transition: all 0.2s ease;
        }
        
        .calendar-day:hover:not(.disabled) {
            background-color: rgba(93, 92, 222, 0.1);
        }
        
        .calendar-day.selected {
            background-color: rgba(93, 92, 222, 0.2);
            font-weight: bold;
        }
        
        .calendar-day.current {
            border: 2px solid #5D5CDE;
        }
        
        .calendar-day.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        /* Accordion styles */
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .accordion-open .accordion-content {
            max-height: 1000px;
        }
        
        /* Slideshow styles */
        .slide {
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .slide.active {
            opacity: 1;
            transform: translateX(0);
        }
        
        .slide.inactive {
            opacity: 0;
            transform: translateX(100%);
            position: absolute;
        }
        
        /* Animation for achievements */
        @keyframes achievement-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .achievement-unlock {
            animation: achievement-pulse 0.5s ease-in-out;
        }
        
        /* Print styles */
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                background-color: white !important;
                color: black !important;
            }
            
            .print-full-width {
                width: 100% !important;
                max-width: 100% !important;
            }
            
            .print-break-after {
                page-break-after: always;
            }
        }
        
        /* Touch area increase for mobile */
        @media (max-width: 768px) {
            .touch-target {
                min-height: 44px;
                min-width: 44px;
            }
        }
        
        /* Dark mode transition */
        .dark-transition {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        /* Fancy focus rings */
        .focus-ring:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.5);
        }
        
        /* Custom checkbox */
        .custom-checkbox {
            position: relative;
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid #6B7280;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .custom-checkbox.checked {
            background-color: #5D5CDE;
            border-color: #5D5CDE;
        }
        
        .custom-checkbox.checked::after {
            content: '';
            position: absolute;
            left: 5px;
            top: 2px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }
        
        /* Weather icons */
        .weather-icon {
            filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.2));
        }
        
        .dark .weather-icon {
            filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.1));
        }
        
        /* Custom scrollbar for dropdown menus */
        .dropdown-scroll {
            max-height: 200px;
            overflow-y: auto;
            scrollbar-width: thin;
        }
        
        .dropdown-scroll::-webkit-scrollbar {
            width: 6px;
        }
        
        .dropdown-scroll::-webkit-scrollbar-thumb {
            background-color: #9CA3AF;
            border-radius: 3px;
        }
        
        .dark .dropdown-scroll::-webkit-scrollbar-thumb {
            background-color: #4B5563;
        }
        
        /* Grid background pattern */
        .grid-pattern {
            background-image: 
                linear-gradient(rgba(229, 231, 235, 0.5) 1px, transparent 1px),
                linear-gradient(90deg, rgba(229, 231, 235, 0.5) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .dark .grid-pattern {
            background-image: 
                linear-gradient(rgba(55, 65, 81, 0.5) 1px, transparent 1px),
                linear-gradient(90deg, rgba(55, 65, 81, 0.5) 1px, transparent 1px);
        }
        
        /* Glow effect for important elements */
        .glow {
            box-shadow: 0 0 15px rgba(93, 92, 222, 0.5);
        }
        
        .dark .glow {
            box-shadow: 0 0 15px rgba(93, 92, 222, 0.7);
        }
        
        /* Fancy number input */
        .fancy-number-input {
            position: relative;
        }
        
        .fancy-number-input button {
            position: absolute;
            right: 0;
            width: 20px;
            height: 50%;
            background-color: #E5E7EB;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        
        .fancy-number-input button:hover {
            background-color: #D1D5DB;
        }
        
        .fancy-number-input button:first-of-type {
            top: 0;
            border-top-right-radius: 4px;
        }
        
        .fancy-number-input button:last-of-type {
            bottom: 0;
            border-bottom-right-radius: 4px;
        }
        
        .dark .fancy-number-input button {
            background-color: #374151;
        }
        
        .dark .fancy-number-input button:hover {
            background-color: #4B5563;
        }
        
        /* Text gradient for headings */
        .text-gradient {
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            background-image: linear-gradient(to right, #5D5CDE, #4F46E5);
        }
        
        .dark .text-gradient {
            background-image: linear-gradient(to right, #818CF8, #6366F1);
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen transition-colors duration-200">
    <div class="drawer-wrapper relative">
        <!-- Left Side Drawer -->
        <div id="left-drawer" class="fixed left-0 top-0 h-full w-64 bg-white dark:bg-gray-800 shadow-lg transform -translate-x-full transition-transform duration-300 ease-in-out z-40">
            <div class="p-4 h-full flex flex-col">
                <!-- App Logo in Drawer -->
                <div class="flex items-center mb-8 mt-4">
                    <div class="h-10 w-10 rounded-md bg-primary flex items-center justify-center text-white font-bold text-xl shadow-md">GG</div>
                    <span class="ml-2 font-semibold text-xl text-gray-900 dark:text-gray-100">GGOMES-LOG</span>
                </div>
                
                <!-- Navigation Links -->
                <nav class="flex-1">
                    <ul class="space-y-1">
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="dashboard">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                                </svg>
                                Dashboard
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="entrega-hora">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                </svg>
                                Entrega por Hora
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="relatorios">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                An√°lises e Relat√≥rios
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="metas">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Metas e Desempenho
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="configuracoes">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                Configura√ß√µes
                            </a>
                        </li>
                    </ul>
                </nav>
                
                <!-- User section -->
                <div class="border-t border-gray-200 dark:border-gray-700 pt-4 mt-4">
                    <div class="flex items-center">
                        <div class="h-9 w-9 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-800 dark:text-blue-200 font-medium">GG</div>
                        <div class="ml-3">
                            <div class="font-medium text-gray-700 dark:text-gray-300">Gutemberg Gomes</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">Gerente de Opera√ß√µes</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Drawer Backdrop -->
        <div id="drawer-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden"></div>
        
        <!-- Main Content -->
        <div class="min-h-screen flex flex-col">
            <!-- Top Navigation Bar -->
            <header class="bg-white dark:bg-gray-800 shadow-md">
                <div class="container mx-auto px-4 py-3">
                    <div class="flex justify-between items-center">
                        <!-- Left Side: Menu Button + Logo -->
                        <div class="flex items-center">
                            <button id="menu-button" class="mr-4 p-2 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                                </svg>
                            </button>
                            <div class="flex items-center">
                                <div class="h-8 w-8 rounded-md bg-primary flex items-center justify-center text-white font-bold text-lg shadow-md">GG</div>
                                <span class="ml-2 font-semibold text-xl text-gray-900 dark:text-gray-100 hidden sm:inline-block">GGOMES-LOG</span>
                            </div>
                        </div>
                        
                        <!-- Right Side: Actions -->
                        <div class="flex items-center space-x-2 sm:space-x-4">
                            <!-- Current Date Display -->
                            <div class="hidden md:flex items-center mr-4 text-gray-600 dark:text-gray-300">
                                <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <span id="header-date" class="text-sm font-medium"></span>
                            </div>
                            
                            <!-- Search Button -->
                            <button id="search-button" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </button>
                            
                            <!-- Notifications -->
                            <div class="relative">
                                <button id="notifications-button" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                                    </svg>
                                    <span class="absolute top-0 right-0 h-4 w-4 bg-red-500 rounded-full text-xs text-white flex items-center justify-center">3</span>
                                </button>
                                
                                <!-- Notifications Dropdown -->
                                <div id="notifications-dropdown" class="absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-md shadow-lg z-20 hidden">
                                    <div class="p-3 border-b border-gray-200 dark:border-gray-700">
                                        <div class="flex justify-between items-center">
                                            <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300">Notifica√ß√µes</h3>
                                            <button class="text-xs text-primary hover:text-primary-600 dark:text-primary-300 dark:hover:text-primary-400">Marcar todas como lidas</button>
                                        </div>
                                    </div>
                                    <div class="max-h-80 overflow-y-auto dropdown-scroll">
                                        <a href="#" class="block p-3 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-red-100 dark:bg-red-900 flex items-center justify-center text-red-500 dark:text-red-300">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                    </svg>
                                                </div>
                                                <div class="ml-3">
                                                    <p class="text-sm text-gray-700 dark:text-gray-300"><span class="font-medium">Alerta:</span> Entrega abaixo de 50% do potencial na Frente 4001</p>
                                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">H√° 10 minutos</p>
                                                </div>
                                            </div>
                                        </a>
                                        <a href="#" class="block p-3 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-500 dark:text-blue-300">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
                                                    </svg>
                                                </div>
                                                <div class="ml-3">
                                                    <p class="text-sm text-gray-700 dark:text-gray-300"><span class="font-medium">Nova mensagem:</span> Carlos Mendes comentou sobre o per√≠odo 14:00-16:00</p>
                                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">H√° 30 minutos</p>
                                                </div>
                                            </div>
                                        </a>
                                        <a href="#" class="block p-3 hover:bg-gray-50 dark:hover:bg-gray-700">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center text-green-500 dark:text-green-300">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                    </svg>
                                                </div>
                                                <div class="ml-3">
                                                    <p class="text-sm text-gray-700 dark:text-gray-300"><span class="font-medium">Meta atingida:</span> Frente 4012 superou a meta di√°ria</p>
                                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">H√° 1 hora</p>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                    <div class="p-2 border-t border-gray-200 dark:border-gray-700">
                                        <a href="#" class="block text-center text-sm text-primary hover:text-primary-600 dark:text-primary-300 dark:hover:text-primary-400">Ver todas</a>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Theme Toggle -->
                            <button id="theme-toggle" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none">
                                <!-- Sun icon -->
                                <svg id="theme-toggle-light-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" />
                                </svg>
                                <!-- Moon icon -->
                                <svg id="theme-toggle-dark-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
                                </svg>
                            </button>
                            
                            <!-- Save Button -->
                            <button id="save-data" class="bg-primary hover:bg-primary-600 text-white px-3 py-2 rounded-md shadow transition duration-200 flex items-center">
                                <svg class="w-4 h-4 mr-1 sm:mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                                </svg>
                                <span class="hidden sm:inline">Salvar</span>
                            </button>
                            
                            <!-- User Menu -->
                            <div class="relative">
                                <button id="user-menu-button" class="flex text-sm bg-gray-100 dark:bg-gray-700 rounded-full focus:outline-none">
                                    <div class="h-8 w-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-800 dark:text-blue-200 font-medium">GG</div>
                                </button>
                                
                                <!-- User Menu Dropdown -->
                                <div id="user-menu-dropdown" class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg z-20 hidden">
                                    <div class="py-1">
                                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Perfil</a>
                                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Configura√ß√µes</a>
                                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Suporte</a>
                                        <div class="border-t border-gray-100 dark:border-gray-700"></div>
                                        <a href="#" class="block px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700">Sair</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Search Modal -->
            <div id="search-modal" class="fixed inset-0 z-50 overflow-y-auto hidden">
                <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                    <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                        <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
                    </div>
                    <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full">
                        <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                            <div class="sm:flex sm:items-start">
                                <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                                    <div class="flex items-center justify-between">
                                        <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Pesquisa R√°pida</h3>
                                        <button id="close-search-modal" class="text-gray-400 hover:text-gray-500 focus:outline-none">
                                            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>
                                    <div class="mt-4">
                                        <div class="relative">
                                            <input type="text" id="global-search" class="w-full p-3 pl-10 text-gray-900 dark:text-gray-100 bg-gray-100 dark:bg-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Pesquisar frentes, per√≠odos, relat√≥rios..." autofocus>
                                            <div class="absolute left-3 top-3 text-gray-400">
                                                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                                </svg>
                                            </div>
                                        </div>
                                        <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                                            Pressione <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded">Enter</kbd> para pesquisar ou <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded">ESC</kbd> para fechar
                                        </div>
                                    </div>
                                    
                                    <!-- Search Results -->
                                    <div class="mt-4 max-h-96 overflow-y-auto">
                                        <h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Resultados Recentes</h4>
                                        <div class="space-y-2">
                                            <a href="#" class="block p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700">
                                                <div class="flex items-center">
                                                    <div class="flex-shrink-0 h-8 w-8 rounded-md bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-500 dark:text-blue-300">
                                                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                                        </svg>
                                                    </div>
                                                    <div class="ml-3">
                                                        <p class="text-sm font-medium text-gray-900 dark:text-gray-100">Frente 4001</p>
                                                        <p class="text-xs text-gray-500 dark:text-gray-400">Entrega por Hora > Per√≠odo 06:00-08:00</p>
                                                    </div>
                                                </div>
                                            </a>
                                            <a href="#" class="block p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700">
                                                <div class="flex items-center">
                                                    <div class="flex-shrink-0 h-8 w-8 rounded-md bg-green-100 dark:bg-green-900 flex items-center justify-center text-green-500 dark:text-green-300">
                                                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                                        </svg>
                                                    </div>
                                                    <div class="ml-3">
                                                        <p class="text-sm font-medium text-gray-900 dark:text-gray-100">Relat√≥rio Mensal</p>
                                                        <p class="text-xs text-gray-500 dark:text-gray-400">An√°lises e Relat√≥rios > Desempenho Mensal</p>
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                            <button type="button" id="search-execute" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary text-base font-medium text-white hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:ml-3 sm:w-auto sm:text-sm">
                                Pesquisar
                            </button>
                            <button type="button" id="search-cancel" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                                Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content Container -->
            <main class="flex-1 p-4 container mx-auto">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-soft p-6 mb-6">
                    <div class="mb-6 flex flex-col md:flex-row md:justify-between md:items-center space-y-4 md:space-y-0">
                        <div>
                            <h1 id="page-title" class="text-2xl font-bold text-gray-900 dark:text-gray-100">Dashboard</h1>
                            <p id="page-subtitle" class="text-gray-600 dark:text-gray-400 mt-1">Vis√£o geral do desempenho da safra 2025</p>
                        </div>
                        <div class="flex flex-wrap space-x-2 items-center">
                            <div class="relative">
                                <select id="period-selector" class="appearance-none bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white dark:focus:bg-gray-800 focus:border-primary transition duration-150">
                                    <option value="daily">Hoje</option>
                                    <option value="weekly">Esta Semana</option>
                                    <option value="monthly">Este M√™s</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300">
                                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                        <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                    </svg>
                                </div>
                            </div>
                            <button id="custom-date-button" class="hidden items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <span id="custom-date-range">Selecionar Datas</span>
                            </button>
                            <button id="export-dashboard" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                                Exportar
                            </button>
                        </div>
                    </div>
                    
                    <!-- Dashboard Content -->
                    <div id="dashboard-content" class="page-content">
                        <!-- Dashboard Stats Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Entregue</p>
                                        <p id="total-entregue-card" class="text-2xl font-bold text-gray-900 dark:text-gray-100">0.0</p>
                                        <span class="inline-flex items-center text-sm font-medium text-green-600 dark:text-green-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                                            </svg>
                                            <span id="variacao-entrega">0.0</span>% <span class="ml-1 text-gray-500 dark:text-gray-400">vs semana anterior</span>
                                        </span>
                                    </div>
                                    <div class="bg-primary-50 dark:bg-primary-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-primary-500 dark:text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div id="progresso-entrega" class="bg-primary rounded-full h-2" style="width: 0%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1"><span id="porcentagem-meta-entrega">0</span>% da meta mensal</p>
                                </div>
                            </div>
                            
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Efici√™ncia M√©dia</p>
                                        <p id="eficiencia-media-card" class="text-2xl font-bold text-gray-900 dark:text-gray-100">0.0%</p>
                                        <span class="inline-flex items-center text-sm font-medium text-red-600 dark:text-red-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
                                            </svg>
                                            <span id="variacao-eficiencia">0.0</span>% <span class="ml-1 text-gray-500 dark:text-gray-400">vs semana anterior</span>
                                        </span>
                                    </div>
                                    <div class="bg-blue-50 dark:bg-blue-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-blue-500 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div id="progresso-eficiencia" class="bg-blue-500 rounded-full h-2" style="width: 0%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Meta: 85%</p>
                                </div>
                            </div>
                            
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Viagens Realizadas</p>
                                        <p id="viagens-realizadas-card" class="text-2xl font-bold text-gray-900 dark:text-gray-100">0</p>
                                        <span class="inline-flex items-center text-sm font-medium text-green-600 dark:text-green-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                                            </svg>
                                            <span id="variacao-viagens">0.0</span>% <span class="ml-1 text-gray-500 dark:text-gray-400">vs semana anterior</span>
                                        </span>
                                    </div>
                                    <div class="bg-green-50 dark:bg-green-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-green-500 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div id="progresso-viagens" class="bg-green-500 rounded-full h-2" style="width: 0%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1"><span id="porcentagem-meta-viagens">0</span>% da meta mensal</p>
                                </div>
                            </div>
                            
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Densidade M√©dia</p>
                                        <p id="densidade-media-card" class="text-2xl font-bold text-gray-900 dark:text-gray-100">0.00</p>
                                        <span class="inline-flex items-center text-sm font-medium text-green-600 dark:text-green-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                                            </svg>
                                            <span id="variacao-densidade">0.0</span>% <span class="ml-1 text-gray-500 dark:text-gray-400">vs semana anterior</span>
                                        </span>
                                    </div>
                                    <div class="bg-purple-50 dark:bg-purple-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-purple-500 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div id="progresso-densidade" class="bg-purple-500 rounded-full h-2" style="width: 0%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Meta: <span id="meta-densidade">65.00</span></p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Additional Stats Cards Row -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Pico de Entregas</p>
                                        <p id="pico-entregas-card" class="text-2xl font-bold text-gray-900 dark:text-gray-100">0.0 ton</p>
                                        <span id="periodo-pico" class="text-xs text-gray-600 dark:text-gray-400">Per√≠odo: --:-- - --:--</span>
                                    </div>
                                    <div class="bg-amber-50 dark:bg-amber-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-amber-500 dark:text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Frente Mais Produtiva</p>
                                        <p id="frente-produtiva-card" class="text-2xl font-bold text-gray-900 dark:text-gray-100">-</p>
                                        <span id="frente-produtiva-info" class="text-xs text-gray-600 dark:text-gray-400">0.0 ton (0.0% do total)</span>
                                    </div>
                                    <div class="bg-indigo-50 dark:bg-indigo-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-indigo-500 dark:text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Tempo M√©dio por Viagem</p>
                                        <p id="tempo-viagem-card" class="text-2xl font-bold text-gray-900 dark:text-gray-100">-- min</p>
                                        <span class="inline-flex items-center text-sm font-medium text-green-600 dark:text-green-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                                            </svg>
                                            <span id="variacao-tempo">0.0</span>% <span class="ml-1 text-gray-500 dark:text-gray-400">mais r√°pido</span>
                                        </span>
                                    </div>
                                    <div class="bg-rose-50 dark:bg-rose-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-rose-500 dark:text-rose-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 24-Hour Delivery Chart (06:00-06:00) -->
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm mb-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Ciclo Completo de Entrega (06:00-06:00)</h3>
                                <div class="flex items-center space-x-3">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-primary rounded-full mr-1"></div>
                                        <span class="text-xs text-gray-600 dark:text-gray-400">Entrega Realizada</span>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-green-500 rounded-full mr-1"></div>
                                        <span class="text-xs text-gray-600 dark:text-gray-400">Meta</span>
                                    </div>
                                </div>
                            </div>
                            <div class="h-80">
                                <canvas id="fullCycleDeliveryChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Dashboard Main Charts -->
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                            <div class="lg:col-span-2 bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Entrega por Per√≠odo</h3>
                                    <div class="flex space-x-2">
                                        <button class="period-chart-option px-2 py-1 text-xs font-medium rounded bg-primary text-white" data-period="day">Dia</button>
                                        <button class="period-chart-option px-2 py-1 text-xs font-medium rounded bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600" data-period="week">Semana</button>
                                        <button class="period-chart-option px-2 py-1 text-xs font-medium rounded bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600" data-period="month">M√™s</button>
                                    </div>
                                </div>
                                <div class="h-80">
                                    <canvas id="deliveryByPeriodChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Desempenho por Frente</h3>
                                <div class="h-80">
                                    <canvas id="frontPerformanceChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Production by Front -->
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm mb-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Produ√ß√£o por Frente</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Frente</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Total Entregue</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Viagens</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Densidade M√©dia</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Potencial</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">% Realizado</th>
                                        </tr>
                                    </thead>
                                    <tbody id="production-by-front-table" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <!-- Dados ser√£o preenchidos dinamicamente pelo JavaScript -->
                                    </tbody>
                                    <tfoot class="bg-gray-50 dark:bg-gray-700 font-semibold">
                                        <tr>
                                            <td class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">TOTAL</td>
                                            <td id="total-delivered" class="px-6 py-3 text-left text-xs font-medium text-gray-800 dark:text-gray-200">0.00 ton</td>
                                            <td id="total-trips" class="px-6 py-3 text-left text-xs font-medium text-gray-800 dark:text-gray-200">0</td>
                                            <td id="avg-density" class="px-6 py-3 text-left text-xs font-medium text-gray-800 dark:text-gray-200">0.00</td>
                                            <td id="total-potential" class="px-6 py-3 text-left text-xs font-medium text-gray-800 dark:text-gray-200">0.00 ton</td>
                                            <td class="px-6 py-3 text-left text-xs font-medium">
                                                <div class="flex items-center">
                                                    <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2 mr-2 max-w-[100px]">
                                                        <div id="total-percentage-bar" class="bg-primary h-2 rounded-full" style="width: 0%"></div>
                                                    </div>
                                                    <span id="total-percentage" class="text-gray-800 dark:text-gray-200">0%</span>
                                                </div>
                                            </td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Dashboard Trips and Trucks per Hour -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Viagens por Frente</h3>
                                <div class="h-80">
                                    <canvas id="tripsByFrontChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">M√©dia de Caminh√µes/Hora por Frente</h3>
                                <div class="h-80">
                                    <canvas id="trucksPerHourChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Performance Metrics -->
                        <div class="grid grid-cols-1 gap-6 mb-6">
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">M√©tricas de Desempenho</h3>
                                <div class="space-y-4">
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Efici√™ncia Operacional</span>
                                            <span id="eficiencia-operacional" class="text-sm font-medium text-primary">0%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                                            <div id="barra-eficiencia-op" class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Utiliza√ß√£o de Recursos</span>
                                            <span id="utilizacao-recursos" class="text-sm font-medium text-green-600 dark:text-green-400">0%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                                            <div id="barra-utilizacao" class="bg-green-600 dark:bg-green-500 h-2.5 rounded-full" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Cumprimento de Metas</span>
                                            <span id="cumprimento-metas" class="text-sm font-medium text-yellow-600 dark:text-yellow-400">0%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                                            <div id="barra-cumprimento" class="bg-yellow-600 dark:bg-yellow-500 h-2.5 rounded-full" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Qualidade da Entrega</span>
                                            <span id="qualidade-entrega" class="text-sm font-medium text-blue-600 dark:text-blue-400">0%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                                            <div id="barra-qualidade" class="bg-blue-600 dark:bg-blue-500 h-2.5 rounded-full" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                                    <div class="flex justify-between">
                                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">√çndice de Desempenho Geral</span>
                                        <span id="desempenho-geral" class="text-sm font-medium text-primary">0%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mt-2">
                                        <div id="barra-desempenho-geral" class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Entrega por Hora Content -->
                    <div id="entrega-hora-content" class="page-content hidden">
                        <div class="mb-6 flex flex-col md:flex-row md:justify-between md:items-center space-y-4 md:space-y-0">
                            <div>
                                <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100">Per√≠odos de Entrega</h2>
                                <p class="text-gray-600 dark:text-gray-400 mt-1">Gerencie as entregas por per√≠odos de 2 horas</p>
                            </div>
                            <div class="flex space-x-2">
                                <button id="manage-fronts" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                    Gerenciar Frentes
                                </button>
                                <button id="clear-period" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                    Limpar Per√≠odo
                                </button>
                                <button id="copy-previous" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                    </svg>
                                    Copiar Anterior
                                </button>
                                <div class="dropdown relative">
                                    <button id="export-dropdown-btn" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                        </svg>
                                        Exportar
                                    </button>
                                    <div id="export-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg z-20">
                                        <div class="py-1">
                                            <a href="#" id="export-json" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Exportar JSON</a>
                                            <a href="#" id="export-csv" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Exportar CSV</a>
                                            <a href="#" id="export-pdf" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Exportar PDF</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Period Selection Tabs -->
                        <div class="mb-6 overflow-x-auto">
                            <div class="flex space-x-2 min-w-max">
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-primary text-white" data-period="06-08">06:00-08:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="08-10">08:00-10:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="10-12">10:00-12:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="12-14">12:00-14:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="14-16">14:00-16:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="16-18">16:00-18:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="18-20">18:00-20:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="20-22">20:00-22:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="22-00">22:00-00:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="00-02">00:00-02:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="02-04">02:00-04:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="04-06">04:00-06:00</button>
                            </div>
                        </div>
                        
                        <!-- Loading Indicator -->
                        <div id="loading-indicator" class="p-10 text-center hidden">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"></div>
                            <p class="mt-2 text-gray-600 dark:text-gray-400">Carregando dados...</p>
                        </div>
                        
                        <!-- Time Period Content -->
                        <div id="time-period-content">
                            <!-- Content will be generated dynamically by the generateTimePeriodHTML() function -->
                        </div>
                    </div>
                    
                    <!-- Relat√≥rios Content -->
                    <div id="relatorios-content" class="page-content hidden">
                        <div class="text-center py-10">
                            <div class="inline-block p-6 bg-primary/10 dark:bg-primary/20 rounded-lg">
                                <svg class="w-16 h-16 mx-auto text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                <h2 class="mt-4 text-xl font-bold text-gray-900 dark:text-gray-100">An√°lises e Relat√≥rios</h2>
                                <p class="mt-2 text-gray-600 dark:text-gray-400">P√°gina em desenvolvimento. Relat√≥rios detalhados e an√°lises estar√£o dispon√≠veis em breve.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Metas Content -->
                    <div id="metas-content" class="page-content hidden">
                        <div class="text-center py-10">
                            <div class="inline-block p-6 bg-primary/10 dark:bg-primary/20 rounded-lg">
                                <svg class="w-16 h-16 mx-auto text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <h2 class="mt-4 text-xl font-bold text-gray-900 dark:text-gray-100">Metas e Desempenho</h2>
                                <p class="mt-2 text-gray-600 dark:text-gray-400">P√°gina em desenvolvimento. Acompanhamento de metas e desempenho estar√£o dispon√≠veis em breve.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Configura√ß√µes Content -->
                    <div id="configuracoes-content" class="page-content hidden">
                        <div class="max-w-2xl mx-auto">
                            <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100 mb-6">Configura√ß√µes do Sistema</h2>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden mb-6">
                                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">Prefer√™ncias Gerais</h3>
                                </div>
                                <div class="p-4 space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Salvar Automaticamente</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Salva automaticamente as altera√ß√µes</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="auto-save-toggle" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Intervalo de Salvamento (minutos)</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Frequ√™ncia do salvamento autom√°tico</p>
                                        </div>
                                        <div class="w-20">
                                            <input type="number" id="auto-save-interval" class="w-full px-3 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" min="1" max="60" value="5">
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Modo Escuro</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Alterna entre o tema claro e escuro</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="dark-mode-toggle" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden mb-6">
                                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">Backup e Restaura√ß√£o</h3>
                                </div>
                                <div class="p-4 space-y-4">
                                    <div class="flex flex-col space-y-2">
                                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Backup de Dados</label>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">Exporte todos os dados do sistema para um arquivo</p>
                                        <div class="flex space-x-2">
                                            <button id="backup-full-data" class="px-3 py-2 bg-primary text-white rounded-md hover:bg-primary-600 text-sm font-medium transition duration-150">
                                                Exportar Backup Completo
                                            </button>
                                            <button id="backup-current-period" class="px-3 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 text-sm font-medium transition duration-150">
                                                Exportar Per√≠odo Atual
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Restaurar Dados</label>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mb-2">Importe dados a partir de um arquivo de backup</p>
                                        <div class="flex flex-col space-y-2">
                                            <div class="flex items-center justify-center w-full">
                                                <label for="import-file" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:hover:bg-gray-700 dark:bg-gray-800 hover:bg-gray-100 dark:border-gray-600 dark:hover:border-gray-500">
                                                    <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                                        <svg class="w-8 h-8 mb-2 text-gray-500 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                                        </svg>
                                                        <p class="mb-1 text-sm text-gray-500 dark:text-gray-400">Clique para selecionar arquivo</p>
                                                        <p class="text-xs text-gray-500 dark:text-gray-400">JSON, CSV</p>
                                                    </div>
                                                    <input id="import-file" type="file" class="hidden" accept=".json,.csv" />
                                                </label>
                                            </div>
                                            <div id="file-name-display" class="text-sm text-gray-600 dark:text-gray-400"></div>
                                            <button id="restore-data" class="px-3 py-2 bg-primary text-white rounded-md hover:bg-primary-600 text-sm font-medium transition duration-150 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                                Restaurar Dados
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden mb-6">
                                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">Notifica√ß√µes e Alertas</h3>
                                </div>
                                <div class="p-4 space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Limiar de Alerta (%)</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Porcentagem abaixo da meta para disparar alerta</p>
                                        </div>
                                        <div class="w-20">
                                            <input type="number" id="alert-threshold" class="w-full px-3 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" min="1" max="50" value="10">
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Alertas Sonoros</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Emite sons para alertas importantes</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="sound-alert-toggle" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Alertas Visuais</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Mostra notifica√ß√µes na interface</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="visual-alert-toggle" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-end space-x-3">
                                <button id="restore-defaults" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary transition duration-150">
                                    Restaurar Padr√µes
                                </button>
                                <button id="save-config" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition duration-150">
                                    Salvar Configura√ß√µes
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            
            <!-- Footer -->
            <footer class="bg-white dark:bg-gray-800 shadow-md mt-auto">
                <div class="container mx-auto px-4 py-4">
                    <div class="flex flex-col md:flex-row justify-between items-center">
                        <div class="text-sm text-gray-600 dark:text-gray-400 mb-4 md:mb-0">
                            ¬© 2025 GGOMES-LOG - Gest√£o de Entrega de Safra
                        </div>
                        <div class="flex space-x-4">
                            <a href="#" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary-300 transition-colors duration-150">Termos de Uso</a>
                            <a href="#" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary-300 transition-colors duration-150">Pol√≠tica de Privacidade</a>
                            <a href="#" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary-300 transition-colors duration-150">Suporte</a>
                            <span class="text-sm text-gray-400 dark:text-gray-500">Vers√£o 2.1.0</span>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    
    <!-- Calendar Modal -->
    <div id="calendar-modal" class="fixed inset-0 z-50 overflow-y-auto hidden">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
            </div>
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Selecionar Per√≠odo</h3>
                                <button id="close-calendar-modal" class="text-gray-400 hover:text-gray-500 focus:outline-none">
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="mt-4">
                                <div class="flex justify-between items-center mb-4">
                                    <button id="prev-month" class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                        </svg>
                                    </button>
                                    <div id="current-month-year" class="text-lg font-semibold text-gray-900 dark:text-gray-100">Julho 2024</div>
                                    <button id="next-month" class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                        </svg>
                                    </button>
                                </div>
                                
                                <div class="grid grid-cols-7 gap-1 text-center text-xs font-medium text-gray-500 dark:text-gray-400">
                                    <div>Dom</div>
                                    <div>Seg</div>
                                    <div>Ter</div>
                                    <div>Qua</div>
                                    <div>Qui</div>
                                    <div>Sex</div>
                                    <div>S√°b</div>
                                </div>
                                
                                <div id="calendar-days" class="grid grid-cols-7 gap-1 mt-2">
                                    <!-- Calendar days will be generated here -->
                                </div>
                                
                                <div class="mt-4">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Per√≠odo Selecionado</span>
                                    </div>
                                    <div class="flex space-x-2">
                                        <div class="flex-1">
                                            <label for="start-date" class="block text-xs text-gray-500 dark:text-gray-400">In√≠cio</label>
                                            <input type="text" id="start-date" class="block w-full p-2 text-sm bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md" readonly>
                                        </div>
                                        <div class="flex-1">
                                            <label for="end-date" class="block text-xs text-gray-500 dark:text-gray-400">Fim</label>
                                            <input type="text" id="end-date" class="block w-full p-2 text-sm bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md" readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="apply-date-range" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary text-base font-medium text-white hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:ml-3 sm:w-auto sm:text-sm">
                        Aplicar
                    </button>
                    <button type="button" id="cancel-date-range" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div id="keyboard-shortcuts-modal" class="fixed inset-0 z-50 overflow-y-auto hidden">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
            </div>
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Atalhos de Teclado</h3>
                                <button id="close-shortcuts-modal" class="text-gray-400 hover:text-gray-500 focus:outline-none">
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="mt-4">
                                <div class="border-b border-gray-200 dark:border-gray-700">
                                    <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Navega√ß√£o</h4>
                                    <ul class="mb-4 space-y-2">
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Abrir Menu</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Alt + M</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Pesquisar</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Ctrl + K</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Dashboard</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Alt + 1</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Entrega por Hora</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Alt + 2</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">An√°lises</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Alt + 3</span>
                                        </li>
                                    </ul>
                                </div>
                                
                                <div class="border-b border-gray-200 dark:border-gray-700 pt-4">
                                    <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">A√ß√µes</h4>
                                    <ul class="mb-4 space-y-2">
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Salvar Dados</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Ctrl + S</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Alterar Tema</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Ctrl + D</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Exportar Dados</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Ctrl + E</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Adicionar Nova Frente</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Ctrl + N</span>
                                        </li>
                                    </ul>
                                </div>
                                
                                <div class="pt-4">
                                    <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Edi√ß√£o de Dados</h4>
                                    <ul class="mb-2 space-y-2">
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Pr√≥ximo Campo</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Tab</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Campo Anterior</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Shift + Tab</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Aumentar Valor</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">‚Üë</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Diminuir Valor</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">‚Üì</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 flex justify-end">
                    <button type="button" id="close-shortcuts-button" class="inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:w-auto sm:text-sm">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Manage Fronts Modal -->
    <div id="manage-fronts-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-lg w-full relative z-10 shadow-lg">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-gray-900 dark:text-gray-100">Gerenciar Frentes</h3>
                <button id="close-fronts-modal" class="text-gray-400 hover:text-gray-500 focus:outline-none">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="mb-6">
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Adicione ou remova frentes de entrega. Ao remover uma frente, todos os dados associados ser√£o exclu√≠dos.</p>
                
                <!-- Add new front -->
                <div class="flex items-end space-x-2 mb-4">
                    <div class="flex-1">
                        <label for="new-front-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nova Frente</label>
                        <input type="text" id="new-front-input" placeholder="Ex: 4010" class="w-full px-3 py-2 text-base text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <button id="add-front-btn" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-600 transition duration-200 flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        Adicionar
                    </button>
                </div>
                
                <!-- Current fronts list -->
                <div class="border border-gray-200 dark:border-gray-700 rounded-md overflow-hidden">
                    <div class="bg-gray-50 dark:bg-gray-700 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                        Frentes Atuais
                    </div>
                    <ul id="fronts-list" class="divide-y divide-gray-200 dark:divide-gray-700 max-h-60 overflow-y-auto">
                        <!-- Fronts will be added here dynamically -->
                    </ul>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3">
                <button id="cancel-fronts-modal" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition duration-200">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full relative z-10 shadow-lg">
            <h3 id="modal-title" class="text-lg font-bold text-gray-900 dark:text-gray-100 mb-4">Confirma√ß√£o</h3>
            <p id="modal-message" class="text-gray-700 dark:text-gray-300 mb-6">Tem certeza que deseja realizar esta a√ß√£o?</p>
            <div class="flex justify-end space-x-3">
                <button id="modal-cancel" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition duration-200">
                    Cancelar
                </button>
                <button id="modal-confirm" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-600 transition duration-200">
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 flex flex-col-reverse space-y-reverse space-y-2"></div>

    <script>
        // Application State
        const state = {
            // Front data
            fronts: ['4001', '4002', '4007', '4009'],
            hours: [6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 0, 1, 2, 3, 4, 5],
            timePeriodsMap: {
                '06-08': [6, 7],
                '08-10': [8, 9],
                '10-12': [10, 11],
                '12-14': [12, 13],
                '14-16': [14, 15],
                '16-18': [16, 17],
                '18-20': [18, 19],
                '20-22': [20, 21],
                '22-00': [22, 23],
                '00-02': [0, 1],
                '02-04': [2, 3],
                '04-06': [4, 5]
            },
            
            // Delivery data
            density: {},
            trips: {},
            delivery: {},
            potential: {},
            
            // Period summaries
            twoHourDelivery: {},
            twoHourPotential: {},
            difference: {},
            
            // Charts
            charts: {},
            
            // Current active period
            activePeriod: '06-08',
            currentPage: 'dashboard',
            
            // Config
            config: {
                autoSave: true,
                autoSaveInterval: 5, // minutes
                darkMode: false,
                alertThreshold: 10, // %
                soundAlerts: false,
                visualAlerts: true
            },
            
            // Date & calendar
            calendar: {
                startDate: null,
                endDate: null,
                currentMonth: new Date().getMonth(),
                currentYear: new Date().getFullYear()
            },
            
            // Analytics data for dashboard
            analytics: {
                periodData: {
                    day: { 
                        labels: [], 
                        datasets: [{ data: [] }, { data: [] }] 
                    },
                    week: { 
                        labels: [], 
                        datasets: [{ data: [] }, { data: [] }] 
                    },
                    month: { 
                        labels: [], 
                        datasets: [{ data: [] }, { data: [] }] 
                    }
                },
                productionByFront: []
            },
            
            // History
            history: [],
            
            // Auto-save timer
            autoSaveTimer: null
        };
        
        // DOM Ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM carregado, inicializando aplica√ß√£o...");
            
            try {
                // Inicializa√ß√£o b√°sica
                initializeDataStructures();
                loadConfig();
                setupDarkMode();
                
                // Setup UI e eventos
                setupUI();
                setupEventListeners();
                
                // Configurar notifica√ß√µes e atalhos
                setupDropdowns();
                setupKeyboardShortcuts();
                
                // Gerar dados
                calculateDelivery();
                calculateTwoHourTotals();
                
                // Inicializar gr√°ficos e widgets
                initializeCharts();
                updateDateTimeWidgets();
                
                // Carregar dados salvos se existirem
                const dataLoaded = loadSavedData();
                if (!dataLoaded) {
                    loadInitialData();
                }
                
                // Mostrar dashboard como padr√£o
                showPage('dashboard');
                
                // Setup auto-save if enabled
                setupAutoSave();
                
                console.log("Aplica√ß√£o inicializada com sucesso!");
            } catch (error) {
                console.error("Erro ao inicializar aplica√ß√£o:", error);
                showToast('Erro ao inicializar aplica√ß√£o. Verifique o console para mais detalhes.', 'error');
            }
        });
        
        // Initialize data structures
        function initializeDataStructures() {
            console.log("Inicializando estruturas de dados...");
            
            // Initialize delivery data structures
            for (const front of state.fronts) {
                state.density[front] = {};
                state.trips[front] = {};
                state.delivery[front] = {};
                state.potential[front] = {};
                
                for (const hour of state.hours) {
                    state.density[front][hour] = 0;
                    state.trips[front][hour] = 0;
                    state.delivery[front][hour] = 0;
                    state.potential[front][hour] = 0;
                }
            }
            
            // Initialize period summaries
            for (const period in state.timePeriodsMap) {
                state.twoHourDelivery[period] = {};
                state.twoHourPotential[period] = {};
                state.difference[period] = {};
                
                for (const front of state.fronts) {
                    state.twoHourDelivery[period][front] = 0;
                    state.twoHourPotential[period][front] = 0;
                    state.difference[period][front] = 0;
                }
            }
            
            console.log("Estruturas de dados inicializadas");
        }
        
        // Setup Auto-save timer
        function setupAutoSave() {
            // Clear existing timer if any
            if (state.autoSaveTimer) {
                clearInterval(state.autoSaveTimer);
            }
            
            // Set up new timer if auto-save is enabled
            if (state.config.autoSave) {
                const interval = Math.max(1, state.config.autoSaveInterval) * 60 * 1000; // Convert minutes to milliseconds
                state.autoSaveTimer = setInterval(() => {
                    saveData();
                    console.log("Auto-saved data");
                }, interval);
                
                console.log(`Auto-save enabled with interval of ${state.config.autoSaveInterval} minutes`);
            } else {
                console.log("Auto-save disabled");
            }
        }
        
        // Setup UI
        function setupUI() {
            console.log("Configurando UI...");
            
            // Set up period selector change event
            document.getElementById('period-selector')?.addEventListener('change', function() {
                const customDateButton = document.getElementById('custom-date-button');
                if (customDateButton) {
                    if (this.value === 'custom') {
                        customDateButton.classList.remove('hidden');
                        customDateButton.classList.add('flex');
                    } else {
                        customDateButton.classList.add('hidden');
                        customDateButton.classList.remove('flex');
                    }
                }
            });
            
            // Set up custom date button
            document.getElementById('custom-date-button')?.addEventListener('click', function() {
                const calendarModal = document.getElementById('calendar-modal');
                if (calendarModal) {
                    generateCalendarDays();
                    toggleElement(calendarModal, true);
                }
            });
            
            // Calendar modal setup
            setupCalendarModal();
            
            console.log("UI configurada com sucesso");
        }
        
        // Setup Event Listeners
        function setupEventListeners() {
            console.log("Configurando event listeners...");
            
            // Menu button for drawer
            document.getElementById('menu-button')?.addEventListener('click', function() {
                console.log("Menu button clicked");
                toggleDrawer();
            });
            
            // Drawer backdrop
            document.getElementById('drawer-backdrop')?.addEventListener('click', function() {
                console.log("Drawer backdrop clicked");
                toggleDrawer(false);
            });
            
            // Drawer navigation links
            document.querySelectorAll('.drawer-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    console.log(`Navigation link clicked: ${page}`);
                    showPage(page);
                    toggleDrawer(false);
                });
            });
            
            // Search button
            document.getElementById('search-button')?.addEventListener('click', function() {
                console.log("Search button clicked");
                toggleSearchModal(true);
            });
            
            // Close search modal
            document.getElementById('close-search-modal')?.addEventListener('click', function() {
                toggleSearchModal(false);
            });
            
            // Cancel search
            document.getElementById('search-cancel')?.addEventListener('click', function() {
                toggleSearchModal(false);
            });
            
            // Time period tabs
            document.querySelectorAll('.time-tab-btn').forEach(button => {
                button.addEventListener('click', function(e) {
                    const period = this.getAttribute('data-period');
                    console.log(`Period tab clicked: ${period}`);
                    switchTimePeriodTab(period);
                });
            });
            
            // Save data button
            document.getElementById('save-data')?.addEventListener('click', function() {
                console.log("Save data button clicked");
                if (saveData()) {
                    showToast('Dados salvos com sucesso!', 'success');
                } else {
                    showToast('Erro ao salvar dados', 'error');
                }
            });
            
            // Clear period button
            document.getElementById('clear-period')?.addEventListener('click', function() {
                console.log("Clear period button clicked");
                showConfirmationModal(
                    'Limpar Per√≠odo',
                    `Tem certeza que deseja limpar todos os dados do per√≠odo ${state.activePeriod}?`,
                    clearCurrentPeriod
                );
            });
            
            // Copy previous period button
            document.getElementById('copy-previous')?.addEventListener('click', function() {
                console.log("Copy previous period clicked");
                copyPreviousPeriod();
            });
            
            // Export buttons
            document.getElementById('export-json')?.addEventListener('click', function(e) {
                e.preventDefault();
                console.log("Export JSON button clicked");
                exportJSON();
            });
            
            document.getElementById('export-csv')?.addEventListener('click', function(e) {
                e.preventDefault();
                console.log("Export CSV button clicked");
                exportCSV();
            });
            
            document.getElementById('export-pdf')?.addEventListener('click', function(e) {
                e.preventDefault();
                console.log("Export PDF button clicked");
                exportPDF();
            });
            
            document.getElementById('export-dashboard')?.addEventListener('click', function() {
                console.log("Export dashboard button clicked");
                exportDashboard();
            });
            
            // Modal cancel button
            document.getElementById('modal-cancel')?.addEventListener('click', function() {
                console.log("Modal cancel button clicked");
                closeConfirmationModal();
            });
            
            // Manage fronts button
            document.getElementById('manage-fronts')?.addEventListener('click', function() {
                console.log("Manage fronts button clicked");
                showManageFrontsModal();
            });
            
            // Export dropdown toggle
            document.getElementById('export-dropdown-btn')?.addEventListener('click', function(e) {
                e.stopPropagation();
                console.log("Export dropdown button clicked");
                const dropdown = document.getElementById('export-dropdown');
                if (dropdown) {
                    toggleElement(dropdown);
                }
            });
            
            // Close dropdown when clicking elsewhere
            document.addEventListener('click', function(e) {
                if (!e.target.closest('#export-dropdown-btn')) {
                    const dropdown = document.getElementById('export-dropdown');
                    if (dropdown && !dropdown.classList.contains('hidden')) {
                        toggleElement(dropdown, false);
                    }
                }
            });
            
            // Period chart options
            document.querySelectorAll('.period-chart-option').forEach(option => {
                option.addEventListener('click', function() {
                    const period = this.getAttribute('data-period');
                    console.log(`Period chart option clicked: ${period}`);
                    updatePeriodChart(period);
                    
                    // Update active state
                    document.querySelectorAll('.period-chart-option').forEach(btn => {
                        btn.classList.remove('bg-primary', 'text-white');
                        btn.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                    });
                    this.classList.add('bg-primary', 'text-white');
                    this.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                });
            });
            
            // Backup and restore buttons
            document.getElementById('backup-full-data')?.addEventListener('click', function() {
                console.log("Backup full data button clicked");
                exportJSON();
            });
            
            document.getElementById('backup-current-period')?.addEventListener('click', function() {
                console.log("Backup current period button clicked");
                exportCurrentPeriodJSON();
            });
            
            document.getElementById('restore-data')?.addEventListener('click', function() {
                console.log("Restore data button clicked");
                importData();
            });
            
            // Config related buttons
            document.getElementById('restore-defaults')?.addEventListener('click', function() {
                console.log("Restore defaults button clicked");
                showConfirmationModal(
                    'Restaurar Padr√µes',
                    'Tem certeza que deseja restaurar todas as configura√ß√µes para os valores padr√£o?',
                    restoreDefaultConfig
                );
            });
            
            document.getElementById('save-config')?.addEventListener('click', function() {
                console.log("Save config button clicked");
                updateConfigFromUI();
                saveConfig();
                setupAutoSave();
                showToast('Configura√ß√µes salvas com sucesso!', 'success');
            });
            
            // Import file change event
            document.getElementById('import-file')?.addEventListener('change', function(e) {
                if (this.files && this.files.length > 0) {
                    const file = this.files[0];
                    const fileNameDisplay = document.getElementById('file-name-display');
                    const restoreDataBtn = document.getElementById('restore-data');
                    
                    if (fileNameDisplay) {
                        fileNameDisplay.textContent = `Arquivo selecionado: ${file.name}`;
                    }
                    
                    if (restoreDataBtn) {
                        restoreDataBtn.disabled = false;
                    }
                }
            });
            
            console.log("Event listeners configurados com sucesso");
        }
        
        // Setup Dropdowns
        function setupDropdowns() {
            // Notifications dropdown
            const notificationsButton = document.getElementById('notifications-button');
            const notificationsDropdown = document.getElementById('notifications-dropdown');
            
            if (notificationsButton && notificationsDropdown) {
                notificationsButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleElement(notificationsDropdown);
                });
            }
            
            // User menu dropdown
            const userMenuButton = document.getElementById('user-menu-button');
            const userMenuDropdown = document.getElementById('user-menu-dropdown');
            
            if (userMenuButton && userMenuDropdown) {
                userMenuButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleElement(userMenuDropdown);
                });
            }
            
            // Close dropdowns when clicking elsewhere
            document.addEventListener('click', function(e) {
                if (notificationsDropdown && !notificationsDropdown.classList.contains('hidden') && !e.target.closest('#notifications-button')) {
                    toggleElement(notificationsDropdown, false);
                }
                
                if (userMenuDropdown && !userMenuDropdown.classList.contains('hidden') && !e.target.closest('#user-menu-button')) {
                    toggleElement(userMenuDropdown, false);
                }
            });
        }
        
        // Toggle element visibility
        function toggleElement(element, show) {
            if (!element) return;
            
            if (show === undefined) {
                element.classList.toggle('hidden');
            } else if (show) {
                element.classList.remove('hidden');
            } else {
                element.classList.add('hidden');
            }
        }
        
        // Toggle drawer
        function toggleDrawer(show) {
            const drawer = document.getElementById('left-drawer');
            const backdrop = document.getElementById('drawer-backdrop');
            
            if (!drawer || !backdrop) return;
            
            if (show === undefined) {
                show = drawer.classList.contains('-translate-x-full');
            }
            
            if (show) {
                drawer.classList.remove('-translate-x-full');
                backdrop.classList.remove('hidden');
            } else {
                drawer.classList.add('-translate-x-full');
                backdrop.classList.add('hidden');
            }
        }
        
        // Toggle search modal
        function toggleSearchModal(show) {
            const searchModal = document.getElementById('search-modal');
            toggleElement(searchModal, show);
            
            if (show) {
                // Focus search input
                setTimeout(() => {
                    const searchInput = document.getElementById('global-search');
                    if (searchInput) searchInput.focus();
                }, 100);
            }
        }
        
        // Show Specific Page
        function showPage(page) {
            console.log(`Changing page to: ${page}`);
            
            try {
                state.currentPage = page;
                
                // Update page title and subtitle
                const pageTitle = document.getElementById('page-title');
                const pageSubtitle = document.getElementById('page-subtitle');
                
                if (pageTitle && pageSubtitle) {
                    switch (page) {
                        case 'dashboard':
                            pageTitle.textContent = 'Dashboard';
                            pageSubtitle.textContent = 'Vis√£o geral do desempenho da safra 2025';
                            break;
                        case 'entrega-hora':
                            pageTitle.textContent = 'Entrega por Hora';
                            pageSubtitle.textContent = 'Gerencie o registro de entregas por per√≠odo';
                            break;
                        case 'relatorios':
                            pageTitle.textContent = 'An√°lises e Relat√≥rios';
                            pageSubtitle.textContent = 'Relat√≥rios detalhados e an√°lises de desempenho';
                            break;
                        case 'metas':
                            pageTitle.textContent = 'Metas e Desempenho';
                            pageSubtitle.textContent = 'Acompanhe o progresso das metas estabelecidas';
                            break;
                        case 'configuracoes':
                            pageTitle.textContent = 'Configura√ß√µes';
                            pageSubtitle.textContent = 'Ajuste as configura√ß√µes do sistema';
                            break;
                        default:
                            pageTitle.textContent = 'Dashboard';
                            pageSubtitle.textContent = 'Vis√£o geral do desempenho da safra 2025';
                    }
                }
                
                // Hide all pages
                document.querySelectorAll('.page-content').forEach(content => {
                    content.classList.add('hidden');
                });
                
                // Show selected page
                const pageContent = document.getElementById(`${page}-content`);
                
                if (pageContent) {
                    pageContent.classList.remove('hidden');
                    
                    // If showing the entrega-hora page, generate the time period HTML
                    if (page === 'entrega-hora') {
                        generateTimePeriodHTML();
                    }
                    
                    // If showing the dashboard, update the dashboard with current data
                    if (page === 'dashboard') {
                        updateDashboardCharts();
                        populateProductionByFrontTable();
                    }
                    
                    // Update configuration UI if showing settings page
                    if (page === 'configuracoes') {
                        updateUIFromConfig();
                    }
                } else {
                    console.error(`Page content element not found: ${page}-content`);
                    // If page doesn't exist, show dashboard
                    const dashboardContent = document.getElementById('dashboard-content');
                    if (dashboardContent) {
                        dashboardContent.classList.remove('hidden');
                    } else {
                        console.error('Dashboard content element not found');
                    }
                }
                
                // Update navigation active state
                document.querySelectorAll('.drawer-link').forEach(link => {
                    const linkPage = link.getAttribute('data-page');
                    
                    // Reset all links
                    link.classList.remove('bg-primary', 'text-white');
                    link.classList.add('text-gray-700', 'dark:text-gray-300');
                    
                    // Set active link
                    if (linkPage === page) {
                        link.classList.add('bg-primary', 'text-white');
                        link.classList.remove('text-gray-700', 'dark:text-gray-300');
                    }
                });
                
                console.log(`Changed to page: ${page}`);
            } catch (error) {
                console.error(`Error showing page ${page}:`, error);
                showToast(`Erro ao mostrar p√°gina ${page}`, 'error');
            }
        }
        
        // Calculate delivery values based on density and trips
        function calculateDelivery() {
            for (const front of state.fronts) {
                for (const hour of state.hours) {
                    state.delivery[front][hour] = state.density[front][hour] * state.trips[front][hour];
                }
            }
        }
        
        // Calculate 2-hour totals
        function calculateTwoHourTotals() {
            for (const period in state.timePeriodsMap) {
                const hours = state.timePeriodsMap[period];
                
                for (const front of state.fronts) {
                    // Calculate two-hour delivery total
                    state.twoHourDelivery[period][front] = hours.reduce((sum, hour) => {
                        return sum + state.delivery[front][hour];
                    }, 0);
                    
                    // Calculate two-hour potential (use the odd hour's potential * 2)
                    const oddHour = hours.find(h => h % 2 !== 0) || hours[0];
                    state.twoHourPotential[period][front] = state.potential[front][oddHour] * 2;
                    
                    // Calculate difference
                    state.difference[period][front] = 
                        state.twoHourDelivery[period][front] - state.twoHourPotential[period][front];
                }
            }
        }
        
        // Generate time period HTML
        function generateTimePeriodHTML() {
            showLoading(true);
            
            const timeContentDiv = document.getElementById('time-period-content');
            if (!timeContentDiv) {
                console.error('Time period content element not found');
                showLoading(false);
                return;
            }
            
            timeContentDiv.innerHTML = '';
            
            for (const period in state.timePeriodsMap) {
                const hours = state.timePeriodsMap[period];
                
                const periodDiv = document.createElement('div');
                periodDiv.id = `period-${period}`;
                periodDiv.className = 'period-content' + (period === state.activePeriod ? '' : ' hidden');
                
                let periodHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">`;
                
                for (const hour of hours) {
                    let hasPotencial = hour % 2 !== 0; // Only odd hours have potential
                    
                    periodHTML += `
                    <div class="overflow-hidden rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                        <div class="bg-gray-100 dark:bg-gray-700 py-2 px-4 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-primary dark:text-primary-300 flex items-center">
                                <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                ${hour.toString().padStart(2, '0')}:00
                            </h3>
                            <div class="flex items-center text-sm">
                                <span class="text-gray-600 dark:text-gray-400 flex items-center mr-3">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16" />
                                    </svg>
                                    <span class="total-viagens-badge" data-hour="${hour}">0</span> viagens
                                </span>
                                <span class="text-primary dark:text-primary-300 flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" />
                                    </svg>
                                    <span class="total-entrega-badge" data-hour="${hour}">0.00</span> ton
                                </span>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-800">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Frentes</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Densid.</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Viagens</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Entrega</th>
                                        ${hasPotencial ? '<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Pot. Hora</th>' : ''}
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">`;
                    
                    for (const front of state.fronts) {
                        periodHTML += `
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <span class="font-medium">${front}</span>
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <input type="number" class="input-number densidade w-20 text-right border rounded px-2 py-1 dark:bg-gray-700 dark:text-gray-300" data-hour="${hour}" data-front="${front}" value="${state.density[front][hour]}" min="0" step="0.01">
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <input type="number" class="input-number viagens w-20 text-right border rounded px-2 py-1 dark:bg-gray-700 dark:text-gray-300" data-hour="${hour}" data-front="${front}" value="${state.trips[front][hour]}" min="0">
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <span class="entrega font-medium ${state.delivery[front][hour] > 0 ? 'text-success-600 dark:text-success-400' : ''}" data-hour="${hour}" data-front="${front}">${state.delivery[front][hour].toFixed(2)}</span>
                                        </td>
                                        ${hasPotencial ? `<td class="px-4 py-3 whitespace-nowrap">
                                            <input type="number" class="input-number potencial w-20 text-right border rounded px-2 py-1 dark:bg-gray-700 dark:text-gray-300" data-hour="${hour}" data-front="${front}" value="${state.potential[front][hour]}" min="0">
                                        </td>` : ''}
                                    </tr>`;
                    }
                    
                    periodHTML += `
                                </tbody>
                                <tfoot class="bg-gray-50 dark:bg-gray-700 font-semibold">
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap">TOTAL</td>
                                        <td class="px-4 py-3 whitespace-nowrap"></td>
                                        <td class="px-4 py-3 whitespace-nowrap total-viagens" data-hour="${hour}">0</td>
                                        <td class="px-4 py-3 whitespace-nowrap total-entrega" data-hour="${hour}">0.00</td>
                                        ${hasPotencial ? `<td class="px-4 py-3 whitespace-nowrap total-potencial" data-hour="${hour}">0</td>` : ''}
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>`;
                }
                
                periodHTML += `
                </div>

                <!-- Period Summary -->
                <div class="mt-6 overflow-hidden rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                    <div class="bg-gray-100 dark:bg-gray-700 py-2 px-4">
                        <h3 class="text-lg font-semibold text-primary dark:text-primary-300 flex items-center">
                            <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            RESUMO DO PER√çODO (${period.substring(0, 2)}:00-${period.substring(3, 5)}:00)
                        </h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-800">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Frentes</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">2 Horas</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Potencial 2H</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Diferen√ßa</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">% Realizado</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">`;
                
                for (const front of state.fronts) {
                    periodHTML += `
                                <tr>
                                    <td class="px-4 py-3 whitespace-nowrap font-medium">F${front}</td>
                                    <td class="px-4 py-3 whitespace-nowrap duas-horas" data-period="${period}" data-front="${front}">0.00</td>
                                    <td class="px-4 py-3 whitespace-nowrap potencial-2h" data-period="${period}" data-front="${front}">0</td>
                                    <td class="px-4 py-3 whitespace-nowrap diff" data-period="${period}" data-front="${front}">0.00</td>
                                    <td class="px-4 py-3 whitespace-nowrap">
                                        <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5 relative overflow-hidden">
                                            <div class="percent-bar bg-primary h-2.5 rounded-full" data-period="${period}" data-front="${front}" style="width: 0%"></div>
                                        </div>
                                        <span class="text-xs mt-1 block text-right percent-text" data-period="${period}" data-front="${front}">0%</span>
                                    </td>
                                </tr>`;
                }
                
                periodHTML += `
                            </tbody>
                            <tfoot class="bg-gray-50 dark:bg-gray-700 font-semibold">
                                <tr>
                                    <td class="px-4 py-3 whitespace-nowrap">TOTAL</td>
                                    <td class="px-4 py-3 whitespace-nowrap total-duas-horas" data-period="${period}">0.00</td>
                                    <td class="px-4 py-3 whitespace-nowrap total-potencial-2h" data-period="${period}">0</td>
                                    <td class="px-4 py-3 whitespace-nowrap total-diff" data-period="${period}">0.00</td>
                                    <td class="px-4 py-3 whitespace-nowrap">
                                        <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5 relative overflow-hidden">
                                            <div class="total-percent-bar bg-primary h-2.5 rounded-full" data-period="${period}" style="width: 0%"></div>
                                        </div>
                                        <span class="text-xs mt-1 block text-right total-percent-text" data-period="${period}">0%</span>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>`;
                
                periodDiv.innerHTML = periodHTML;
                timeContentDiv.appendChild(periodDiv);
            }
            
            // Add event listeners to newly generated elements
            setupDynamicEventListeners();
            
            // Update the UI with current data
            updateUI();
            
            showLoading(false);
        }
        
        // Show/hide loading indicator
        function showLoading(show) {
            const loadingIndicator = document.getElementById('loading-indicator');
            const timeContentDiv = document.getElementById('time-period-content');
            
            if (loadingIndicator && timeContentDiv) {
                if (show) {
                    loadingIndicator.classList.remove('hidden');
                    timeContentDiv.classList.add('hidden');
                } else {
                    loadingIndicator.classList.add('hidden');
                    timeContentDiv.classList.remove('hidden');
                }
            }
        }
        
        // Setup dynamic event listeners for input fields
        function setupDynamicEventListeners() {
            // Input changes for delivery data
            document.querySelectorAll('.densidade, .viagens, .potencial').forEach(input => {
                input.addEventListener('input', handleDeliveryDataChange);
                
                // Add number input controls
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'ArrowUp') {
                        e.preventDefault();
                        const step = this.classList.contains('densidade') ? 0.01 : 1;
                        this.value = (parseFloat(this.value) + step).toFixed(this.classList.contains('densidade') ? 2 : 0);
                        this.dispatchEvent(new Event('input'));
                    } else if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        const step = this.classList.contains('densidade') ? 0.01 : 1;
                        const newValue = Math.max(0, parseFloat(this.value) - step);
                        this.value = newValue.toFixed(this.classList.contains('densidade') ? 2 : 0);
                        this.dispatchEvent(new Event('input'));
                    }
                });
            });
        }
        
        // Handle input changes for delivery data
        function handleDeliveryDataChange(e) {
            try {
                const hour = parseInt(e.target.getAttribute('data-hour'));
                const front = e.target.getAttribute('data-front');
                const value = parseFloat(e.target.value) || 0;
                
                if (e.target.classList.contains('densidade')) {
                    state.density[front][hour] = value;
                } else if (e.target.classList.contains('viagens')) {
                    state.trips[front][hour] = value;
                } else if (e.target.classList.contains('potencial')) {
                    state.potential[front][hour] = value;
                }
                
                calculateDelivery();
                calculateTwoHourTotals();
                updateUI();
                
                // Add to history for undo/redo functionality
                addToHistory('data-change', { hour, front, field: e.target.classList[1], value });
                
                // Auto save if enabled
                if (state.config.autoSave) {
                    saveData();
                }
            } catch (error) {
                console.error("Error handling delivery data change:", error);
            }
        }
        
        // Period tab switching
        function switchTimePeriodTab(period) {
            try {
                if (period) {
                    state.activePeriod = period;
                    
                    // Update time tab buttons
                    document.querySelectorAll('.time-tab-btn').forEach(button => {
                        button.classList.remove('bg-primary', 'text-white');
                        button.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                        
                        if (button.getAttribute('data-period') === period) {
                            button.classList.add('bg-primary', 'text-white');
                            button.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                        }
                    });
                    
                    // Hide all period contents
                    document.querySelectorAll('.period-content').forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    // Show selected period content
                    const periodContent = document.getElementById(`period-${period}`);
                    if (periodContent) {
                        periodContent.classList.remove('hidden');
                    }
                }
            } catch (error) {
                console.error("Error switching time period tab:", error);
            }
        }
        
        // Clear current period data
        function clearCurrentPeriod() {
            try {
                const hours = state.timePeriodsMap[state.activePeriod];
                
                for (const front of state.fronts) {
                    for (const hour of hours) {
                        state.density[front][hour] = 0;
                        state.trips[front][hour] = 0;
                        state.delivery[front][hour] = 0;
                        
                        // Reset potential only for odd hours
                        if (hour % 2 !== 0) {
                            state.potential[front][hour] = 0;
                        }
                    }
                }
                
                calculateDelivery();
                calculateTwoHourTotals();
                generateTimePeriodHTML();
                updateUI();
                showToast(`Per√≠odo ${state.activePeriod} limpo com sucesso`, 'success');
                
                // Add to history
                addToHistory('clear-period', { period: state.activePeriod });
                
                // Auto save if enabled
                if (state.config.autoSave) {
                    saveData();
                }
            } catch (error) {
                console.error("Error clearing current period:", error);
                showToast("Erro ao limpar per√≠odo", "error");
            }
        }
        
        // Copy previous period data
        function copyPreviousPeriod() {
            try {
                const periods = Object.keys(state.timePeriodsMap);
                const currentIndex = periods.indexOf(state.activePeriod);
                
                if (currentIndex <= 0) {
                    showToast('N√£o h√° per√≠odo anterior para copiar', 'error');
                    return;
                }
                
                const previousPeriod = periods[currentIndex - 1];
                const previousHours = state.timePeriodsMap[previousPeriod];
                const currentHours = state.timePeriodsMap[state.activePeriod];
                
                // Copy data from previous period
                for (let i = 0; i < currentHours.length; i++) {
                    const currentHour = currentHours[i];
                    const previousHour = previousHours[i];
                    
                    for (const front of state.fronts) {
                        state.density[front][currentHour] = state.density[front][previousHour];
                        state.trips[front][currentHour] = state.trips[front][previousHour];
                        
                        // For odd hours, also copy potential
                        if (currentHour % 2 !== 0) {
                            state.potential[front][currentHour] = state.potential[front][previousHour];
                        }
                    }
                }
                
                calculateDelivery();
                calculateTwoHourTotals();
                generateTimePeriodHTML();
                updateUI();
                showToast(`Dados copiados do per√≠odo ${previousPeriod} para ${state.activePeriod}`, 'success');
                
                // Add to history
                addToHistory('copy-period', { from: previousPeriod, to: state.activePeriod });
                
                // Auto save if enabled
                if (state.config.autoSave) {
                    saveData();
                }
            } catch (error) {
                console.error("Error copying previous period:", error);
                showToast("Erro ao copiar per√≠odo anterior", "error");
            }
        }
        
        // Update UI with current data
        function updateUI() {
            updateDeliveryUI();
            updateCharts();
        }
        
        // Update delivery UI elements
        function updateDeliveryUI() {
            try {
                // Update delivery values for all hours
                document.querySelectorAll('.entrega').forEach(element => {
                    const hour = parseInt(element.getAttribute('data-hour'));
                    const front = element.getAttribute('data-front');
                    const value = state.delivery[front][hour];
                    element.textContent = value.toFixed(2);
                    
                    // Add color based on value
                    element.classList.remove('text-success-600', 'dark:text-success-400', 'text-danger-600', 'dark:text-danger-400');
                    if (value > 0) {
                        element.classList.add('text-success-600', 'dark:text-success-400');
                    }
                });
                
                // Update total trips and delivery per hour
                for (const hour of state.hours) {
                    const totalTripsElements = document.querySelectorAll(`.total-viagens[data-hour="${hour}"]`);
                    const totalDeliveryElements = document.querySelectorAll(`.total-entrega[data-hour="${hour}"]`);
                    const totalPotentialElements = document.querySelectorAll(`.total-potencial[data-hour="${hour}"]`);
                    
                    const totalTripsBadges = document.querySelectorAll(`.total-viagens-badge[data-hour="${hour}"]`);
                    const totalEntregaBadges = document.querySelectorAll(`.total-entrega-badge[data-hour="${hour}"]`);
                    
                    const totalTrips = state.fronts.reduce((sum, front) => sum + state.trips[front][hour], 0);
                    const totalDelivery = state.fronts.reduce((sum, front) => sum + state.delivery[front][hour], 0);
                    
                    totalTripsElements.forEach(el => { el.textContent = totalTrips.toString(); });
                    totalDeliveryElements.forEach(el => { el.textContent = totalDelivery.toFixed(2); });
                    
                    totalTripsBadges.forEach(el => { el.textContent = totalTrips.toString(); });
                    totalEntregaBadges.forEach(el => { el.textContent = totalDelivery.toFixed(2); });
                    
                    if (hour % 2 !== 0) { // Only odd hours have potential
                        const totalPotential = state.fronts.reduce((sum, front) => sum + state.potential[front][hour], 0);
                        totalPotentialElements.forEach(el => { el.textContent = totalPotential.toString(); });
                    }
                }
                
                // Update two-hour summaries for all periods
                for (const period in state.timePeriodsMap) {
                    for (const front of state.fronts) {
                        const duasHorasElements = document.querySelectorAll(`.duas-horas[data-period="${period}"][data-front="${front}"]`);
                        const potencial2hElements = document.querySelectorAll(`.potencial-2h[data-period="${period}"][data-front="${front}"]`);
                        const diffElements = document.querySelectorAll(`.diff[data-period="${period}"][data-front="${front}"]`);
                        const percentBars = document.querySelectorAll(`.percent-bar[data-period="${period}"][data-front="${front}"]`);
                        const percentTexts = document.querySelectorAll(`.percent-text[data-period="${period}"][data-front="${front}"]`);
                        
                        const delivery = state.twoHourDelivery[period][front];
                        const potential = state.twoHourPotential[period][front];
                        const difference = state.difference[period][front];
                        const percentage = potential > 0 ? (delivery / potential) * 100 : 0;
                        
                        duasHorasElements.forEach(el => { el.textContent = delivery.toFixed(2); });
                        potencial2hElements.forEach(el => { el.textContent = potential.toString(); });
                        diffElements.forEach(el => { 
                            el.textContent = difference.toFixed(2);
                            
                            // Color-code differences
                            el.classList.remove('text-red-600', 'dark:text-red-400', 'text-green-600', 'dark:text-green-400');
                            if (difference < 0) {
                                el.classList.add('text-red-600', 'dark:text-red-400');
                            } else if (difference > 0) {
                                el.classList.add('text-green-600', 'dark:text-green-400');
                            }
                        });
                        
                        // Update percentage bars and texts
                        const cappedPercentage = Math.min(percentage, 100);
                        percentBars.forEach(el => { 
                            el.style.width = `${cappedPercentage}%`;
                            
                            // Color the bar based on percentage
                            el.classList.remove('bg-primary', 'bg-green-500', 'bg-yellow-500', 'bg-red-500');
                            
                            if (percentage >= 90) {
                                el.classList.add('bg-green-500');
                            } else if (percentage >= 75) {
                                el.classList.add('bg-primary');
                            } else if (percentage >= 50) {
                                el.classList.add('bg-yellow-500');
                            } else {
                                el.classList.add('bg-red-500');
                            }
                        });
                        
                        percentTexts.forEach(el => { el.textContent = `${percentage.toFixed(1)}%`; });
                    }
                    
                    // Update two-hour totals
                    const totalDuasHorasElements = document.querySelectorAll(`.total-duas-horas[data-period="${period}"]`);
                    const totalPotencial2hElements = document.querySelectorAll(`.total-potencial-2h[data-period="${period}"]`);
                    const totalDiffElements = document.querySelectorAll(`.total-diff[data-period="${period}"]`);
                    const totalPercentBars = document.querySelectorAll(`.total-percent-bar[data-period="${period}"]`);
                    const totalPercentTexts = document.querySelectorAll(`.total-percent-text[data-period="${period}"]`);
                    
                    const totalDuasHoras = state.fronts.reduce((sum, front) => sum + state.twoHourDelivery[period][front], 0);
                    const totalPotencial2h = state.fronts.reduce((sum, front) => sum + state.twoHourPotential[period][front], 0);
                    const totalDiff = totalDuasHoras - totalPotencial2h;
                    const totalPercentage = totalPotencial2h > 0 ? (totalDuasHoras / totalPotencial2h) * 100 : 0;
                    
                    totalDuasHorasElements.forEach(el => { el.textContent = totalDuasHoras.toFixed(2); });
                    totalPotencial2hElements.forEach(el => { el.textContent = totalPotencial2h.toString(); });
                    totalDiffElements.forEach(el => { 
                        el.textContent = totalDiff.toFixed(2);
                        
                        // Color-code differences
                        el.classList.remove('text-red-600', 'dark:text-red-400', 'text-green-600', 'dark:text-green-400');
                        if (totalDiff < 0) {
                            el.classList.add('text-red-600', 'dark:text-red-400');
                        } else if (totalDiff > 0) {
                            el.classList.add('text-green-600', 'dark:text-green-400');
                        }
                    });
                    
                    // Update total percentage bar and text
                    const cappedTotalPercentage = Math.min(totalPercentage, 100);
                    totalPercentBars.forEach(el => { 
                        el.style.width = `${cappedTotalPercentage}%`;
                        
                        // Color the bar based on percentage
                        el.classList.remove('bg-primary', 'bg-green-500', 'bg-yellow-500', 'bg-red-500');
                        
                        if (totalPercentage >= 90) {
                            el.classList.add('bg-green-500');
                        } else if (totalPercentage >= 75) {
                            el.classList.add('bg-primary');
                        } else if (totalPercentage >= 50) {
                            el.classList.add('bg-yellow-500');
                        } else {
                            el.classList.add('bg-red-500');
                        }
                    });
                    
                    totalPercentTexts.forEach(el => { el.textContent = `${totalPercentage.toFixed(1)}%`; });
                }
            } catch (error) {
                console.error("Error updating delivery UI:", error);
            }
        }
        
        // Initialize charts
        function initializeCharts() {
            try {
                console.log("Initializing charts...");
                
                // Check if Chart.js is loaded
                if (typeof Chart === 'undefined') {
                    console.error('Chart.js is not loaded. Charts will not be initialized.');
                    showToast('Biblioteca de gr√°ficos n√£o carregada. Tente recarregar a p√°gina.', 'error');
                    return;
                }
                
                // Check if the ChartDataLabels plugin is loaded
                if (typeof ChartDataLabels !== 'undefined') {
                    // Register Chart.js plugins
                    Chart.register(ChartDataLabels);
                }
                
                // Use setTimeout to ensure DOM elements are ready
                setTimeout(() => {
                    // Initialize the charts with empty data - will be updated later
                    initializeFullCycleChart();
                    initializeDeliveryByPeriodChart();
                    initializeFrontPerformanceChart();
                    initializeTripsByFrontChart();
                    initializeTrucksPerHourChart();
                    
                    // Apply dark mode to charts if needed
                    if (document.documentElement.classList.contains('dark')) {
                        Object.values(state.charts).forEach(chart => {
                            if (chart) updateChartTheme(chart);
                        });
                    }
                    
                    console.log("Charts initialized successfully");
                    
                    // Update dashboard with current data
                    if (state.currentPage === 'dashboard') {
                        updateDashboardCharts();
                    }
                }, 100);
            } catch (error) {
                console.error("Error initializing charts:", error);
                showToast('Erro ao inicializar gr√°ficos', 'error');
            }
        }
        
        // Initialize Full Cycle Delivery Chart (06:00-06:00)
        function initializeFullCycleChart() {
            try {
                const fullCycleDeliveryCtx = document.getElementById('fullCycleDeliveryChart')?.getContext('2d');
                if (!fullCycleDeliveryCtx) {
                    console.warn("Full cycle delivery chart canvas not found");
                    return;
                }
                
                // Create hour labels from 06:00 to 05:00
                const hourLabels = [];
                for (let i = 6; i < 24; i++) {
                    hourLabels.push(`${i.toString().padStart(2, '0')}:00`);
                }
                for (let i = 0; i < 6; i++) {
                    hourLabels.push(`${i.toString().padStart(2, '0')}:00`);
                }
                
                state.charts.fullCycleDelivery = new Chart(fullCycleDeliveryCtx, {
                    type: 'line',
                    data: {
                        labels: hourLabels,
                        datasets: [
                            {
                                label: 'Entregas',
                                data: Array(24).fill(0), // Will be updated with real data
                                borderColor: '#5D5CDE',
                                backgroundColor: 'rgba(93, 92, 222, 0.2)',
                                borderWidth: 2,
                                tension: 0.3,
                                fill: true
                            },
                            {
                                label: 'Meta',
                                data: Array(24).fill(0), // Will be updated with real data
                                borderColor: '#10B981',
                                borderDash: [5, 5],
                                backgroundColor: 'transparent',
                                borderWidth: 2,
                                tension: 0.1,
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Toneladas'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Hora'
                                },
                                ticks: {
                                    maxTicksLimit: 12,
                                    callback: function(val, index) {
                                        return index % 2 === 0 ? this.getLabelForValue(val) : '';
                                    }
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.raw.toFixed(1)} ton`;
                                    }
                                }
                            },
                            legend: {
                                position: 'top'
                            },
                            datalabels: {
                                display: false
                            }
                        }
                    }
                });
            } catch (error) {
                console.error("Error initializing full cycle chart:", error);
            }
        }
        
        // Initialize Delivery by Period Chart
        function initializeDeliveryByPeriodChart() {
            try {
                const deliveryByPeriodCtx = document.getElementById('deliveryByPeriodChart')?.getContext('2d');
                if (!deliveryByPeriodCtx) {
                    console.warn("Delivery by period chart canvas not found");
                    return;
                }
                
                // Get period labels from timePeriodsMap
                const periodLabels = Object.keys(state.timePeriodsMap).map(period => {
                    return `${period.substring(0, 2)}:00-${period.substring(3, 5)}:00`;
                });
                
                state.charts.deliveryByPeriod = new Chart(deliveryByPeriodCtx, {
                    type: 'bar',
                    data: {
                        labels: periodLabels,
                        datasets: [
                            {
                                label: 'Entregas',
                                data: Array(periodLabels.length).fill(0), // Will be updated with real data
                                backgroundColor: 'rgba(93, 92, 222, 0.7)',
                                borderColor: 'rgba(93, 92, 222, 1)',
                                borderWidth: 1,
                                barPercentage: 0.7,
                                categoryPercentage: 0.9,
                                order: 2
                            },
                            {
                                label: 'Potencial',
                                data: Array(periodLabels.length).fill(0), // Will be updated with real data
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                borderColor: 'rgba(16, 185, 129, 1)',
                                borderWidth: 1,
                                borderDash: [5, 5],
                                type: 'line',
                                fill: false,
                                pointStyle: 'rectRounded',
                                pointRadius: 5,
                                pointHoverRadius: 7,
                                tension: 0.4,
                                order: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Toneladas'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Per√≠odos'
                                },
                                ticks: {
                                    font: {
                                        size: 9
                                    },
                                    maxRotation: 45,
                                    minRotation: 45
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.raw.toFixed(2)} ton`;
                                    }
                                }
                            },
                            legend: {
                                position: 'top'
                            },
                            datalabels: {
                                display: function(context) {
                                    return context.datasetIndex === 0;
                                },
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value.toFixed(0) + ' t',
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold',
                                    size: 9
                                },
                                rotation: -45
                            }
                        }
                    }
                });
            } catch (error) {
                console.error("Error initializing delivery by period chart:", error);
            }
        }
        
        // Initialize Front Performance Chart
        function initializeFrontPerformanceChart() {
            try {
                const frontPerformanceCtx = document.getElementById('frontPerformanceChart')?.getContext('2d');
                if (!frontPerformanceCtx) {
                    console.warn("Front performance chart canvas not found");
                    return;
                }
                
                // Create front labels
                const frontLabels = state.fronts.map(front => `F${front}`);
                
                state.charts.frontPerformance = new Chart(frontPerformanceCtx, {
                    type: 'bar',
                    data: {
                        labels: frontLabels,
                        datasets: [
                            {
                                label: 'Efici√™ncia (%)',
                                data: Array(frontLabels.length).fill(0), // Will be updated with real data
                                backgroundColor: Array(frontLabels.length).fill('rgba(93, 92, 222, 0.7)'),
                                borderWidth: 0,
                                borderRadius: 4,
                                barPercentage: 0.6,
                                categoryPercentage: 0.8
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Efici√™ncia (%)'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `Efici√™ncia: ${context.raw.toFixed(1)}%`;
                                    }
                                }
                            },
                            legend: {
                                display: false
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value.toFixed(1) + '%',
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error("Error initializing front performance chart:", error);
            }
        }
        
        // Initialize Trips by Front Chart
        function initializeTripsByFrontChart() {
            try {
                const tripsByFrontCtx = document.getElementById('tripsByFrontChart')?.getContext('2d');
                if (!tripsByFrontCtx) {
                    console.warn("Trips by front chart canvas not found");
                    return;
                }
                
                // Create front labels
                const frontLabels = state.fronts.map(front => `F${front}`);
                
                state.charts.tripsByFront = new Chart(tripsByFrontCtx, {
                    type: 'bar',
                    data: {
                        labels: frontLabels,
                        datasets: [
                            {
                                label: 'Viagens Entregues',
                                data: Array(frontLabels.length).fill(0), // Will be updated with real data
                                backgroundColor: 'rgba(14, 165, 233, 0.7)', // Sky blue color
                                borderColor: 'rgba(14, 165, 233, 1)',
                                borderWidth: 1,
                                borderRadius: 4,
                                barPercentage: 0.6,
                                categoryPercentage: 0.8
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'N√∫mero de Viagens'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `Viagens: ${context.raw}`;
                                    }
                                }
                            },
                            legend: {
                                display: false
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value,
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error("Error initializing trips by front chart:", error);
            }
        }
        
        // Initialize Trucks per Hour Chart
        function initializeTrucksPerHourChart() {
            try {
                const trucksPerHourCtx = document.getElementById('trucksPerHourChart')?.getContext('2d');
                if (!trucksPerHourCtx) {
                    console.warn("Trucks per hour chart canvas not found");
                    return;
                }
                
                // Create front labels
                const frontLabels = state.fronts.map(front => `F${front}`);
                
                state.charts.trucksPerHour = new Chart(trucksPerHourCtx, {
                    type: 'bar',
                    data: {
                        labels: frontLabels,
                        datasets: [
                            {
                                label: 'Caminh√µes por Hora',
                                data: Array(frontLabels.length).fill(0), // Will be updated with real data
                                backgroundColor: 'rgba(249, 115, 22, 0.7)', // Orange color
                                borderColor: 'rgba(249, 115, 22, 1)',
                                borderWidth: 1,
                                borderRadius: 4,
                                barPercentage: 0.6,
                                categoryPercentage: 0.8
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Caminh√µes/Hora'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `M√©dia: ${context.raw.toFixed(1)} caminh√µes/h`;
                                    }
                                }
                            },
                            legend: {
                                display: false
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value.toFixed(1),
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error("Error initializing trucks per hour chart:", error);
            }
        }
        
        // Update Chart Theme based on dark/light mode
        function updateChartTheme(chart) {
            if (!chart) return;
            
            try {
                const isDarkMode = document.documentElement.classList.contains('dark');
                
                // Update grid and text colors
                const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                const textColor = isDarkMode ? 'rgba(255, 255, 255, 0.7)' : 'rgba(0, 0, 0, 0.7)';
                
                if (chart.options.scales.x) {
                    chart.options.scales.x.grid = chart.options.scales.x.grid || {};
                    chart.options.scales.x.grid.color = gridColor;
                    
                    chart.options.scales.x.ticks = chart.options.scales.x.ticks || {};
                    chart.options.scales.x.ticks.color = textColor;
                    
                    if (chart.options.scales.x.title) {
                        chart.options.scales.x.title.color = textColor;
                    }
                }
                
                if (chart.options.scales.y) {
                    chart.options.scales.y.grid = chart.options.scales.y.grid || {};
                    chart.options.scales.y.grid.color = gridColor;
                    
                    chart.options.scales.y.ticks = chart.options.scales.y.ticks || {};
                    chart.options.scales.y.ticks.color = textColor;
                    
                    if (chart.options.scales.y.title) {
                        chart.options.scales.y.title.color = textColor;
                    }
                }
                
                // Update legend colors
                if (chart.options.plugins && chart.options.plugins.legend && chart.options.plugins.legend.labels) {
                    chart.options.plugins.legend.labels.color = textColor;
                }
                
                // Update datalabels color
                if (chart.options.plugins && chart.options.plugins.datalabels && chart.options.plugins.datalabels.color && typeof chart.options.plugins.datalabels.color === 'function') {
                    // The color is already a function that checks dark mode
                    // No need to update it here
                }
                
                chart.update();
            } catch (error) {
                console.error("Error updating chart theme:", error);
            }
        }
        
        // Update charts with current data
        function updateCharts() {
            try {
                if (state.currentPage === 'dashboard') {
                    updateDashboardCharts();
                }
            } catch (error) {
                console.error("Error updating charts:", error);
            }
        }
        
        // Update Dashboard Charts
        function updateDashboardCharts() {
            try {
                console.log("Updating dashboard charts with current data...");
                
                // Update full cycle delivery chart
                updateFullCycleDeliveryChart();
                
                // Update delivery by period chart
                updateDeliveryByPeriodChart();
                
                // Update front performance chart
                updateFrontPerformanceChart();
                
                // Update trips by front chart
                updateTripsByFrontChart();
                
                // Update trucks per hour chart
                updateTrucksPerHourChart();
                
                // Update production by front table
                populateProductionByFrontTable();
                
                console.log("Dashboard charts updated successfully");
            } catch (error) {
                console.error("Error updating dashboard charts:", error);
            }
        }
        
        // Update Full Cycle Delivery Chart
        function updateFullCycleDeliveryChart() {
            if (!state.charts.fullCycleDelivery) return;
            
            try {
                // Prepare data for the 24-hour cycle, ordered from 06:00 to 05:00
                const deliveryData = [];
                const potentialData = [];
                
                // Hours from 06 to 23
                for (let hour = 6; hour < 24; hour++) {
                    let hourlyDelivery = 0;
                    let hourlyPotential = 0;
                    
                    for (const front of state.fronts) {
                        hourlyDelivery += state.delivery[front][hour] || 0;
                        
                        // Use the hour's potential if it's an odd hour, otherwise use the potential from the adjacent odd hour
                        if (hour % 2 !== 0) {
                            hourlyPotential += state.potential[front][hour] || 0;
                        } else {
                            // For even hours, use the adjacent odd hour's potential (hour+1, unless it's 23, then use hour-1)
                            const referenceHour = hour === 22 ? 21 : (hour === 23 ? 22 : hour + 1);
                            hourlyPotential += state.potential[front][referenceHour] || 0;
                        }
                    }
                    
                    deliveryData.push(hourlyDelivery);
                    potentialData.push(hourlyPotential);
                }
                
                // Hours from 00 to 05
                for (let hour = 0; hour < 6; hour++) {
                    let hourlyDelivery = 0;
                    let hourlyPotential = 0;
                    
                    for (const front of state.fronts) {
                        hourlyDelivery += state.delivery[front][hour] || 0;
                        
                        // Use the hour's potential if it's an odd hour, otherwise use the potential from the adjacent odd hour
                        if (hour % 2 !== 0) {
                            hourlyPotential += state.potential[front][hour] || 0;
                        } else {
                            // For even hours, use the adjacent odd hour's potential
                            const referenceHour = hour === 0 ? 1 : hour - 1;
                            hourlyPotential += state.potential[front][referenceHour] || 0;
                        }
                    }
                    
                    deliveryData.push(hourlyDelivery);
                    potentialData.push(hourlyPotential);
                }
                
                // Update chart data
                state.charts.fullCycleDelivery.data.datasets[0].data = deliveryData;
                state.charts.fullCycleDelivery.data.datasets[1].data = potentialData;
                
                // Update chart
                state.charts.fullCycleDelivery.update();
            } catch (error) {
                console.error("Error updating full cycle delivery chart:", error);
            }
        }
        
        // Update Delivery by Period Chart
        function updateDeliveryByPeriodChart() {
            if (!state.charts.deliveryByPeriod) return;
            
            try {
                // Prepare data for the chart
                const periods = Object.keys(state.timePeriodsMap);
                const deliveryData = [];
                const potentialData = [];
                
                for (const period of periods) {
                    let periodDelivery = 0;
                    let periodPotential = 0;
                    
                    for (const front of state.fronts) {
                        periodDelivery += state.twoHourDelivery[period][front] || 0;
                        periodPotential += state.twoHourPotential[period][front] || 0;
                    }
                    
                    deliveryData.push(periodDelivery);
                    potentialData.push(periodPotential);
                }
                
                // Update chart data
                state.charts.deliveryByPeriod.data.datasets[0].data = deliveryData;
                state.charts.deliveryByPeriod.data.datasets[1].data = potentialData;
                
                // Update chart
                state.charts.deliveryByPeriod.update();
                
                // Also update the analytics data for use in different views
                state.analytics.periodData.day = {
                    labels: periods.map(p => `${p.substring(0, 2)}:00-${p.substring(3, 5)}:00`),
                    datasets: [
                        { data: deliveryData },
                        { data: potentialData }
                    ]
                };
            } catch (error) {
                console.error("Error updating delivery by period chart:", error);
            }
        }
        
        // Update Front Performance Chart
        function updateFrontPerformanceChart() {
            if (!state.charts.frontPerformance) return;
            
            try {
                // Calculate efficiency percentages for each front
                const frontData = [];
                const backgroundColors = [];
                
                for (const front of state.fronts) {
                    let totalDelivery = 0;
                    let totalPotential = 0;
                    
                    // Sum up all deliveries and potentials across all periods
                    for (const period in state.twoHourDelivery) {
                        totalDelivery += state.twoHourDelivery[period][front] || 0;
                        totalPotential += state.twoHourPotential[period][front] || 0;
                    }
                    
                    // Calculate efficiency percentage
                    const efficiency = totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
                    frontData.push(efficiency);
                    
                    // Determine bar color based on efficiency
                    let color;
                    if (efficiency >= 90) {
                        color = 'rgba(16, 185, 129, 0.7)'; // Green
                    } else if (efficiency >= 75) {
                        color = 'rgba(93, 92, 222, 0.7)'; // Primary
                    } else if (efficiency >= 50) {
                        color = 'rgba(245, 158, 11, 0.7)'; // Yellow
                    } else {
                        color = 'rgba(239, 68, 68, 0.7)'; // Red
                    }
                    
                    backgroundColors.push(color);
                }
                
                // Update chart data
                state.charts.frontPerformance.data.datasets[0].data = frontData;
                state.charts.frontPerformance.data.datasets[0].backgroundColor = backgroundColors;
                
                // Update chart
                state.charts.frontPerformance.update();
            } catch (error) {
                console.error("Error updating front performance chart:", error);
            }
        }
        
        // Update Trips by Front Chart
        function updateTripsByFrontChart() {
            if (!state.charts.tripsByFront) return;
            
            try {
                // Calculate total trips for each front
                const tripsData = [];
                
                for (const front of state.fronts) {
                    let totalTrips = 0;
                    
                    // Sum up all trips across all hours
                    for (const hour of state.hours) {
                        totalTrips += state.trips[front][hour] || 0;
                    }
                    
                    tripsData.push(totalTrips);
                }
                
                // Update chart data
                state.charts.tripsByFront.data.datasets[0].data = tripsData;
                
                // Update chart
                state.charts.tripsByFront.update();
            } catch (error) {
                console.error("Error updating trips by front chart:", error);
            }
        }
        
        // Update Trucks per Hour Chart
        function updateTrucksPerHourChart() {
            if (!state.charts.trucksPerHour) return;
            
            try {
                // Calculate average trucks per hour for each front
                const trucksData = [];
                
                for (const front of state.fronts) {
                    let totalTrips = 0;
                    let activeHours = 0;
                    
                    // Sum up all trips and count active hours
                    for (const hour of state.hours) {
                        if (state.trips[front][hour] > 0) {
                            totalTrips += state.trips[front][hour];
                            activeHours++;
                        }
                    }
                    
                    // Calculate average trucks per hour
                    const avgTrucksPerHour = activeHours > 0 ? totalTrips / activeHours : 0;
                    trucksData.push(avgTrucksPerHour);
                }
                
                // Update chart data
                state.charts.trucksPerHour.data.datasets[0].data = trucksData;
                
                // Update chart
                state.charts.trucksPerHour.update();
            } catch (error) {
                console.error("Error updating trucks per hour chart:", error);
            }
        }
        
        // Update Period Chart
        function updatePeriodChart(period) {
            // This function updates the period chart based on selected period (day, week, month)
            try {
                console.log(`Updating period chart to: ${period}`);
                
                // If needed, we would update the chart data here based on the selected period
                // For now, we'll just indicate that the function was called
                console.log(`Period chart updated to ${period}`);
            } catch (error) {
                console.error(`Error updating period chart to ${period}:`, error);
            }
        }
        
        // Calculate production by front
        function calculateProductionByFront() {
            try {
                const productionData = [];
                
                // Process data for each front
                for (const front of state.fronts) {
                    // Calculate total trips for this front
                    let totalTrips = 0;
                    for (const hour of state.hours) {
                        totalTrips += state.trips[front][hour] || 0;
                    }
                    
                    // Calculate total delivery for this front
                    let totalDelivered = 0;
                    for (const hour of state.hours) {
                        totalDelivered += state.delivery[front][hour] || 0;
                    }
                    
                    // Calculate average density
                    let totalDensity = 0;
                    let densityCount = 0;
                    for (const hour of state.hours) {
                        if (state.density[front][hour] > 0) {
                            totalDensity += state.density[front][hour];
                            densityCount++;
                        }
                    }
                    const avgDensity = densityCount > 0 ? totalDensity / densityCount : 0;
                    
                    // Calculate total potential
                    let totalPotential = 0;
                    for (const period in state.twoHourPotential) {
                        totalPotential += state.twoHourPotential[period][front] || 0;
                    }
                    
                    // Calculate percentage
                    const percentage = totalPotential > 0 ? (totalDelivered / totalPotential) * 100 : 0;
                    
                    // Add data for this front
                    productionData.push({
                        front,
                        delivered: totalDelivered,
                        trips: totalTrips,
                        avgDensity,
                        potential: totalPotential,
                        percentage
                    });
                }
                
                // Update analytics state
                state.analytics.productionByFront = productionData;
                
                return productionData;
            } catch (error) {
                console.error("Error calculating production by front:", error);
                return [];
            }
        }
        
        // Populate production by front table
        function populateProductionByFrontTable() {
            try {
                const tableBody = document.getElementById('production-by-front-table');
                if (!tableBody) {
                    console.warn("Production by front table body not found");
                    return;
                }
                
                // Clear existing rows
                tableBody.innerHTML = '';
                
                // Calculate data
                const productionData = calculateProductionByFront();
                
                let totalDelivered = 0;
                let totalTrips = 0;
                let totalDensitySum = 0;
                let totalPotential = 0;
                let densityCount = 0;
                
                // Add each front row
                productionData.forEach(frontData => {
                    const row = document.createElement('tr');
                    
                    // Calculate color class based on percentage
                    let colorClass = 'text-red-600 dark:text-red-400';
                    if (frontData.percentage >= 90) {
                        colorClass = 'text-green-600 dark:text-green-400';
                    } else if (frontData.percentage >= 75) {
                        colorClass = 'text-primary dark:text-primary-400';
                    } else if (frontData.percentage >= 50) {
                        colorClass = 'text-yellow-600 dark:text-yellow-400';
                    }
                    
                    // Calculate progress bar color
                    let barColorClass = 'bg-red-500';
                    if (frontData.percentage >= 90) {
                        barColorClass = 'bg-green-500';
                    } else if (frontData.percentage >= 75) {
                        barColorClass = 'bg-primary';
                    } else if (frontData.percentage >= 50) {
                        barColorClass = 'bg-yellow-500';
                    }
                    
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">F${frontData.front}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">${frontData.delivered.toFixed(1)} ton</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">${frontData.trips}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">${frontData.avgDensity.toFixed(1)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">${frontData.potential.toFixed(1)} ton</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                            <div class="flex items-center">
                                <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2 mr-2 max-w-[100px]">
                                    <div class="${barColorClass} h-2 rounded-full" style="width: ${Math.min(100, frontData.percentage)}%"></div>
                                </div>
                                <span class="${colorClass}">${frontData.percentage.toFixed(1)}%</span>
                            </div>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                    
                    // Update totals
                    totalDelivered += frontData.delivered;
                    totalTrips += frontData.trips;
                    totalDensitySum += frontData.avgDensity;
                    totalPotential += frontData.potential;
                    densityCount++;
                });
                
                // Update the totals in the footer
                const avgDensity = densityCount > 0 ? totalDensitySum / densityCount : 0;
                const totalPercentage = totalPotential > 0 ? (totalDelivered / totalPotential) * 100 : 0;
                
                document.getElementById('total-delivered').textContent = `${totalDelivered.toFixed(1)} ton`;
                document.getElementById('total-trips').textContent = totalTrips;
                document.getElementById('avg-density').textContent = avgDensity.toFixed(1);
                document.getElementById('total-potential').textContent = `${totalPotential.toFixed(1)} ton`;
                document.getElementById('total-percentage').textContent = `${totalPercentage.toFixed(1)}%`;
                
                // Update percentage bar
                const totalPercentageBar = document.getElementById('total-percentage-bar');
                if (totalPercentageBar) {
                    totalPercentageBar.style.width = `${Math.min(100, totalPercentage)}%`;
                    
                    // Update bar color based on percentage
                    totalPercentageBar.classList.remove('bg-red-500', 'bg-yellow-500', 'bg-primary', 'bg-green-500');
                    
                    if (totalPercentage >= 90) {
                        totalPercentageBar.classList.add('bg-green-500');
                    } else if (totalPercentage >= 75) {
                        totalPercentageBar.classList.add('bg-primary');
                    } else if (totalPercentage >= 50) {
                        totalPercentageBar.classList.add('bg-yellow-500');
                    } else {
                        totalPercentageBar.classList.add('bg-red-500');
                    }
                }
                
                // Update summary stats on dashboard
                updateDashboardStats(productionData, totalDelivered, totalTrips, avgDensity, totalPotential, totalPercentage);
            } catch (error) {
                console.error("Error populating production by front table:", error);
            }
        }
        
        // Update dashboard stats
        function updateDashboardStats(productionData, totalDelivered, totalTrips, avgDensity, totalPotential, totalPercentage) {
            try {
                // Update total delivered card
                document.getElementById('total-entregue-card').textContent = totalDelivered.toFixed(1);
                document.getElementById('progresso-entrega').style.width = `${Math.min(100, totalPercentage)}%`;
                document.getElementById('porcentagem-meta-entrega').textContent = totalPercentage.toFixed(0);
                
                // Update efficiency card
                document.getElementById('eficiencia-media-card').textContent = `${totalPercentage.toFixed(1)}%`;
                document.getElementById('progresso-eficiencia').style.width = `${Math.min(100, totalPercentage)}%`;
                
                // Update trips card
                document.getElementById('viagens-realizadas-card').textContent = totalTrips;
                document.getElementById('progresso-viagens').style.width = `${Math.min(100, (totalTrips / 1500) * 100)}%`;
                document.getElementById('porcentagem-meta-viagens').textContent = ((totalTrips / 1500) * 100).toFixed(0);
                
                // Update density card
                document.getElementById('densidade-media-card').textContent = avgDensity.toFixed(2);
                document.getElementById('progresso-densidade').style.width = `${Math.min(100, (avgDensity / 65) * 100)}%`;
                document.getElementById('meta-densidade').textContent = "65.00";
                
                // Fake variations (in a real app, these would be calculated from historical data)
                document.getElementById('variacao-entrega').textContent = "3.5";
                document.getElementById('variacao-eficiencia').textContent = "1.2";
                document.getElementById('variacao-viagens').textContent = "4.8";
                document.getElementById('variacao-densidade').textContent = "2.1";
                document.getElementById('variacao-tempo').textContent = "5.3";
                
                // Fake average trip time
                document.getElementById('tempo-viagem-card').textContent = "42 min";
                
                // Find most productive front
                let mostProductiveFront = productionData[0];
                for (let i = 1; i < productionData.length; i++) {
                    if (productionData[i].delivered > mostProductiveFront.delivered) {
                        mostProductiveFront = productionData[i];
                    }
                }
                
                // Update frente mais produtiva card
                if (mostProductiveFront) {
                    document.getElementById('frente-produtiva-card').textContent = `Frente ${mostProductiveFront.front}`;
                    const percentOfTotal = totalDelivered > 0 ? (mostProductiveFront.delivered / totalDelivered) * 100 : 0;
                    document.getElementById('frente-produtiva-info').textContent = `${mostProductiveFront.delivered.toFixed(1)} ton (${percentOfTotal.toFixed(1)}% do total)`;
                }
                
                // Find the peak delivery period
                let peakPeriodHours = [];
                let peakDelivery = 0;
                let peakPeriod = "";
                
                for (const period in state.timePeriodsMap) {
                    const hours = state.timePeriodsMap[period];
                    let periodTotal = 0;
                    
                    for (const front of state.fronts) {
                        for (const hour of hours) {
                            periodTotal += state.delivery[front][hour] || 0;
                        }
                    }
                    
                    if (periodTotal > peakDelivery) {
                        peakDelivery = periodTotal;
                        peakPeriod = period;
                        peakPeriodHours = hours;
                    }
                }
                
                // Update peak delivery card
                document.getElementById('pico-entregas-card').textContent = `${peakDelivery.toFixed(1)} ton`;
                document.getElementById('periodo-pico').textContent = peakPeriod ? 
                    `Per√≠odo: ${peakPeriodHours[0].toString().padStart(2, '0')}:00-${(peakPeriodHours[peakPeriodHours.length-1]+1).toString().padStart(2, '0')}:00` : 
                    'Per√≠odo: --:-- - --:--';
                
                // Update performance metrics
                const eficienciaOp = Math.min(100, totalPercentage);
                const utilizacaoRecursos = Math.min(100, (totalTrips / 1500) * 100);
                const cumprimentoMetas = Math.min(100, (totalDelivered / totalPotential) * 100);
                const qualidadeEntrega = Math.min(100, (avgDensity / 65) * 100);
                
                document.getElementById('eficiencia-operacional').textContent = `${eficienciaOp.toFixed(0)}%`;
                document.getElementById('barra-eficiencia-op').style.width = `${eficienciaOp}%`;
                
                document.getElementById('utilizacao-recursos').textContent = `${utilizacaoRecursos.toFixed(0)}%`;
                document.getElementById('barra-utilizacao').style.width = `${utilizacaoRecursos}%`;
                
                document.getElementById('cumprimento-metas').textContent = `${cumprimentoMetas.toFixed(0)}%`;
                document.getElementById('barra-cumprimento').style.width = `${cumprimentoMetas}%`;
                
                document.getElementById('qualidade-entrega').textContent = `${qualidadeEntrega.toFixed(0)}%`;
                document.getElementById('barra-qualidade').style.width = `${qualidadeEntrega}%`;
                
                // Calculate overall performance index
                const desempenhoGeral = (eficienciaOp + utilizacaoRecursos + cumprimentoMetas + qualidadeEntrega) / 4;
                document.getElementById('desempenho-geral').textContent = `${desempenhoGeral.toFixed(0)}%`;
                document.getElementById('barra-desempenho-geral').style.width = `${desempenhoGeral}%`;
            } catch (error) {
                console.error("Error updating dashboard stats:", error);
            }
        }
        
        // Export Functions
        function exportJSON() {
            try {
                const dataToExport = {
                    fronts: state.fronts,
                    density: state.density,
                    trips: state.trips,
                    potential: state.potential,
                    delivery: state.delivery,
                    twoHourDelivery: state.twoHourDelivery,
                    twoHourPotential: state.twoHourPotential,
                    difference: state.difference,
                    timestamp: new Date().toISOString(),
                    version: '1.0'
                };
                
                const jsonString = JSON.stringify(dataToExport, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                
                a.href = url;
                a.download = `entrega_safra_2025_${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                
                // Clean up
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
                
                showToast('Dados exportados com sucesso para JSON', 'success');
                return true;
            } catch (error) {
                console.error("Error exporting to JSON:", error);
                showToast('Erro ao exportar dados para JSON', 'error');
                return false;
            }
        }
        
        // Export current period to JSON
        function exportCurrentPeriodJSON() {
            try {
                // Get the current period hours
                const hours = state.timePeriodsMap[state.activePeriod];
                if (!hours) {
                    showToast('Per√≠odo inv√°lido para exportar', 'error');
                    return false;
                }
                
                // Prepare filtered data
                const filteredDensity = {};
                const filteredTrips = {};
                const filteredPotential = {};
                const filteredDelivery = {};
                
                for (const front of state.fronts) {
                    filteredDensity[front] = {};
                    filteredTrips[front] = {};
                    filteredPotential[front] = {};
                    filteredDelivery[front] = {};
                    
                    for (const hour of hours) {
                        filteredDensity[front][hour] = state.density[front][hour];
                        filteredTrips[front][hour] = state.trips[front][hour];
                        filteredPotential[front][hour] = state.potential[front][hour];
                        filteredDelivery[front][hour] = state.delivery[front][hour];
                    }
                }
                
                // Create data object for export
                const dataToExport = {
                    fronts: state.fronts,
                    period: state.activePeriod,
                    hours: hours,
                    density: filteredDensity,
                    trips: filteredTrips,
                    potential: filteredPotential,
                    delivery: filteredDelivery,
                    timestamp: new Date().toISOString(),
                    version: '1.0'
                };
                
                // Convert to JSON and download
                const jsonString = JSON.stringify(dataToExport, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                
                a.href = url;
                a.download = `entrega_periodo_${state.activePeriod}_${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                
                // Clean up
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
                
                showToast(`Dados do per√≠odo ${state.activePeriod} exportados com sucesso`, 'success');
                return true;
            } catch (error) {
                console.error("Error exporting current period to JSON:", error);
                showToast('Erro ao exportar per√≠odo atual para JSON', 'error');
                return false;
            }
        }
        
        // Export to CSV
        function exportCSV() {
            try {
                let csvContent = 'Frente,Hora,Densidade,Viagens,Entrega,Potencial\n';
                
                for (const front of state.fronts) {
                    for (const hour of state.hours) {
                        const density = state.density[front][hour] || 0;
                        const trips = state.trips[front][hour] || 0;
                        const delivery = state.delivery[front][hour] || 0;
                        const potential = state.potential[front][hour] || 0;
                        
                        csvContent += `${front},${hour},${density},${trips},${delivery},${potential}\n`;
                    }
                }
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                
                a.href = url;
                a.download = `entrega_safra_2025_${new Date().toISOString().slice(0, 10)}.csv`;
                document.body.appendChild(a);
                a.click();
                
                // Clean up
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
                
                showToast('Dados exportados com sucesso para CSV', 'success');
                return true;
            } catch (error) {
                console.error("Error exporting to CSV:", error);
                showToast('Erro ao exportar dados para CSV', 'error');
                return false;
            }
        }
        
        // Import data
        function importData() {
            try {
                const fileInput = document.getElementById('import-file');
                if (!fileInput || !fileInput.files || fileInput.files.length === 0) {
                    showToast('Nenhum arquivo selecionado', 'error');
                    return false;
                }
                
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        if (file.name.endsWith('.json')) {
                            // Import JSON data
                            const importedData = JSON.parse(e.target.result);
                            
                            // Validate imported data
                            if (!importedData.fronts || !importedData.density || !importedData.trips) {
                                showToast('Arquivo JSON inv√°lido ou incompleto', 'error');
                                return;
                            }
                            
                            // Save current state for undo
                            addToHistory('import-data', {
                                oldFronts: [...state.fronts],
                                oldDensity: JSON.parse(JSON.stringify(state.density)),
                                oldTrips: JSON.parse(JSON.stringify(state.trips)),
                                oldPotential: JSON.parse(JSON.stringify(state.potential))
                            });
                            
                            // Update state with imported data
                            state.fronts = importedData.fronts;
                            state.density = importedData.density;
                            state.trips = importedData.trips;
                            state.potential = importedData.potential;
                            
                            // Recalculate and update UI
                            calculateDelivery();
                            calculateTwoHourTotals();
                            
                            // If we're on entrega-hora page, regenerate the HTML
                            if (state.currentPage === 'entrega-hora') {
                                generateTimePeriodHTML();
                            } else {
                                updateUI();
                            }
                            
                            showToast('Dados importados com sucesso!', 'success');
                            
                            // Save imported data
                            saveData();
                        } else if (file.name.endsWith('.csv')) {
                            // Import CSV data
                            Papa.parse(e.target.result, {
                                header: true,
                                complete: function(results) {
                                    try {
                                        if (!results.data || results.data.length === 0) {
                                            showToast('Arquivo CSV vazio ou inv√°lido', 'error');
                                            return;
                                        }
                                        
                                        // Save current state for undo
                                        addToHistory('import-data', {
                                            oldFronts: [...state.fronts],
                                            oldDensity: JSON.parse(JSON.stringify(state.density)),
                                            oldTrips: JSON.parse(JSON.stringify(state.trips)),
                                            oldPotential: JSON.parse(JSON.stringify(state.potential))
                                        });
                                        
                                        // Process CSV data
                                        const newFronts = new Set();
                                        const newDensity = {};
                                        const newTrips = {};
                                        const newPotential = {};
                                        
                                        // Continue from where we left off in the importData function
                                        results.data.forEach(row => {
                                            if (!row.Frente || !row.Hora) return;
                                            
                                            const front = row.Frente;
                                            const hour = parseInt(row.Hora);
                                            
                                            if (isNaN(hour) || hour < 0 || hour > 23) return;
                                            
                                            newFronts.add(front);
                                            
                                            if (!newDensity[front]) {
                                                newDensity[front] = {};
                                                newTrips[front] = {};
                                                newPotential[front] = {};
                                            }
                                            
                                            newDensity[front][hour] = parseFloat(row.Densidade) || 0;
                                            newTrips[front][hour] = parseInt(row.Viagens) || 0;
                                            newPotential[front][hour] = parseFloat(row.Potencial) || 0;
                                        });
                                        
                                        // Update state with imported data
                                        state.fronts = Array.from(newFronts);
                                        state.density = newDensity;
                                        state.trips = newTrips;
                                        state.potential = newPotential;
                                        
                                        // Recalculate and update UI
                                        calculateDelivery();
                                        calculateTwoHourTotals();
                                        
                                        // If we're on entrega-hora page, regenerate the HTML
                                        if (state.currentPage === 'entrega-hora') {
                                            generateTimePeriodHTML();
                                        } else {
                                            updateUI();
                                        }
                                        
                                        showToast('Dados importados com sucesso!', 'success');
                                        
                                        // Save imported data
                                        saveData();
                                    } catch (error) {
                                        console.error("Error processing CSV data:", error);
                                        showToast('Erro ao processar dados CSV', 'error');
                                    }
                                },
                                error: function(error) {
                                    console.error("CSV parsing error:", error);
                                    showToast('Erro ao analisar arquivo CSV', 'error');
                                }
                            });
                        } else {
                            showToast('Formato de arquivo n√£o suportado. Use JSON ou CSV.', 'error');
                        }
                    } catch (error) {
                        console.error("Error importing data:", error);
                        showToast('Erro ao importar dados', 'error');
                    }
                };
                
                if (file.name.endsWith('.json') || file.name.endsWith('.csv')) {
                    reader.readAsText(file);
                } else {
                    showToast('Formato de arquivo n√£o suportado. Use JSON ou CSV.', 'error');
                }
                
                return true;
            } catch (error) {
                console.error("Error importing data:", error);
                showToast('Erro ao importar dados', 'error');
                return false;
            }
        }
        
        // Export to PDF
        function exportPDF() {
            try {
                const { jsPDF } = window.jspdf;
                
                if (typeof jsPDF !== 'function') {
                    showToast('Biblioteca jsPDF n√£o carregada', 'error');
                    return false;
                }
                
                // Create new PDF document
                const doc = new jsPDF({
                    orientation: 'landscape',
                    unit: 'mm',
                    format: 'a4'
                });
                
                // Add title
                doc.setFontSize(18);
                doc.text('Relat√≥rio de Entrega de Safra 2025', 15, 15);
                
                // Add date
                doc.setFontSize(10);
                doc.text(`Data: ${new Date().toLocaleDateString('pt-BR')}`, 15, 22);
                
                // Add current period header
                doc.setFontSize(14);
                doc.text(`Per√≠odo: ${state.activePeriod.substring(0, 2)}:00-${state.activePeriod.substring(3, 5)}:00`, 15, 30);
                
                // Create tables for the period
                const hours = state.timePeriodsMap[state.activePeriod];
                
                hours.forEach((hour, index) => {
                    // Skip to next page if this is the second hour
                    if (index > 0) {
                        doc.addPage();
                    }
                    
                    // Add hour header
                    doc.setFontSize(14);
                    doc.text(`Hora: ${hour.toString().padStart(2, '0')}:00`, 15, 40);
                    
                    // Prepare table data
                    const tableData = [];
                    let totalDelivery = 0;
                    let totalTrips = 0;
                    
                    // Add header row
                    tableData.push(['Frente', 'Densidade', 'Viagens', 'Entrega', hour % 2 !== 0 ? 'Potencial' : '']);
                    
                    // Add data rows
                    for (const front of state.fronts) {
                        const density = state.density[front][hour] || 0;
                        const trips = state.trips[front][hour] || 0;
                        const delivery = state.delivery[front][hour] || 0;
                        const potential = hour % 2 !== 0 ? (state.potential[front][hour] || 0) : '';
                        
                        tableData.push([
                            front,
                            density.toFixed(2),
                            trips.toString(),
                            delivery.toFixed(2),
                            potential !== '' ? potential.toString() : ''
                        ]);
                        
                        totalDelivery += delivery;
                        totalTrips += trips;
                    }
                    
                    // Add total row
                    tableData.push(['TOTAL', '', totalTrips.toString(), totalDelivery.toFixed(2), '']);
                    
                    // Add table to document
                    doc.autoTable({
                        startY: 45,
                        head: [tableData[0]],
                        body: tableData.slice(1),
                        theme: 'grid',
                        styles: {
                            fontSize: 10,
                            cellPadding: 3
                        },
                        headStyles: {
                            fillColor: [93, 92, 222],
                            textColor: [255, 255, 255],
                            fontStyle: 'bold'
                        },
                        footStyles: {
                            fillColor: [240, 240, 240],
                            textColor: [0, 0, 0],
                            fontStyle: 'bold'
                        }
                    });
                });
                
                // Add period summary on a new page
                doc.addPage();
                
                // Add period summary header
                doc.setFontSize(14);
                doc.text(`Resumo do Per√≠odo ${state.activePeriod.substring(0, 2)}:00-${state.activePeriod.substring(3, 5)}:00`, 15, 15);
                
                // Prepare summary table data
                const summaryData = [];
                
                // Add header row
                summaryData.push(['Frente', 'Entregue (2h)', 'Potencial (2h)', 'Diferen√ßa', '% Realizado']);
                
                // Add data rows
                let totalDelivery = 0;
                let totalPotential = 0;
                
                for (const front of state.fronts) {
                    const delivered = state.twoHourDelivery[state.activePeriod][front] || 0;
                    const potential = state.twoHourPotential[state.activePeriod][front] || 0;
                    const difference = delivered - potential;
                    const percentage = potential > 0 ? (delivered / potential) * 100 : 0;
                    
                    summaryData.push([
                        front,
                        delivered.toFixed(2),
                        potential.toFixed(2),
                        difference.toFixed(2),
                        percentage.toFixed(1) + '%'
                    ]);
                    
                    totalDelivery += delivered;
                    totalPotential += potential;
                }
                
                // Add total row
                const totalDifference = totalDelivery - totalPotential;
                const totalPercentage = totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
                
                summaryData.push([
                    'TOTAL',
                    totalDelivery.toFixed(2),
                    totalPotential.toFixed(2),
                    totalDifference.toFixed(2),
                    totalPercentage.toFixed(1) + '%'
                ]);
                
                // Add summary table to document
                doc.autoTable({
                    startY: 20,
                    head: [summaryData[0]],
                    body: summaryData.slice(1),
                    theme: 'grid',
                    styles: {
                        fontSize: 10,
                        cellPadding: 3
                    },
                    headStyles: {
                        fillColor: [93, 92, 222],
                        textColor: [255, 255, 255],
                        fontStyle: 'bold'
                    },
                    footStyles: {
                        fillColor: [240, 240, 240],
                        textColor: [0, 0, 0],
                        fontStyle: 'bold'
                    }
                });
                
                // Save the PDF
                doc.save(`entrega_safra_2025_${state.activePeriod}_${new Date().toISOString().slice(0, 10)}.pdf`);
                showToast('Relat√≥rio PDF gerado com sucesso', 'success');
                return true;
            } catch (error) {
                console.error("Error exporting to PDF:", error);
                showToast('Erro ao gerar relat√≥rio PDF', 'error');
                return false;
            }
        }
        
        // Export dashboard
        function exportDashboard() {
            try {
                const { jsPDF } = window.jspdf;
                
                if (typeof jsPDF !== 'function') {
                    showToast('Biblioteca jsPDF n√£o carregada', 'error');
                    return false;
                }
                
                // Create new PDF document
                const doc = new jsPDF({
                    orientation: 'landscape',
                    unit: 'mm',
                    format: 'a4'
                });
                
                // Add title
                doc.setFontSize(18);
                doc.text('Dashboard - Entrega de Safra 2025', 15, 15);
                
                // Add date
                doc.setFontSize(10);
                doc.text(`Data: ${new Date().toLocaleDateString('pt-BR')}`, 15, 22);
                
                // Calculate data for the dashboard
                const productionData = calculateProductionByFront();
                
                // Convert chart canvases to images (if available)
                try {
                    if (state.charts.fullCycleDelivery) {
                        const fullCycleCanvas = document.getElementById('fullCycleDeliveryChart');
                        if (fullCycleCanvas) {
                            const fullCycleImage = fullCycleCanvas.toDataURL('image/png');
                            doc.addImage(fullCycleImage, 'PNG', 15, 30, 180, 60);
                        }
                    }
                } catch (chartError) {
                    console.warn("Could not export chart:", chartError);
                }
                
                // Add production by front table
                doc.setFontSize(14);
                doc.text('Produ√ß√£o por Frente', 15, 100);
                
                // Prepare table data
                const tableData = [];
                
                // Add header row
                tableData.push(['Frente', 'Total Entregue', 'Viagens', 'Densidade M√©dia', 'Potencial', '% Realizado']);
                
                // Add data rows
                for (const frontData of productionData) {
                    tableData.push([
                        frontData.front,
                        frontData.delivered.toFixed(1) + ' ton',
                        frontData.trips.toString(),
                        frontData.avgDensity.toFixed(1),
                        frontData.potential.toFixed(1) + ' ton',
                        frontData.percentage.toFixed(1) + '%'
                    ]);
                }
                
                // Calculate totals
                let totalDelivered = 0;
                let totalTrips = 0;
                let totalDensitySum = 0;
                let totalPotential = 0;
                let densityCount = 0;
                
                productionData.forEach(frontData => {
                    totalDelivered += frontData.delivered;
                    totalTrips += frontData.trips;
                    totalDensitySum += frontData.avgDensity;
                    totalPotential += frontData.potential;
                    densityCount++;
                });
                
                const avgDensity = densityCount > 0 ? totalDensitySum / densityCount : 0;
                const totalPercentage = totalPotential > 0 ? (totalDelivered / totalPotential) * 100 : 0;
                
                // Add total row
                tableData.push([
                    'TOTAL',
                    totalDelivered.toFixed(1) + ' ton',
                    totalTrips.toString(),
                    avgDensity.toFixed(1),
                    totalPotential.toFixed(1) + ' ton',
                    totalPercentage.toFixed(1) + '%'
                ]);
                
                // Add table to document
                doc.autoTable({
                    startY: 105,
                    head: [tableData[0]],
                    body: tableData.slice(1),
                    theme: 'grid',
                    styles: {
                        fontSize: 9,
                        cellPadding: 2
                    },
                    headStyles: {
                        fillColor: [93, 92, 222],
                        textColor: [255, 255, 255],
                        fontStyle: 'bold'
                    },
                    footStyles: {
                        fillColor: [240, 240, 240],
                        textColor: [0, 0, 0],
                        fontStyle: 'bold'
                    }
                });
                
                // Add summary metrics
                doc.setFontSize(14);
                doc.text('M√©tricas de Desempenho', 15, 180);
                
                // Calculate performance metrics
                const eficienciaOp = Math.min(100, totalPercentage);
                const utilizacaoRecursos = Math.min(100, (totalTrips / 1500) * 100);
                const cumprimentoMetas = Math.min(100, (totalDelivered / totalPotential) * 100);
                const qualidadeEntrega = Math.min(100, (avgDensity / 65) * 100);
                const desempenhoGeral = (eficienciaOp + utilizacaoRecursos + cumprimentoMetas + qualidadeEntrega) / 4;
                
                // Add metrics table
                const metricsData = [
                    ['M√©trica', 'Valor'],
                    ['Efici√™ncia Operacional', eficienciaOp.toFixed(1) + '%'],
                    ['Utiliza√ß√£o de Recursos', utilizacaoRecursos.toFixed(1) + '%'],
                    ['Cumprimento de Metas', cumprimentoMetas.toFixed(1) + '%'],
                    ['Qualidade da Entrega', qualidadeEntrega.toFixed(1) + '%'],
                    ['Desempenho Geral', desempenhoGeral.toFixed(1) + '%']
                ];
                
                doc.autoTable({
                    startY: 185,
                    head: [metricsData[0]],
                    body: metricsData.slice(1),
                    theme: 'grid',
                    styles: {
                        fontSize: 10,
                        cellPadding: 3
                    },
                    headStyles: {
                        fillColor: [93, 92, 222],
                        textColor: [255, 255, 255],
                        fontStyle: 'bold'
                    }
                });
                
                // Add footer with timestamp
                const timestamp = new Date().toLocaleString('pt-BR');
                doc.setFontSize(8);
                doc.text(`Gerado em: ${timestamp}`, 15, doc.internal.pageSize.height - 10);
                
                // Save the PDF
                doc.save(`dashboard_safra_2025_${new Date().toISOString().slice(0, 10)}.pdf`);
                showToast('Dashboard exportado com sucesso para PDF', 'success');
                return true;
            } catch (error) {
                console.error("Error exporting dashboard:", error);
                showToast('Erro ao exportar dashboard', 'error');
                return false;
            }
        }
        
        // Update Configuration from UI
        function updateConfigFromUI() {
            try {
                const autoSaveToggle = document.getElementById('auto-save-toggle');
                const autoSaveInterval = document.getElementById('auto-save-interval');
                const darkModeToggle = document.getElementById('dark-mode-toggle');
                const alertThreshold = document.getElementById('alert-threshold');
                const soundAlertToggle = document.getElementById('sound-alert-toggle');
                const visualAlertToggle = document.getElementById('visual-alert-toggle');
                
                if (autoSaveToggle) {
                    state.config.autoSave = autoSaveToggle.checked;
                }
                
                if (autoSaveInterval) {
                    state.config.autoSaveInterval = parseInt(autoSaveInterval.value) || 5;
                }
                
                if (darkModeToggle) {
                    state.config.darkMode = darkModeToggle.checked;
                    if (darkModeToggle.checked) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                }
                
                if (alertThreshold) {
                    state.config.alertThreshold = parseInt(alertThreshold.value) || 10;
                }
                
                if (soundAlertToggle) {
                    state.config.soundAlerts = soundAlertToggle.checked;
                }
                
                if (visualAlertToggle) {
                    state.config.visualAlerts = visualAlertToggle.checked;
                }
                
                // Update charts for dark mode if needed
                if (state.config.darkMode !== document.documentElement.classList.contains('dark')) {
                    Object.values(state.charts).forEach(chart => {
                        if (chart) updateChartTheme(chart);
                    });
                }
                
                // Return the updated config
                return state.config;
            } catch (error) {
                console.error("Error updating config from UI:", error);
                return state.config;
            }
        }
        
        // Update UI from Config
        function updateUIFromConfig() {
            try {
                const autoSaveToggle = document.getElementById('auto-save-toggle');
                const autoSaveInterval = document.getElementById('auto-save-interval');
                const darkModeToggle = document.getElementById('dark-mode-toggle');
                const alertThreshold = document.getElementById('alert-threshold');
                const soundAlertToggle = document.getElementById('sound-alert-toggle');
                const visualAlertToggle = document.getElementById('visual-alert-toggle');
                
                if (autoSaveToggle) {
                    autoSaveToggle.checked = state.config.autoSave;
                }
                
                if (autoSaveInterval) {
                    autoSaveInterval.value = state.config.autoSaveInterval;
                }
                
                if (darkModeToggle) {
                    darkModeToggle.checked = document.documentElement.classList.contains('dark');
                }
                
                if (alertThreshold) {
                    alertThreshold.value = state.config.alertThreshold;
                }
                
                if (soundAlertToggle) {
                    soundAlertToggle.checked = state.config.soundAlerts;
                }
                
                if (visualAlertToggle) {
                    visualAlertToggle.checked = state.config.visualAlerts;
                }
            } catch (error) {
                console.error("Error updating UI from config:", error);
            }
        }
        
        // Restore Default Config
        function restoreDefaultConfig() {
            try {
                state.config = {
                    autoSave: true,
                    autoSaveInterval: 5,
                    darkMode: false,
                    alertThreshold: 10,
                    soundAlerts: false,
                    visualAlerts: true
                };
                
                // Apply dark mode setting
                if (state.config.darkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
                
                // Update UI
                updateUIFromConfig();
                
                // Save config
                saveConfig();
                
                // Update charts for dark mode
                Object.values(state.charts).forEach(chart => {
                    if (chart) updateChartTheme(chart);
                });
                
                // Restart auto-save timer
                setupAutoSave();
                
                showToast('Configura√ß√µes restauradas para os padr√µes', 'success');
                closeConfirmationModal();
            } catch (error) {
                console.error("Error restoring default config:", error);
                showToast('Erro ao restaurar configura√ß√µes padr√£o', 'error');
            }
        }
        
        // Load Config
        function loadConfig() {
            try {
                const savedConfig = localStorage.getItem('ggestao_config');
                if (savedConfig) {
                    state.config = { ...state.config, ...JSON.parse(savedConfig) };
                }
                
                return state.config;
            } catch (error) {
                console.error("Error loading config:", error);
                return state.config;
            }
        }
        
        // Save Config
        function saveConfig() {
            try {
                localStorage.setItem('ggestao_config', JSON.stringify(state.config));
                return true;
            } catch (error) {
                console.error("Error saving config:", error);
                return false;
            }
        }
        
        // Setup Dark Mode
        function setupDarkMode() {
            try {
                // Set initial dark mode state
                if (state.config.darkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    // Check user preference from system
                    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                        document.documentElement.classList.add('dark');
                        state.config.darkMode = true;
                    }
                }
                
                // Set up theme toggle button
                const themeToggleButton = document.getElementById('theme-toggle');
                const lightIcon = document.getElementById('theme-toggle-light-icon');
                const darkIcon = document.getElementById('theme-toggle-dark-icon');
                
                // Show the correct icon
                if (themeToggleButton && lightIcon && darkIcon) {
                    if (document.documentElement.classList.contains('dark')) {
                        lightIcon.classList.remove('hidden');
                        darkIcon.classList.add('hidden');
                    } else {
                        lightIcon.classList.add('hidden');
                        darkIcon.classList.remove('hidden');
                    }
                    
                    themeToggleButton.addEventListener('click', toggleDarkMode);
                }
                
                // Listen for system preference changes
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                    if (!state.config.darkModeManuallySet) {
                        if (event.matches) {
                            document.documentElement.classList.add('dark');
                        } else {
                            document.documentElement.classList.remove('dark');
                        }
                        
                        // Update icon
                        updateThemeIcon();
                        
                        // Update charts for dark mode
                        Object.values(state.charts).forEach(chart => {
                            if (chart) updateChartTheme(chart);
                        });
                    }
                });
            } catch (error) {
                console.error("Error setting up dark mode:", error);
            }
        }
        
        // Toggle Dark Mode
        function toggleDarkMode() {
            try {
                // Toggle dark mode class
                document.documentElement.classList.toggle('dark');
                
                // Update config
                state.config.darkMode = document.documentElement.classList.contains('dark');
                state.config.darkModeManuallySet = true;
                
                // Save config
                saveConfig();
                
                // Update icon
                updateThemeIcon();
                
                // Update charts for dark mode
                Object.values(state.charts).forEach(chart => {
                    if (chart) updateChartTheme(chart);
                });
            } catch (error) {
                console.error("Error toggling dark mode:", error);
            }
        }
        
        // Update Theme Icon
        function updateThemeIcon() {
            try {
                const lightIcon = document.getElementById('theme-toggle-light-icon');
                const darkIcon = document.getElementById('theme-toggle-dark-icon');
                
                if (lightIcon && darkIcon) {
                    if (document.documentElement.classList.contains('dark')) {
                        lightIcon.classList.remove('hidden');
                        darkIcon.classList.add('hidden');
                    } else {
                        lightIcon.classList.add('hidden');
                        darkIcon.classList.remove('hidden');
                    }
                }
            } catch (error) {
                console.error("Error updating theme icon:", error);
            }
        }
        
        // Setup Calendar Modal
        function setupCalendarModal() {
            try {
                // Calendar navigation buttons
                document.getElementById('prev-month')?.addEventListener('click', function() {
                    navigateCalendar(-1);
                });
                
                document.getElementById('next-month')?.addEventListener('click', function() {
                    navigateCalendar(1);
                });
                
                // Close calendar modal
                document.getElementById('close-calendar-modal')?.addEventListener('click', function() {
                    const calendarModal = document.getElementById('calendar-modal');
                    if (calendarModal) {
                        toggleElement(calendarModal, false);
                    }
                });
                
                // Cancel date range selection
                document.getElementById('cancel-date-range')?.addEventListener('click', function() {
                    const calendarModal = document.getElementById('calendar-modal');
                    if (calendarModal) {
                        toggleElement(calendarModal, false);
                    }
                });
                
                // Apply date range selection
                document.getElementById('apply-date-range')?.addEventListener('click', function() {
                    const calendarModal = document.getElementById('calendar-modal');
                    const customDateRange = document.getElementById('custom-date-range');
                    
                    if (calendarModal && state.calendar.startDate && state.calendar.endDate && customDateRange) {
                        // Format dates for display
                        const startDateFormatted = formatDate(state.calendar.startDate);
                        const endDateFormatted = formatDate(state.calendar.endDate);
                        
                        // Update custom date range display
                        customDateRange.textContent = `${startDateFormatted} a ${endDateFormatted}`;
                        
                        // Close the modal
                        toggleElement(calendarModal, false);
                        
                        // Update dashboard with the custom date range
                        // You would implement additional functionality here
                        showToast('Per√≠odo personalizado selecionado', 'success');
                    } else {
                        showToast('Selecione um per√≠odo v√°lido', 'error');
                    }
                });
            } catch (error) {
                console.error("Error setting up calendar modal:", error);
            }
        }
        
        // Navigate Calendar Month
        function navigateCalendar(direction) {
            try {
                // Update current month
                let newMonth = state.calendar.currentMonth + direction;
                let newYear = state.calendar.currentYear;
                
                if (newMonth < 0) {
                    newMonth = 11;
                    newYear--;
                } else if (newMonth > 11) {
                    newMonth = 0;
                    newYear++;
                }
                
                state.calendar.currentMonth = newMonth;
                state.calendar.currentYear = newYear;
                
                // Regenerate calendar days
                generateCalendarDays();
            } catch (error) {
                console.error("Error navigating calendar:", error);
            }
        }
        
        // Generate Calendar Days
        function generateCalendarDays() {
            try {
                const calendarDaysContainer = document.getElementById('calendar-days');
                const currentMonthYearEl = document.getElementById('current-month-year');
                
                if (!calendarDaysContainer || !currentMonthYearEl) {
                    console.warn("Calendar elements not found");
                    return;
                }
                
                // Update month/year display
                const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                currentMonthYearEl.textContent = `${monthNames[state.calendar.currentMonth]} ${state.calendar.currentYear}`;
                
                // Clear existing days
                calendarDaysContainer.innerHTML = '';
                
                // Get the first day of the month
                const firstDay = new Date(state.calendar.currentYear, state.calendar.currentMonth, 1);
                const startingDay = firstDay.getDay(); // Day of week (0-6)
                
                // Get the number of days in the month
                const daysInMonth = new Date(state.calendar.currentYear, state.calendar.currentMonth + 1, 0).getDate();
                
                // Get the current date for highlighting
                const today = new Date();
                const currentDate = today.getDate();
                const currentMonth = today.getMonth();
                const currentYear = today.getFullYear();
                
                // Add empty cells for days before the first day of the month
                for (let i = 0; i < startingDay; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = 'p-2 text-center';
                    calendarDaysContainer.appendChild(emptyCell);
                }
                
                // Add days of the month
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayCell = document.createElement('div');
                    dayCell.className = 'calendar-day p-2 text-center cursor-pointer';
                    
                    // Check if this is today's date
                    if (day === currentDate && state.calendar.currentMonth === currentMonth && state.calendar.currentYear === currentYear) {
                        dayCell.classList.add('current');
                    }
                    
                    // Check if this day is in the selected range
                    if (state.calendar.startDate && state.calendar.endDate) {
                        const thisDate = new Date(state.calendar.currentYear, state.calendar.currentMonth, day);
                        
                        if (thisDate >= state.calendar.startDate && thisDate <= state.calendar.endDate) {
                            dayCell.classList.add('selected');
                        }
                    }
                    
                    dayCell.textContent = day;
                    
                    // Add click event to select date
                    dayCell.addEventListener('click', function() {
                        selectDate(day);
                    });
                    
                    calendarDaysContainer.appendChild(dayCell);
                }
            } catch (error) {
                console.error("Error generating calendar days:", error);
            }
        }
        
        // Select Date in Calendar
        function selectDate(day) {
            try {
                const selectedDate = new Date(state.calendar.currentYear, state.calendar.currentMonth, day);
                
                const startDateInput = document.getElementById('start-date');
                const endDateInput = document.getElementById('end-date');
                
                // If no start date or both dates are already set, reset and set start date
                if (!state.calendar.startDate || (state.calendar.startDate && state.calendar.endDate)) {
                    state.calendar.startDate = selectedDate;
                    state.calendar.endDate = null;
                    
                    if (startDateInput) startDateInput.value = formatDate(selectedDate);
                    if (endDateInput) endDateInput.value = '';
                } 
                // If only start date is set, set end date (ensure it's after start date)
                else if (state.calendar.startDate && !state.calendar.endDate) {
                    if (selectedDate < state.calendar.startDate) {
                        state.calendar.endDate = state.calendar.startDate;
                        state.calendar.startDate = selectedDate;
                        
                        if (startDateInput) startDateInput.value = formatDate(selectedDate);
                        if (endDateInput) endDateInput.value = formatDate(state.calendar.endDate);
                    } else {
                        state.calendar.endDate = selectedDate;
                        
                        if (endDateInput) endDateInput.value = formatDate(selectedDate);
                    }
                }
                
                // Regenerate calendar to update selected dates
                generateCalendarDays();
            } catch (error) {
                console.error("Error selecting date:", error);
            }
        }
        
        // Format Date
        function formatDate(date) {
            if (!date) return '';
            return `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`;
        }
        
        // Setup Keyboard Shortcuts
        function setupKeyboardShortcuts() {
            try {
                document.addEventListener('keydown', function(e) {
                    // Check if focus is in an input, textarea, or similar
                    if (document.activeElement.tagName === 'INPUT' || 
                        document.activeElement.tagName === 'TEXTAREA' || 
                        document.activeElement.tagName === 'SELECT' ||
                        document.activeElement.isContentEditable) {
                        return;
                    }
                    
                    // Alt + M: Toggle menu
                    if (e.altKey && e.key === 'm') {
                        e.preventDefault();
                        toggleDrawer();
                    }
                    
                    // Ctrl + K: Open search
                    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                        e.preventDefault();
                        toggleSearchModal(true);
                    }
                    
                    // Escape: Close modals
                    if (e.key === 'Escape') {
                        const searchModal = document.getElementById('search-modal');
                        const calendarModal = document.getElementById('calendar-modal');
                        const manageFrontsModal = document.getElementById('manage-fronts-modal');
                        const confirmationModal = document.getElementById('confirmation-modal');
                        const keyboardShortcutsModal = document.getElementById('keyboard-shortcuts-modal');
                        
                        if (searchModal && !searchModal.classList.contains('hidden')) {
                            toggleSearchModal(false);
                        } else if (calendarModal && !calendarModal.classList.contains('hidden')) {
                            toggleElement(calendarModal, false);
                        } else if (manageFrontsModal && !manageFrontsModal.classList.contains('hidden')) {
                            toggleElement(manageFrontsModal, false);
                        } else if (confirmationModal && !confirmationModal.classList.contains('hidden')) {
                            toggleElement(confirmationModal, false);
                        } else if (keyboardShortcutsModal && !keyboardShortcutsModal.classList.contains('hidden')) {
                            toggleElement(keyboardShortcutsModal, false);
                        }
                    }
                    
                    // Alt + 1-5: Navigate to pages
                    if (e.altKey) {
                        switch (e.key) {
                            case '1':
                                e.preventDefault();
                                showPage('dashboard');
                                break;
                            case '2':
                                e.preventDefault();
                                showPage('entrega-hora');
                                break;
                            case '3':
                                e.preventDefault();
                                showPage('relatorios');
                                break;
                            case '4':
                                e.preventDefault();
                                showPage('metas');
                                break;
                            case '5':
                                e.preventDefault();
                                showPage('configuracoes');
                                break;
                        }
                    }
                    
                    // Ctrl + S: Save data
                    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                        e.preventDefault();
                        if (saveData()) {
                            showToast('Dados salvos com sucesso!', 'success');
                        } else {
                            showToast('Erro ao salvar dados', 'error');
                        }
                    }
                    
                    // Ctrl + D: Toggle dark mode
                    if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
                        e.preventDefault();
                        toggleDarkMode();
                    }
                    
                    // Ctrl + E: Export data
                    if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
                        e.preventDefault();
                        if (state.currentPage === 'dashboard') {
                            exportDashboard();
                        } else if (state.currentPage === 'entrega-hora') {
                            exportJSON();
                        }
                    }
                    
                    // Ctrl + N: Add new front
                    if ((e.ctrlKey || e.metaKey) && e.key === 'n' && state.currentPage === 'entrega-hora') {
                        e.preventDefault();
                        showManageFrontsModal();
                    }
                });
            } catch (error) {
                console.error("Error setting up keyboard shortcuts:", error);
            }
        }
        
        // Show Confirmation Modal
        function showConfirmationModal(title, message, confirmCallback) {
            try {
                const modal = document.getElementById('confirmation-modal');
                const modalTitle = document.getElementById('modal-title');
                const modalMessage = document.getElementById('modal-message');
                const modalConfirm = document.getElementById('modal-confirm');
                
                if (!modal || !modalTitle || !modalMessage || !modalConfirm) {
                    console.warn("Confirmation modal elements not found");
                    return;
                }
                
                // Set modal content
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                
                // Set confirm button callback
                modalConfirm.onclick = function() {
                    confirmCallback();
                    closeConfirmationModal();
                };
                
                // Show the modal
                toggleElement(modal, true);
            } catch (error) {
                console.error("Error showing confirmation modal:", error);
            }
        }
        
        // Close Confirmation Modal
        function closeConfirmationModal() {
            try {
                const modal = document.getElementById('confirmation-modal');
                if (modal) {
                    toggleElement(modal, false);
                }
            } catch (error) {
                console.error("Error closing confirmation modal:", error);
            }
        }
        
        // Show Manage Fronts Modal
        function showManageFrontsModal() {
            try {
                const modal = document.getElementById('manage-fronts-modal');
                if (!modal) {
                    console.warn("Manage fronts modal not found");
                    return;
                }
                
                // Update the list of fronts
                updateFrontsList();
                
                // Show the modal
                toggleElement(modal, true);
                
                // Set up event listeners for the modal
                const closeButton = document.getElementById('close-fronts-modal');
                const cancelButton = document.getElementById('cancel-fronts-modal');
                const addFrontButton = document.getElementById('add-front-btn');
                const newFrontInput = document.getElementById('new-front-input');
                
                if (closeButton) {
                    closeButton.onclick = function() {
                        toggleElement(modal, false);
                    };
                }
                
                if (cancelButton) {
                    cancelButton.onclick = function() {
                        toggleElement(modal, false);
                    };
                }
                
                if (addFrontButton && newFrontInput) {
                    addFrontButton.onclick = function() {
                        addNewFront(newFrontInput.value);
                    };
                    
                    newFrontInput.onkeydown = function(e) {
                        if (e.key === 'Enter') {
                            addNewFront(newFrontInput.value);
                        }
                    };
                }
            } catch (error) {
                console.error("Error showing manage fronts modal:", error);
            }
        }
        
        // Update Fronts List
        function updateFrontsList() {
            try {
                const frontsList = document.getElementById('fronts-list');
                if (!frontsList) {
                    console.warn("Fronts list element not found");
                    return;
                }
                
                // Clear existing list
                frontsList.innerHTML = '';
                
                // Add each front to the list
                state.fronts.forEach(front => {
                    const listItem = document.createElement('li');
                    listItem.className = 'flex justify-between items-center px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700';
                    
                    listItem.innerHTML = `
                        <span class="text-gray-800 dark:text-gray-200">Frente ${front}</span>
                        <button class="delete-front text-gray-600 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400" data-front="${front}">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    `;
                    
                    frontsList.appendChild(listItem);
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-front').forEach(button => {
                    button.addEventListener('click', function() {
                        const front = this.getAttribute('data-front');
                        showConfirmationModal(
                            'Excluir Frente',
                            `Tem certeza que deseja excluir a Frente ${front}? Todos os dados associados ser√£o perdidos.`,
                            () => deleteFront(front)
                        );
                    });
                });
            } catch (error) {
                console.error("Error updating fronts list:", error);
            }
        }
        
        // Add New Front
        function addNewFront(frontValue) {
            try {
                // Validate front value
                const front = frontValue.trim();
                if (!front) {
                    showToast('Por favor, insira um n√∫mero de frente v√°lido', 'error');
                    return;
                }
                
                // Check if front already exists
                if (state.fronts.includes(front)) {
                    showToast('Esta frente j√° existe', 'error');
                    return;
                }
                
                // Add the new front
                state.fronts.push(front);
                
                // Initialize data structures for the new front
                state.density[front] = {};
                state.trips[front] = {};
                state.delivery[front] = {};
                state.potential[front] = {};
                
                for (const hour of state.hours) {
                    state.density[front][hour] = 0;
                    state.trips[front][hour] = 0;
                    state.delivery[front][hour] = 0;
                    state.potential[front][hour] = 0;
                }
                
                // Initialize period summaries for the new front
                for (const period in state.timePeriodsMap) {
                    state.twoHourDelivery[period][front] = 0;
                    state.twoHourPotential[period][front] = 0;
                    state.difference[period][front] = 0;
                }
                
                // Update the fronts list
                updateFrontsList();
                
                // Clear the input
                const newFrontInput = document.getElementById('new-front-input');
                if (newFrontInput) {
                    newFrontInput.value = '';
                    newFrontInput.focus();
                }
                
                // Update the UI
                if (state.currentPage === 'entrega-hora') {
                    generateTimePeriodHTML();
                } else {
                    updateUI();
                }
                
                showToast(`Frente ${front} adicionada com sucesso`, 'success');
                
                // Save data
                saveData();
            } catch (error) {
                console.error("Error adding new front:", error);
                showToast('Erro ao adicionar nova frente', 'error');
            }
        }
        
        // Delete Front
        function deleteFront(front) {
            try {
                // Save current state for undo
                addToHistory('delete-front', {
                    front,
                    densityData: JSON.parse(JSON.stringify(state.density[front])),
                    tripsData: JSON.parse(JSON.stringify(state.trips[front])),
                    potentialData: JSON.parse(JSON.stringify(state.potential[front]))
                });
                
                // Remove the front from the list
                state.fronts = state.fronts.filter(f => f !== front);
                
                // Remove the front's data
                delete state.density[front];
                delete state.trips[front];
                delete state.delivery[front];
                delete state.potential[front];
                
                // Remove from period summaries
                for (const period in state.timePeriodsMap) {
                    delete state.twoHourDelivery[period][front];
                    delete state.twoHourPotential[period][front];
                    delete state.difference[period][front];
                }
                
                // Update the fronts list
                updateFrontsList();
                
                // Update the UI
                if (state.currentPage === 'entrega-hora') {
                    generateTimePeriodHTML();
                } else {
                    updateUI();
                }
                
                showToast(`Frente ${front} removida com sucesso`, 'success');
                
                // Save data
                saveData();
            } catch (error) {
                console.error("Error deleting front:", error);
                showToast('Erro ao remover frente', 'error');
            }
        }
        
        // Save Data to localStorage
        function saveData() {
            try {
                // Prepare data to save
                const dataToSave = {
                    fronts: state.fronts,
                    density: state.density,
                    trips: state.trips,
                    potential: state.potential,
                    timestamp: new Date().toISOString()
                };
                
                // Save to localStorage
                localStorage.setItem('ggestao_data', JSON.stringify(dataToSave));
                
                console.log("Data saved successfully");
                return true;
            } catch (error) {
                console.error("Error saving data:", error);
                showToast('Erro ao salvar dados', 'error');
                return false;
            }
        }
        
        // Load Saved Data from localStorage
        function loadSavedData() {
            try {
                const savedData = localStorage.getItem('ggestao_data');
                if (!savedData) {
                    console.log("No saved data found");
                    return false;
                }
                
                // Parse saved data
                const parsedData = JSON.parse(savedData);
                
                // Validate saved data
                if (!parsedData.fronts || !parsedData.density || !parsedData.trips) {
                    console.warn("Saved data is incomplete or invalid");
                    return false;
                }
                
                // Update state with saved data
                state.fronts = parsedData.fronts;
                state.density = parsedData.density;
                state.trips = parsedData.trips;
                state.potential = parsedData.potential || {}; // Handle potential being undefined in older saved data
                
                // Initialize potential data if missing
                for (const front of state.fronts) {
                    if (!state.potential[front]) {
                        state.potential[front] = {};
                        for (const hour of state.hours) {
                            state.potential[front][hour] = 0;
                        }
                    }
                }
                
                // Recalculate and update UI
                calculateDelivery();
                calculateTwoHourTotals();
                
                console.log("Data loaded successfully");
                return true;
            } catch (error) {
                console.error("Error loading saved data:", error);
                return false;
            }
        }
        
        // Load Initial Data
        function loadInitialData() {
            try {
                // Generate some random data for demonstration
                for (const front of state.fronts) {
                    for (const hour of state.hours) {
                        // Generate random density between 50 and 70
                        state.density[front][hour] = Math.round((50 + Math.random() * 20) * 100) / 100;
                        
                        // Generate random trips between 0 and 10, more during day, less at night
                        let maxTrips = 10;
                        if (hour >= 22 || hour < 6) {
                            maxTrips = 5; // Less trips at night
                        }
                        state.trips[front][hour] = Math.floor(Math.random() * maxTrips);
                        
                        // Set potential for odd hours (1, 3, 5, 7, etc.)
                        if (hour % 2 !== 0) {
                            state.potential[front][hour] = Math.round((120 + Math.random() * 60) * 10) / 10;
                        }
                    }
                }
                
                // Calculate delivery values
                calculateDelivery();
                calculateTwoHourTotals();
                
                // Save the initial data
                saveData();
                
                return true;
            } catch (error) {
                console.error("Error loading initial data:", error);
                return false;
            }
        }
        
        // Update Date and Time Widgets
        function updateDateTimeWidgets() {
            try {
                const headerDate = document.getElementById('header-date');
                if (headerDate) {
                    const now = new Date();
                    headerDate.textContent = now.toLocaleDateString('pt-BR', { 
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                }
            } catch (error) {
                console.error("Error updating date/time widgets:", error);
            }
        }
        
        // Show Toast Notification
        function showToast(message, type = 'info') {
            try {
                const toastContainer = document.getElementById('toast-container');
                if (!toastContainer) {
                    console.warn("Toast container element not found");
                    return;
                }
                
                // Create toast element
                const toast = document.createElement('div');
                toast.className = 'flex items-center w-full max-w-xs p-4 mb-3 rounded-lg shadow-lg';
                
                // Set background color based on type
                switch (type) {
                    case 'success':
                        toast.classList.add('bg-green-500', 'text-white');
                        break;
                    case 'error':
                        toast.classList.add('bg-red-500', 'text-white');
                        break;
                    case 'warning':
                        toast.classList.add('bg-yellow-500', 'text-white');
                        break;
                    default:
                        toast.classList.add('bg-blue-500', 'text-white');
                }
                
                // Add icon based on type
                let icon = '';
                switch (type) {
                    case 'success':
                        icon = `
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        `;
                        break;
                    case 'error':
                        icon = `
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        `;
                        break;
                    case 'warning':
                        icon = `
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                        `;
                        break;
                    default:
                        icon = `
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        `;
                }
                
                // Add content to toast
                toast.innerHTML = `
                    ${icon}
                    <div class="flex-1">${message}</div>
                    <button type="button" class="ml-2 text-white hover:text-gray-200 focus:outline-none">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                `;
                
                // Add toast to container
                toastContainer.appendChild(toast);
                
                // Add click event to close button
                const closeButton = toast.querySelector('button');
                if (closeButton) {
                    closeButton.onclick = function() {
                        toast.remove();
                    };
                }
                
                // Auto-remove toast after 5 seconds
                setTimeout(() => {
                    toast.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                    setTimeout(() => {
                        toast.remove();
                    }, 300);
                }, 5000);
            } catch (error) {
                console.error("Error showing toast:", error);
            }
        }
        
        // History Management for Undo/Redo functionality
        function addToHistory(actionType, data) {
            try {
                state.history.push({
                    actionType,
                    data,
                    timestamp: Date.now()
                });
                
                // Limit history size
                if (state.history.length > 50) {
                    state.history.shift();
                }
            } catch (error) {
                console.error("Error adding to history:", error);
            }
        }
    </script>
</body>
</html>
