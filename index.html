<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Entrega de Safra 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.0.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.2.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.25/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#5D5CDE',
                            '50': '#EEEEFF',
                            '100': '#D4D4F7',
                            '200': '#ACACEF',
                            '300': '#8584E7',
                            '400': '#5D5CDE',
                            '500': '#3635D5',
                            '600': '#2A29B0',
                            '700': '#211F8A',
                            '800': '#171664',
                            '900': '#0D0C3E'
                        },
                        secondary: {
                            DEFAULT: '#6B7280',
                            '50': '#F9FAFB',
                            '100': '#F3F4F6',
                            '200': '#E5E7EB',
                            '300': '#D1D5DB',
                            '400': '#9CA3AF',
                            '500': '#6B7280',
                            '600': '#4B5563',
                            '700': '#374151',
                            '800': '#1F2937',
                            '900': '#111827'
                        },
                        success: {
                            DEFAULT: '#10B981',
                            '50': '#ECFDF5',
                            '100': '#D1FAE5',
                            '200': '#A7F3D0',
                            '300': '#6EE7B7',
                            '400': '#34D399',
                            '500': '#10B981',
                            '600': '#059669',
                            '700': '#047857',
                            '800': '#065F46',
                            '900': '#064E3B'
                        },
                        warning: {
                            DEFAULT: '#F59E0B',
                            '50': '#FFFBEB',
                            '100': '#FEF3C7',
                            '200': '#FDE68A',
                            '300': '#FCD34D',
                            '400': '#FBBF24',
                            '500': '#F59E0B',
                            '600': '#D97706',
                            '700': '#B45309',
                            '800': '#92400E',
                            '900': '#78350F'
                        },
                        danger: {
                            DEFAULT: '#EF4444',
                            '50': '#FEF2F2',
                            '100': '#FEE2E2',
                            '200': '#FECACA',
                            '300': '#FCA5A5',
                            '400': '#F87171',
                            '500': '#EF4444',
                            '600': '#DC2626',
                            '700': '#B91C1C',
                            '800': '#991B1B',
                            '900': '#7F1D1D'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    },
                    boxShadow: {
                        'inner-sm': 'inset 0 1px 2px 0 rgba(0, 0, 0, 0.05)',
                        'soft': '0 2px 15px -3px rgba(0, 0, 0, 0.07), 0 10px 20px -2px rgba(0, 0, 0, 0.04)',
                        'card': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)'
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'progress': 'progress 1s ease-in-out infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'bounce-sm': 'bounce-sm 1s infinite'
                    },
                    keyframes: {
                        progress: {
                            '0%': { width: '0%' },
                            '100%': { width: '100%' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        'bounce-sm': {
                            '0%, 100%': {
                                transform: 'translateY(-2px)',
                                animationTimingFunction: 'cubic-bezier(0.8, 0, 1, 1)'
                            },
                            '50%': {
                                transform: 'translateY(0)',
                                animationTimingFunction: 'cubic-bezier(0, 0, 0.2, 1)'
                            }
                        }
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <style>
        [x-cloak] { display: none !important; }
        .input-number {
            -moz-appearance: textfield;
            appearance: textfield;
        }
        .input-number::-webkit-outer-spin-button,
        .input-number::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* Skeleton loading effect */
        .skeleton {
            animation: skeleton-loading 1.5s infinite;
            background-image: linear-gradient(90deg, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0));
            background-size: 200px 100%;
            background-repeat: no-repeat;
            background-position: -200px 0;
        }
        
        @keyframes skeleton-loading {
            100% { background-position: 200px 0; }
        }
        
        .dark .skeleton {
            animation: skeleton-loading-dark 1.5s infinite;
            background-image: linear-gradient(90deg, rgba(50, 50, 50, 0), rgba(50, 50, 50, 0.4), rgba(50, 50, 50, 0));
            background-size: 200px 100%;
            background-repeat: no-repeat;
            background-position: -200px 0;
        }
        
        @keyframes skeleton-loading-dark {
            100% { background-position: 200px 0; }
        }
        
        /* Transitions */
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
        }
        .dark ::-webkit-scrollbar-track {
            background: #374151;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #4B5563;
        }
        .dark ::-webkit-scrollbar-thumb:hover {
            background: #6B7280;
        }
        
        /* Tooltip styles */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltip-text {
            visibility: hidden;
            width: auto;
            min-width: 120px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            white-space: nowrap;
        }
        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: rgba(0, 0, 0, 0.8) transparent transparent transparent;
        }
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        .dark .tooltip .tooltip-text {
            background-color: rgba(255, 255, 255, 0.8);
            color: #000;
        }
        .dark .tooltip .tooltip-text::after {
            border-color: rgba(255, 255, 255, 0.8) transparent transparent transparent;
        }

        /* Dashboard card hover effects */
        .dashboard-card {
            transition: all 0.3s ease;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        /* Calendar styles */
        .calendar-day {
            transition: all 0.2s ease;
        }
        
        .calendar-day:hover:not(.disabled) {
            background-color: rgba(93, 92, 222, 0.1);
        }
        
        .calendar-day.selected {
            background-color: rgba(93, 92, 222, 0.2);
            font-weight: bold;
        }
        
        .calendar-day.current {
            border: 2px solid #5D5CDE;
        }
        
        .calendar-day.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        /* Accordion styles */
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .accordion-open .accordion-content {
            max-height: 1000px;
        }
        
        /* Slideshow styles */
        .slide {
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .slide.active {
            opacity: 1;
            transform: translateX(0);
        }
        
        .slide.inactive {
            opacity: 0;
            transform: translateX(100%);
            position: absolute;
        }
        
        /* Animation for achievements */
        @keyframes achievement-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .achievement-unlock {
            animation: achievement-pulse 0.5s ease-in-out;
        }
        
        /* Print styles */
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                background-color: white !important;
                color: black !important;
            }
            
            .print-full-width {
                width: 100% !important;
                max-width: 100% !important;
            }
            
            .print-break-after {
                page-break-after: always;
            }
        }
        
        /* Touch area increase for mobile */
        @media (max-width: 768px) {
            .touch-target {
                min-height: 44px;
                min-width: 44px;
            }
        }
        
        /* Dark mode transition */
        .dark-transition {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        /* Fancy focus rings */
        .focus-ring:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.5);
        }
        
        /* Custom checkbox */
        .custom-checkbox {
            position: relative;
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid #6B7280;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .custom-checkbox.checked {
            background-color: #5D5CDE;
            border-color: #5D5CDE;
        }
        
        .custom-checkbox.checked::after {
            content: '';
            position: absolute;
            left: 5px;
            top: 2px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }
        
        /* Weather icons */
        .weather-icon {
            filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.2));
        }
        
        .dark .weather-icon {
            filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.1));
        }
        
        /* Custom scrollbar for dropdown menus */
        .dropdown-scroll {
            max-height: 200px;
            overflow-y: auto;
            scrollbar-width: thin;
        }
        
        .dropdown-scroll::-webkit-scrollbar {
            width: 6px;
        }
        
        .dropdown-scroll::-webkit-scrollbar-thumb {
            background-color: #9CA3AF;
            border-radius: 3px;
        }
        
        .dark .dropdown-scroll::-webkit-scrollbar-thumb {
            background-color: #4B5563;
        }
        
        /* Grid background pattern */
        .grid-pattern {
            background-image: 
                linear-gradient(rgba(229, 231, 235, 0.5) 1px, transparent 1px),
                linear-gradient(90deg, rgba(229, 231, 235, 0.5) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .dark .grid-pattern {
            background-image: 
                linear-gradient(rgba(55, 65, 81, 0.5) 1px, transparent 1px),
                linear-gradient(90deg, rgba(55, 65, 81, 0.5) 1px, transparent 1px);
        }
        
        /* Glow effect for important elements */
        .glow {
            box-shadow: 0 0 15px rgba(93, 92, 222, 0.5);
        }
        
        .dark .glow {
            box-shadow: 0 0 15px rgba(93, 92, 222, 0.7);
        }
        
        /* Fancy number input */
        .fancy-number-input {
            position: relative;
        }
        
        .fancy-number-input button {
            position: absolute;
            right: 0;
            width: 20px;
            height: 50%;
            background-color: #E5E7EB;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        
        .fancy-number-input button:hover {
            background-color: #D1D5DB;
        }
        
        .fancy-number-input button:first-of-type {
            top: 0;
            border-top-right-radius: 4px;
        }
        
        .fancy-number-input button:last-of-type {
            bottom: 0;
            border-bottom-right-radius: 4px;
        }
        
        .dark .fancy-number-input button {
            background-color: #374151;
        }
        
        .dark .fancy-number-input button:hover {
            background-color: #4B5563;
        }
        
        /* Text gradient for headings */
        .text-gradient {
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            background-image: linear-gradient(to right, #5D5CDE, #4F46E5);
        }
        
        .dark .text-gradient {
            background-image: linear-gradient(to right, #818CF8, #6366F1);
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen transition-colors duration-200">
    <div class="drawer-wrapper relative">
        <!-- Left Side Drawer -->
        <div id="left-drawer" class="fixed left-0 top-0 h-full w-64 bg-white dark:bg-gray-800 shadow-lg transform -translate-x-full transition-transform duration-300 ease-in-out z-40">
            <div class="p-4 h-full flex flex-col">
                <!-- App Logo in Drawer -->
                <div class="flex items-center mb-8 mt-4">
                    <div class="h-10 w-10 rounded-md bg-primary flex items-center justify-center text-white font-bold text-xl shadow-md">GG</div>
                    <span class="ml-2 font-semibold text-xl text-gray-900 dark:text-gray-100">GGOMES-LOG</span>
                </div>
                
                <!-- Navigation Links -->
                <nav class="flex-1">
                    <ul class="space-y-1">
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="dashboard">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                                </svg>
                                Dashboard
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="entrega-hora">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                </svg>
                                Entrega por Hora
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="relatorios">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                Análises e Relatórios
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="metas">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Metas e Desempenho
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="configuracoes">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                Configurações
                            </a>
                        </li>
                    </ul>
                </nav>
                
                <!-- User section -->
                <div class="border-t border-gray-200 dark:border-gray-700 pt-4 mt-4">
                    <div class="flex items-center">
                        <div class="h-9 w-9 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-800 dark:text-blue-200 font-medium">GG</div>
                        <div class="ml-3">
                            <div class="font-medium text-gray-700 dark:text-gray-300">Gutemberg Gomes</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">Gerente de Operações</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Drawer Backdrop -->
        <div id="drawer-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden"></div>
        
        <!-- Main Content -->
        <div class="min-h-screen flex flex-col">
            <!-- Top Navigation Bar -->
            <header class="bg-white dark:bg-gray-800 shadow-md">
                <div class="container mx-auto px-4 py-3">
                    <div class="flex justify-between items-center">
                        <!-- Left Side: Menu Button + Logo -->
                        <div class="flex items-center">
                            <button id="menu-button" class="mr-4 p-2 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                                </svg>
                            </button>
                            <div class="flex items-center">
                                <div class="h-8 w-8 rounded-md bg-primary flex items-center justify-center text-white font-bold text-lg shadow-md">GG</div>
                                <span class="ml-2 font-semibold text-xl text-gray-900 dark:text-gray-100 hidden sm:inline-block">GGOMES-LOG</span>
                            </div>
                        </div>
                        
                        <!-- Right Side: Actions -->
                        <div class="flex items-center space-x-2 sm:space-x-4">
                            <!-- Current Date Display -->
                            <div class="hidden md:flex items-center mr-4 text-gray-600 dark:text-gray-300">
                                <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <span id="header-date" class="text-sm font-medium"></span>
                            </div>
                            
                            <!-- Search Button -->
                            <button id="search-button" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </button>
                            
                            <!-- Notifications -->
                            <div class="relative">
                                <button id="notifications-button" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                                    </svg>
                                    <span class="absolute top-0 right-0 h-4 w-4 bg-red-500 rounded-full text-xs text-white flex items-center justify-center">3</span>
                                </button>
                                
                                <!-- Notifications Dropdown -->
                                <div id="notifications-dropdown" class="absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-md shadow-lg z-20 hidden">
                                    <div class="p-3 border-b border-gray-200 dark:border-gray-700">
                                        <div class="flex justify-between items-center">
                                            <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300">Notificações</h3>
                                            <button class="text-xs text-primary hover:text-primary-600 dark:text-primary-300 dark:hover:text-primary-400">Marcar todas como lidas</button>
                                        </div>
                                    </div>
                                    <div class="max-h-80 overflow-y-auto dropdown-scroll">
                                        <a href="#" class="block p-3 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-red-100 dark:bg-red-900 flex items-center justify-center text-red-500 dark:text-red-300">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                    </svg>
                                                </div>
                                                <div class="ml-3">
                                                    <p class="text-sm text-gray-700 dark:text-gray-300"><span class="font-medium">Alerta:</span> Entrega abaixo de 50% do potencial na Frente 4001</p>
                                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Há 10 minutos</p>
                                                </div>
                                            </div>
                                        </a>
                                        <a href="#" class="block p-3 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-500 dark:text-blue-300">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
                                                    </svg>
                                                </div>
                                                <div class="ml-3">
                                                    <p class="text-sm text-gray-700 dark:text-gray-300"><span class="font-medium">Nova mensagem:</span> Carlos Mendes comentou sobre o período 14:00-16:00</p>
                                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Há 30 minutos</p>
                                                </div>
                                            </div>
                                        </a>
                                        <a href="#" class="block p-3 hover:bg-gray-50 dark:hover:bg-gray-700">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center text-green-500 dark:text-green-300">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                    </svg>
                                                </div>
                                                <div class="ml-3">
                                                    <p class="text-sm text-gray-700 dark:text-gray-300"><span class="font-medium">Meta atingida:</span> Frente 4012 superou a meta diária</p>
                                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Há 1 hora</p>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                    <div class="p-2 border-t border-gray-200 dark:border-gray-700">
                                        <a href="#" class="block text-center text-sm text-primary hover:text-primary-600 dark:text-primary-300 dark:hover:text-primary-400">Ver todas</a>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Theme Toggle -->
                            <button id="theme-toggle" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none">
                                <!-- Sun icon -->
                                <svg id="theme-toggle-light-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" />
                                </svg>
                                <!-- Moon icon -->
                                <svg id="theme-toggle-dark-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
                                </svg>
                            </button>
                            
                            <!-- Save Button -->
                            <button id="save-data" class="bg-primary hover:bg-primary-600 text-white px-3 py-2 rounded-md shadow transition duration-200 flex items-center">
                                <svg class="w-4 h-4 mr-1 sm:mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                                </svg>
                                <span class="hidden sm:inline">Salvar</span>
                            </button>
                            
                            <!-- User Menu -->
                            <div class="relative">
                                <button id="user-menu-button" class="flex text-sm bg-gray-100 dark:bg-gray-700 rounded-full focus:outline-none">
                                    <div class="h-8 w-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-800 dark:text-blue-200 font-medium">JS</div>
                                </button>
                                
                                <!-- User Menu Dropdown -->
                                <div id="user-menu-dropdown" class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg z-20 hidden">
                                    <div class="py-1">
                                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Perfil</a>
                                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Configurações</a>
                                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Suporte</a>
                                        <div class="border-t border-gray-100 dark:border-gray-700"></div>
                                        <a href="#" class="block px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700">Sair</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Search Modal -->
            <div id="search-modal" class="fixed inset-0 z-50 overflow-y-auto hidden">
                <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                    <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                        <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
                    </div>
                    <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full">
                        <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                            <div class="sm:flex sm:items-start">
                                <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                                    <div class="flex items-center justify-between">
                                        <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Pesquisa Rápida</h3>
                                        <button id="close-search-modal" class="text-gray-400 hover:text-gray-500 focus:outline-none">
                                            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>
                                    <div class="mt-4">
                                        <div class="relative">
                                            <input type="text" id="global-search" class="w-full p-3 pl-10 text-gray-900 dark:text-gray-100 bg-gray-100 dark:bg-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Pesquisar frentes, períodos, relatórios..." autofocus>
                                            <div class="absolute left-3 top-3 text-gray-400">
                                                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                                </svg>
                                            </div>
                                        </div>
                                        <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                                            Pressione <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded">Enter</kbd> para pesquisar ou <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded">ESC</kbd> para fechar
                                        </div>
                                    </div>
                                    
                                    <!-- Search Results -->
                                    <div class="mt-4 max-h-96 overflow-y-auto">
                                        <h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Resultados Recentes</h4>
                                        <div class="space-y-2">
                                            <a href="#" class="block p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700">
                                                <div class="flex items-center">
                                                    <div class="flex-shrink-0 h-8 w-8 rounded-md bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-500 dark:text-blue-300">
                                                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                                        </svg>
                                                    </div>
                                                    <div class="ml-3">
                                                        <p class="text-sm font-medium text-gray-900 dark:text-gray-100">Frente 4001</p>
                                                        <p class="text-xs text-gray-500 dark:text-gray-400">Entrega por Hora > Período 06:00-08:00</p>
                                                    </div>
                                                </div>
                                            </a>
                                            <a href="#" class="block p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700">
                                                <div class="flex items-center">
                                                    <div class="flex-shrink-0 h-8 w-8 rounded-md bg-green-100 dark:bg-green-900 flex items-center justify-center text-green-500 dark:text-green-300">
                                                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                                        </svg>
                                                    </div>
                                                    <div class="ml-3">
                                                        <p class="text-sm font-medium text-gray-900 dark:text-gray-100">Relatório Mensal</p>
                                                        <p class="text-xs text-gray-500 dark:text-gray-400">Análises e Relatórios > Desempenho Mensal</p>
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                            <button type="button" id="search-execute" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary text-base font-medium text-white hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:ml-3 sm:w-auto sm:text-sm">
                                Pesquisar
                            </button>
                            <button type="button" id="search-cancel" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                                Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content Container -->
            <main class="flex-1 p-4 container mx-auto">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-soft p-6 mb-6">
                    <div class="mb-6 flex flex-col md:flex-row md:justify-between md:items-center space-y-4 md:space-y-0">
                        <div>
                            <h1 id="page-title" class="text-2xl font-bold text-gray-900 dark:text-gray-100">Dashboard</h1>
                            <p id="page-subtitle" class="text-gray-600 dark:text-gray-400 mt-1">Visão geral do desempenho da safra 2025</p>
                        </div>
                        <div class="flex flex-wrap space-x-2 items-center">
                            <div class="relative">
                                <select id="period-selector" class="appearance-none bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white dark:focus:bg-gray-800 focus:border-primary transition duration-150">
                                    <option value="daily">Hoje</option>
                                    <option value="weekly">Esta Semana</option>
                                    <option value="monthly">Este Mês</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300">
                                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                        <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                    </svg>
                                </div>
                            </div>
                            <button id="custom-date-button" class="hidden items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <span id="custom-date-range">Selecionar Datas</span>
                            </button>
                            <button id="export-dashboard" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                                Exportar
                            </button>
                        </div>
                    </div>
                    
                    <!-- Dashboard Content -->
                    <div id="dashboard-content" class="page-content">
                        <!-- Dashboard Stats Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Entregue</p>
                                        <p class="text-2xl font-bold text-gray-900 dark:text-gray-100">3,245.8</p>
                                        <span class="inline-flex items-center text-sm font-medium text-green-600 dark:text-green-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                                            </svg>
                                            12.5% <span class="ml-1 text-gray-500 dark:text-gray-400">vs semana anterior</span>
                                        </span>
                                    </div>
                                    <div class="bg-primary-50 dark:bg-primary-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-primary-500 dark:text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-primary rounded-full h-2" style="width: 85%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">85% da meta mensal</p>
                                </div>
                            </div>
                            
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Eficiência Média</p>
                                        <p class="text-2xl font-bold text-gray-900 dark:text-gray-100">78.4%</p>
                                        <span class="inline-flex items-center text-sm font-medium text-red-600 dark:text-red-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
                                            </svg>
                                            3.2% <span class="ml-1 text-gray-500 dark:text-gray-400">vs semana anterior</span>
                                        </span>
                                    </div>
                                    <div class="bg-blue-50 dark:bg-blue-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-blue-500 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-blue-500 rounded-full h-2" style="width: 78.4%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Meta: 85%</p>
                                </div>
                            </div>
                            
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Viagens Realizadas</p>
                                        <p class="text-2xl font-bold text-gray-900 dark:text-gray-100">1,245</p>
                                        <span class="inline-flex items-center text-sm font-medium text-green-600 dark:text-green-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                                            </svg>
                                            8.7% <span class="ml-1 text-gray-500 dark:text-gray-400">vs semana anterior</span>
                                        </span>
                                    </div>
                                    <div class="bg-green-50 dark:bg-green-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-green-500 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-green-500 rounded-full h-2" style="width: 92%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">92% da meta mensal</p>
                                </div>
                            </div>
                            
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Densidade Média</p>
                                        <p class="text-2xl font-bold text-gray-900 dark:text-gray-100">68.92</p>
                                        <span class="inline-flex items-center text-sm font-medium text-green-600 dark:text-green-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                                            </svg>
                                            1.2% <span class="ml-1 text-gray-500 dark:text-gray-400">vs semana anterior</span>
                                        </span>
                                    </div>
                                    <div class="bg-purple-50 dark:bg-purple-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-purple-500 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-purple-500 rounded-full h-2" style="width: 88%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Meta: 65.00</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Dashboard Main Charts -->
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                            <div class="lg:col-span-2 bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Entrega por Período</h3>
                                    <div class="flex space-x-2">
                                        <button class="period-chart-option px-2 py-1 text-xs font-medium rounded bg-primary text-white" data-period="day">Dia</button>
                                        <button class="period-chart-option px-2 py-1 text-xs font-medium rounded bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600" data-period="week">Semana</button>
                                        <button class="period-chart-option px-2 py-1 text-xs font-medium rounded bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600" data-period="month">Mês</button>
                                    </div>
                                </div>
                                <div class="h-80">
                                    <canvas id="deliveryByPeriodChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Desempenho por Frente</h3>
                                <div class="h-80">
                                    <canvas id="frontPerformanceChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Dashboard Trips and Trucks per Hour -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Viagens por Frente</h3>
                                <div class="h-80">
                                    <canvas id="tripsByFrontChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Média de Caminhões/Hora por Frente</h3>
                                <div class="h-80">
                                    <canvas id="trucksPerHourChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Performance Metrics -->
                        <div class="grid grid-cols-1 gap-6 mb-6">
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Métricas de Desempenho</h3>
                                <div class="space-y-4">
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Eficiência Operacional</span>
                                            <span class="text-sm font-medium text-primary">82%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                                            <div class="bg-primary h-2.5 rounded-full" style="width: 82%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Utilização de Recursos</span>
                                            <span class="text-sm font-medium text-green-600 dark:text-green-400">94%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                                            <div class="bg-green-600 dark:bg-green-500 h-2.5 rounded-full" style="width: 94%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Cumprimento de Metas</span>
                                            <span class="text-sm font-medium text-yellow-600 dark:text-yellow-400">68%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                                            <div class="bg-yellow-600 dark:bg-yellow-500 h-2.5 rounded-full" style="width: 68%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Qualidade da Entrega</span>
                                            <span class="text-sm font-medium text-blue-600 dark:text-blue-400">88%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                                            <div class="bg-blue-600 dark:bg-blue-500 h-2.5 rounded-full" style="width: 88%"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                                    <div class="flex justify-between">
                                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Índice de Desempenho Geral</span>
                                        <span class="text-sm font-medium text-primary">83%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mt-2">
                                        <div class="bg-primary h-2.5 rounded-full" style="width: 83%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Entrega por Hora Content -->
                    <div id="entrega-hora-content" class="page-content hidden">
                        <div class="mb-6 flex flex-col md:flex-row md:justify-between md:items-center space-y-4 md:space-y-0">
                            <div>
                                <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100">Períodos de Entrega</h2>
                                <p class="text-gray-600 dark:text-gray-400 mt-1">Gerencie as entregas por períodos de 2 horas</p>
                            </div>
                            <div class="flex space-x-2">
                                <button id="manage-fronts" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                    Gerenciar Frentes
                                </button>
                                <button id="clear-period" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                    Limpar Período
                                </button>
                                <button id="copy-previous" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                    </svg>
                                    Copiar Anterior
                                </button>
                                <div class="dropdown relative">
                                    <button id="export-dropdown-btn" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                        </svg>
                                        Exportar
                                    </button>
                                    <div id="export-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg z-20">
                                        <div class="py-1">
                                            <a href="#" id="export-json" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Exportar JSON</a>
                                            <a href="#" id="export-csv" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Exportar CSV</a>
                                            <a href="#" id="export-pdf" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Exportar PDF</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Period Selection Tabs -->
                        <div class="mb-6 overflow-x-auto">
                            <div class="flex space-x-2 min-w-max">
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-primary text-white" data-period="06-08">06:00-08:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="08-10">08:00-10:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="10-12">10:00-12:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="12-14">12:00-14:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="14-16">14:00-16:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="16-18">16:00-18:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="18-20">18:00-20:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="20-22">20:00-22:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="22-00">22:00-00:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="00-02">00:00-02:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="02-04">02:00-04:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="04-06">04:00-06:00</button>
                            </div>
                        </div>
                        
                        <!-- Loading Indicator -->
                        <div id="loading-indicator" class="p-10 text-center hidden">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"></div>
                            <p class="mt-2 text-gray-600 dark:text-gray-400">Carregando dados...</p>
                        </div>
                        
                        <!-- Time Period Content -->
                        <div id="time-period-content">
                            <!-- Content will be generated dynamically by the generateTimePeriodHTML() function -->
                        </div>
                    </div>
                    
                    <!-- Relatórios Content -->
                    <div id="relatorios-content" class="page-content hidden">
                        <div class="text-center py-10">
                            <div class="inline-block p-6 bg-primary/10 dark:bg-primary/20 rounded-lg">
                                <svg class="w-16 h-16 mx-auto text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                <h2 class="mt-4 text-xl font-bold text-gray-900 dark:text-gray-100">Análises e Relatórios</h2>
                                <p class="mt-2 text-gray-600 dark:text-gray-400">Página em desenvolvimento. Relatórios detalhados e análises estarão disponíveis em breve.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Metas Content -->
                    <div id="metas-content" class="page-content hidden">
                        <div class="text-center py-10">
                            <div class="inline-block p-6 bg-primary/10 dark:bg-primary/20 rounded-lg">
                                <svg class="w-16 h-16 mx-auto text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <h2 class="mt-4 text-xl font-bold text-gray-900 dark:text-gray-100">Metas e Desempenho</h2>
                                <p class="mt-2 text-gray-600 dark:text-gray-400">Página em desenvolvimento. Acompanhamento de metas e desempenho estarão disponíveis em breve.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Configurações Content -->
                    <div id="configuracoes-content" class="page-content hidden">
                        <div class="max-w-2xl mx-auto">
                            <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100 mb-6">Configurações do Sistema</h2>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden mb-6">
                                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">Preferências Gerais</h3>
                                </div>
                                <div class="p-4 space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Salvar Automaticamente</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Salva automaticamente as alterações</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="auto-save-toggle" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Intervalo de Salvamento (minutos)</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Frequência do salvamento automático</p>
                                        </div>
                                        <div class="w-20">
                                            <input type="number" id="auto-save-interval" class="w-full px-3 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" min="1" max="60" value="5">
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Modo Escuro</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Alterna entre o tema claro e escuro</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="dark-mode-toggle" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden mb-6">
                                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">Notificações e Alertas</h3>
                                </div>
                                <div class="p-4 space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Limiar de Alerta (%)</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Porcentagem abaixo da meta para disparar alerta</p>
                                        </div>
                                        <div class="w-20">
                                            <input type="number" id="alert-threshold" class="w-full px-3 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" min="1" max="50" value="10">
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Alertas Sonoros</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Emite sons para alertas importantes</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="sound-alert-toggle" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Alertas Visuais</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Mostra notificações na interface</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="visual-alert-toggle" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-end space-x-3">
                                <button id="restore-defaults" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary transition duration-150">
                                    Restaurar Padrões
                                </button>
                                <button id="save-config" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition duration-150">
                                    Salvar Configurações
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            
            <!-- Footer -->
            <footer class="bg-white dark:bg-gray-800 shadow-md mt-auto">
                <div class="container mx-auto px-4 py-4">
                    <div class="flex flex-col md:flex-row justify-between items-center">
                        <div class="text-sm text-gray-600 dark:text-gray-400 mb-4 md:mb-0">
                            © 2025 GGOMES-LOG - Gestão de Entrega de Safra
                        </div>
                        <div class="flex space-x-4">
                            <a href="#" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary-300 transition-colors duration-150">Termos de Uso</a>
                            <a href="#" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary-300 transition-colors duration-150">Política de Privacidade</a>
                            <a href="#" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary-300 transition-colors duration-150">Suporte</a>
                            <span class="text-sm text-gray-400 dark:text-gray-500">Versão 2.1.0</span>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    
    <!-- Calendar Modal -->
    <div id="calendar-modal" class="fixed inset-0 z-50 overflow-y-auto hidden">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
            </div>
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Selecionar Período</h3>
                                <button id="close-calendar-modal" class="text-gray-400 hover:text-gray-500 focus:outline-none">
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="mt-4">
                                <div class="flex justify-between items-center mb-4">
                                    <button id="prev-month" class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                        </svg>
                                    </button>
                                    <div id="current-month-year" class="text-lg font-semibold text-gray-900 dark:text-gray-100">Julho 2024</div>
                                    <button id="next-month" class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                        </svg>
                                    </button>
                                </div>
                                
                                <div class="grid grid-cols-7 gap-1 text-center text-xs font-medium text-gray-500 dark:text-gray-400">
                                    <div>Dom</div>
                                    <div>Seg</div>
                                    <div>Ter</div>
                                    <div>Qua</div>
                                    <div>Qui</div>
                                    <div>Sex</div>
                                    <div>Sáb</div>
                                </div>
                                
                                <div id="calendar-days" class="grid grid-cols-7 gap-1 mt-2">
                                    <!-- Calendar days will be generated here -->
                                </div>
                                
                                <div class="mt-4">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Período Selecionado</span>
                                    </div>
                                    <div class="flex space-x-2">
                                        <div class="flex-1">
                                            <label for="start-date" class="block text-xs text-gray-500 dark:text-gray-400">Início</label>
                                            <input type="text" id="start-date" class="block w-full p-2 text-sm bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md" readonly>
                                        </div>
                                        <div class="flex-1">
                                            <label for="end-date" class="block text-xs text-gray-500 dark:text-gray-400">Fim</label>
                                            <input type="text" id="end-date" class="block w-full p-2 text-sm bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md" readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="apply-date-range" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary text-base font-medium text-white hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:ml-3 sm:w-auto sm:text-sm">
                        Aplicar
                    </button>
                    <button type="button" id="cancel-date-range" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div id="keyboard-shortcuts-modal" class="fixed inset-0 z-50 overflow-y-auto hidden">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
            </div>
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Atalhos de Teclado</h3>
                                <button id="close-shortcuts-modal" class="text-gray-400 hover:text-gray-500 focus:outline-none">
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="mt-4">
                                <div class="border-b border-gray-200 dark:border-gray-700">
                                    <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Navegação</h4>
                                    <ul class="mb-4 space-y-2">
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Abrir Menu</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Alt + M</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Pesquisar</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Ctrl + K</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Dashboard</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Alt + 1</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Entrega por Hora</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Alt + 2</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Análises</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Alt + 3</span>
                                        </li>
                                    </ul>
                                </div>
                                
                                <div class="border-b border-gray-200 dark:border-gray-700 pt-4">
                                    <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Ações</h4>
                                    <ul class="mb-4 space-y-2">
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Salvar Dados</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Ctrl + S</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Alterar Tema</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Ctrl + D</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Exportar Dados</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Ctrl + E</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Adicionar Nova Frente</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Ctrl + N</span>
                                        </li>
                                    </ul>
                                </div>
                                
                                <div class="pt-4">
                                    <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Edição de Dados</h4>
                                    <ul class="mb-2 space-y-2">
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Próximo Campo</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Tab</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Campo Anterior</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Shift + Tab</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Aumentar Valor</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">↑</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Diminuir Valor</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">↓</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 flex justify-end">
                    <button type="button" id="close-shortcuts-button" class="inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:w-auto sm:text-sm">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Manage Fronts Modal -->
    <div id="manage-fronts-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-lg w-full relative z-10 shadow-lg">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-gray-900 dark:text-gray-100">Gerenciar Frentes</h3>
                <button id="close-fronts-modal" class="text-gray-400 hover:text-gray-500 focus:outline-none">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="mb-6">
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Adicione ou remova frentes de entrega. Ao remover uma frente, todos os dados associados serão excluídos.</p>
                
                <!-- Add new front -->
                <div class="flex items-end space-x-2 mb-4">
                    <div class="flex-1">
                        <label for="new-front-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nova Frente</label>
                        <input type="text" id="new-front-input" placeholder="Ex: 4010" class="w-full px-3 py-2 text-base text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <button id="add-front-btn" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-600 transition duration-200 flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        Adicionar
                    </button>
                </div>
                
                <!-- Current fronts list -->
                <div class="border border-gray-200 dark:border-gray-700 rounded-md overflow-hidden">
                    <div class="bg-gray-50 dark:bg-gray-700 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                        Frentes Atuais
                    </div>
                    <ul id="fronts-list" class="divide-y divide-gray-200 dark:divide-gray-700 max-h-60 overflow-y-auto">
                        <!-- Fronts will be added here dynamically -->
                    </ul>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3">
                <button id="cancel-fronts-modal" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition duration-200">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full relative z-10 shadow-lg">
            <h3 id="modal-title" class="text-lg font-bold text-gray-900 dark:text-gray-100 mb-4">Confirmação</h3>
            <p id="modal-message" class="text-gray-700 dark:text-gray-300 mb-6">Tem certeza que deseja realizar esta ação?</p>
            <div class="flex justify-end space-x-3">
                <button id="modal-cancel" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition duration-200">
                    Cancelar
                </button>
                <button id="modal-confirm" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-600 transition duration-200">
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 flex flex-col-reverse space-y-reverse space-y-2"></div>

    <script>
        // Application State
        const state = {
            // Front data
            fronts: ['4001', '4002', '4007', '4009'],
            hours: [6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 0, 1, 2, 3, 4, 5],
            timePeriodsMap: {
                '06-08': [6, 7],
                '08-10': [8, 9],
                '10-12': [10, 11],
                '12-14': [12, 13],
                '14-16': [14, 15],
                '16-18': [16, 17],
                '18-20': [18, 19],
                '20-22': [20, 21],
                '22-00': [22, 23],
                '00-02': [0, 1],
                '02-04': [2, 3],
                '04-06': [4, 5]
            },
            
            // Delivery data
            density: {},
            trips: {},
            delivery: {},
            potential: {},
            
            // Period summaries
            twoHourDelivery: {},
            twoHourPotential: {},
            difference: {},
            
            // Charts
            charts: {
                frontSummary: null,
                hourlyPerformance: null,
                efficiencyGauge: null,
                periodComparison: null,
                deliveryByPeriod: null,
                frontPerformance: null,
                tripsByFront: null, // New chart for trips by front
                trucksPerHour: null // New chart for trucks per hour
            },
            
            // Current active period
            activePeriod: '06-08',
            currentPage: 'dashboard',
            
            // Config
            config: {
                autoSave: true,
                autoSaveInterval: 5, // minutes
                darkMode: false,
                alertThreshold: 10, // %
                soundAlerts: false,
                visualAlerts: true
            },
            
            // Date & calendar
            calendar: {
                startDate: null,
                endDate: null,
                currentMonth: new Date().getMonth(),
                currentYear: new Date().getFullYear()
            },
            
            // History
            history: [],
            
            // Analytics data
            analytics: {
                periodData: {
                    day: {
                        labels: ["06:00-08:00", "08:00-10:00", "10:00-12:00", "12:00-14:00", "14:00-16:00", "16:00-18:00",
                                "18:00-20:00", "20:00-22:00", "22:00-00:00", "00:00-02:00", "02:00-04:00", "04:00-06:00"],
                        datasets: [
                            { label: "Entregas", data: [553, 621, 485, 392, 574, 483, 420, 380, 350, 290, 310, 430] },
                            { label: "Potencial", data: [650, 650, 650, 650, 650, 650, 650, 650, 650, 650, 650, 650] }
                        ]
                    },
                    week: {
                        labels: ["Segunda", "Terça", "Quarta", "Quinta", "Sexta", "Sábado", "Domingo"],
                        datasets: [
                            { label: "Entregas", data: [2850, 3100, 2950, 3200, 3400, 2900, 2600] },
                            { label: "Potencial", data: [3500, 3500, 3500, 3500, 3500, 3500, 3500] }
                        ]
                    },
                    month: {
                        labels: ["Semana 1", "Semana 2", "Semana 3", "Semana 4"],
                        datasets: [
                            { label: "Entregas", data: [18000, 19500, 20100, 21000] },
                            { label: "Potencial", data: [22000, 22000, 22000, 22000] }
                        ]
                    }
                },
                frontPerformance: {
                    labels: ["F4001", "F4002", "F4007", "F4009"],
                    datasets: [
                        { label: "Eficiência", data: [85, 72, 91, 68, 76, 82] }
                    ]
                },
                // New analytics data for trips by front
                tripsByFront: {
                    labels: ["F4001", "F4002", "F4007", "F4009"],
                    datasets: [
                        { label: "Viagens", data: [250, 320, 180, 275] }
                    ]
                },
                // New analytics data for trucks per hour
                trucksPerHour: {
                    labels: ["F4001", "F4002", "F4007", "F4009"],
                    datasets: [
                        { label: "Caminhões/Hora", data: [5.2, 6.7, 3.8, 5.7] }
                    ]
                }
            }
        };
        
        // DOM Ready
        document.addEventListener('DOMContentLoaded', function() {
            initializeDataStructures();
            loadConfig();
            setupDarkMode();
            loadInitialData();
            setupUI();
            setupEventListeners();
            calculateDelivery();
            calculateTwoHourTotals();
            initializeCharts();
            updateDateTimeWidgets();
            
            // Set up auto-save interval
            if (state.config.autoSave) {
                setInterval(saveData, state.config.autoSaveInterval * 60 * 1000);
            }
            
            // Show dashboard as default
            showPage('dashboard');
            
            // Auto-load saved data if available
            loadSavedData();
            
            // Initialize the export dropdown toggle
            document.getElementById('export-dropdown-btn')?.addEventListener('click', function() {
                const dropdown = document.getElementById('export-dropdown');
                if (dropdown) {
                    toggleElement(dropdown);
                }
            });
            
            // Close dropdown when clicking elsewhere
            document.addEventListener('click', function(e) {
                if (!e.target.closest('#export-dropdown-btn')) {
                    const dropdown = document.getElementById('export-dropdown');
                    if (dropdown && !dropdown.classList.contains('hidden')) {
                        toggleElement(dropdown, false);
                    }
                }
            });
            
            // Connect restore defaults button
            document.getElementById('restore-defaults')?.addEventListener('click', function() {
                showConfirmationModal(
                    'Restaurar Padrões',
                    'Tem certeza que deseja restaurar todas as configurações para os valores padrão?',
                    restoreDefaultConfig
                );
            });
            
            // Connect save config button
            document.getElementById('save-config')?.addEventListener('click', function() {
                updateConfigFromUI();
                saveConfig();
                showToast('Configurações salvas com sucesso!', 'success');
            });
            
            // Setup Manage Fronts modal
            setupManageFrontsModal();
        });
        
        // Show Manage Fronts Modal
        function showManageFrontsModal() {
            const modal = document.getElementById('manage-fronts-modal');
            if (!modal) return;
            
            // Populate fronts list
            updateFrontsList();
            
            // Show modal
            toggleElement(modal, true);
        }

        // Update the list of fronts in the modal
        function updateFrontsList() {
            const frontsList = document.getElementById('fronts-list');
            if (!frontsList) return;
            
            // Clear existing list
            frontsList.innerHTML = '';
            
            // Add each front to the list
            state.fronts.forEach(front => {
                const listItem = document.createElement('li');
                listItem.className = 'px-4 py-3 bg-white dark:bg-gray-800 flex justify-between items-center';
                
                listItem.innerHTML = `
                    <span class="font-medium">Frente ${front}</span>
                    <button class="remove-front-btn text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300" data-front="${front}">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                    </button>
                `;
                
                frontsList.appendChild(listItem);
            });
            
            // Add event listeners to remove buttons
            document.querySelectorAll('.remove-front-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const front = this.getAttribute('data-front');
                    showConfirmationModal(
                        'Remover Frente',
                        `Tem certeza que deseja remover a Frente ${front}? Todos os dados associados serão excluídos.`,
                        () => removeFront(front)
                    );
                });
            });
        }

        // Add a new front
        function addFront() {
            const input = document.getElementById('new-front-input');
            if (!input) return;
            
            const frontValue = input.value.trim();
            
            // Validate input
            if (!frontValue) {
                showToast('Por favor, informe o número da frente', 'error');
                return;
            }
            
            // Check if it's a valid front number (numbers only)
            if (!/^\d+$/.test(frontValue)) {
                showToast('O número da frente deve conter apenas dígitos', 'error');
                return;
            }
            
            // Check if front already exists
            if (state.fronts.includes(frontValue)) {
                showToast(`A Frente ${frontValue} já existe`, 'error');
                return;
            }
            
            // Add to fronts array
            state.fronts.push(frontValue);
            
            // Initialize data structures for the new front
            state.density[frontValue] = {};
            state.trips[frontValue] = {};
            state.delivery[frontValue] = {};
            state.potential[frontValue] = {};
            
            for (const hour of state.hours) {
                state.density[frontValue][hour] = 0;
                state.trips[frontValue][hour] = 0;
                state.delivery[frontValue][hour] = 0;
                state.potential[frontValue][hour] = 0;
            }
            
            // Initialize period summaries for the new front
            for (const period in state.timePeriodsMap) {
                state.twoHourDelivery[period][frontValue] = 0;
                state.twoHourPotential[period][frontValue] = 0;
                state.difference[period][frontValue] = 0;
            }
            
            // Clear input
            input.value = '';
            
            // Update UI
            updateFrontsList();
            
            // Regenerate time period HTML to include the new front
            generateTimePeriodHTML();
            
            // Update charts that display front data
            updateCharts();
            
            showToast(`Frente ${frontValue} adicionada com sucesso`, 'success');
            
            // Add to history
            addToHistory('add-front', { front: frontValue });
            
            // Save data
            saveData();
        }

        // Remove a front
        function removeFront(front) {
            // Find the index of the front
            const index = state.fronts.indexOf(front);
            if (index === -1) return;
            
            // Remove from fronts array
            state.fronts.splice(index, 1);
            
            // Remove data structures
            delete state.density[front];
            delete state.trips[front];
            delete state.delivery[front];
            delete state.potential[front];
            
            // Remove from period summaries
            for (const period in state.timePeriodsMap) {
                delete state.twoHourDelivery[period][front];
                delete state.twoHourPotential[period][front];
                delete state.difference[period][front];
            }
            
            // Update UI
            updateFrontsList();
            
            // Regenerate time period HTML
            generateTimePeriodHTML();
            
            // Update charts
            updateCharts();
            
            showToast(`Frente ${front} removida com sucesso`, 'success');
            
            // Add to history
            addToHistory('remove-front', { front });
            
            // Save data
            saveData();
        }

        // Setup Manage Fronts modal events
        function setupManageFrontsModal() {
            const modal = document.getElementById('manage-fronts-modal');
            const closeButton = document.getElementById('close-fronts-modal');
            const cancelButton = document.getElementById('cancel-fronts-modal');
            const addButton = document.getElementById('add-front-btn');
            const newFrontInput = document.getElementById('new-front-input');
            
            if (closeButton) {
                closeButton.addEventListener('click', () => toggleElement(modal, false));
            }
            
            if (cancelButton) {
                cancelButton.addEventListener('click', () => toggleElement(modal, false));
            }
            
            if (addButton) {
                addButton.addEventListener('click', addFront);
            }
            
            if (newFrontInput) {
                newFrontInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addFront();
                    }
                });
            }
        }
        
        function restoreDefaultConfig() {
            // Reset to default values
            state.config = {
                autoSave: true,
                autoSaveInterval: 5,
                darkMode: false,
                alertThreshold: 10,
                soundAlerts: false,
                visualAlerts: true
            };
            
            // Update UI with restored values
            updateUIFromConfig();
            
            // Apply dark mode setting
            updateDarkMode();
            
            // Save the restored config
            saveConfig();
            
            showToast('Configurações restauradas para os valores padrão', 'success');
        }
        
        // Initialize data structures
        function initializeDataStructures() {
            // Initialize delivery data structures
            for (const front of state.fronts) {
                state.density[front] = {};
                state.trips[front] = {};
                state.delivery[front] = {};
                state.potential[front] = {};
                
                for (const hour of state.hours) {
                    state.density[front][hour] = 0;
                    state.trips[front][hour] = 0;
                    state.delivery[front][hour] = 0;
                    state.potential[front][hour] = 0;
                }
            }
            
            // Initialize period summaries
            for (const period in state.timePeriodsMap) {
                state.twoHourDelivery[period] = {};
                state.twoHourPotential[period] = {};
                state.difference[period] = {};
                
                for (const front of state.fronts) {
                    state.twoHourDelivery[period][front] = 0;
                    state.twoHourPotential[period][front] = 0;
                    state.difference[period][front] = 0;
                }
            }
        }
        
        // Setup Initial UI
        function setupUI() {
            // Setup navigation drawer links
            document.querySelectorAll('.drawer-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    showPage(page);
                    toggleDrawer(false);
                });
            });
            
            // Setup date/time widgets
            setInterval(updateDateTimeWidgets, 60000); // Update every minute
            
            // Setup dropdown event listeners
            setupDropdowns();
            
            // Set up period chart options
            document.querySelectorAll('.period-chart-option').forEach(option => {
                option.addEventListener('click', function() {
                    const period = this.getAttribute('data-period');
                    updatePeriodChart(period);
                    
                    // Update active state
                    document.querySelectorAll('.period-chart-option').forEach(btn => {
                        btn.classList.remove('bg-primary', 'text-white');
                        btn.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                    });
                    this.classList.add('bg-primary', 'text-white');
                    this.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                });
            });
            
            // Calendar setup
            setupCalendarModal();
        }
        
        // Setup Dropdowns
        function setupDropdowns() {
            // Notifications dropdown
            const notificationsButton = document.getElementById('notifications-button');
            const notificationsDropdown = document.getElementById('notifications-dropdown');
            
            if (notificationsButton && notificationsDropdown) {
                notificationsButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleElement(notificationsDropdown);
                });
            }
            
            // User menu dropdown
            const userMenuButton = document.getElementById('user-menu-button');
            const userMenuDropdown = document.getElementById('user-menu-dropdown');
            
            if (userMenuButton && userMenuDropdown) {
                userMenuButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleElement(userMenuDropdown);
                });
            }
            
            // Close dropdowns when clicking elsewhere
            document.addEventListener('click', function(e) {
                if (notificationsDropdown && notificationsDropdown.classList.contains('block')) {
                    toggleElement(notificationsDropdown, false);
                }
                
                if (userMenuDropdown && userMenuDropdown.classList.contains('block')) {
                    toggleElement(userMenuDropdown, false);
                }
            });
        }
        
        // Toggle element visibility
        function toggleElement(element, show) {
            if (!element) return;
            
            if (show === undefined) {
                element.classList.toggle('hidden');
                element.classList.toggle('block');
            } else if (show) {
                element.classList.remove('hidden');
                element.classList.add('block');
            } else {
                element.classList.add('hidden');
                element.classList.remove('block');
            }
        }
        
        // Setup Calendar Modal
        function setupCalendarModal() {
            const customDateButton = document.getElementById('custom-date-button');
            const calendarModal = document.getElementById('calendar-modal');
            const closeCalendarModal = document.getElementById('close-calendar-modal');
            const cancelDateRange = document.getElementById('cancel-date-range');
            const applyDateRange = document.getElementById('apply-date-range');
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            
            // Initialize calendar data
            state.calendar.startDate = new Date();
            state.calendar.endDate = new Date();
            
            // Show custom date button when custom period is selected
            document.getElementById('period-selector')?.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customDateButton.classList.remove('hidden');
                    customDateButton.classList.add('flex');
                } else {
                    customDateButton.classList.add('hidden');
                    customDateButton.classList.remove('flex');
                }
            });
            
            // Show calendar modal
            if (customDateButton) {
                customDateButton.addEventListener('click', function() {
                    generateCalendarDays();
                    toggleElement(calendarModal, true);
                });
            }
            
            // Close calendar modal
            if (closeCalendarModal) {
                closeCalendarModal.addEventListener('click', function() {
                    toggleElement(calendarModal, false);
                });
            }
            
            if (cancelDateRange) {
                cancelDateRange.addEventListener('click', function() {
                    toggleElement(calendarModal, false);
                });
            }
            
            // Apply date range
            if (applyDateRange) {
                applyDateRange.addEventListener('click', function() {
                    if (state.calendar.startDate && state.calendar.endDate) {
                        const startDateStr = formatDate(state.calendar.startDate);
                        const endDateStr = formatDate(state.calendar.endDate);
                        
                        document.getElementById('custom-date-range').textContent = `${startDateStr} - ${endDateStr}`;
                    }
                    
                    toggleElement(calendarModal, false);
                });
            }
            
            // Navigate months
            if (prevMonthBtn) {
                prevMonthBtn.addEventListener('click', function() {
                    state.calendar.currentMonth--;
                    if (state.calendar.currentMonth < 0) {
                        state.calendar.currentMonth = 11;
                        state.calendar.currentYear--;
                    }
                    generateCalendarDays();
                });
            }
            
            if (nextMonthBtn) {
                nextMonthBtn.addEventListener('click', function() {
                    state.calendar.currentMonth++;
                    if (state.calendar.currentMonth > 11) {
                        state.calendar.currentMonth = 0;
                        state.calendar.currentYear++;
                    }
                    generateCalendarDays();
                });
            }
        }
        
        // Generate Calendar Days
        function generateCalendarDays() {
            const calendarDays = document.getElementById('calendar-days');
            const currentMonthYear = document.getElementById('current-month-year');
            const startDateInput = document.getElementById('start-date');
            const endDateInput = document.getElementById('end-date');
            
            if (!calendarDays || !currentMonthYear) return;
            
            // Clear previous calendar
            calendarDays.innerHTML = '';
            
            // Set current month and year
            const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            currentMonthYear.textContent = `${monthNames[state.calendar.currentMonth]} ${state.calendar.currentYear}`;
            
            // Get first day of month and number of days
            const firstDay = new Date(state.calendar.currentYear, state.calendar.currentMonth, 1).getDay();
            const daysInMonth = new Date(state.calendar.currentYear, state.calendar.currentMonth + 1, 0).getDate();
            
            // Add empty cells for days before the first day of month
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'h-10';
                calendarDays.appendChild(emptyCell);
            }
            
            // Add days
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                const currentDate = new Date(state.calendar.currentYear, state.calendar.currentMonth, day);
                currentDate.setHours(0, 0, 0, 0);
                
                dayCell.className = 'calendar-day h-10 flex items-center justify-center rounded-full cursor-pointer';
                
                // Highlight current day
                if (currentDate.getTime() === today.getTime()) {
                    dayCell.classList.add('current');
                }
                
                // Highlight selected range
                if (state.calendar.startDate && state.calendar.endDate) {
                    if (currentDate.getTime() >= state.calendar.startDate.getTime() && 
                        currentDate.getTime() <= state.calendar.endDate.getTime()) {
                        dayCell.classList.add('selected');
                    }
                }
                
                dayCell.textContent = day;
                
                // Add click event to select date range
                dayCell.addEventListener('click', function() {
                    if (!state.calendar.startDate || (state.calendar.startDate && state.calendar.endDate)) {
                        // Start new selection
                        state.calendar.startDate = new Date(state.calendar.currentYear, state.calendar.currentMonth, day);
                        state.calendar.endDate = null;
                        
                        // Update inputs
                        if (startDateInput) startDateInput.value = formatDate(state.calendar.startDate);
                        if (endDateInput) endDateInput.value = '';
                    } else {
                        // Complete selection
                        const clickedDate = new Date(state.calendar.currentYear, state.calendar.currentMonth, day);
                        
                        // Ensure end date is after start date
                        if (clickedDate >= state.calendar.startDate) {
                            state.calendar.endDate = clickedDate;
                        } else {
                            state.calendar.endDate = state.calendar.startDate;
                            state.calendar.startDate = clickedDate;
                        }
                        
                        // Update inputs
                        if (startDateInput) startDateInput.value = formatDate(state.calendar.startDate);
                        if (endDateInput) endDateInput.value = formatDate(state.calendar.endDate);
                    }
                    
                    // Redraw calendar to show selection
                    generateCalendarDays();
                });
                
                calendarDays.appendChild(dayCell);
            }
        }
        
        // Format date to dd/mm/yyyy
        function formatDate(date) {
            if (!date) return '';
            return `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`;
        }
        
        // Update Date/Time Widgets
        function updateDateTimeWidgets() {
            const headerDate = document.getElementById('header-date');
            
            const now = new Date();
            const dateOptions = { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' };
            
            const formattedDate = now.toLocaleDateString('pt-BR', dateOptions);
            
            if (headerDate) headerDate.textContent = formattedDate;
        }
        
        // Setup Keyboard Shortcuts
        function setupKeyboardShortcuts() {
            // Listen for keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Ctrl + K for search
                if (e.ctrlKey && e.key === 'k') {
                    e.preventDefault();
                    toggleSearchModal(true);
                }
                
                // Alt + M for menu
                if (e.altKey && e.key === 'm') {
                    e.preventDefault();
                    toggleDrawer();
                }
                
                // Ctrl + S for save
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    saveData();
                    showToast('Dados salvos com sucesso!', 'success');
                }
                
                // Alt + 1-7 for navigation
                if (e.altKey && !isNaN(parseInt(e.key)) && parseInt(e.key) >= 1 && parseInt(e.key) <= 7) {
                    e.preventDefault();
                    const pages = ['dashboard', 'entrega-hora', 'relatorios', 'metas', 'configuracoes'];
                    const index = parseInt(e.key) - 1;
                    
                    if (index < pages.length) {
                        showPage(pages[index]);
                    }
                }
                
                // Ctrl + D for dark mode toggle
                if (e.ctrlKey && e.key === 'd') {
                    e.preventDefault();
                    toggleDarkMode();
                }
                
                // ? for keyboard shortcuts modal
                if (e.key === '?') {
                    e.preventDefault();
                    toggleKeyboardShortcutsModal(true);
                }
                
                // Escape key to close modals
                if (e.key === 'Escape') {
                    const activeModals = document.querySelectorAll('.fixed.inset-0:not(.hidden)');
                    if (activeModals.length > 0) {
                        e.preventDefault();
                        activeModals.forEach(modal => {
                            toggleElement(modal, false);
                        });
                    }
                }
            });
            
            // Setup keyboard shortcuts modal
            const keyboardShortcutsModal = document.getElementById('keyboard-shortcuts-modal');
            const closeShortcutsModal = document.getElementById('close-shortcuts-modal');
            const closeShortcutsButton = document.getElementById('close-shortcuts-button');
            
            if (closeShortcutsModal) {
                closeShortcutsModal.addEventListener('click', () => toggleKeyboardShortcutsModal(false));
            }
            
            if (closeShortcutsButton) {
                closeShortcutsButton.addEventListener('click', () => toggleKeyboardShortcutsModal(false));
            }
        }
        
        // Toggle Keyboard Shortcuts Modal
        function toggleKeyboardShortcutsModal(show) {
            const keyboardShortcutsModal = document.getElementById('keyboard-shortcuts-modal');
            toggleElement(keyboardShortcutsModal, show);
        }
        
        // Toggle Search Modal
        function toggleSearchModal(show) {
            const searchModal = document.getElementById('search-modal');
            toggleElement(searchModal, show);
            
            if (show) {
                // Focus search input
                setTimeout(() => {
                    const searchInput = document.getElementById('global-search');
                    if (searchInput) searchInput.focus();
                }, 100);
            }
            
            // Setup search modal events
            const closeSearchModal = document.getElementById('close-search-modal');
            const searchCancel = document.getElementById('search-cancel');
            
            if (closeSearchModal) {
                closeSearchModal.addEventListener('click', () => toggleSearchModal(false));
            }
            
            if (searchCancel) {
                searchCancel.addEventListener('click', () => toggleSearchModal(false));
            }
        }
        
        // Toggle Left Drawer
        function toggleDrawer(show) {
            const drawer = document.getElementById('left-drawer');
            const backdrop = document.getElementById('drawer-backdrop');
            
            if (!drawer || !backdrop) return;
            
            if (show === undefined) {
                show = drawer.classList.contains('-translate-x-full');
            }
            
            if (show) {
                drawer.classList.remove('-translate-x-full');
                backdrop.classList.remove('hidden');
            } else {
                drawer.classList.add('-translate-x-full');
                backdrop.classList.add('hidden');
            }
        }
        
        // Show Specific Page
        function showPage(page) {
            state.currentPage = page;
            
            // Update page title and subtitle
            const pageTitle = document.getElementById('page-title');
            const pageSubtitle = document.getElementById('page-subtitle');
            
            if (pageTitle && pageSubtitle) {
                switch (page) {
                    case 'dashboard':
                        pageTitle.textContent = 'Dashboard';
                        pageSubtitle.textContent = 'Visão geral do desempenho da safra 2025';
                        break;
                    case 'entrega-hora':
                        pageTitle.textContent = 'Entrega por Hora';
                        pageSubtitle.textContent = 'Gerencie o registro de entregas por período';
                        break;
                    case 'relatorios':
                        pageTitle.textContent = 'Análises e Relatórios';
                        pageSubtitle.textContent = 'Relatórios detalhados e análises de desempenho';
                        break;
                    case 'metas':
                        pageTitle.textContent = 'Metas e Desempenho';
                        pageSubtitle.textContent = 'Acompanhe o progresso das metas estabelecidas';
                        break;
                    case 'configuracoes':
                        pageTitle.textContent = 'Configurações';
                        pageSubtitle.textContent = 'Ajuste as configurações do sistema';
                        break;
                    default:
                        pageTitle.textContent = 'Dashboard';
                        pageSubtitle.textContent = 'Visão geral do desempenho da safra 2025';
                }
            }
            
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show selected page
            const pageContent = document.getElementById(`${page}-content`);
            if (pageContent) {
                pageContent.classList.remove('hidden');
                
                // If showing the entrega-hora page, generate the time period HTML
                if (page === 'entrega-hora') {
                    generateTimePeriodHTML();
                }
                
                // If showing the dashboard, update the dashboard with current data
                if (page === 'dashboard') {
                    updateDashboardCharts();
                }
            } else {
                // If page doesn't exist, show dashboard
                const dashboardContent = document.getElementById('dashboard-content');
                if (dashboardContent) dashboardContent.classList.remove('hidden');
            }
            
            // Update navigation active state
            document.querySelectorAll('.drawer-link').forEach(link => {
                link.classList.remove('bg-primary', 'text-white');
                link.classList.add('text-gray-700', 'dark:text-gray-300');
                
                if (link.getAttribute('data-page') === page) {
                    link.classList.add('bg-primary', 'text-white');
                    link.classList.remove('text-gray-700', 'dark:text-gray-300');
                }
            });
        }
        
        // Generate Time Period HTML
        function generateTimePeriodHTML() {
            showLoading(true);
            
            const timeContentDiv = document.getElementById('time-period-content');
            if (!timeContentDiv) {
                showLoading(false);
                return;
            }
            
            timeContentDiv.innerHTML = '';
            
            for (const period in state.timePeriodsMap) {
                const hours = state.timePeriodsMap[period];
                
                const periodDiv = document.createElement('div');
                periodDiv.id = `period-${period}`;
                periodDiv.className = 'period-content' + (period === state.activePeriod ? '' : ' hidden');
                
                let periodHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">`;
                
                for (const hour of hours) {
                    let hasPotencial = hour % 2 !== 0; // Only odd hours have potential
                    
                    periodHTML += `
                    <div class="overflow-hidden rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                        <div class="bg-gray-100 dark:bg-gray-700 py-2 px-4 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-primary dark:text-primary-300 flex items-center">
                                <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                ${hour.toString().padStart(2, '0')}:00
                            </h3>
                            <div class="flex items-center text-sm">
                                <span class="text-gray-600 dark:text-gray-400 flex items-center mr-3">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16" />
                                    </svg>
                                    <span class="total-viagens-badge" data-hour="${hour}">0</span> viagens
                                </span>
                                <span class="text-primary dark:text-primary-300 flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" />
                                    </svg>
                                    <span class="total-entrega-badge" data-hour="${hour}">0.00</span> ton
                                </span>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-800">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Frentes</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Densid.</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Viagens</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Entrega</th>
                                        ${hasPotencial ? '<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Pot. Hora</th>' : ''}
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">`;
                    
                    for (const front of state.fronts) {
                        periodHTML += `
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <span class="font-medium">${front}</span>
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <input type="number" class="input-number densidade w-20 text-right border rounded px-2 py-1 dark:bg-gray-700" data-hour="${hour}" data-front="${front}" value="${state.density[front][hour]}" min="0" step="0.01">
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <input type="number" class="input-number viagens w-20 text-right border rounded px-2 py-1 dark:bg-gray-700" data-hour="${hour}" data-front="${front}" value="${state.trips[front][hour]}" min="0">
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <span class="entrega font-medium ${state.delivery[front][hour] > 0 ? 'text-success-600 dark:text-success-400' : ''}" data-hour="${hour}" data-front="${front}">${state.delivery[front][hour].toFixed(2)}</span>
                                        </td>
                                        ${hasPotencial ? `<td class="px-4 py-3 whitespace-nowrap">
                                            <input type="number" class="input-number potencial w-20 text-right border rounded px-2 py-1 dark:bg-gray-700" data-hour="${hour}" data-front="${front}" value="${state.potential[front][hour]}" min="0">
                                        </td>` : ''}
                                    </tr>`;
                    }
                    
                    periodHTML += `
                                </tbody>
                                <tfoot class="bg-gray-50 dark:bg-gray-700 font-semibold">
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap">TOTAL</td>
                                        <td class="px-4 py-3 whitespace-nowrap"></td>
                                        <td class="px-4 py-3 whitespace-nowrap total-viagens" data-hour="${hour}">0</td>
                                        <td class="px-4 py-3 whitespace-nowrap total-entrega" data-hour="${hour}">0.00</td>
                                        ${hasPotencial ? `<td class="px-4 py-3 whitespace-nowrap total-potencial" data-hour="${hour}">0</td>` : ''}
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>`;
                }
                
                periodHTML += `
                </div>

                <!-- Period Summary -->
                <div class="mt-6 overflow-hidden rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                    <div class="bg-gray-100 dark:bg-gray-700 py-2 px-4">
                        <h3 class="text-lg font-semibold text-primary dark:text-primary-300 flex items-center">
                            <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            RESUMO DO PERÍODO (${period.substring(0, 2)}:00-${period.substring(3, 5)}:00)
                        </h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-800">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Frentes</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">2 Horas</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Potencial 2H</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Diferença</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">% Realizado</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">`;
                
                for (const front of state.fronts) {
                    periodHTML += `
                                <tr>
                                    <td class="px-4 py-3 whitespace-nowrap font-medium">F${front}</td>
                                    <td class="px-4 py-3 whitespace-nowrap duas-horas" data-period="${period}" data-front="${front}">0.00</td>
                                    <td class="px-4 py-3 whitespace-nowrap potencial-2h" data-period="${period}" data-front="${front}">0</td>
                                    <td class="px-4 py-3 whitespace-nowrap diff" data-period="${period}" data-front="${front}">0.00</td>
                                    <td class="px-4 py-3 whitespace-nowrap">
                                        <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5 relative overflow-hidden">
                                            <div class="percent-bar bg-primary h-2.5 rounded-full" data-period="${period}" data-front="${front}" style="width: 0%"></div>
                                        </div>
                                        <span class="text-xs mt-1 block text-right percent-text" data-period="${period}" data-front="${front}">0%</span>
                                    </td>
                                </tr>`;
                }
                
                periodHTML += `
                            </tbody>
                            <tfoot class="bg-gray-50 dark:bg-gray-700 font-semibold">
                                <tr>
                                    <td class="px-4 py-3 whitespace-nowrap">TOTAL</td>
                                    <td class="px-4 py-3 whitespace-nowrap total-duas-horas" data-period="${period}">0.00</td>
                                    <td class="px-4 py-3 whitespace-nowrap total-potencial-2h" data-period="${period}">0</td>
                                    <td class="px-4 py-3 whitespace-nowrap total-diff" data-period="${period}">0.00</td>
                                    <td class="px-4 py-3 whitespace-nowrap">
                                        <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5 relative overflow-hidden">
                                            <div class="total-percent-bar bg-primary h-2.5 rounded-full" data-period="${period}" style="width: 0%"></div>
                                        </div>
                                        <span class="text-xs mt-1 block text-right total-percent-text" data-period="${period}">0%</span>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>`;
                
                periodDiv.innerHTML = periodHTML;
                timeContentDiv.appendChild(periodDiv);
            }
            
            // Add event listeners to newly generated elements
            setupDynamicEventListeners();
            
            // Update the UI with current data
            updateUI();
            
            showLoading(false);
        }
        
        // Setup event listeners for dynamically generated elements
        function setupDynamicEventListeners() {
            // Input changes for delivery data
            document.querySelectorAll('.densidade, .viagens, .potencial').forEach(input => {
                input.addEventListener('input', handleDeliveryDataChange);
                
                // Add number input controls
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'ArrowUp') {
                        e.preventDefault();
                        const step = this.classList.contains('densidade') ? 0.01 : 1;
                        this.value = (parseFloat(this.value) + step).toFixed(this.classList.contains('densidade') ? 2 : 0);
                        this.dispatchEvent(new Event('input'));
                    } else if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        const step = this.classList.contains('densidade') ? 0.01 : 1;
                        const newValue = Math.max(0, parseFloat(this.value) - step);
                        this.value = newValue.toFixed(this.classList.contains('densidade') ? 2 : 0);
                        this.dispatchEvent(new Event('input'));
                    }
                });
            });
        }
        
        // Show/hide loading indicator
        function showLoading(show) {
            const loadingIndicator = document.getElementById('loading-indicator');
            const timeContentDiv = document.getElementById('time-period-content');
            
            if (loadingIndicator && timeContentDiv) {
                if (show) {
                    loadingIndicator.classList.remove('hidden');
                    timeContentDiv.classList.add('hidden');
                } else {
                    loadingIndicator.classList.add('hidden');
                    timeContentDiv.classList.remove('hidden');
                }
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Menu button for drawer
            document.getElementById('menu-button')?.addEventListener('click', toggleDrawer);
            
            // Drawer backdrop click to close
            document.getElementById('drawer-backdrop')?.addEventListener('click', () => toggleDrawer(false));
            
            // Search button
            document.getElementById('search-button')?.addEventListener('click', () => toggleSearchModal(true));
            
            // Main tab switching
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', switchMainTab);
            });
            
            // Time period tab switching
            document.querySelectorAll('.time-tab-btn').forEach(button => {
                button.addEventListener('click', switchTimePeriodTab);
            });
            
            // Save button
            document.getElementById('save-data')?.addEventListener('click', function() {
                saveData();
                showToast('Dados salvos com sucesso!', 'success');
            });
            
            // Clear period button
            document.getElementById('clear-period')?.addEventListener('click', function() {
                showConfirmationModal(
                    'Limpar Período',
                    `Tem certeza que deseja limpar todos os dados do período ${state.activePeriod}?`,
                    clearCurrentPeriod
                );
            });
            
            // Copy previous period button
            document.getElementById('copy-previous')?.addEventListener('click', copyPreviousPeriod);
            
            // Export buttons
            document.getElementById('export-json')?.addEventListener('click', exportJSON);
            document.getElementById('export-csv')?.addEventListener('click', exportCSV);
            document.getElementById('export-pdf')?.addEventListener('click', exportPDF);
            document.getElementById('export-dashboard')?.addEventListener('click', exportDashboard);
            
            // Modal buttons
            document.getElementById('modal-cancel')?.addEventListener('click', closeConfirmationModal);
            
            // Manage fronts button
            document.getElementById('manage-fronts')?.addEventListener('click', showManageFrontsModal);
        }
        
        // Tab Switching Functions
        function switchMainTab(e) {
            const tabId = e.target.closest('.tab-button').getAttribute('data-tab');
            
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active', 'text-primary', 'border-primary');
                button.classList.add('text-secondary-500', 'dark:text-secondary-400', 'border-transparent');
            });
            
            e.target.closest('.tab-button').classList.add('active', 'text-primary', 'border-primary');
            e.target.closest('.tab-button').classList.remove('text-secondary-500', 'dark:text-secondary-400', 'border-transparent');
            
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show selected tab content
            document.getElementById(`${tabId}-content`).classList.remove('hidden');
        }
        
        function switchTimePeriodTab(e) {
            const period = e.target.getAttribute('data-period');
            state.activePeriod = period;
            
            // Update time tab buttons
            document.querySelectorAll('.time-tab-btn').forEach(button => {
                button.classList.remove('bg-primary', 'text-white');
                button.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
            });
            
            e.target.classList.add('bg-primary', 'text-white');
            e.target.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
            
            // Hide all period contents
            document.querySelectorAll('.period-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show selected period content
            document.getElementById(`period-${period}`)?.classList.remove('hidden');
        }
        
        // Data Calculation Functions
        function calculateDelivery() {
            for (const front of state.fronts) {
                for (const hour of state.hours) {
                    state.delivery[front][hour] = state.density[front][hour] * state.trips[front][hour];
                }
            }
        }
        
        function calculateTwoHourTotals() {
            for (const period in state.timePeriodsMap) {
                const hours = state.timePeriodsMap[period];
                
                for (const front of state.fronts) {
                    // Calculate two-hour delivery total
                    state.twoHourDelivery[period][front] = hours.reduce((sum, hour) => {
                        return sum + state.delivery[front][hour];
                    }, 0);
                    
                    // Calculate two-hour potential (use the odd hour's potential * 2)
                    const oddHour = hours.find(h => h % 2 !== 0) || hours[0];
                    state.twoHourPotential[period][front] = state.potential[front][oddHour] * 2;
                    
                    // Calculate difference
                    state.difference[period][front] = 
                        state.twoHourDelivery[period][front] - state.twoHourPotential[period][front];
                }
            }
        }
        
        // Data Handling Functions
        function handleDeliveryDataChange(e) {
            const hour = parseInt(e.target.getAttribute('data-hour'));
            const front = e.target.getAttribute('data-front');
            const value = parseFloat(e.target.value) || 0;
            
            if (e.target.classList.contains('densidade')) {
                state.density[front][hour] = value;
            } else if (e.target.classList.contains('viagens')) {
                state.trips[front][hour] = value;
            } else if (e.target.classList.contains('potencial')) {
                state.potential[front][hour] = value;
            }
            
            calculateDelivery();
            calculateTwoHourTotals();
            updateUI();
            
            // Add to history for undo/redo functionality
            addToHistory('data-change', { hour, front, field: e.target.classList[1], value });
        }
        
        // Add action to history
        function addToHistory(action, data) {
            state.history.push({ action, data, timestamp: new Date() });
            
            // Limit history size to prevent memory issues
            if (state.history.length > 100) {
                state.history.shift();
            }
        }
        
        function clearCurrentPeriod() {
            const hours = state.timePeriodsMap[state.activePeriod];
            
            for (const front of state.fronts) {
                for (const hour of hours) {
                    state.density[front][hour] = 0;
                    state.trips[front][hour] = 0;
                    state.delivery[front][hour] = 0;
                    
                    // Reset potential only for odd hours
                    if (hour % 2 !== 0) {
                        state.potential[front][hour] = 0;
                    }
                }
            }
            
            calculateDelivery();
            calculateTwoHourTotals();
            generateTimePeriodHTML();
            updateUI();
            showToast(`Período ${state.activePeriod} limpo com sucesso`, 'success');
            
            // Add to history
            addToHistory('clear-period', { period: state.activePeriod });
        }
        
        function copyPreviousPeriod() {
            const periods = Object.keys(state.timePeriodsMap);
            const currentIndex = periods.indexOf(state.activePeriod);
            
            if (currentIndex <= 0) {
                showToast('Não há período anterior para copiar', 'error');
                return;
            }
            
            const previousPeriod = periods[currentIndex - 1];
            const previousHours = state.timePeriodsMap[previousPeriod];
            const currentHours = state.timePeriodsMap[state.activePeriod];
            
            // Copy data from previous period
            for (let i = 0; i < currentHours.length; i++) {
                const currentHour = currentHours[i];
                const previousHour = previousHours[i];
                
                for (const front of state.fronts) {
                    state.density[front][currentHour] = state.density[front][previousHour];
                    state.trips[front][currentHour] = state.trips[front][previousHour];
                    
                    // For odd hours, also copy potential
                    if (currentHour % 2 !== 0) {
                        state.potential[front][currentHour] = state.potential[front][previousHour];
                    }
                }
            }
            
            calculateDelivery();
            calculateTwoHourTotals();
            generateTimePeriodHTML();
            updateUI();
            showToast(`Dados copiados do período ${previousPeriod} para ${state.activePeriod}`, 'success');
            
            // Add to history
            addToHistory('copy-period', { from: previousPeriod, to: state.activePeriod });
        }
        
        // UI Update Functions
        function updateUI() {
            updateDeliveryUI();
            updateCharts();
        }
        
        function updateDeliveryUI() {
            // Update delivery values for all hours
            document.querySelectorAll('.entrega').forEach(element => {
                const hour = parseInt(element.getAttribute('data-hour'));
                const front = element.getAttribute('data-front');
                const value = state.delivery[front][hour];
                element.textContent = value.toFixed(2);
                
                // Add color based on value
                element.classList.remove('text-success-600', 'dark:text-success-400', 'text-danger-600', 'dark:text-danger-400');
                if (value > 0) {
                    element.classList.add('text-success-600', 'dark:text-success-400');
                }
            });
            
            // Update total trips and delivery per hour
            for (const hour of state.hours) {
                const totalTripsElement = document.querySelector(`.total-viagens[data-hour="${hour}"]`);
                const totalDeliveryElement = document.querySelector(`.total-entrega[data-hour="${hour}"]`);
                const totalPotentialElement = document.querySelector(`.total-potencial[data-hour="${hour}"]`);
                
                const totalTripsBadge = document.querySelector(`.total-viagens-badge[data-hour="${hour}"]`);
                const totalEntregaBadge = document.querySelector(`.total-entrega-badge[data-hour="${hour}"]`);
                
                if (totalTripsElement || totalTripsBadge) {
                    const totalTrips = state.fronts.reduce((sum, front) => sum + state.trips[front][hour], 0);
                    
                    if (totalTripsElement) totalTripsElement.textContent = totalTrips;
                    if (totalTripsBadge) totalTripsBadge.textContent = totalTrips;
                }
                
                if (totalDeliveryElement || totalEntregaBadge) {
                    const totalDelivery = state.fronts.reduce((sum, front) => sum + state.delivery[front][hour], 0);
                    
                    if (totalDeliveryElement) totalDeliveryElement.textContent = totalDelivery.toFixed(2);
                    if (totalEntregaBadge) totalEntregaBadge.textContent = totalDelivery.toFixed(2);
                }
                
                if (totalPotentialElement && hour % 2 !== 0) { // Only odd hours have potential
                    const totalPotential = state.fronts.reduce((sum, front) => sum + state.potential[front][hour], 0);
                    totalPotentialElement.textContent = totalPotential;
                }
            }
            
            // Update two-hour summaries for all periods
            for (const period in state.timePeriodsMap) {
                for (const front of state.fronts) {
                    const duasHorasElement = document.querySelector(`.duas-horas[data-period="${period}"][data-front="${front}"]`);
                    const potencial2hElement = document.querySelector(`.potencial-2h[data-period="${period}"][data-front="${front}"]`);
                    const diffElement = document.querySelector(`.diff[data-period="${period}"][data-front="${front}"]`);
                    const percentBar = document.querySelector(`.percent-bar[data-period="${period}"][data-front="${front}"]`);
                    const percentText = document.querySelector(`.percent-text[data-period="${period}"][data-front="${front}"]`);
                    
                    if (duasHorasElement && potencial2hElement && diffElement) {
                        duasHorasElement.textContent = state.twoHourDelivery[period][front].toFixed(2);
                        potencial2hElement.textContent = state.twoHourPotential[period][front];
                        diffElement.textContent = state.difference[period][front].toFixed(2);
                        
                        // Color-code differences
                        diffElement.classList.remove('text-red-600', 'dark:text-red-400', 'text-green-600', 'dark:text-green-400');
                        if (state.difference[period][front] < 0) {
                            diffElement.classList.add('text-red-600', 'dark:text-red-400');
                        } else if (state.difference[period][front] > 0) {
                            diffElement.classList.add('text-green-600', 'dark:text-green-400');
                        }
                        
                        // Update percentage bar
                        if (percentBar && percentText) {
                            const potential = state.twoHourPotential[period][front];
                            const actual = state.twoHourDelivery[period][front];
                            
                            let percentage = potential > 0 ? (actual / potential) * 100 : 0;
                            percentage = Math.min(percentage, 100); // Cap at 100%
                            
                            percentBar.style.width = `${percentage}%`;
                            percentText.textContent = `${percentage.toFixed(1)}%`;
                            
                            // Color the bar based on percentage
                            percentBar.classList.remove('bg-primary', 'bg-green-500', 'bg-yellow-500', 'bg-red-500');
                            
                            if (percentage >= 90) {
                                percentBar.classList.add('bg-green-500');
                            } else if (percentage >= 75) {
                                percentBar.classList.add('bg-primary');
                            } else if (percentage >= 50) {
                                percentBar.classList.add('bg-yellow-500');
                            } else {
                                percentBar.classList.add('bg-red-500');
                            }
                        }
                    }
                }
                
                // Update two-hour totals
                const totalDuasHorasElement = document.querySelector(`.total-duas-horas[data-period="${period}"]`);
                const totalPotencial2hElement = document.querySelector(`.total-potencial-2h[data-period="${period}"]`);
                const totalDiffElement = document.querySelector(`.total-diff[data-period="${period}"]`);
                const totalPercentBar = document.querySelector(`.total-percent-bar[data-period="${period}"]`);
                const totalPercentText = document.querySelector(`.total-percent-text[data-period="${period}"]`);
                
                if (totalDuasHorasElement && totalPotencial2hElement && totalDiffElement) {
                    const totalDuasHoras = state.fronts.reduce(
                        (sum, front) => sum + state.twoHourDelivery[period][front], 0
                    );
                    const totalPotencial2h = state.fronts.reduce(
                        (sum, front) => sum + state.twoHourPotential[period][front], 0
                    );
                    const totalDiff = state.fronts.reduce(
                        (sum, front) => sum + state.difference[period][front], 0
                    );
                    
                    totalDuasHorasElement.textContent = totalDuasHoras.toFixed(2);
                    totalPotencial2hElement.textContent = totalPotencial2h;
                    totalDiffElement.textContent = totalDiff.toFixed(2);
                    
                    // Color-code total difference
                    totalDiffElement.classList.remove('text-red-600', 'dark:text-red-400', 'text-green-600', 'dark:text-green-400');
                    if (totalDiff < 0) {
                        totalDiffElement.classList.add('text-red-600', 'dark:text-red-400');
                    } else if (totalDiff > 0) {
                        totalDiffElement.classList.add('text-green-600', 'dark:text-green-400');
                    }
                    
                    // Update total percentage bar
                    if (totalPercentBar && totalPercentText) {
                        let percentage = totalPotencial2h > 0 ? (totalDuasHoras / totalPotencial2h) * 100 : 0;
                        percentage = Math.min(percentage, 100); // Cap at 100%
                        
                        totalPercentBar.style.width = `${percentage}%`;
                        totalPercentText.textContent = `${percentage.toFixed(1)}%`;
                        
                        // Color the bar based on percentage
                        totalPercentBar.classList.remove('bg-primary', 'bg-green-500', 'bg-yellow-500', 'bg-red-500');
                        
                        if (percentage >= 90) {
                            totalPercentBar.classList.add('bg-green-500');
                        } else if (percentage >= 75) {
                            totalPercentBar.classList.add('bg-primary');
                        } else if (percentage >= 50) {
                            totalPercentBar.classList.add('bg-yellow-500');
                        } else {
                            totalPercentBar.classList.add('bg-red-500');
                        }
                    }
                }
            }
        }
        
        // Chart Functions
        function initializeCharts() {
            // Check if Chart.js is loaded
            if (typeof Chart === 'undefined') {
                console.error('Chart.js is not loaded. Charts will not be initialized.');
                return;
            }
            
            // Check if the ChartDataLabels plugin is loaded
            if (typeof ChartDataLabels === 'undefined') {
                console.warn('ChartDataLabels plugin is not loaded. Charts will not have data labels.');
            } else {
                // Register Chart.js plugins
                Chart.register(ChartDataLabels);
            }
            
            // Front Summary Chart
            const frontSummaryCtx = document.getElementById('frontSummaryChart')?.getContext('2d');
            if (frontSummaryCtx) {
                state.charts.frontSummary = new Chart(frontSummaryCtx, {
                    type: 'bar',
                    data: {
                        labels: state.fronts.map(front => `F${front}`),
                        datasets: [{
                            label: 'Entregas (toneladas)',
                            data: Array(state.fronts.length).fill(0),
                            backgroundColor: 'rgba(93, 92, 222, 0.7)',
                            borderColor: 'rgba(93, 92, 222, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Toneladas'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.raw.toFixed(2)} ton`;
                                    }
                                }
                            },
                            legend: {
                                position: 'top'
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value.toFixed(1) + ' t',
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            }
            
            // Hourly Performance Chart
            const hourlyPerformanceCtx = document.getElementById('hourlyPerformanceChart')?.getContext('2d');
            if (hourlyPerformanceCtx) {
                state.charts.hourlyPerformance = new Chart(hourlyPerformanceCtx, {
                    type: 'line',
                    data: {
                        labels: state.hours.slice(0, 12).map(hour => `${hour.toString().padStart(2, '0')}:00`),
                        datasets: [
                            {
                                label: 'Entregas',
                                data: Array(12).fill(0),
                                backgroundColor: 'rgba(93, 92, 222, 0.2)',
                                borderColor: 'rgba(93, 92, 222, 1)',
                                borderWidth: 2,
                                tension: 0.4
                            },
                            {
                                label: 'Potencial',
                                data: Array(12).fill(0),
                                backgroundColor: 'rgba(16, 185, 129, 0.2)',
                                borderColor: 'rgba(16, 185, 129, 1)',
                                borderWidth: 2,
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Toneladas'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Horário'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.raw.toFixed(2)} ton`;
                                    }
                                }
                            },
                            legend: {
                                position: 'top'
                            },
                            datalabels: {
                                display: false
                            }
                        }
                    }
                });
            }
            
            // Efficiency Gauge Chart (Using horizontal bar chart as a gauge)
            const efficiencyGaugeCtx = document.getElementById('efficiencyGaugeChart')?.getContext('2d');
            if (efficiencyGaugeCtx) {
                state.charts.efficiencyGauge = new Chart(efficiencyGaugeCtx, {
                    type: 'bar',
                    data: {
                        labels: state.fronts.map(front => `F${front}`),
                        datasets: [{
                            label: 'Eficiência (%)',
                            data: Array(state.fronts.length).fill(0),
                            backgroundColor: state.fronts.map(() => getEfficiencyColor(0)),
                            borderColor: state.fronts.map(() => getEfficiencyColor(0, true)),
                            borderWidth: 1,
                            barPercentage: 0.8,
                            categoryPercentage: 0.8
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Porcentagem (%)'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `Eficiência: ${context.raw.toFixed(1)}%`;
                                    }
                                }
                            },
                            legend: {
                                display: false
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'end',
                                formatter: (value) => value.toFixed(1) + '%',
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
                
                // Use custom function to update efficiency colors
                updateEfficiencyColors(state.charts.efficiencyGauge);
            }
            
            // Delivery by Period Chart for Dashboard
            const deliveryByPeriodCtx = document.getElementById('deliveryByPeriodChart')?.getContext('2d');
            if (deliveryByPeriodCtx) {
                const periodLabels = state.analytics.periodData.day.labels;
                const deliveryData = state.analytics.periodData.day.datasets[0].data;
                const potentialData = state.analytics.periodData.day.datasets[1].data;
                
                state.charts.deliveryByPeriod = new Chart(deliveryByPeriodCtx, {
                    type: 'bar',
                    data: {
                        labels: periodLabels,
                        datasets: [
                            {
                                label: 'Entregas',
                                data: deliveryData,
                                backgroundColor: 'rgba(93, 92, 222, 0.7)',
                                borderColor: 'rgba(93, 92, 222, 1)',
                                borderWidth: 1,
                                barPercentage: 0.7,
                                categoryPercentage: 0.9,
                                order: 2
                            },
                            {
                                label: 'Potencial',
                                data: potentialData,
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                borderColor: 'rgba(16, 185, 129, 1)',
                                borderWidth: 1,
                                borderDash: [5, 5],
                                type: 'line',
                                fill: false,
                                pointStyle: 'rectRounded',
                                pointRadius: 5,
                                pointHoverRadius: 7,
                                tension: 0.4,
                                order: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Toneladas'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Períodos'
                                },
                                ticks: {
                                    // Make x-axis labels more readable by using a smaller font or rotating them
                                    font: {
                                        size: 9
                                    },
                                    maxRotation: 45,
                                    minRotation: 45
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.raw.toFixed(2)} ton`;
                                    }
                                }
                            },
                            legend: {
                                position: 'top'
                            },
                            datalabels: {
                                display: function(context) {
                                    // Only show data labels for the bar dataset
                                    return context.datasetIndex === 0;
                                },
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value.toFixed(0) + ' t',
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold',
                                    size: 9
                                },
                                rotation: -45
                            }
                        }
                    }
                });
            }
            
            // Front Performance Chart for Dashboard
            const frontPerformanceCtx = document.getElementById('frontPerformanceChart')?.getContext('2d');
            if (frontPerformanceCtx) {
                const frontLabels = state.analytics.frontPerformance.labels;
                const efficiencyData = state.analytics.frontPerformance.datasets[0].data;
                
                state.charts.frontPerformance = new Chart(frontPerformanceCtx, {
                    type: 'bar',
                    data: {
                        labels: frontLabels,
                        datasets: [
                            {
                                label: 'Eficiência (%)',
                                data: efficiencyData,
                                backgroundColor: efficiencyData.map(value => getEfficiencyColorGradient(value)),
                                borderWidth: 0,
                                borderRadius: 4,
                                barPercentage: 0.6,
                                categoryPercentage: 0.8
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Eficiência (%)'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `Eficiência: ${context.raw}%`;
                                    }
                                }
                            },
                            legend: {
                                display: false
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value + '%',
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            }
            
            // NEW: Trips by Front Chart
            const tripsByFrontCtx = document.getElementById('tripsByFrontChart')?.getContext('2d');
            if (tripsByFrontCtx) {
                const frontLabels = state.analytics.tripsByFront.labels;
                const tripsData = state.analytics.tripsByFront.datasets[0].data;
                
                state.charts.tripsByFront = new Chart(tripsByFrontCtx, {
                    type: 'bar',
                    data: {
                        labels: frontLabels,
                        datasets: [
                            {
                                label: 'Viagens Entregues',
                                data: tripsData,
                                backgroundColor: 'rgba(14, 165, 233, 0.7)', // Sky blue color
                                borderColor: 'rgba(14, 165, 233, 1)',
                                borderWidth: 1,
                                borderRadius: 4,
                                barPercentage: 0.6,
                                categoryPercentage: 0.8
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Número de Viagens'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `Viagens: ${context.raw}`;
                                    }
                                }
                            },
                            legend: {
                                display: false
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value,
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            }
            
            // NEW: Trucks per Hour Chart
            const trucksPerHourCtx = document.getElementById('trucksPerHourChart')?.getContext('2d');
            if (trucksPerHourCtx) {
                const frontLabels = state.analytics.trucksPerHour.labels;
                const trucksData = state.analytics.trucksPerHour.datasets[0].data;
                
                state.charts.trucksPerHour = new Chart(trucksPerHourCtx, {
                    type: 'bar',
                    data: {
                        labels: frontLabels,
                        datasets: [
                            {
                                label: 'Caminhões por Hora',
                                data: trucksData,
                                backgroundColor: 'rgba(249, 115, 22, 0.7)', // Orange color
                                borderColor: 'rgba(249, 115, 22, 1)',
                                borderWidth: 1,
                                borderRadius: 4,
                                barPercentage: 0.6,
                                categoryPercentage: 0.8
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Caminhões/Hora'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `Média: ${context.raw.toFixed(1)} caminhões/h`;
                                    }
                                }
                            },
                            legend: {
                                display: false
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value.toFixed(1),
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            }
            
            // Apply dark mode to charts if needed
            if (document.documentElement.classList.contains('dark')) {
                if (state.charts.frontSummary) updateChartTheme(state.charts.frontSummary);
                if (state.charts.hourlyPerformance) updateChartTheme(state.charts.hourlyPerformance);
                if (state.charts.efficiencyGauge) updateChartTheme(state.charts.efficiencyGauge);
                if (state.charts.deliveryByPeriod) updateChartTheme(state.charts.deliveryByPeriod);
                if (state.charts.frontPerformance) updateChartTheme(state.charts.frontPerformance);
                if (state.charts.tripsByFront) updateChartTheme(state.charts.tripsByFront);
                if (state.charts.trucksPerHour) updateChartTheme(state.charts.trucksPerHour);
            }
        }
        
        function updatePeriodChart(period) {
            if (!state.charts.deliveryByPeriod) return;
            
            // Update chart data based on selected period
            const periodData = state.analytics.periodData[period];
            
            state.charts.deliveryByPeriod.data.labels = periodData.labels;
            state.charts.deliveryByPeriod.data.datasets[0].data = periodData.datasets[0].data;
            state.charts.deliveryByPeriod.data.datasets[1].data = periodData.datasets[1].data;
            
            state.charts.deliveryByPeriod.update();
        }
        
        function getEfficiencyColor(value, isBorder = false) {
            const alpha = isBorder ? 1 : 0.7;
            
            if (value >= 90) {
                return `rgba(16, 185, 129, ${alpha})`;  // Green
            } else if (value >= 75) {
                return `rgba(93, 92, 222, ${alpha})`;   // Primary
            } else if (value >= 50) {
                return `rgba(245, 158, 11, ${alpha})`;  // Yellow
            } else {
                return `rgba(239, 68, 68, ${alpha})`;   // Red
            }
        }
        
        function getEfficiencyColorGradient(value) {
            if (value >= 90) {
                return 'rgba(16, 185, 129, 0.7)';  // Green
            } else if (value >= 75) {
                return 'rgba(93, 92, 222, 0.7)';   // Primary
            } else if (value >= 50) {
                return 'rgba(245, 158, 11, 0.7)';  // Yellow
            } else {
                return 'rgba(239, 68, 68, 0.7)';   // Red
            }
        }
        
        function updateEfficiencyColors(chart) {
            if (!chart) return;
            
            const dataset = chart.data.datasets[0];
            dataset.backgroundColor = dataset.data.map(value => getEfficiencyColor(value));
            dataset.borderColor = dataset.data.map(value => getEfficiencyColor(value, true));
            
            chart.update();
        }
        
        function updateChartTheme(chart) {
            if (!chart) return;
            
            const isDark = document.documentElement.classList.contains('dark');
            const textColor = isDark ? '#E5E7EB' : '#374151';
            const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
            
            // Check if scales and its properties exist before updating
            if (chart.options.scales.x) {
                if (chart.options.scales.x.grid) chart.options.scales.x.grid.color = gridColor;
                if (chart.options.scales.x.ticks) chart.options.scales.x.ticks.color = textColor;
            }
            
            if (chart.options.scales.y) {
                if (chart.options.scales.y.grid) chart.options.scales.y.grid.color = gridColor;
                if (chart.options.scales.y.ticks) chart.options.scales.y.ticks.color = textColor;
            }
            
            // Check if plugins and its properties exist before updating
            if (chart.options.plugins) {
                if (chart.options.plugins.title) chart.options.plugins.title.color = textColor;
                if (chart.options.plugins.legend && chart.options.plugins.legend.labels) {
                    chart.options.plugins.legend.labels.color = textColor;
                }
            }
            
            chart.update();
        }
        
        function updateCharts() {
            // Update Front Summary Chart
            if (state.charts.frontSummary) {
                const frontDeliveryData = state.fronts.map(front => {
                    return state.hours.slice(0, 12).reduce((sum, hour) => sum + state.delivery[front][hour], 0);
                });
                
                state.charts.frontSummary.data.datasets[0].data = frontDeliveryData;
                state.charts.frontSummary.update();
            }
            
            // Update Hourly Performance Chart
            if (state.charts.hourlyPerformance) {
                const hourlyDeliveryData = state.hours.slice(0, 12).map(hour => {
                    return state.fronts.reduce((sum, front) => sum + state.delivery[front][hour], 0);
                });
                
                const hourlyPotentialData = state.hours.slice(0, 12).map(hour => {
                    return state.fronts.reduce((sum, front) => sum + state.potential[front][hour], 0);
                });
                
                state.charts.hourlyPerformance.data.datasets[0].data = hourlyDeliveryData;
                state.charts.hourlyPerformance.data.datasets[1].data = hourlyPotentialData;
                state.charts.hourlyPerformance.update();
            }
            
            // Update Efficiency Gauge Chart
            if (state.charts.efficiencyGauge) {
                const efficiencyData = state.fronts.map(front => {
                    const totalDelivery = state.hours.slice(0, 12).reduce(
                        (sum, hour) => sum + state.delivery[front][hour], 0
                    );
                    
                    const oddHours = state.hours.slice(0, 12).filter(hour => hour % 2 !== 0);
                    const totalPotential = oddHours.reduce(
                        (sum, hour) => sum + state.potential[front][hour] * 2, 0
                    );
                    
                    return totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
                });
                
                state.charts.efficiencyGauge.data.datasets[0].data = efficiencyData;
                updateEfficiencyColors(state.charts.efficiencyGauge);
                state.charts.efficiencyGauge.update();
            }
            
            // Update Dashboard Charts with actual delivery data
            updateDashboardCharts();
        }
        
        // Update Dashboard Charts with actual data
        function updateDashboardCharts() {
            // Update delivery by period chart on dashboard
            if (state.charts.deliveryByPeriod) {
                // Get real data from the delivery state for all periods (full 24 hours)
                const periods = Object.keys(state.timePeriodsMap);
                const periodLabels = periods.map(period => {
                    return `${period.substring(0, 2)}:00-${period.substring(3, 5)}:00`;
                });
                
                const deliveryData = periods.map(period => {
                    const hours = state.timePeriodsMap[period];
                    return state.fronts.reduce((sum, front) => {
                        return sum + hours.reduce((hourSum, hour) => {
                            return hourSum + state.delivery[front][hour];
                        }, 0);
                    }, 0);
                });
                
                const potentialData = periods.map(period => {
                    const hours = state.timePeriodsMap[period];
                    const oddHour = hours.find(h => h % 2 !== 0) || hours[0];
                    return state.fronts.reduce((sum, front) => {
                        return sum + (state.potential[front][oddHour] * 2);
                    }, 0);
                });
                
                // Update analytics data with real data
                state.analytics.periodData.day.labels = periodLabels;
                state.analytics.periodData.day.datasets[0].data = deliveryData;
                state.analytics.periodData.day.datasets[1].data = potentialData;
                
                // Update chart with new data
                state.charts.deliveryByPeriod.data.labels = periodLabels;
                state.charts.deliveryByPeriod.data.datasets[0].data = deliveryData;
                state.charts.deliveryByPeriod.data.datasets[1].data = potentialData;
                state.charts.deliveryByPeriod.update();
            }
            
            // Update front performance chart on dashboard
            if (state.charts.frontPerformance) {
                const frontLabels = state.fronts.map(front => `F${front}`);
                
                const efficiencyData = state.fronts.map(front => {
                    let totalDelivery = 0;
                    let totalPotential = 0;
                    
                    // Calculate total delivery for all periods
                    for (const period in state.timePeriodsMap) {
                        const hours = state.timePeriodsMap[period];
                        
                        // Sum delivery for this period
                        for (const hour of hours) {
                            totalDelivery += state.delivery[front][hour];
                        }
                        
                        // Sum potential for this period (only odd hours have potential)
                        const oddHour = hours.find(h => h % 2 !== 0);
                        if (oddHour && state.potential[front][oddHour]) {
                            totalPotential += state.potential[front][oddHour] * 2;
                        }
                    }
                    
                    return totalPotential > 0 ? Math.round((totalDelivery / totalPotential) * 100) : 0;
                });
                
                // Update analytics data with real data
                state.analytics.frontPerformance.labels = frontLabels;
                state.analytics.frontPerformance.datasets[0].data = efficiencyData;
                
                // Update chart with new data
                state.charts.frontPerformance.data.labels = frontLabels;
                state.charts.frontPerformance.data.datasets[0].data = efficiencyData;
                state.charts.frontPerformance.data.datasets[0].backgroundColor = 
                    efficiencyData.map(value => getEfficiencyColorGradient(value));
                state.charts.frontPerformance.update();
            }
            
            // NEW: Update trips by front chart
            if (state.charts.tripsByFront) {
                const frontLabels = state.fronts.map(front => `F${front}`);
                
                // Calculate total trips for each front
                const tripsData = state.fronts.map(front => {
                    return state.hours.reduce((sum, hour) => sum + state.trips[front][hour], 0);
                });
                
                // Update analytics data
                state.analytics.tripsByFront.labels = frontLabels;
                state.analytics.tripsByFront.datasets[0].data = tripsData;
                
                // Update chart
                state.charts.tripsByFront.data.labels = frontLabels;
                state.charts.tripsByFront.data.datasets[0].data = tripsData;
                state.charts.tripsByFront.update();
            }
            
            // NEW: Update trucks per hour chart
            if (state.charts.trucksPerHour) {
                const frontLabels = state.fronts.map(front => `F${front}`);
                
                // Calculate average trucks per hour for each front
                const trucksData = state.fronts.map(front => {
                    const totalTrips = state.hours.reduce((sum, hour) => sum + state.trips[front][hour], 0);
                    // Assuming 24 active hours for the average calculation
                    const activeHours = state.hours.filter(hour => state.trips[front][hour] > 0).length || 1;
                    return totalTrips / activeHours;
                });
                
                // Update analytics data
                state.analytics.trucksPerHour.labels = frontLabels;
                state.analytics.trucksPerHour.datasets[0].data = trucksData;
                
                // Update chart
                state.charts.trucksPerHour.data.labels = frontLabels;
                state.charts.trucksPerHour.data.datasets[0].data = trucksData;
                state.charts.trucksPerHour.update();
            }
            
            // Update dashboard stats cards
            updateDashboardStatsCards();
        }
        
        // Update dashboard stats cards with real data
        function updateDashboardStatsCards() {
            // Calculate total delivery across all fronts and hours
            const totalDelivery = Object.keys(state.delivery).reduce((frontSum, front) => {
                return frontSum + Object.keys(state.delivery[front]).reduce((hourSum, hour) => {
                    return hourSum + state.delivery[front][hour];
                }, 0);
            }, 0);
            
            // Calculate total potential
            const totalPotential = Object.keys(state.potential).reduce((frontSum, front) => {
                let frontPotential = 0;
                for (const period in state.timePeriodsMap) {
                    const hours = state.timePeriodsMap[period];
                    const oddHour = hours.find(h => h % 2 !== 0);
                    if (oddHour && state.potential[front][oddHour]) {
                        frontPotential += state.potential[front][oddHour] * 2;
                    }
                }
                return frontSum + frontPotential;
            }, 0);
            
            // Calculate efficiency
            const efficiency = totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
            
            // Calculate total trips
            const totalTrips = Object.keys(state.trips).reduce((frontSum, front) => {
                return frontSum + Object.keys(state.trips[front]).reduce((hourSum, hour) => {
                    return hourSum + state.trips[front][hour];
                }, 0);
            }, 0);
            
            // Calculate average density
            let densitySum = 0;
            let densityCount = 0;
            
            for (const front in state.density) {
                for (const hour in state.density[front]) {
                    if (state.density[front][hour] > 0) {
                        densitySum += state.density[front][hour];
                        densityCount++;
                    }
                }
            }
            
            const avgDensity = densityCount > 0 ? densitySum / densityCount : 0;
            
            // Update dashboard cards
            const dashboardCards = document.querySelectorAll('.dashboard-card');
            if (dashboardCards.length >= 4) {
                // Total delivered
                const deliveredCard = dashboardCards[0];
                const deliveredValue = deliveredCard.querySelector('.text-2xl');
                const deliveredProgress = deliveredCard.querySelector('.bg-primary');
                
                if (deliveredValue) {
                    deliveredValue.textContent = totalDelivery.toFixed(1);
                }
                
                if (deliveredProgress && totalPotential > 0) {
                    const deliveryPercentage = Math.min(100, (totalDelivery / totalPotential) * 100);
                    deliveredProgress.style.width = `${deliveryPercentage}%`;
                    
                    const percentText = deliveredCard.querySelector('.text-xs');
                    if (percentText) {
                        percentText.textContent = `${Math.round(deliveryPercentage)}% da meta mensal`;
                    }
                }
                
                // Efficiency
                const efficiencyCard = dashboardCards[1];
                const efficiencyValue = efficiencyCard.querySelector('.text-2xl');
                const efficiencyProgress = efficiencyCard.querySelector('.bg-blue-500');
                
                if (efficiencyValue) {
                    efficiencyValue.textContent = `${efficiency.toFixed(1)}%`;
                }
                
                if (efficiencyProgress) {
                    efficiencyProgress.style.width = `${Math.min(100, efficiency)}%`;
                }
                
                // Trips
                const tripsCard = dashboardCards[2];
                const tripsValue = tripsCard.querySelector('.text-2xl');
                
                if (tripsValue) {
                    tripsValue.textContent = totalTrips;
                }
                
                // Density
                const densityCard = dashboardCards[3];
                const densityValue = densityCard.querySelector('.text-2xl');
                
                if (densityValue) {
                    densityValue.textContent = avgDensity.toFixed(2);
                }
            }
        }
        
        // Load initial data
        function loadInitialData() {
            // Set some sample data
            const sampleFronts = ['4001', '4002', '4007', '4009'];
            
            for (const front of sampleFronts) {
                // Add density values for different hours (just for example)
                state.density[front][6] = 65.0;
                state.density[front][7] = 67.5;
                state.density[front][8] = 70.0;
                state.density[front][9] = 72.0;
                
                // Add trip values
                state.trips[front][6] = 5;
                state.trips[front][7] = 7;
                state.trips[front][8] = 6;
                state.trips[front][9] = 8;
                
                // Add potential values for odd hours
                state.potential[front][7] = 500;
                state.potential[front][9] = 550;
            }
            
            // Calculate delivery based on density and trips
            calculateDelivery();
            calculateTwoHourTotals();
        }
        
        // Save/Load Data Functions
        function saveData() {
            try {
                // Convert state to a serializable object
                const dataToSave = {
                    fronts: state.fronts,
                    density: state.density,
                    trips: state.trips,
                    potential: state.potential,
                    delivery: state.delivery
                };
                
                const jsonString = JSON.stringify(dataToSave);
                localStorage.setItem('delivery_data', jsonString);
                return true;
            } catch (error) {
                console.error('Error saving data:', error);
                return false;
            }
        }
        
        function loadSavedData() {
            try {
                const savedData = localStorage.getItem('delivery_data');
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    
                    // Restore saved data to state
                    if (parsedData.fronts) {
                        state.fronts = parsedData.fronts;
                    }
                    state.density = parsedData.density || state.density;
                    state.trips = parsedData.trips || state.trips;
                    state.potential = parsedData.potential || state.potential;
                    state.delivery = parsedData.delivery || state.delivery;
                    
                    // Recalculate and update UI
                    calculateDelivery();
                    calculateTwoHourTotals();
                    updateUI();
                    showToast('Dados carregados com sucesso', 'success');
                    return true;
                }
                return false;
            } catch (error) {
                console.error('Error loading data:', error);
                return false;
            }
        }
        
        // Config Functions
        function saveConfig() {
            try {
                const jsonString = JSON.stringify(state.config);
                localStorage.setItem('app_config', jsonString);
                return true;
            } catch (error) {
                console.error('Error saving config:', error);
                return false;
            }
        }
        
        function loadConfig() {
            try {
                const savedConfig = localStorage.getItem('app_config');
                if (savedConfig) {
                    const parsedConfig = JSON.parse(savedConfig);
                    
                    // Merge saved config with default values
                    state.config = { ...state.config, ...parsedConfig };
                    
                    // Update UI based on loaded config
                    updateUIFromConfig();
                }
            } catch (error) {
                console.error('Error loading config:', error);
            }
        }
        
        function updateUIFromConfig() {
            // Update UI elements based on config
            const autoSaveToggle = document.getElementById('auto-save-toggle');
            const autoSaveInterval = document.getElementById('auto-save-interval');
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const alertThreshold = document.getElementById('alert-threshold');
            const soundAlertToggle = document.getElementById('sound-alert-toggle');
            const visualAlertToggle = document.getElementById('visual-alert-toggle');
            
            if (autoSaveToggle) autoSaveToggle.checked = state.config.autoSave;
            if (autoSaveInterval) autoSaveInterval.value = state.config.autoSaveInterval;
            if (darkModeToggle) darkModeToggle.checked = state.config.darkMode;
            if (alertThreshold) alertThreshold.value = state.config.alertThreshold;
            if (soundAlertToggle) soundAlertToggle.checked = state.config.soundAlerts;
            if (visualAlertToggle) visualAlertToggle.checked = state.config.visualAlerts;
        }
        
        function updateConfigFromUI() {
            // Update config from UI elements
            const autoSaveToggle = document.getElementById('auto-save-toggle');
            const autoSaveInterval = document.getElementById('auto-save-interval');
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const alertThreshold = document.getElementById('alert-threshold');
            const soundAlertToggle = document.getElementById('sound-alert-toggle');
            const visualAlertToggle = document.getElementById('visual-alert-toggle');
            
            state.config.autoSave = autoSaveToggle ? autoSaveToggle.checked : state.config.autoSave;
            state.config.autoSaveInterval = autoSaveInterval ? parseInt(autoSaveInterval.value) : state.config.autoSaveInterval;
            state.config.darkMode = darkModeToggle ? darkModeToggle.checked : state.config.darkMode;
            state.config.alertThreshold = alertThreshold ? parseInt(alertThreshold.value) : state.config.alertThreshold;
            state.config.soundAlerts = soundAlertToggle ? soundAlertToggle.checked : state.config.soundAlerts;
            state.config.visualAlerts = visualAlertToggle ? visualAlertToggle.checked : state.config.visualAlerts;
            
            // Apply dark mode from UI
            updateDarkMode();
        }
        
        // Export Functions
        function exportJSON() {
            // Prepare data
            const dataToExport = {
                fronts: state.fronts,
                density: state.density,
                trips: state.trips,
                potential: state.potential,
                delivery: state.delivery,
                timestamp: new Date().toISOString(),
                version: '1.0'
            };
            
            // Convert to JSON string
            const jsonString = JSON.stringify(dataToExport, null, 2);
            
            // Create blob and download link
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            
            a.href = url;
            a.download = `entrega_data_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            
            // Clean up
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
            
            showToast('Dados exportados com sucesso (JSON)', 'success');
        }
        
        function exportCSV() {
            // Headers
            let csvContent = 'Frente,Hora,Densidade,Viagens,Entrega,Potencial\n';
            
            // Data rows
            for (const front of state.fronts) {
                for (const hour of state.hours) {
                    const density = state.density[front][hour];
                    const trips = state.trips[front][hour];
                    const delivery = state.delivery[front][hour];
                    const potential = state.potential[front][hour];
                    
                    csvContent += `${front},${hour},${density},${trips},${delivery},${potential}\n`;
                }
            }
            
            // Create blob and download link
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            
            a.href = url;
            a.download = `entrega_data_${new Date().toISOString().slice(0, 10)}.csv`;
            document.body.appendChild(a);
            a.click();
            
            // Clean up
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
            
            showToast('Dados exportados com sucesso (CSV)', 'success');
        }
        
        function exportPDF() {
            // Check if jsPDF is loaded
            if (typeof jspdf === 'undefined' || typeof jspdf.jsPDF === 'undefined') {
                showToast('Erro: jsPDF não está disponível', 'error');
                return;
            }
            
            // Create PDF document
            const { jsPDF } = jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(18);
            doc.text('Relatório de Entrega de Safra', 14, 20);
            
            // Add date
            doc.setFontSize(10);
            doc.text(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, 14, 30);
            
            // Add period summary table
            doc.setFontSize(14);
            doc.text(`Resumo do Período: ${state.activePeriod.substring(0, 2)}:00-${state.activePeriod.substring(3, 5)}:00`, 14, 40);
            
            // Create period summary table data
            const tableData = [];
            tableData.push(['Frente', 'Entrega (2h)', 'Potencial (2h)', 'Diferença', '% Realizado']);
            
            for (const front of state.fronts) {
                const entrega = state.twoHourDelivery[state.activePeriod][front];
                const potencial = state.twoHourPotential[state.activePeriod][front];
                const diferenca = state.difference[state.activePeriod][front];
                const percentual = potencial > 0 ? (entrega / potencial) * 100 : 0;
                
                tableData.push([
                    `F${front}`,
                    entrega.toFixed(2),
                    potencial.toString(),
                    diferenca.toFixed(2),
                    `${percentual.toFixed(1)}%`
                ]);
            }
            
            // Add totals row
            const totalEntrega = state.fronts.reduce((sum, front) => sum + state.twoHourDelivery[state.activePeriod][front], 0);
            const totalPotencial = state.fronts.reduce((sum, front) => sum + state.twoHourPotential[state.activePeriod][front], 0);
            const totalDiferenca = state.fronts.reduce((sum, front) => sum + state.difference[state.activePeriod][front], 0);
            const totalPercentual = totalPotencial > 0 ? (totalEntrega / totalPotencial) * 100 : 0;
            
            tableData.push([
                'TOTAL',
                totalEntrega.toFixed(2),
                totalPotencial.toString(),
                totalDiferenca.toFixed(2),
                `${totalPercentual.toFixed(1)}%`
            ]);
            
            // Add table to PDF
            doc.autoTable({
                startY: 45,
                head: [tableData[0]],
                body: tableData.slice(1),
                theme: 'grid',
                headStyles: { fillColor: [93, 92, 222] },
                alternateRowStyles: { fillColor: [240, 240, 255] }
            });
            
            // Save PDF
            doc.save(`relatorio_entrega_${state.activePeriod}_${new Date().toISOString().slice(0, 10)}.pdf`);
            
            showToast('Relatório exportado com sucesso (PDF)', 'success');
        }
        
        function exportDashboard() {
            // Check if jsPDF is loaded
            if (typeof jspdf === 'undefined' || typeof jspdf.jsPDF === 'undefined') {
                showToast('Erro: jsPDF não está disponível', 'error');
                return;
            }
            
            // Create PDF document
            const { jsPDF } = jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(18);
            doc.text('Dashboard de Entrega de Safra', 14, 20);
            
            // Add date
            doc.setFontSize(10);
            doc.text(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, 14, 30);
            
            // Add summary cards
            doc.setFontSize(14);
            doc.text('Resumo de Desempenho', 14, 40);
            
            // Create summary table
            const summaryData = [];
            summaryData.push(['Métrica', 'Valor', '% da Meta']);
            
            // Calculate summary values
            const totalDelivery = Object.keys(state.delivery).reduce((frontSum, front) => {
                return frontSum + Object.keys(state.delivery[front]).reduce((hourSum, hour) => {
                    return hourSum + state.delivery[front][hour];
                }, 0);
            }, 0);
            
            const totalPotential = Object.keys(state.potential).reduce((frontSum, front) => {
                let frontPotential = 0;
                for (const period in state.timePeriodsMap) {
                    const hours = state.timePeriodsMap[period];
                    const oddHour = hours.find(h => h % 2 !== 0);
                    if (oddHour && state.potential[front][oddHour]) {
                        frontPotential += state.potential[front][oddHour] * 2;
                    }
                }
                return frontSum + frontPotential;
            }, 0);
            
            const efficiency = totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
            
            const totalTrips = Object.keys(state.trips).reduce((frontSum, front) => {
                return frontSum + Object.keys(state.trips[front]).reduce((hourSum, hour) => {
                    return hourSum + state.trips[front][hour];
                }, 0);
            }, 0);
            
            let densitySum = 0;
            let densityCount = 0;
            
            for (const front in state.density) {
                for (const hour in state.density[front]) {
                    if (state.density[front][hour] > 0) {
                        densitySum += state.density[front][hour];
                        densityCount++;
                    }
                }
            }
            
            const avgDensity = densityCount > 0 ? densitySum / densityCount : 0;
            
            // Add data to summary table
            const deliveryPercentage = totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
            
            summaryData.push(['Total Entregue', `${totalDelivery.toFixed(2)} ton`, `${deliveryPercentage.toFixed(1)}%`]);
            summaryData.push(['Eficiência Média', `${efficiency.toFixed(1)}%`, `${(efficiency / 85 * 100).toFixed(1)}%`]);
            summaryData.push(['Viagens Realizadas', totalTrips.toString(), 'N/A']);
            summaryData.push(['Densidade Média', avgDensity.toFixed(2), 'N/A']);
            
            // Add table to PDF
            doc.autoTable({
                startY: 45,
                head: [summaryData[0]],
                body: summaryData.slice(1),
                theme: 'grid',
                headStyles: { fillColor: [93, 92, 222] },
                alternateRowStyles: { fillColor: [240, 240, 255] }
            });
            
            // Add front performance
            doc.setFontSize(14);
            doc.text('Desempenho por Frente', 14, doc.autoTable.previous.finalY + 15);
            
            // Create front performance table
            const frontData = [];
            frontData.push(['Frente', 'Entrega (ton)', 'Potencial (ton)', 'Eficiência']);
            
            for (const front of state.fronts) {
                let frontDelivery = 0;
                let frontPotential = 0;
                
                // Calculate front totals
                for (const period in state.timePeriodsMap) {
                    const hours = state.timePeriodsMap[period];
                    
                    // Sum delivery
                    for (const hour of hours) {
                        frontDelivery += state.delivery[front][hour];
                    }
                    
                    // Sum potential (odd hours)
                    const oddHour = hours.find(h => h % 2 !== 0);
                    if (oddHour && state.potential[front][oddHour]) {
                        frontPotential += state.potential[front][oddHour] * 2;
                    }
                }
                
                const frontEfficiency = frontPotential > 0 ? (frontDelivery / frontPotential) * 100 : 0;
                
                frontData.push([
                    `F${front}`,
                    frontDelivery.toFixed(2),
                    frontPotential.toFixed(2),
                    `${frontEfficiency.toFixed(1)}%`
                ]);
            }
            
            // Add front performance table to PDF
            doc.autoTable({
                startY: doc.autoTable.previous.finalY + 20,
                head: [frontData[0]],
                body: frontData.slice(1),
                theme: 'grid',
                headStyles: { fillColor: [93, 92, 222] },
                alternateRowStyles: { fillColor: [240, 240, 255] }
            });
            
            // Save PDF
            doc.save(`dashboard_entrega_${new Date().toISOString().slice(0, 10)}.pdf`);
            
            showToast('Dashboard exportado com sucesso (PDF)', 'success');
        }
        
        // Confirmation Modal Functions
        function showConfirmationModal(title, message, confirmCallback) {
            const modal = document.getElementById('confirmation-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalConfirm = document.getElementById('modal-confirm');
            
            if (!modal || !modalTitle || !modalMessage || !modalConfirm) return;
            
            // Set modal content
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            
            // Set confirm button action
            modalConfirm.onclick = () => {
                if (typeof confirmCallback === 'function') {
                    confirmCallback();
                }
                closeConfirmationModal();
            };
            
            // Show modal
            modal.classList.remove('hidden');
        }
        
        function closeConfirmationModal() {
            const modal = document.getElementById('confirmation-modal');
            if (modal) modal.classList.add('hidden');
        }
        
        // Toast notification functions
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            if (!toastContainer) return;
            
            const toast = document.createElement('div');
            toast.className = 'flex items-center w-full max-w-xs p-4 mb-4 text-gray-500 bg-white dark:bg-gray-800 rounded-lg shadow-md';
            
            let iconSvg = '';
            let bgColor = 'bg-blue-100 dark:bg-blue-900';
            let iconColor = 'text-blue-500 dark:text-blue-400';
            
            switch(type) {
                case 'success':
                    iconSvg = `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>`;
                    bgColor = 'bg-green-100 dark:bg-green-900';
                    iconColor = 'text-green-500 dark:text-green-400';
                    break;
                case 'error':
                    iconSvg = `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>`;
                    bgColor = 'bg-red-100 dark:bg-red-900';
                    iconColor = 'text-red-500 dark:text-red-400';
                    break;
                case 'warning':
                    iconSvg = `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>`;
                    bgColor = 'bg-yellow-100 dark:bg-yellow-900';
                    iconColor = 'text-yellow-500 dark:text-yellow-400';
                    break;
                default: // info
                    iconSvg = `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                    </svg>`;
                    bgColor = 'bg-blue-100 dark:bg-blue-900';
                    iconColor = 'text-blue-500 dark:text-blue-400';
            }
            
            toast.innerHTML = `
                <div class="inline-flex items-center justify-center flex-shrink-0 w-8 h-8 ${bgColor} rounded-lg ${iconColor}">
                    ${iconSvg}
                </div>
                <div class="ml-3 text-sm font-normal text-gray-800 dark:text-gray-200">${message}</div>
                <button type="button" class="ml-auto -mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100 inline-flex h-8 w-8 dark:text-gray-500 dark:hover:text-white dark:bg-gray-800 dark:hover:bg-gray-700" aria-label="Close">
                    <span class="sr-only">Close</span>
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                </button>
            `;
            
            // Add toast to container
            toastContainer.appendChild(toast);
            
            // Add click event to close button
            toast.querySelector('button').addEventListener('click', () => {
                toast.remove();
            });
            
            // Auto remove toast after 5 seconds
            setTimeout(() => {
                toast.classList.add('opacity-0');
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 5000);
        }
        
        // Dark Mode Functions
        function setupDarkMode() {
            // Check for dark mode preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
                state.config.darkMode = true;
            }
            
            // Listen for dark mode changes
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                    state.config.darkMode = true;
                } else {
                    document.documentElement.classList.remove('dark');
                    state.config.darkMode = false;
                }
                
                updateChartThemes();
            });
            
            // Set up theme toggle button
            const themeToggle = document.getElementById('theme-toggle');
            const lightIcon = document.getElementById('theme-toggle-light-icon');
            const darkIcon = document.getElementById('theme-toggle-dark-icon');
            
            if (themeToggle && lightIcon && darkIcon) {
                // Show correct icon based on current theme
                if (document.documentElement.classList.contains('dark')) {
                    lightIcon.classList.remove('hidden');
                    darkIcon.classList.add('hidden');
                } else {
                    lightIcon.classList.add('hidden');
                    darkIcon.classList.remove('hidden');
                }
                
                // Add click event
                themeToggle.addEventListener('click', toggleDarkMode);
            }
        }
        
        function toggleDarkMode() {
            const lightIcon = document.getElementById('theme-toggle-light-icon');
            const darkIcon = document.getElementById('theme-toggle-dark-icon');
            
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                state.config.darkMode = false;
                
                if (lightIcon && darkIcon) {
                    lightIcon.classList.add('hidden');
                    darkIcon.classList.remove('hidden');
                }
            } else {
                document.documentElement.classList.add('dark');
                state.config.darkMode = true;
                
                if (lightIcon && darkIcon) {
                    lightIcon.classList.remove('hidden');
                    darkIcon.classList.add('hidden');
                }
            }
            
            // Update dark mode toggle in settings
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            if (darkModeToggle) darkModeToggle.checked = state.config.darkMode;
            
            // Update charts for dark mode
            updateChartThemes();
            
            // Save config
            saveConfig();
        }
        
        function updateDarkMode() {
            if (state.config.darkMode) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
            
            // Update icons
            const lightIcon = document.getElementById('theme-toggle-light-icon');
            const darkIcon = document.getElementById('theme-toggle-dark-icon');
            
            if (lightIcon && darkIcon) {
                if (document.documentElement.classList.contains('dark')) {
                    lightIcon.classList.remove('hidden');
                    darkIcon.classList.add('hidden');
                } else {
                    lightIcon.classList.add('hidden');
                    darkIcon.classList.remove('hidden');
                }
            }
            
            // Update charts for dark mode
            updateChartThemes();
        }
        
        function updateChartThemes() {
            // Update all charts to match the current theme
            for (const chartKey in state.charts) {
                if (state.charts[chartKey]) {
                    updateChartTheme(state.charts[chartKey]);
                }
            }
        }
        
        // Initialize the application
        // This will be called when the document is ready
        setupKeyboardShortcuts();
    </script>
</body>
</html>
