<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gest√£o de Entrega de Safra 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.0.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.2.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.25/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#5D5CDE',
                            '50': '#EEEEFF',
                            '100': '#D4D4F7',
                            '200': '#ACACEF',
                            '300': '#8584E7',
                            '400': '#5D5CDE',
                            '500': '#3635D5',
                            '600': '#2A29B0',
                            '700': '#211F8A',
                            '800': '#171664',
                            '900': '#0D0C3E'
                        },
                        secondary: {
                            DEFAULT: '#6B7280',
                            '50': '#F9FAFB',
                            '100': '#F3F4F6',
                            '200': '#E5E7EB',
                            '300': '#D1D5DB',
                            '400': '#9CA3AF',
                            '500': '#6B7280',
                            '600': '#4B5563',
                            '700': '#374151',
                            '800': '#1F2937',
                            '900': '#111827'
                        },
                        success: {
                            DEFAULT: '#10B981',
                            '50': '#ECFDF5',
                            '100': '#D1FAE5',
                            '200': '#A7F3D0',
                            '300': '#6EE7B7',
                            '400': '#34D399',
                            '500': '#10B981',
                            '600': '#059669',
                            '700': '#047857',
                            '800': '#065F46',
                            '900': '#064E3B'
                        },
                        warning: {
                            DEFAULT: '#F59E0B',
                            '50': '#FFFBEB',
                            '100': '#FEF3C7',
                            '200': '#FDE68A',
                            '300': '#FCD34D',
                            '400': '#FBBF24',
                            '500': '#F59E0B',
                            '600': '#D97706',
                            '700': '#B45309',
                            '800': '#92400E',
                            '900': '#78350F'
                        },
                        danger: {
                            DEFAULT: '#EF4444',
                            '50': '#FEF2F2',
                            '100': '#FEE2E2',
                            '200': '#FECACA',
                            '300': '#FCA5A5',
                            '400': '#F87171',
                            '500': '#EF4444',
                            '600': '#DC2626',
                            '700': '#B91C1C',
                            '800': '#991B1B',
                            '900': '#7F1D1D'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    },
                    boxShadow: {
                        'inner-sm': 'inset 0 1px 2px 0 rgba(0, 0, 0, 0.05)',
                        'soft': '0 2px 15px -3px rgba(0, 0, 0, 0.07), 0 10px 20px -2px rgba(0, 0, 0, 0.04)',
                        'card': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)'
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'progress': 'progress 1s ease-in-out infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'bounce-sm': 'bounce-sm 1s infinite'
                    },
                    keyframes: {
                        progress: {
                            '0%': { width: '0%' },
                            '100%': { width: '100%' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        'bounce-sm': {
                            '0%, 100%': {
                                transform: 'translateY(-2px)',
                                animationTimingFunction: 'cubic-bezier(0.8, 0, 1, 1)'
                            },
                            '50%': {
                                transform: 'translateY(0)',
                                animationTimingFunction: 'cubic-bezier(0, 0, 0.2, 1)'
                            }
                        }
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <style>
        [x-cloak] { display: none !important; }
        .input-number {
            -moz-appearance: textfield;
            appearance: textfield;
        }
        .input-number::-webkit-outer-spin-button,
        .input-number::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* Skeleton loading effect */
        .skeleton {
            animation: skeleton-loading 1.5s infinite;
            background-image: linear-gradient(90deg, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0));
            background-size: 200px 100%;
            background-repeat: no-repeat;
            background-position: -200px 0;
        }
        
        @keyframes skeleton-loading {
            100% { background-position: 200px 0; }
        }
        
        .dark .skeleton {
            animation: skeleton-loading-dark 1.5s infinite;
            background-image: linear-gradient(90deg, rgba(50, 50, 50, 0), rgba(50, 50, 50, 0.4), rgba(50, 50, 50, 0));
            background-size: 200px 100%;
            background-repeat: no-repeat;
            background-position: -200px 0;
        }
        
        @keyframes skeleton-loading-dark {
            100% { background-position: 200px 0; }
        }
        
        /* Transitions */
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
        }
        .dark ::-webkit-scrollbar-track {
            background: #374151;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #4B5563;
        }
        .dark ::-webkit-scrollbar-thumb:hover {
            background: #6B7280;
        }
        
        /* Tooltip styles */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltip-text {
            visibility: hidden;
            width: auto;
            min-width: 120px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            white-space: nowrap;
        }
        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: rgba(0, 0, 0, 0.8) transparent transparent transparent;
        }
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        .dark .tooltip .tooltip-text {
            background-color: rgba(255, 255, 255, 0.8);
            color: #000;
        }
        .dark .tooltip .tooltip-text::after {
            border-color: rgba(255, 255, 255, 0.8) transparent transparent transparent;
        }

        /* Dashboard card hover effects */
        .dashboard-card {
            transition: all 0.3s ease;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        /* Calendar styles */
        .calendar-day {
            transition: all 0.2s ease;
        }
        
        .calendar-day:hover:not(.disabled) {
            background-color: rgba(93, 92, 222, 0.1);
        }
        
        .calendar-day.selected {
            background-color: rgba(93, 92, 222, 0.2);
            font-weight: bold;
        }
        
        .calendar-day.current {
            border: 2px solid #5D5CDE;
        }
        
        .calendar-day.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        /* Accordion styles */
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .accordion-open .accordion-content {
            max-height: 1000px;
        }
        
        /* Slideshow styles */
        .slide {
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .slide.active {
            opacity: 1;
            transform: translateX(0);
        }
        
        .slide.inactive {
            opacity: 0;
            transform: translateX(100%);
            position: absolute;
        }
        
        /* Animation for achievements */
        @keyframes achievement-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .achievement-unlock {
            animation: achievement-pulse 0.5s ease-in-out;
        }
        
        /* Print styles */
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                background-color: white !important;
                color: black !important;
            }
            
            .print-full-width {
                width: 100% !important;
                max-width: 100% !important;
            }
            
            .print-break-after {
                page-break-after: always;
            }
        }
        
        /* Touch area increase for mobile */
        @media (max-width: 768px) {
            .touch-target {
                min-height: 44px;
                min-width: 44px;
            }
        }
        
        /* Dark mode transition */
        .dark-transition {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        /* Fancy focus rings */
        .focus-ring:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.5);
        }
        
        /* Custom checkbox */
        .custom-checkbox {
            position: relative;
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid #6B7280;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .custom-checkbox.checked {
            background-color: #5D5CDE;
            border-color: #5D5CDE;
        }
        
        .custom-checkbox.checked::after {
            content: '';
            position: absolute;
            left: 5px;
            top: 2px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }
        
        /* Weather icons */
        .weather-icon {
            filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.2));
        }
        
        .dark .weather-icon {
            filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.1));
        }
        
        /* Custom scrollbar for dropdown menus */
        .dropdown-scroll {
            max-height: 200px;
            overflow-y: auto;
            scrollbar-width: thin;
        }
        
        .dropdown-scroll::-webkit-scrollbar {
            width: 6px;
        }
        
        .dropdown-scroll::-webkit-scrollbar-thumb {
            background-color: #9CA3AF;
            border-radius: 3px;
        }
        
        .dark .dropdown-scroll::-webkit-scrollbar-thumb {
            background-color: #4B5563;
        }
        
        /* Grid background pattern */
        .grid-pattern {
            background-image: 
                linear-gradient(rgba(229, 231, 235, 0.5) 1px, transparent 1px),
                linear-gradient(90deg, rgba(229, 231, 235, 0.5) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .dark .grid-pattern {
            background-image: 
                linear-gradient(rgba(55, 65, 81, 0.5) 1px, transparent 1px),
                linear-gradient(90deg, rgba(55, 65, 81, 0.5) 1px, transparent 1px);
        }
        
        /* Glow effect for important elements */
        .glow {
            box-shadow: 0 0 15px rgba(93, 92, 222, 0.5);
        }
        
        .dark .glow {
            box-shadow: 0 0 15px rgba(93, 92, 222, 0.7);
        }
        
        /* Fancy number input */
        .fancy-number-input {
            position: relative;
        }
        
        .fancy-number-input button {
            position: absolute;
            right: 0;
            width: 20px;
            height: 50%;
            background-color: #E5E7EB;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        
        .fancy-number-input button:hover {
            background-color: #D1D5DB;
        }
        
        .fancy-number-input button:first-of-type {
            top: 0;
            border-top-right-radius: 4px;
        }
        
        .fancy-number-input button:last-of-type {
            bottom: 0;
            border-bottom-right-radius: 4px;
        }
        
        .dark .fancy-number-input button {
            background-color: #374151;
        }
        
        .dark .fancy-number-input button:hover {
            background-color: #4B5563;
        }
        
        /* Text gradient for headings */
        .text-gradient {
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            background-image: linear-gradient(to right, #5D5CDE, #4F46E5);
        }
        
        .dark .text-gradient {
            background-image: linear-gradient(to right, #818CF8, #6366F1);
        }

        /* Empty state styles */
        .empty-state {
            border: 2px dashed #E5E7EB;
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            color: #9CA3AF;
        }
        
        .dark .empty-state {
            border-color: #374151;
            color: #6B7280;
        }

        /* Help text style */
        .help-text {
            font-size: 0.875rem;
            color: #6B7280;
            margin-top: 0.5rem;
            font-style: italic;
        }
        
        .dark .help-text {
            color: #9CA3AF;
        }

        /* Placeholder text */
        .placeholder-text {
            color: #9CA3AF;
            font-style: italic;
        }
        
        .dark .placeholder-text {
            color: #6B7280;
        }
        
        /* History mode indicator */
        .history-mode-indicator {
            background-color: #FEF3C7;
            color: #92400E;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .dark .history-mode-indicator {
            background-color: #78350F;
            color: #FCD34D;
        }
        
        /* Date chip styles */
        .date-chip {
            display: inline-flex;
            align-items: center;
            background-color: #E5E7EB;
            color: #374151;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .date-chip:hover {
            background-color: #D1D5DB;
        }
        
        .date-chip.selected {
            background-color: #5D5CDE;
            color: white;
        }
        
        .dark .date-chip {
            background-color: #374151;
            color: #E5E7EB;
        }
        
        .dark .date-chip:hover {
            background-color: #4B5563;
        }
        
        .dark .date-chip.selected {
            background-color: #5D5CDE;
            color: white;
        }
        
        /* Comparison table styles */
        .comparison-table th,
        .comparison-table td {
            padding: 0.75rem 1rem;
            text-align: center;
        }
        
        .comparison-table th:first-child,
        .comparison-table td:first-child {
            text-align: left;
        }
        
        .comparison-table th {
            background-color: #F3F4F6;
            font-weight: 600;
            color: #374151;
        }
        
        .dark .comparison-table th {
            background-color: #374151;
            color: #F3F4F6;
        }
        
        .comparison-table tr:nth-child(even) {
            background-color: #F9FAFB;
        }
        
        .dark .comparison-table tr:nth-child(even) {
            background-color: #1F2937;
        }
        
        .comparison-table tr:hover {
            background-color: #F3F4F6;
        }
        
        .dark .comparison-table tr:hover {
            background-color: #374151;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen transition-colors duration-200">
    <div class="drawer-wrapper relative">
        <!-- Left Side Drawer -->
        <div id="left-drawer" class="fixed left-0 top-0 h-full w-64 bg-white dark:bg-gray-800 shadow-lg transform -translate-x-full transition-transform duration-300 ease-in-out z-40">
            <div class="p-4 h-full flex flex-col">
                <!-- App Logo in Drawer -->
                <div class="flex items-center mb-8 mt-4">
                    <div class="h-10 w-10 rounded-md bg-primary flex items-center justify-center text-white font-bold text-xl shadow-md">GG</div>
                    <span class="ml-2 font-semibold text-xl text-gray-900 dark:text-gray-100">GGOMES-LOG</span>
                </div>
                
                <!-- Navigation Links -->
                <nav class="flex-1">
                    <ul class="space-y-1">
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="dashboard">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                                </svg>
                                Dashboard
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="entrega-hora">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                </svg>
                                Entrega por Hora
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="relatorios">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                An√°lises e Relat√≥rios
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="historico">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Hist√≥rico
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="metas">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Metas e Desempenho
                            </a>
                        </li>
                        <li>
                            <a href="#" class="drawer-link flex items-center p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" data-page="configuracoes">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                Configura√ß√µes
                            </a>
                        </li>
                    </ul>
                </nav>
                
                <!-- User section -->
                <div class="border-t border-gray-200 dark:border-gray-700 pt-4 mt-4">
                    <div class="flex items-center">
                        <div class="h-9 w-9 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-800 dark:text-blue-200 font-medium">GG</div>
                        <div class="ml-3">
                            <div class="font-medium text-gray-700 dark:text-gray-300">Gutemberg Gomes</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">Gerente de Opera√ß√µes</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Drawer Backdrop -->
        <div id="drawer-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden"></div>
        
        <!-- Main Content -->
        <div class="min-h-screen flex flex-col">
            <!-- Top Navigation Bar -->
            <header class="bg-white dark:bg-gray-800 shadow-md">
                <div class="container mx-auto px-4 py-3">
                    <div class="flex justify-between items-center">
                        <!-- Left Side: Menu Button + Logo -->
                        <div class="flex items-center">
                            <button id="menu-button" class="mr-4 p-2 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                                </svg>
                            </button>
                            <div class="flex items-center">
                                <div class="h-8 w-8 rounded-md bg-primary flex items-center justify-center text-white font-bold text-lg shadow-md">GG</div>
                                <span class="ml-2 font-semibold text-xl text-gray-900 dark:text-gray-100 hidden sm:inline-block">GGOMES-LOG</span>
                            </div>
                        </div>
                        
                        <!-- Current Date Display -->
                        <div class="flex items-center">
                            <div id="history-mode-indicator" class="hidden mr-2 history-mode-indicator">
                                <span>Modo Hist√≥rico</span>
                            </div>
                            <div class="hidden md:flex items-center text-gray-600 dark:text-gray-300 mr-4">
                                <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <span id="header-date" class="text-sm font-medium"></span>
                            </div>
                            <div id="header-selected-date" class="hidden items-center mr-4 px-2 py-1 rounded-md bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200">
                                <span id="selected-date-text" class="text-sm font-medium"></span>
                            </div>
                        </div>
                        
                        <!-- Right Side: Actions -->
                        <div class="flex items-center space-x-2 sm:space-x-4">
                            <!-- Search Button -->
                            <button id="search-button" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </button>
                            
                            <!-- Notifications -->
                            <div class="relative">
                                <button id="notifications-button" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                                    </svg>
                                    <span class="absolute top-0 right-0 h-4 w-4 bg-red-500 rounded-full text-xs text-white flex items-center justify-center">3</span>
                                </button>
                                
                                <!-- Notifications Dropdown -->
                                <div id="notifications-dropdown" class="absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-md shadow-lg z-20 hidden">
                                    <div class="p-3 border-b border-gray-200 dark:border-gray-700">
                                        <div class="flex justify-between items-center">
                                            <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300">Notifica√ß√µes</h3>
                                            <button class="text-xs text-primary hover:text-primary-600 dark:text-primary-300 dark:hover:text-primary-400">Marcar todas como lidas</button>
                                        </div>
                                    </div>
                                    <div class="max-h-80 overflow-y-auto dropdown-scroll">
                                        <a href="#" class="block p-3 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-red-100 dark:bg-red-900 flex items-center justify-center text-red-500 dark:text-red-300">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                    </svg>
                                                </div>
                                                <div class="ml-3">
                                                    <p class="text-sm text-gray-700 dark:text-gray-300"><span class="font-medium">Alerta:</span> Entrega abaixo de 50% do potencial na Frente 4001</p>
                                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">H√° 10 minutos</p>
                                                </div>
                                            </div>
                                        </a>
                                        <a href="#" class="block p-3 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-500 dark:text-blue-300">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
                                                    </svg>
                                                </div>
                                                <div class="ml-3">
                                                    <p class="text-sm text-gray-700 dark:text-gray-300"><span class="font-medium">Nova mensagem:</span> Carlos Mendes comentou sobre o per√≠odo 14:00-16:00</p>
                                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">H√° 30 minutos</p>
                                                </div>
                                            </div>
                                        </a>
                                        <a href="#" class="block p-3 hover:bg-gray-50 dark:hover:bg-gray-700">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center text-green-500 dark:text-green-300">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                    </svg>
                                                </div>
                                                <div class="ml-3">
                                                    <p class="text-sm text-gray-700 dark:text-gray-300"><span class="font-medium">Meta atingida:</span> Frente 4012 superou a meta di√°ria</p>
                                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">H√° 1 hora</p>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                    <div class="p-2 border-t border-gray-200 dark:border-gray-700">
                                        <a href="#" class="block text-center text-sm text-primary hover:text-primary-600 dark:text-primary-300 dark:hover:text-primary-400">Ver todas</a>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Theme Toggle -->
                            <button id="theme-toggle" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none">
                                <!-- Sun icon -->
                                <svg id="theme-toggle-light-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" />
                                </svg>
                                <!-- Moon icon -->
                                <svg id="theme-toggle-dark-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
                                </svg>
                            </button>
                            
                            <!-- Exit History Mode Button -->
                            <button id="exit-history-mode" class="hidden bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded-md shadow transition duration-200 flex items-center">
                                <svg class="w-4 h-4 mr-1 sm:mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                                </svg>
                                <span class="hidden sm:inline">Sair do Hist√≥rico</span>
                            </button>
                            
                            <!-- Save Button -->
                            <button id="save-data" class="bg-primary hover:bg-primary-600 text-white px-3 py-2 rounded-md shadow transition duration-200 flex items-center">
                                <svg class="w-4 h-4 mr-1 sm:mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                                </svg>
                                <span class="hidden sm:inline">Salvar</span>
                            </button>
                            
                            <!-- User Menu -->
                            <div class="relative">
                                <button id="user-menu-button" class="flex text-sm bg-gray-100 dark:bg-gray-700 rounded-full focus:outline-none">
                                    <div class="h-8 w-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-800 dark:text-blue-200 font-medium">GG</div>
                                </button>
                                
                                <!-- User Menu Dropdown -->
                                <div id="user-menu-dropdown" class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg z-20 hidden">
                                    <div class="py-1">
                                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Perfil</a>
                                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Configura√ß√µes</a>
                                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Suporte</a>
                                        <div class="border-t border-gray-100 dark:border-gray-700"></div>
                                        <a href="#" class="block px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700">Sair</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Search Modal -->
            <div id="search-modal" class="fixed inset-0 z-50 overflow-y-auto hidden">
                <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                    <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                        <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
                    </div>
                    <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full">
                        <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                            <div class="sm:flex sm:items-start">
                                <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                                    <div class="flex items-center justify-between">
                                        <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Pesquisa R√°pida</h3>
                                        <button id="close-search-modal" class="text-gray-400 hover:text-gray-500 focus:outline-none">
                                            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>
                                    <div class="mt-4">
                                        <div class="relative">
                                            <input type="text" id="global-search" class="w-full p-3 pl-10 text-gray-900 dark:text-gray-100 bg-gray-100 dark:bg-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Pesquisar frentes, per√≠odos, relat√≥rios..." autofocus>
                                            <div class="absolute left-3 top-3 text-gray-400">
                                                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                                </svg>
                                            </div>
                                        </div>
                                        <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                                            Pressione <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded">Enter</kbd> para pesquisar ou <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded">ESC</kbd> para fechar
                                        </div>
                                    </div>
                                    
                                    <!-- Search Results -->
                                    <div class="mt-4 max-h-96 overflow-y-auto">
                                        <h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Resultados Recentes</h4>
                                        <div class="space-y-2">
                                            <a href="#" class="block p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700">
                                                <div class="flex items-center">
                                                    <div class="flex-shrink-0 h-8 w-8 rounded-md bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-500 dark:text-blue-300">
                                                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                                        </svg>
                                                    </div>
                                                    <div class="ml-3">
                                                        <p class="text-sm font-medium text-gray-900 dark:text-gray-100">Frente 4001</p>
                                                        <p class="text-xs text-gray-500 dark:text-gray-400">Entrega por Hora > Per√≠odo 06:00-08:00</p>
                                                    </div>
                                                </div>
                                            </a>
                                            <a href="#" class="block p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700">
                                                <div class="flex items-center">
                                                    <div class="flex-shrink-0 h-8 w-8 rounded-md bg-green-100 dark:bg-green-900 flex items-center justify-center text-green-500 dark:text-green-300">
                                                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                                        </svg>
                                                    </div>
                                                    <div class="ml-3">
                                                        <p class="text-sm font-medium text-gray-900 dark:text-gray-100">Relat√≥rio Mensal</p>
                                                        <p class="text-xs text-gray-500 dark:text-gray-400">An√°lises e Relat√≥rios > Desempenho Mensal</p>
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                            <button type="button" id="search-execute" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary text-base font-medium text-white hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:ml-3 sm:w-auto sm:text-sm">
                                Pesquisar
                            </button>
                            <button type="button" id="search-cancel" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                                Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content Container -->
            <main class="flex-1 p-4 container mx-auto">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-soft p-6 mb-6">
                    <div class="mb-6 flex flex-col md:flex-row md:justify-between md:items-center space-y-4 md:space-y-0">
                        <div>
                            <h1 id="page-title" class="text-2xl font-bold text-gray-900 dark:text-gray-100">Dashboard</h1>
                            <p id="page-subtitle" class="text-gray-600 dark:text-gray-400 mt-1">Vis√£o geral do desempenho da safra 2025</p>
                        </div>
                        <div class="flex flex-wrap space-x-2 items-center">
                            <div class="relative">
                                <select id="period-selector" class="appearance-none bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white dark:focus:bg-gray-800 focus:border-primary transition duration-150">
                                    <option value="daily">Hoje</option>
                                    <option value="weekly">Esta Semana</option>
                                    <option value="monthly">Este M√™s</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300">
                                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                        <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                    </svg>
                                </div>
                            </div>
                            <button id="custom-date-button" class="hidden items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <span id="custom-date-range">Selecionar Datas</span>
                            </button>
                            <button id="export-dashboard" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                                Exportar
                            </button>
                        </div>
                    </div>
                    
                    <!-- Dashboard Content -->
                    <div id="dashboard-content" class="page-content">
                        <!-- Dashboard Empty State (shown when no data available) -->
                        <div id="dashboard-empty-state" class="empty-state mb-6">
                            <svg class="mx-auto h-12 w-12 text-gray-400 dark:text-gray-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <h3 class="text-lg font-medium text-gray-700 dark:text-gray-300 mb-2">Sem dados para exibir</h3>
                            <p class="text-gray-500 dark:text-gray-400 mb-4">Ainda n√£o h√° dados de entrega registrados no sistema.</p>
                            <a href="#" class="drawer-link inline-flex items-center px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-600 transition-colors" data-page="entrega-hora">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                Registrar Entregas
                            </a>
                        </div>

                        <!-- Dashboard Stats Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Entregue</p>
                                        <p class="text-2xl font-bold text-gray-900 dark:text-gray-100">0.0</p>
                                        <span class="inline-flex items-center text-sm font-medium text-gray-600 dark:text-gray-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            Baseado em dados reais
                                        </span>
                                    </div>
                                    <div class="bg-primary-50 dark:bg-primary-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-primary-500 dark:text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-primary rounded-full h-2" style="width: 0%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">0% da meta mensal</p>
                                </div>
                            </div>
                            
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Efici√™ncia M√©dia</p>
                                        <p class="text-2xl font-bold text-gray-900 dark:text-gray-100">0.0%</p>
                                        <span class="inline-flex items-center text-sm font-medium text-gray-600 dark:text-gray-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            Entrega √∑ Potencial
                                        </span>
                                    </div>
                                    <div class="bg-blue-50 dark:bg-blue-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-blue-500 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-blue-500 rounded-full h-2" style="width: 0%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Meta: 85%</p>
                                </div>
                            </div>
                            
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Viagens Realizadas</p>
                                        <p class="text-2xl font-bold text-gray-900 dark:text-gray-100">0</p>
                                        <span class="inline-flex items-center text-sm font-medium text-gray-600 dark:text-gray-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            Total de todas as frentes
                                        </span>
                                    </div>
                                    <div class="bg-green-50 dark:bg-green-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-green-500 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-green-500 rounded-full h-2" style="width: 0%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">0% da meta mensal</p>
                                </div>
                            </div>
                            
                            <div class="dashboard-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Densidade M√©dia</p>
                                        <p class="text-2xl font-bold text-gray-900 dark:text-gray-100">0.00</p>
                                        <span class="inline-flex items-center text-sm font-medium text-gray-600 dark:text-gray-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            M√©dia de todos os registros
                                        </span>
                                    </div>
                                    <div class="bg-purple-50 dark:bg-purple-900/30 p-3 rounded-full">
                                        <svg class="w-7 h-7 text-purple-500 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-purple-500 rounded-full h-2" style="width: 0%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Meta: 65.00</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Dashboard Main Charts -->
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                            <div class="lg:col-span-2 bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Entrega por Per√≠odo</h3>
                                    <div class="flex space-x-2">
                                        <button class="period-chart-option px-2 py-1 text-xs font-medium rounded bg-primary text-white" data-period="day">Dia</button>
                                        <button class="period-chart-option px-2 py-1 text-xs font-medium rounded bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600" data-period="week">Semana</button>
                                        <button class="period-chart-option px-2 py-1 text-xs font-medium rounded bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600" data-period="month">M√™s</button>
                                    </div>
                                </div>
                                <div class="h-80">
                                    <canvas id="deliveryByPeriodChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Desempenho por Frente</h3>
                                <div class="h-80">
                                    <canvas id="frontPerformanceChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Dashboard Trips and Trucks per Hour -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Viagens por Frente</h3>
                                <div class="h-80">
                                    <canvas id="tripsByFrontChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">M√©dia de Caminh√µes/Hora por Frente</h3>
                                <div class="h-80">
                                    <canvas id="trucksPerHourChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Performance Metrics -->
                        <div class="grid grid-cols-1 gap-6 mb-6">
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">M√©tricas de Desempenho</h3>
                                <div class="space-y-4">
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Efici√™ncia Operacional</span>
                                            <span class="text-sm font-medium text-primary">0%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                                            <div class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Utiliza√ß√£o de Recursos</span>
                                            <span class="text-sm font-medium text-green-600 dark:text-green-400">0%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                                            <div class="bg-green-600 dark:bg-green-500 h-2.5 rounded-full" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Cumprimento de Metas</span>
                                            <span class="text-sm font-medium text-yellow-600 dark:text-yellow-400">0%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                                            <div class="bg-yellow-600 dark:bg-yellow-500 h-2.5 rounded-full" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Qualidade da Entrega</span>
                                            <span class="text-sm font-medium text-blue-600 dark:text-blue-400">0%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                                            <div class="bg-blue-600 dark:bg-blue-500 h-2.5 rounded-full" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                                    <div class="flex justify-between">
                                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">√çndice de Desempenho Geral</span>
                                        <span class="text-sm font-medium text-primary">0%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mt-2">
                                        <div class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Entrega por Hora Content -->
                    <div id="entrega-hora-content" class="page-content hidden">
                        <div class="mb-6 flex flex-col md:flex-row md:justify-between md:items-center space-y-4 md:space-y-0">
                            <div>
                                <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100">Per√≠odos de Entrega</h2>
                                <p class="text-gray-600 dark:text-gray-400 mt-1">Gerencie as entregas por per√≠odos de 2 horas</p>
                            </div>
                            <div class="flex space-x-2">
                                <button id="clear-period" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                    Limpar Per√≠odo
                                </button>
                                <button id="copy-previous" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                    </svg>
                                    Copiar Anterior
                                </button>
                                <div class="dropdown relative">
                                    <button id="export-dropdown-btn" class="flex items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                        </svg>
                                        Exportar
                                    </button>
                                    <div id="export-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg z-20">
                                        <div class="py-1">
                                            <a href="#" id="export-json" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Exportar JSON</a>
                                            <a href="#" id="export-csv" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Exportar CSV</a>
                                            <a href="#" id="export-pdf" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Exportar PDF</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Date Selector for History Viewing -->
                        <div id="date-selector-container" class="mb-4 hidden">
                            <div class="bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg">
                                <h3 class="text-sm font-semibold text-blue-800 dark:text-blue-200 mb-2">Visualizando dados hist√≥ricos</h3>
                                <div class="flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-blue-600 dark:text-blue-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                    <span class="text-sm text-blue-800 dark:text-blue-200" id="current-historical-date">01/01/2025</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Period Selection Tabs -->
                        <div class="mb-6 overflow-x-auto">
                            <div class="flex space-x-2 min-w-max">
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-primary text-white" data-period="06-08">06:00-08:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="08-10">08:00-10:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="10-12">10:00-12:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="12-14">12:00-14:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="14-16">14:00-16:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="16-18">16:00-18:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="18-20">18:00-20:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="20-22">20:00-22:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="22-00">22:00-00:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="00-02">00:00-02:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="02-04">02:00-04:00</button>
                                <button class="time-tab-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" data-period="04-06">04:00-06:00</button>
                            </div>
                        </div>
                        
                        <!-- Loading Indicator -->
                        <div id="loading-indicator" class="p-10 text-center hidden">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"></div>
                            <p class="mt-2 text-gray-600 dark:text-gray-400">Carregando dados...</p>
                        </div>
                        
                        <!-- Time Period Content -->
                        <div id="time-period-content">
                            <!-- Content will be generated dynamically by the generateTimePeriodHTML() function -->
                        </div>
                    </div>
                    
                    <!-- Hist√≥rico Content (New Page) -->
                    <div id="historico-content" class="page-content hidden">
                        <div class="mb-6">
                            <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100">Hist√≥rico de Registros</h2>
                            <p class="text-gray-600 dark:text-gray-400 mt-1">Visualize e compare dados de diferentes datas</p>
                        </div>
                        
                        <!-- Available Dates Section -->
                        <div class="mb-6 bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Datas Dispon√≠veis</h3>
                            
                            <div id="no-history-message" class="hidden empty-state">
                                <svg class="mx-auto h-12 w-12 text-gray-400 dark:text-gray-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <h3 class="text-lg font-medium text-gray-700 dark:text-gray-300 mb-2">Sem dados hist√≥ricos</h3>
                                <p class="text-gray-500 dark:text-gray-400 mb-4">Ainda n√£o h√° registros salvos em diferentes datas.</p>
                                <p class="text-gray-500 dark:text-gray-400">Os registros di√°rios s√£o salvos automaticamente quando voc√™ registra dados de entrega.</p>
                            </div>
                            
                            <div id="dates-container" class="mb-4">
                                <!-- Date chips will be added here dynamically -->
                            </div>
                            
                            <div class="flex space-x-2">
                                <button id="view-selected-date" class="bg-primary hover:bg-primary-600 text-white px-4 py-2 rounded-md shadow transition duration-200 flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                    </svg>
                                    Visualizar Data Selecionada
                                </button>
                                
                                <button id="compare-dates" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md shadow transition duration-200 flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                    Comparar Datas Selecionadas
                                </button>
                            </div>
                        </div>
                        
                        <!-- Comparison Section -->
                        <div id="comparison-container" class="hidden">
                            <div class="mb-6 bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Compara√ß√£o de Datas</h3>
                                
                                <div id="selected-dates-comparison" class="mb-4 flex flex-wrap">
                                    <!-- Selected date chips for comparison will be displayed here -->
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                        <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100 mb-4">Total Entregue por Data</h4>
                                        <div class="h-80">
                                            <canvas id="comparisonDeliveryChart"></canvas>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                        <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100 mb-4">Efici√™ncia por Data</h4>
                                        <div class="h-80">
                                            <canvas id="comparisonEfficiencyChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700 comparison-table">
                                        <thead>
                                            <tr>
                                                <th>M√©trica</th>
                                                <!-- Date headers will be added dynamically -->
                                            </tr>
                                        </thead>
                                        <tbody id="comparison-table-body">
                                            <!-- Table rows will be added dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="mt-6 flex justify-end">
                                    <button id="export-comparison" class="bg-primary hover:bg-primary-600 text-white px-4 py-2 rounded-md shadow transition duration-200 flex items-center">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                        </svg>
                                        Exportar Compara√ß√£o
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Daily Trends Chart -->
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Tend√™ncias Di√°rias</h3>
                            <div class="h-96">
                                <canvas id="dailyTrendsChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Relat√≥rios Content -->
                    <div id="relatorios-content" class="page-content hidden">
                        <div class="mb-6 flex flex-col md:flex-row md:justify-between md:items-center space-y-4 md:space-y-0">
                            <div>
                                <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100">An√°lises e Relat√≥rios</h2>
                                <p class="text-gray-600 dark:text-gray-400 mt-1">Relat√≥rios detalhados de desempenho</p>
                            </div>
                            
                            <div class="flex flex-wrap space-x-2 items-center">
                                <div class="relative">
                                    <select id="report-type-selector" class="appearance-none bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white dark:focus:bg-gray-800 focus:border-primary transition duration-150">
                                        <option value="daily">Relat√≥rio Di√°rio</option>
                                        <option value="weekly">Relat√≥rio Semanal</option>
                                        <option value="monthly">Relat√≥rio Mensal</option>
                                        <option value="custom">Per√≠odo Personalizado</option>
                                    </select>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300">
                                        <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                            <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                        </svg>
                                    </div>
                                </div>
                                
                                <div class="relative">
                                    <select id="date-selector" class="appearance-none bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white dark:focus:bg-gray-800 focus:border-primary transition duration-150">
                                        <!-- Date options will be populated dynamically -->
                                    </select>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300">
                                        <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                            <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                        </svg>
                                    </div>
                                </div>
                                
                                <button id="custom-report-date-button" class="hidden items-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded transition duration-150">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                    <span id="custom-report-range">Selecionar Datas</span>
                                </button>
                                
                                <button id="generate-report" class="flex items-center bg-primary hover:bg-primary-600 text-white py-2 px-4 rounded transition duration-150">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                    </svg>
                                    Gerar Relat√≥rio
                                </button>
                            </div>
                        </div>
                        
                        <!-- Report Loading Indicator -->
                        <div id="report-loading" class="p-10 text-center hidden">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"></div>
                            <p class="mt-2 text-gray-600 dark:text-gray-400">Gerando relat√≥rio...</p>
                        </div>
                        
                        <!-- Report Content -->
                        <div id="report-content" class="hidden">
                            <!-- Report Header -->
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm mb-6">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100" id="report-title">Relat√≥rio Di√°rio</h3>
                                        <p class="text-gray-600 dark:text-gray-400 mt-1" id="report-period">Per√≠odo: 01/01/2025</p>
                                    </div>
                                    <div>
                                        <button id="export-report" class="flex items-center bg-primary hover:bg-primary-600 text-white py-2 px-4 rounded transition duration-150">
                                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                            </svg>
                                            Exportar
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Report Summary -->
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                    <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Entregue</h4>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-gray-100" id="report-total-delivered">0.0</p>
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-2">
                                        <div class="bg-primary rounded-full h-2" id="report-total-delivered-bar" style="width: 0%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="report-total-delivered-percent">0% da meta</p>
                                </div>
                                
                                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                    <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400">Efici√™ncia M√©dia</h4>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-gray-100" id="report-efficiency">0.0%</p>
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-2">
                                        <div class="bg-blue-500 rounded-full h-2" id="report-efficiency-bar" style="width: 0%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Meta: 85%</p>
                                </div>
                                
                                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                    <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400">Viagens Realizadas</h4>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-gray-100" id="report-trips">0</p>
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-2">
                                        <div class="bg-green-500 rounded-full h-2" id="report-trips-bar" style="width: 0%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="report-trips-percent">0% da meta</p>
                                </div>
                                
                                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                    <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400">Densidade M√©dia</h4>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-gray-100" id="report-density">0.00</p>
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-2">
                                        <div class="bg-purple-500 rounded-full h-2" id="report-density-bar" style="width: 0%"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Meta: 65.00</p>
                                </div>
                            </div>
                            
                            <!-- Report Charts -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                    <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100 mb-4">Entrega por Per√≠odo</h4>
                                    <div class="h-80">
                                        <canvas id="reportDeliveryChart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                    <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100 mb-4">Desempenho por Frente</h4>
                                    <div class="h-80">
                                        <canvas id="reportPerformanceChart"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Report Table -->
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
                                <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100 mb-4">Detalhes por Frente</h4>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-800">
                                            <tr>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Frente</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Entrega (ton)</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Potencial (ton)</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Efici√™ncia</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Viagens</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Densidade M√©dia</th>
                                            </tr>
                                        </thead>
                                        <tbody id="report-table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <!-- Table rows will be dynamically added here -->
                                        </tbody>
                                        <tfoot class="bg-gray-50 dark:bg-gray-700 font-semibold">
                                            <tr>
                                                <td class="px-4 py-3 whitespace-nowrap">TOTAL</td>
                                                <td id="report-footer-delivery" class="px-4 py-3 whitespace-nowrap">0.0</td>
                                                <td id="report-footer-potential" class="px-4 py-3 whitespace-nowrap">0.0</td>
                                                <td id="report-footer-efficiency" class="px-4 py-3 whitespace-nowrap">0.0%</td>
                                                <td id="report-footer-trips" class="px-4 py-3 whitespace-nowrap">0</td>
                                                <td id="report-footer-density" class="px-4 py-3 whitespace-nowrap">0.00</td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- No Data Message -->
                        <div id="no-report-data-message" class="empty-state">
                            <svg class="mx-auto h-12 w-12 text-gray-400 dark:text-gray-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <h3 class="text-lg font-medium text-gray-700 dark:text-gray-300 mb-2">Sem dados para o relat√≥rio</h3>
                            <p class="text-gray-500 dark:text-gray-400 mb-4">Selecione um per√≠odo e gere um relat√≥rio para visualizar as informa√ß√µes.</p>
                        </div>
                    </div>
                    
                    <!-- Metas Content -->
                    <div id="metas-content" class="page-content hidden">
                        <div class="text-center py-10">
                            <div class="inline-block p-6 bg-primary/10 dark:bg-primary/20 rounded-lg">
                                <svg class="w-16 h-16 mx-auto text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <h2 class="mt-4 text-xl font-bold text-gray-900 dark:text-gray-100">Metas e Desempenho</h2>
                                <p class="mt-2 text-gray-600 dark:text-gray-400">P√°gina em desenvolvimento. Acompanhamento de metas e desempenho estar√£o dispon√≠veis em breve.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Configura√ß√µes Content -->
                    <div id="configuracoes-content" class="page-content hidden">
                        <div class="max-w-2xl mx-auto">
                            <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100 mb-6">Configura√ß√µes do Sistema</h2>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden mb-6">
                                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">Prefer√™ncias Gerais</h3>
                                </div>
                                <div class="p-4 space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Salvar Automaticamente</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Salva automaticamente as altera√ß√µes</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="auto-save-toggle" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Intervalo de Salvamento (minutos)</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Frequ√™ncia do salvamento autom√°tico</p>
                                        </div>
                                        <div class="w-20">
                                            <input type="number" id="auto-save-interval" class="w-full px-3 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" min="1" max="60" value="5">
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Modo Escuro</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Alterna entre o tema claro e escuro</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="dark-mode-toggle" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Salvamento Di√°rio Autom√°tico</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Salva automaticamente os registros di√°rios para hist√≥rico</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="auto-daily-save-toggle" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden mb-6">
                                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">Notifica√ß√µes e Alertas</h3>
                                </div>
                                <div class="p-4 space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Limiar de Alerta (%)</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Porcentagem abaixo da meta para disparar alerta</p>
                                        </div>
                                        <div class="w-20">
                                            <input type="number" id="alert-threshold" class="w-full px-3 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" min="1" max="50" value="10">
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Alertas Sonoros</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Emite sons para alertas importantes</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="sound-alert-toggle" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Alertas Visuais</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Mostra notifica√ß√µes na interface</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="visual-alert-toggle" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden mb-6">
                                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">Gest√£o de Dados</h3>
                                </div>
                                <div class="p-4 space-y-4">
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Gerenciamento de Hist√≥rico</h4>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">Gerencie dados hist√≥ricos salvos no sistema</p>
                                        
                                        <div class="flex flex-wrap space-x-2">
                                            <button id="export-all-history" class="mb-2 flex items-center bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-md shadow transition duration-200">
                                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                                </svg>
                                                Exportar Todo Hist√≥rico
                                            </button>
                                            
                                            <button id="clear-history" class="mb-2 flex items-center bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-md shadow transition duration-200">
                                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                                </svg>
                                                Limpar Hist√≥rico
                                            </button>
                                            
                                            <label for="import-history" class="mb-2 flex items-center bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-md shadow transition duration-200 cursor-pointer">
                                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                                </svg>
                                                Importar Hist√≥rico
                                                <input id="import-history" type="file" accept=".json" class="hidden">
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="pt-2">
                                        <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Backup e Restaura√ß√£o</h4>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">Crie backups e restaure dados do sistema</p>
                                        
                                        <div class="flex flex-wrap space-x-2">
                                            <button id="create-backup" class="mb-2 flex items-center bg-primary hover:bg-primary-600 text-white px-3 py-2 rounded-md shadow transition duration-200">
                                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                                                </svg>
                                                Criar Backup
                                            </button>
                                            
                                            <label for="restore-backup" class="mb-2 flex items-center bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-md shadow transition duration-200 cursor-pointer">
                                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                                </svg>
                                                Restaurar Backup
                                                <input id="restore-backup" type="file" accept=".json" class="hidden">
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-end space-x-3">
                                <button id="restore-defaults" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary transition duration-150">
                                    Restaurar Padr√µes
                                </button>
                                <button id="save-config" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition duration-150">
                                    Salvar Configura√ß√µes
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            
            <!-- Footer -->
            <footer class="bg-white dark:bg-gray-800 shadow-md mt-auto">
                <div class="container mx-auto px-4 py-4">
                    <div class="flex flex-col md:flex-row justify-between items-center">
                        <div class="text-sm text-gray-600 dark:text-gray-400 mb-4 md:mb-0">
                            ¬© 2025 GGOMES-LOG - Gest√£o de Entrega de Safra
                        </div>
                        <div class="flex space-x-4">
                            <a href="#" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary-300 transition-colors duration-150">Termos de Uso</a>
                            <a href="#" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary-300 transition-colors duration-150">Pol√≠tica de Privacidade</a>
                            <a href="#" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary-300 transition-colors duration-150">Suporte</a>
                            <span class="text-sm text-gray-400 dark:text-gray-500">Vers√£o 2.1.0</span>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    
    <!-- Calendar Modal -->
    <div id="calendar-modal" class="fixed inset-0 z-50 overflow-y-auto hidden">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
            </div>
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Selecionar Per√≠odo</h3>
                                <button id="close-calendar-modal" class="text-gray-400 hover:text-gray-500 focus:outline-none">
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="mt-4">
                                <div class="flex justify-between items-center mb-4">
                                    <button id="prev-month" class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                        </svg>
                                    </button>
                                    <div id="current-month-year" class="text-lg font-semibold text-gray-900 dark:text-gray-100">Julho 2024</div>
                                    <button id="next-month" class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                        </svg>
                                    </button>
                                </div>
                                
                                <div class="grid grid-cols-7 gap-1 text-center text-xs font-medium text-gray-500 dark:text-gray-400">
                                    <div>Dom</div>
                                    <div>Seg</div>
                                    <div>Ter</div>
                                    <div>Qua</div>
                                    <div>Qui</div>
                                    <div>Sex</div>
                                    <div>S√°b</div>
                                </div>
                                
                                <div id="calendar-days" class="grid grid-cols-7 gap-1 mt-2">
                                    <!-- Calendar days will be generated here -->
                                </div>
                                
                                <div class="mt-4">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Per√≠odo Selecionado</span>
                                    </div>
                                    <div class="flex space-x-2">
                                        <div class="flex-1">
                                            <label for="start-date" class="block text-xs text-gray-500 dark:text-gray-400">In√≠cio</label>
                                            <input type="text" id="start-date" class="block w-full p-2 text-sm bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md" readonly>
                                        </div>
                                        <div class="flex-1">
                                            <label for="end-date" class="block text-xs text-gray-500 dark:text-gray-400">Fim</label>
                                            <input type="text" id="end-date" class="block w-full p-2 text-sm bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md" readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="apply-date-range" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary text-base font-medium text-white hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:ml-3 sm:w-auto sm:text-sm">
                        Aplicar
                    </button>
                    <button type="button" id="cancel-date-range" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div id="keyboard-shortcuts-modal" class="fixed inset-0 z-50 overflow-y-auto hidden">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
            </div>
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Atalhos de Teclado</h3>
                                <button id="close-shortcuts-modal" class="text-gray-400 hover:text-gray-500 focus:outline-none">
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="mt-4">
                                <div class="border-b border-gray-200 dark:border-gray-700">
                                    <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Navega√ß√£o</h4>
                                    <ul class="mb-4 space-y-2">
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Abrir Menu</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Alt + M</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Pesquisar</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Ctrl + K</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Dashboard</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Alt + 1</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Entrega por Hora</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Alt + 2</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">An√°lises</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Alt + 3</span>
                                        </li>
                                    </ul>
                                </div>
                                
                                <div class="border-b border-gray-200 dark:border-gray-700 pt-4">
                                    <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">A√ß√µes</h4>
                                    <ul class="mb-4 space-y-2">
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Salvar Dados</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Ctrl + S</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Alterar Tema</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Ctrl + D</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Exportar Dados</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Ctrl + E</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Adicionar Nova Frente</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Ctrl + N</span>
                                        </li>
                                    </ul>
                                </div>
                                
                                <div class="pt-4">
                                    <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Edi√ß√£o de Dados</h4>
                                    <ul class="mb-2 space-y-2">
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Pr√≥ximo Campo</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Tab</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Campo Anterior</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Shift + Tab</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Aumentar Valor</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">‚Üë</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-gray-700 dark:text-gray-300">Diminuir Valor</span>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">‚Üì</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 flex justify-end">
                    <button type="button" id="close-shortcuts-button" class="inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:w-auto sm:text-sm">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 flex flex-col-reverse space-y-reverse space-y-2"></div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full relative z-10 shadow-lg">
            <h3 id="modal-title" class="text-lg font-bold text-gray-900 dark:text-gray-100 mb-4">Confirma√ß√£o</h3>
            <p id="modal-message" class="text-gray-700 dark:text-gray-300 mb-6">Tem certeza que deseja realizar esta a√ß√£o?</p>
            <div class="flex justify-end space-x-3">
                <button id="modal-cancel" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition duration-200">
                    Cancelar
                </button>
                <button id="modal-confirm" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-600 transition duration-200">
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <script>
        // Application State
        const state = {
            // Front data
            fronts: ['4001', '4002', '4007', '4009'],
            hours: [6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 0, 1, 2, 3, 4, 5],
            timePeriodsMap: {
                '06-08': [6, 7],
                '08-10': [8, 9],
                '10-12': [10, 11],
                '12-14': [12, 13],
                '14-16': [14, 15],
                '16-18': [16, 17],
                '18-20': [18, 19],
                '20-22': [20, 21],
                '22-00': [22, 23],
                '00-02': [0, 1],
                '02-04': [2, 3],
                '04-06': [4, 5]
            },
            
            // Delivery data
            density: {},
            trips: {},
            delivery: {},
            potential: {},
            
            // Period summaries
            twoHourDelivery: {},
            twoHourPotential: {},
            difference: {},
            
            // Charts
            charts: {
                frontSummary: null,
                hourlyPerformance: null,
                efficiencyGauge: null,
                periodComparison: null,
                deliveryByPeriod: null,
                frontPerformance: null,
                tripsByFront: null, // Chart for trips by front
                trucksPerHour: null, // Chart for trucks per hour
                comparisonDeliveryChart: null, // Chart for comparing delivery across dates
                comparisonEfficiencyChart: null, // Chart for comparing efficiency across dates
                dailyTrendsChart: null, // Chart for daily trends
                reportDeliveryChart: null, // Chart for report delivery
                reportPerformanceChart: null // Chart for report performance
            },
            
            // Current active period
            activePeriod: '06-08',
            currentPage: 'dashboard',
            
            // Config
            config: {
                autoSave: true,
                autoSaveInterval: 5, // minutes
                darkMode: false,
                alertThreshold: 10, // %
                soundAlerts: false,
                visualAlerts: true,
                autoDailySave: true // Auto save daily records
            },
            
            // Date & calendar
            calendar: {
                startDate: null,
                endDate: null,
                currentMonth: new Date().getMonth(),
                currentYear: new Date().getFullYear(),
                selectedDate: new Date() // Current selected date
            },
            
            // Historical data
            dailyHistory: {}, // Stores the daily records
            selectedHistoryDates: [], // For comparison
            
            // History compare mode
            historyCompareMode: false,
            
            // Action history for undo/redo
            history: [],
            
            // Tracks if user has entered any data
            hasData: false
        };
        
        // DOM Ready
        document.addEventListener('DOMContentLoaded', function() {
            initializeDataStructures();
            loadConfig();
            setupDarkMode();
            loadInitialData();
            setupUI();
            setupEventListeners();
            calculateDelivery();
            calculateTwoHourTotals();
            initializeCharts();
            updateDateTimeWidgets();
            
            // Set up auto-save interval
            if (state.config.autoSave) {
                setInterval(saveData, state.config.autoSaveInterval * 60 * 1000);
            }
            
            // Show dashboard as default
            showPage('dashboard');
            
            // Auto-load saved data if available
            loadSavedData();
            
            // Load historical data
            loadHistoricalData();
            
            // Initialize the export dropdown toggle
            document.getElementById('export-dropdown-btn')?.addEventListener('click', function() {
                const dropdown = document.getElementById('export-dropdown');
                if (dropdown) {
                    toggleElement(dropdown);
                }
            });
            
            // Close dropdown when clicking elsewhere
            document.addEventListener('click', function(e) {
                if (!e.target.closest('#export-dropdown-btn')) {
                    const dropdown = document.getElementById('export-dropdown');
                    if (dropdown && !dropdown.classList.contains('hidden')) {
                        toggleElement(dropdown, false);
                    }
                }
            });
            
            // Connect restore defaults button
            document.getElementById('restore-defaults')?.addEventListener('click', function() {
                showConfirmationModal(
                    'Restaurar Padr√µes',
                    'Tem certeza que deseja restaurar todas as configura√ß√µes para os valores padr√£o?',
                    restoreDefaultConfig
                );
            });
            
            // Connect save config button
            document.getElementById('save-config')?.addEventListener('click', function() {
                updateConfigFromUI();
                saveConfig();
                showToast('Configura√ß√µes salvas com sucesso!', 'success');
            });
            
            // Connect exit history mode button
            document.getElementById('exit-history-mode')?.addEventListener('click', function() {
                exitHistoryMode();
            });
            
            // Connect view selected date button
            document.getElementById('view-selected-date')?.addEventListener('click', function() {
                if (state.selectedHistoryDates.length === 0) {
                    showToast('Selecione pelo menos uma data para visualizar', 'warning');
                    return;
                }
                
                // Load data for the selected date
                loadDailyData(state.selectedHistoryDates[0]);
                
                // Show entrega-hora page
                showPage('entrega-hora');
            });
            
            // Connect compare dates button
            document.getElementById('compare-dates')?.addEventListener('click', function() {
                if (state.selectedHistoryDates.length < 2) {
                    showToast('Selecione pelo menos duas datas para comparar', 'warning');
                    return;
                }
                
                // Show the comparison container
                generateComparisonView();
                
                // Update comparison charts
                updateComparisonCharts();
            });
            
            // Connect clear history button
            document.getElementById('clear-history')?.addEventListener('click', function() {
                showConfirmationModal(
                    'Limpar Hist√≥rico',
                    'Tem certeza que deseja limpar todo o hist√≥rico de dados? Esta a√ß√£o n√£o pode ser desfeita.',
                    clearHistoricalData
                );
            });
            
            // Connect export all history button
            document.getElementById('export-all-history')?.addEventListener('click', exportAllHistory);
            
            // Connect import history input
            document.getElementById('import-history')?.addEventListener('change', importHistory);
            
            // Connect create backup button
            document.getElementById('create-backup')?.addEventListener('click', createBackup);
            
            // Connect restore backup input
            document.getElementById('restore-backup')?.addEventListener('change', restoreBackup);
            
            // Connect export comparison button
            document.getElementById('export-comparison')?.addEventListener('click', exportComparison);
            
            // Connect report generation button
            document.getElementById('generate-report')?.addEventListener('click', generateReport);
            
            // Connect export report button
            document.getElementById('export-report')?.addEventListener('click', exportReport);
            
            // Auto-daily toggle
            document.getElementById('auto-daily-save-toggle')?.addEventListener('change', function() {
                state.config.autoDailySave = this.checked;
                saveConfig();
            });

            // Initialize keyboard shortcuts
            setupKeyboardShortcuts();
        });
        
        function restoreDefaultConfig() {
            // Reset to default values
            state.config = {
                autoSave: true,
                autoSaveInterval: 5,
                darkMode: false,
                alertThreshold: 10,
                soundAlerts: false,
                visualAlerts: true,
                autoDailySave: true
            };
            
            // Update UI with restored values
            updateUIFromConfig();
            
            // Apply dark mode setting
            updateDarkMode();
            
            // Save the restored config
            saveConfig();
            
            showToast('Configura√ß√µes restauradas para os valores padr√£o', 'success');
        }
        
        // Initialize data structures
        function initializeDataStructures() {
            // Initialize delivery data structures
            for (const front of state.fronts) {
                state.density[front] = {};
                state.trips[front] = {};
                state.delivery[front] = {};
                state.potential[front] = {};
                
                for (const hour of state.hours) {
                    state.density[front][hour] = 0;
                    state.trips[front][hour] = 0;
                    state.delivery[front][hour] = 0;
                    state.potential[front][hour] = 0;
                }
            }
            
            // Initialize period summaries
            for (const period in state.timePeriodsMap) {
                state.twoHourDelivery[period] = {};
                state.twoHourPotential[period] = {};
                state.difference[period] = {};
                
                for (const front of state.fronts) {
                    state.twoHourDelivery[period][front] = 0;
                    state.twoHourPotential[period][front] = 0;
                    state.difference[period][front] = 0;
                }
            }
        }
        
        // Setup Initial UI
        function setupUI() {
            // Setup navigation drawer links
            document.querySelectorAll('.drawer-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    showPage(page);
                    toggleDrawer(false);
                });
            });
            
            // Setup date/time widgets
            setInterval(updateDateTimeWidgets, 60000); // Update every minute
            
            // Setup dropdown event listeners
            setupDropdowns();
            
            // Set up period chart options
            document.querySelectorAll('.period-chart-option').forEach(option => {
                option.addEventListener('click', function() {
                    const period = this.getAttribute('data-period');
                    updatePeriodChart(period);
                    
                    // Update active state
                    document.querySelectorAll('.period-chart-option').forEach(btn => {
                        btn.classList.remove('bg-primary', 'text-white');
                        btn.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                    });
                    this.classList.add('bg-primary', 'text-white');
                    this.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                });
            });
            
            // Calendar setup
            setupCalendarModal();

            // Setup date selector for reports
            setupDateSelector();

            // Check for initial empty state
            updateEmptyStateVisibility();
        }
        
        // Setup Date Selector for Reports
        function setupDateSelector() {
            const reportTypeSelector = document.getElementById('report-type-selector');
            const dateSelector = document.getElementById('date-selector');
            const customReportDateButton = document.getElementById('custom-report-date-button');
            
            if (!reportTypeSelector || !dateSelector || !customReportDateButton) return;
            
            // Update date selector based on report type
            reportTypeSelector.addEventListener('change', function() {
                const reportType = this.value;
                dateSelector.innerHTML = ''; // Clear options
                
                switch (reportType) {
                    case 'daily':
                        // Past 7 days
                        for (let i = 0; i < 7; i++) {
                            const date = new Date();
                            date.setDate(date.getDate() - i);
                            const dateStr = formatDate(date);
                            const option = document.createElement('option');
                            option.value = formatDateISO(date);
                            option.textContent = i === 0 ? 'Hoje' : dateStr;
                            dateSelector.appendChild(option);
                        }
                        dateSelector.classList.remove('hidden');
                        customReportDateButton.classList.add('hidden');
                        break;
                        
                    case 'weekly':
                        // Past 4 weeks
                        for (let i = 0; i < 4; i++) {
                            const endDate = new Date();
                            endDate.setDate(endDate.getDate() - (i * 7));
                            const startDate = new Date(endDate);
                            startDate.setDate(startDate.getDate() - 6);
                            
                            const dateRangeStr = `${formatDate(startDate)} - ${formatDate(endDate)}`;
                            const option = document.createElement('option');
                            option.value = `${formatDateISO(startDate)}_${formatDateISO(endDate)}`;
                            option.textContent = i === 0 ? 'Esta Semana' : dateRangeStr;
                            dateSelector.appendChild(option);
                        }
                        dateSelector.classList.remove('hidden');
                        customReportDateButton.classList.add('hidden');
                        break;
                        
                    case 'monthly':
                        // Past 3 months
                        for (let i = 0; i < 3; i++) {
                            const date = new Date();
                            date.setDate(1); // First day of current month
                            date.setMonth(date.getMonth() - i);
                            
                            const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                            const monthStr = `${monthNames[date.getMonth()]} ${date.getFullYear()}`;
                            
                            const option = document.createElement('option');
                            option.value = formatDateISO(date).substring(0, 7); // YYYY-MM
                            option.textContent = i === 0 ? 'Este M√™s' : monthStr;
                            dateSelector.appendChild(option);
                        }
                        dateSelector.classList.remove('hidden');
                        customReportDateButton.classList.add('hidden');
                        break;
                        
                    case 'custom':
                        dateSelector.classList.add('hidden');
                        customReportDateButton.classList.remove('hidden');
                        customReportDateButton.classList.add('flex');
                        break;
                }
            });
            
            // Initialize with daily report type
            reportTypeSelector.dispatchEvent(new Event('change'));
        }
        
        // Setup Dropdowns
        function setupDropdowns() {
            // Notifications dropdown
            const notificationsButton = document.getElementById('notifications-button');
            const notificationsDropdown = document.getElementById('notifications-dropdown');
            
            if (notificationsButton && notificationsDropdown) {
                notificationsButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleElement(notificationsDropdown);
                });
            }
            
            // User menu dropdown
            const userMenuButton = document.getElementById('user-menu-button');
            const userMenuDropdown = document.getElementById('user-menu-dropdown');
            
            if (userMenuButton && userMenuDropdown) {
                userMenuButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleElement(userMenuDropdown);
                });
            }
            
            // Close dropdowns when clicking elsewhere
            document.addEventListener('click', function(e) {
                if (notificationsDropdown && notificationsDropdown.classList.contains('block')) {
                    toggleElement(notificationsDropdown, false);
                }
                
                if (userMenuDropdown && userMenuDropdown.classList.contains('block')) {
                    toggleElement(userMenuDropdown, false);
                }
            });
        }
        
        // Toggle element visibility
        function toggleElement(element, show) {
            if (!element) return;
            
            if (show === undefined) {
                element.classList.toggle('hidden');
                element.classList.toggle('block');
            } else if (show) {
                element.classList.remove('hidden');
                element.classList.add('block');
            } else {
                element.classList.add('hidden');
                element.classList.remove('block');
            }
        }
        
        // Setup Calendar Modal
        function setupCalendarModal() {
            const customDateButton = document.getElementById('custom-date-button');
            const calendarModal = document.getElementById('calendar-modal');
            const closeCalendarModal = document.getElementById('close-calendar-modal');
            const cancelDateRange = document.getElementById('cancel-date-range');
            const applyDateRange = document.getElementById('apply-date-range');
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            
            // Initialize calendar data
            state.calendar.startDate = new Date();
            state.calendar.endDate = new Date();
            
            // Show custom date button when custom period is selected
            document.getElementById('period-selector')?.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customDateButton.classList.remove('hidden');
                    customDateButton.classList.add('flex');
                } else {
                    customDateButton.classList.add('hidden');
                    customDateButton.classList.remove('flex');
                }
            });
            
            // Show calendar modal
            if (customDateButton) {
                customDateButton.addEventListener('click', function() {
                    generateCalendarDays();
                    toggleElement(calendarModal, true);
                });
            }
            
            // Close calendar modal
            if (closeCalendarModal) {
                closeCalendarModal.addEventListener('click', function() {
                    toggleElement(calendarModal, false);
                });
            }
            
            if (cancelDateRange) {
                cancelDateRange.addEventListener('click', function() {
                    toggleElement(calendarModal, false);
                });
            }
            
            // Apply date range
            if (applyDateRange) {
                applyDateRange.addEventListener('click', function() {
                    if (state.calendar.startDate && state.calendar.endDate) {
                        const startDateStr = formatDate(state.calendar.startDate);
                        const endDateStr = formatDate(state.calendar.endDate);
                        
                        document.getElementById('custom-date-range').textContent = `${startDateStr} - ${endDateStr}`;
                    }
                    
                    toggleElement(calendarModal, false);
                });
            }
            
            // Navigate months
            if (prevMonthBtn) {
                prevMonthBtn.addEventListener('click', function() {
                    state.calendar.currentMonth--;
                    if (state.calendar.currentMonth < 0) {
                        state.calendar.currentMonth = 11;
                        state.calendar.currentYear--;
                    }
                    generateCalendarDays();
                });
            }
            
            if (nextMonthBtn) {
                nextMonthBtn.addEventListener('click', function() {
                    state.calendar.currentMonth++;
                    if (state.calendar.currentMonth > 11) {
                        state.calendar.currentMonth = 0;
                        state.calendar.currentYear++;
                    }
                    generateCalendarDays();
                });
            }
        }
        
        // Generate Calendar Days
        function generateCalendarDays() {
            const calendarDays = document.getElementById('calendar-days');
            const currentMonthYear = document.getElementById('current-month-year');
            const startDateInput = document.getElementById('start-date');
            const endDateInput = document.getElementById('end-date');
            
            if (!calendarDays || !currentMonthYear) return;
            
            // Clear previous calendar
            calendarDays.innerHTML = '';
            
            // Set current month and year
            const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            currentMonthYear.textContent = `${monthNames[state.calendar.currentMonth]} ${state.calendar.currentYear}`;
            
            // Get first day of month and number of days
            const firstDay = new Date(state.calendar.currentYear, state.calendar.currentMonth, 1).getDay();
            const daysInMonth = new Date(state.calendar.currentYear, state.calendar.currentMonth + 1, 0).getDate();
            
            // Add empty cells for days before the first day of month
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'h-10';
                calendarDays.appendChild(emptyCell);
            }
            
            // Add days
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                const currentDate = new Date(state.calendar.currentYear, state.calendar.currentMonth, day);
                currentDate.setHours(0, 0, 0, 0);
                
                dayCell.className = 'calendar-day h-10 flex items-center justify-center rounded-full cursor-pointer';
                
                // Highlight current day
                if (currentDate.getTime() === today.getTime()) {
                    dayCell.classList.add('current');
                }
                
                // Highlight selected range
                if (state.calendar.startDate && state.calendar.endDate) {
                    if (currentDate.getTime() >= state.calendar.startDate.getTime() && 
                        currentDate.getTime() <= state.calendar.endDate.getTime()) {
                        dayCell.classList.add('selected');
                    }
                }
                
                dayCell.textContent = day;
                
                // Add click event to select date range
                dayCell.addEventListener('click', function() {
                    if (!state.calendar.startDate || (state.calendar.startDate && state.calendar.endDate)) {
                        // Start new selection
                        state.calendar.startDate = new Date(state.calendar.currentYear, state.calendar.currentMonth, day);
                        state.calendar.endDate = null;
                        
                        // Update inputs
                        if (startDateInput) startDateInput.value = formatDate(state.calendar.startDate);
                        if (endDateInput) endDateInput.value = '';
                    } else {
                        // Complete selection
                        const clickedDate = new Date(state.calendar.currentYear, state.calendar.currentMonth, day);
                        
                        // Ensure end date is after start date
                        if (clickedDate >= state.calendar.startDate) {
                            state.calendar.endDate = clickedDate;
                        } else {
                            state.calendar.endDate = state.calendar.startDate;
                            state.calendar.startDate = clickedDate;
                        }
                        
                        // Update inputs
                        if (startDateInput) startDateInput.value = formatDate(state.calendar.startDate);
                        if (endDateInput) endDateInput.value = formatDate(state.calendar.endDate);
                    }
                    
                    // Redraw calendar to show selection
                    generateCalendarDays();
                });
                
                calendarDays.appendChild(dayCell);
            }
        }
        
        // Format date to dd/mm/yyyy
        function formatDate(date) {
            if (!date) return '';
            return `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`;
        }
        
        // Format date to YYYY-MM-DD for storage keys
        function formatDateISO(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // Update Date/Time Widgets
        function updateDateTimeWidgets() {
            const headerDate = document.getElementById('header-date');
            
            const now = new Date();
            const dateOptions = { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' };
            
            const formattedDate = now.toLocaleDateString('pt-BR', dateOptions);
            
            if (headerDate) headerDate.textContent = formattedDate;
            
            // If in history mode, update the selected date display
            if (state.historyCompareMode) {
                const selectedDateText = document.getElementById('selected-date-text');
                if (selectedDateText) {
                    const date = state.calendar.selectedDate;
                    selectedDateText.textContent = formatDate(date);
                }
            }
        }
        
        // Setup Keyboard Shortcuts
        function setupKeyboardShortcuts() {
            // Listen for keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Ctrl + K for search
                if (e.ctrlKey && e.key === 'k') {
                    e.preventDefault();
                    toggleSearchModal(true);
                }
                
                // Alt + M for menu
                if (e.altKey && e.key === 'm') {
                    e.preventDefault();
                    toggleDrawer();
                }
                
                // Ctrl + S for save
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    saveData();
                    showToast('Dados salvos com sucesso!', 'success');
                }
                
                // Alt + 1-7 for navigation
                if (e.altKey && !isNaN(parseInt(e.key)) && parseInt(e.key) >= 1 && parseInt(e.key) <= 7) {
                    e.preventDefault();
                    const pages = ['dashboard', 'entrega-hora', 'relatorios', 'historico', 'metas', 'configuracoes'];
                    const index = parseInt(e.key) - 1;
                    
                    if (index < pages.length) {
                        showPage(pages[index]);
                    }
                }
                
                // Ctrl + D for dark mode toggle
                if (e.ctrlKey && e.key === 'd') {
                    e.preventDefault();
                    toggleDarkMode();
                }
                
                // ? for keyboard shortcuts modal
                if (e.key === '?') {
                    e.preventDefault();
                    toggleKeyboardShortcutsModal(true);
                }
                
                // Escape key to close modals
                if (e.key === 'Escape') {
                    const activeModals = document.querySelectorAll('.fixed.inset-0:not(.hidden)');
                    if (activeModals.length > 0) {
                        e.preventDefault();
                        activeModals.forEach(modal => {
                            toggleElement(modal, false);
                        });
                    }
                }
            });
            
            // Setup keyboard shortcuts modal
            const keyboardShortcutsModal = document.getElementById('keyboard-shortcuts-modal');
            const closeShortcutsModal = document.getElementById('close-shortcuts-modal');
            const closeShortcutsButton = document.getElementById('close-shortcuts-button');
            
            if (closeShortcutsModal) {
                closeShortcutsModal.addEventListener('click', () => toggleKeyboardShortcutsModal(false));
            }
            
            if (closeShortcutsButton) {
                closeShortcutsButton.addEventListener('click', () => toggleKeyboardShortcutsModal(false));
            }
        }
        
        // Toggle Keyboard Shortcuts Modal
        function toggleKeyboardShortcutsModal(show) {
            const keyboardShortcutsModal = document.getElementById('keyboard-shortcuts-modal');
            toggleElement(keyboardShortcutsModal, show);
        }
        
        // Toggle Search Modal
        function toggleSearchModal(show) {
            const searchModal = document.getElementById('search-modal');
            toggleElement(searchModal, show);
            
            if (show) {
                // Focus search input
                setTimeout(() => {
                    const searchInput = document.getElementById('global-search');
                    if (searchInput) searchInput.focus();
                }, 100);
            }
            
            // Setup search modal events
            const closeSearchModal = document.getElementById('close-search-modal');
            const searchCancel = document.getElementById('search-cancel');
            
            if (closeSearchModal) {
                closeSearchModal.addEventListener('click', () => toggleSearchModal(false));
            }
            
            if (searchCancel) {
                searchCancel.addEventListener('click', () => toggleSearchModal(false));
            }
        }
        
        // Toggle Left Drawer
        function toggleDrawer(show) {
            const drawer = document.getElementById('left-drawer');
            const backdrop = document.getElementById('drawer-backdrop');
            
            if (!drawer || !backdrop) return;
            
            if (show === undefined) {
                show = drawer.classList.contains('-translate-x-full');
            }
            
            if (show) {
                drawer.classList.remove('-translate-x-full');
                backdrop.classList.remove('hidden');
            } else {
                drawer.classList.add('-translate-x-full');
                backdrop.classList.add('hidden');
            }
        }
        
        // Show Specific Page
        function showPage(page) {
            state.currentPage = page;
            
            // Update page title and subtitle
            const pageTitle = document.getElementById('page-title');
            const pageSubtitle = document.getElementById('page-subtitle');
            
            if (pageTitle && pageSubtitle) {
                switch (page) {
                    case 'dashboard':
                        pageTitle.textContent = 'Dashboard';
                        pageSubtitle.textContent = 'Vis√£o geral do desempenho da safra 2025';
                        break;
                    case 'entrega-hora':
                        pageTitle.textContent = 'Entrega por Hora';
                        pageSubtitle.textContent = 'Gerencie o registro de entregas por per√≠odo';
                        break;
                    case 'relatorios':
                        pageTitle.textContent = 'An√°lises e Relat√≥rios';
                        pageSubtitle.textContent = 'Relat√≥rios detalhados e an√°lises de desempenho';
                        break;
                    case 'historico':
                        pageTitle.textContent = 'Hist√≥rico de Registros';
                        pageSubtitle.textContent = 'Visualize e compare dados de diferentes datas';
                        break;
                    case 'metas':
                        pageTitle.textContent = 'Metas e Desempenho';
                        pageSubtitle.textContent = 'Acompanhe o progresso das metas estabelecidas';
                        break;
                    case 'configuracoes':
                        pageTitle.textContent = 'Configura√ß√µes';
                        pageSubtitle.textContent = 'Ajuste as configura√ß√µes do sistema';
                        break;
                    default:
                        pageTitle.textContent = 'Dashboard';
                        pageSubtitle.textContent = 'Vis√£o geral do desempenho da safra 2025';
                }
            }
            
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show selected page
            const pageContent = document.getElementById(`${page}-content`);
            if (pageContent) {
                pageContent.classList.remove('hidden');
                
                // If showing the entrega-hora page, generate the time period HTML
                if (page === 'entrega-hora') {
                    generateTimePeriodHTML();
                }
                
                // If showing the dashboard, update the dashboard with current data
                if (page === 'dashboard') {
                    updateDashboardCharts();
                    updateEmptyStateVisibility();
                }
                
                // If showing the history page, update the available dates
                if (page === 'historico') {
                    updateAvailableDates();
                    initializeHistoryCharts();
                }
                
                // If showing the reports page, setup date selector
                if (page === 'relatorios') {
                    setupDateSelector();
                    hideReportContent();
                }
            } else {
                // If page doesn't exist, show dashboard
                const dashboardContent = document.getElementById('dashboard-content');
                if (dashboardContent) dashboardContent.classList.remove('hidden');
            }
            
            // Update navigation active state
            document.querySelectorAll('.drawer-link').forEach(link => {
                link.classList.remove('bg-primary', 'text-white');
                link.classList.add('text-gray-700', 'dark:text-gray-300');
                
                if (link.getAttribute('data-page') === page) {
                    link.classList.add('bg-primary', 'text-white');
                    link.classList.remove('text-gray-700', 'dark:text-gray-300');
                }
            });
        }

        // Check if there's any user data and update empty state visibility
        function updateEmptyStateVisibility() {
            const dashboardEmptyState = document.getElementById('dashboard-empty-state');
            if (!dashboardEmptyState) return;

            // Check if there's any data
            let hasAnyData = false;

            // Check for density, trips, or potential values
            for (const front in state.density) {
                for (const hour in state.density[front]) {
                    if (state.density[front][hour] > 0 || state.trips[front][hour] > 0 || state.potential[front][hour] > 0) {
                        hasAnyData = true;
                        break;
                    }
                }
                if (hasAnyData) break;
            }

            // Update state
            state.hasData = hasAnyData;

            // Show/hide empty state
            if (state.hasData) {
                dashboardEmptyState.classList.add('hidden');
            } else {
                dashboardEmptyState.classList.remove('hidden');
            }
        }
        
        // Generate Time Period HTML
        function generateTimePeriodHTML() {
            showLoading(true);
            
            const timeContentDiv = document.getElementById('time-period-content');
            if (!timeContentDiv) {
                showLoading(false);
                return;
            }
            
            timeContentDiv.innerHTML = '';
            
            // Show history mode indicator if in history mode
            const dateSelectorContainer = document.getElementById('date-selector-container');
            const historyModeIndicator = document.getElementById('history-mode-indicator');
            const headerSelectedDate = document.getElementById('header-selected-date');
            const exitHistoryModeButton = document.getElementById('exit-history-mode');
            
            if (state.historyCompareMode) {
                // Display date selector when in history mode
                if (dateSelectorContainer) {
                    dateSelectorContainer.classList.remove('hidden');
                    
                    // Update current historical date
                    const currentHistoricalDate = document.getElementById('current-historical-date');
                    if (currentHistoricalDate) {
                        currentHistoricalDate.textContent = formatDate(state.calendar.selectedDate);
                    }
                }
                
                // Show history mode indicator
                if (historyModeIndicator) historyModeIndicator.classList.remove('hidden');
                
                // Show selected date in header
                if (headerSelectedDate) {
                    headerSelectedDate.classList.remove('hidden');
                    headerSelectedDate.classList.add('flex');
                    
                    const selectedDateText = document.getElementById('selected-date-text');
                    if (selectedDateText) {
                        selectedDateText.textContent = formatDate(state.calendar.selectedDate);
                    }
                }
                
                // Show exit history mode button
                if (exitHistoryModeButton) {
                    exitHistoryModeButton.classList.remove('hidden');
                    exitHistoryModeButton.classList.add('flex');
                }
            } else {
                // Hide history mode UI elements when not in history mode
                if (dateSelectorContainer) dateSelectorContainer.classList.add('hidden');
                if (historyModeIndicator) historyModeIndicator.classList.add('hidden');
                if (headerSelectedDate) {
                    headerSelectedDate.classList.remove('flex');
                    headerSelectedDate.classList.add('hidden');
                }
                if (exitHistoryModeButton) {
                    exitHistoryModeButton.classList.remove('flex');
                    exitHistoryModeButton.classList.add('hidden');
                }
            }
            
            for (const period in state.timePeriodsMap) {
                const hours = state.timePeriodsMap[period];
                
                const periodDiv = document.createElement('div');
                periodDiv.id = `period-${period}`;
                periodDiv.className = 'period-content' + (period === state.activePeriod ? '' : ' hidden');
                
                let periodHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">`;
                
                for (const hour of hours) {
                    let hasPotencial = hour % 2 !== 0; // Only odd hours have potential
                    
                    periodHTML += `
                    <div class="overflow-hidden rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                        <div class="bg-gray-100 dark:bg-gray-700 py-2 px-4 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-primary dark:text-primary-300 flex items-center">
                                <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                ${hour.toString().padStart(2, '0')}:00
                            </h3>
                            <div class="flex items-center text-sm">
                                <span class="text-gray-600 dark:text-gray-400 flex items-center mr-3">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16" />
                                    </svg>
                                    <span class="total-viagens-badge" data-hour="${hour}">0</span> viagens
                                </span>
                                <span class="text-primary dark:text-primary-300 flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" />
                                    </svg>
                                    <span class="total-entrega-badge" data-hour="${hour}">0.00</span> ton
                                </span>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-800">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Frentes</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Densid.</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Viagens</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Entrega</th>
                                        ${hasPotencial ? '<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Pot. Hora</th>' : ''}
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">`;
                    
                    for (const front of state.fronts) {
                        periodHTML += `
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <span class="font-medium">${front}</span>
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <input type="number" class="input-number densidade w-20 text-right border rounded px-2 py-1 dark:bg-gray-700" data-hour="${hour}" data-front="${front}" value="${state.density[front][hour]}" min="0" step="0.01">
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <input type="number" class="input-number viagens w-20 text-right border rounded px-2 py-1 dark:bg-gray-700" data-hour="${hour}" data-front="${front}" value="${state.trips[front][hour]}" min="0">
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <span class="entrega font-medium ${state.delivery[front][hour] > 0 ? 'text-success-600 dark:text-success-400' : ''}" data-hour="${hour}" data-front="${front}">${state.delivery[front][hour].toFixed(2)}</span>
                                        </td>
                                        ${hasPotencial ? `<td class="px-4 py-3 whitespace-nowrap">
                                            <input type="number" class="input-number potencial w-20 text-right border rounded px-2 py-1 dark:bg-gray-700" data-hour="${hour}" data-front="${front}" value="${state.potential[front][hour]}" min="0">
                                        </td>` : ''}
                                    </tr>`;
                    }
                    
                    periodHTML += `
                                </tbody>
                                <tfoot class="bg-gray-50 dark:bg-gray-700 font-semibold">
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap">TOTAL</td>
                                        <td class="px-4 py-3 whitespace-nowrap"></td>
                                        <td class="px-4 py-3 whitespace-nowrap total-viagens" data-hour="${hour}">0</td>
                                        <td class="px-4 py-3 whitespace-nowrap total-entrega" data-hour="${hour}">0.00</td>
                                        ${hasPotencial ? `<td class="px-4 py-3 whitespace-nowrap total-potencial" data-hour="${hour}">0</td>` : ''}
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>`;
                }
                
                periodHTML += `
                </div>

                <!-- Period Summary -->
                <div class="mt-6 overflow-hidden rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                    <div class="bg-gray-100 dark:bg-gray-700 py-2 px-4">
                        <h3 class="text-lg font-semibold text-primary dark:text-primary-300 flex items-center">
                            <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            RESUMO DO PER√çODO (${period.substring(0, 2)}:00-${period.substring(3, 5)}:00)
                        </h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-800">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Frentes</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">2 Horas</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Potencial 2H</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Diferen√ßa</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">% Realizado</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">`;
                
                for (const front of state.fronts) {
                    periodHTML += `
                                <tr>
                                    <td class="px-4 py-3 whitespace-nowrap font-medium">F${front}</td>
                                    <td class="px-4 py-3 whitespace-nowrap duas-horas" data-period="${period}" data-front="${front}">0.00</td>
                                    <td class="px-4 py-3 whitespace-nowrap potencial-2h" data-period="${period}" data-front="${front}">0</td>
                                    <td class="px-4 py-3 whitespace-nowrap diff" data-period="${period}" data-front="${front}">0.00</td>
                                    <td class="px-4 py-3 whitespace-nowrap">
                                        <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5 relative overflow-hidden">
                                            <div class="percent-bar bg-primary h-2.5 rounded-full" data-period="${period}" data-front="${front}" style="width: 0%"></div>
                                        </div>
                                        <span class="text-xs mt-1 block text-right percent-text" data-period="${period}" data-front="${front}">0%</span>
                                    </td>
                                </tr>`;
                }
                
                periodHTML += `
                            </tbody>
                            <tfoot class="bg-gray-50 dark:bg-gray-700 font-semibold">
                                <tr>
                                    <td class="px-4 py-3 whitespace-nowrap">TOTAL</td>
                                    <td class="px-4 py-3 whitespace-nowrap total-duas-horas" data-period="${period}">0.00</td>
                                    <td class="px-4 py-3 whitespace-nowrap total-potencial-2h" data-period="${period}">0</td>
                                    <td class="px-4 py-3 whitespace-nowrap total-diff" data-period="${period}">0.00</td>
                                    <td class="px-4 py-3 whitespace-nowrap">
                                        <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5 relative overflow-hidden">
                                            <div class="total-percent-bar bg-primary h-2.5 rounded-full" data-period="${period}" style="width: 0%"></div>
                                        </div>
                                        <span class="text-xs mt-1 block text-right total-percent-text" data-period="${period}">0%</span>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>`;
                
                periodDiv.innerHTML = periodHTML;
                timeContentDiv.appendChild(periodDiv);
            }
            
            // Add event listeners to newly generated elements
            setupDynamicEventListeners();
            
            // Update the UI with current data
            updateUI();
            
            showLoading(false);
        }
        
        // Setup event listeners for dynamically generated elements
        function setupDynamicEventListeners() {
            // Input changes for delivery data
            document.querySelectorAll('.densidade, .viagens, .potencial').forEach(input => {
                input.addEventListener('input', handleDeliveryDataChange);
                
                // Disable inputs if in history mode
                if (state.historyCompareMode) {
                    input.disabled = true;
                }
                
                // Add number input controls
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'ArrowUp') {
                        e.preventDefault();
                        const step = this.classList.contains('densidade') ? 0.01 : 1;
                        this.value = (parseFloat(this.value) + step).toFixed(this.classList.contains('densidade') ? 2 : 0);
                        this.dispatchEvent(new Event('input'));
                    } else if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        const step = this.classList.contains('densidade') ? 0.01 : 1;
                        const newValue = Math.max(0, parseFloat(this.value) - step);
                        this.value = newValue.toFixed(this.classList.contains('densidade') ? 2 : 0);
                        this.dispatchEvent(new Event('input'));
                    }
                });
            });
        }
        
        // Show/hide loading indicator
        function showLoading(show) {
            const loadingIndicator = document.getElementById('loading-indicator');
            const timeContentDiv = document.getElementById('time-period-content');
            
            if (loadingIndicator && timeContentDiv) {
                if (show) {
                    loadingIndicator.classList.remove('hidden');
                    timeContentDiv.classList.add('hidden');
                } else {
                    loadingIndicator.classList.add('hidden');
                    timeContentDiv.classList.remove('hidden');
                }
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Menu button for drawer
            document.getElementById('menu-button')?.addEventListener('click', toggleDrawer);
            
            // Drawer backdrop click to close
            document.getElementById('drawer-backdrop')?.addEventListener('click', () => toggleDrawer(false));
            
            // Search button
            document.getElementById('search-button')?.addEventListener('click', () => toggleSearchModal(true));
            
            // Main tab switching
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', switchMainTab);
            });
            
            // Time period tab switching
            document.querySelectorAll('.time-tab-btn').forEach(button => {
                button.addEventListener('click', switchTimePeriodTab);
            });
            
            // Save button
            document.getElementById('save-data')?.addEventListener('click', function() {
                // Don't allow saving in history mode
                if (state.historyCompareMode) {
                    showToast('N√£o √© poss√≠vel salvar enquanto estiver visualizando dados hist√≥ricos. Saia do modo hist√≥rico primeiro.', 'warning');
                    return;
                }
                
                saveData();
                showToast('Dados salvos com sucesso!', 'success');
            });
            
            // Clear period button
            document.getElementById('clear-period')?.addEventListener('click', function() {
                // Don't allow clearing in history mode
                if (state.historyCompareMode) {
                    showToast('N√£o √© poss√≠vel limpar dados enquanto estiver visualizando dados hist√≥ricos. Saia do modo hist√≥rico primeiro.', 'warning');
                    return;
                }
                
                showConfirmationModal(
                    'Limpar Per√≠odo',
                    `Tem certeza que deseja limpar todos os dados do per√≠odo ${state.activePeriod}?`,
                    clearCurrentPeriod
                );
            });
            
            // Copy previous period button
            document.getElementById('copy-previous')?.addEventListener('click', function() {
                // Don't allow copying in history mode
                if (state.historyCompareMode) {
                    showToast('N√£o √© poss√≠vel copiar dados enquanto estiver visualizando dados hist√≥ricos. Saia do modo hist√≥rico primeiro.', 'warning');
                    return;
                }
                
                copyPreviousPeriod();
            });
            
            // Export buttons
            document.getElementById('export-json')?.addEventListener('click', exportJSON);
            document.getElementById('export-csv')?.addEventListener('click', exportCSV);
            document.getElementById('export-pdf')?.addEventListener('click', exportPDF);
            document.getElementById('export-dashboard')?.addEventListener('click', exportDashboard);
            
            // Modal buttons
            document.getElementById('modal-cancel')?.addEventListener('click', closeConfirmationModal);
        }
        
        // Tab Switching Functions
        function switchMainTab(e) {
            const tabId = e.target.closest('.tab-button').getAttribute('data-tab');
            
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active', 'text-primary', 'border-primary');
                button.classList.add('text-secondary-500', 'dark:text-secondary-400', 'border-transparent');
            });
            
            e.target.closest('.tab-button').classList.add('active', 'text-primary', 'border-primary');
            e.target.closest('.tab-button').classList.remove('text-secondary-500', 'dark:text-secondary-400', 'border-transparent');
            
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show selected tab content
            document.getElementById(`${tabId}-content`).classList.remove('hidden');
        }
        
        function switchTimePeriodTab(e) {
            const period = e.target.getAttribute('data-period');
            state.activePeriod = period;
            
            // Update time tab buttons
            document.querySelectorAll('.time-tab-btn').forEach(button => {
                button.classList.remove('bg-primary', 'text-white');
                button.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
            });
            
            e.target.classList.add('bg-primary', 'text-white');
            e.target.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
            
            // Hide all period contents
            document.querySelectorAll('.period-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show selected period content
            document.getElementById(`period-${period}`)?.classList.remove('hidden');
        }
        
        // Data Calculation Functions
        function calculateDelivery() {
            for (const front of state.fronts) {
                for (const hour of state.hours) {
                    state.delivery[front][hour] = state.density[front][hour] * state.trips[front][hour];
                }
            }
        }
        
        function calculateTwoHourTotals() {
            for (const period in state.timePeriodsMap) {
                const hours = state.timePeriodsMap[period];
                
                for (const front of state.fronts) {
                    // Calculate two-hour delivery total
                    state.twoHourDelivery[period][front] = hours.reduce((sum, hour) => {
                        return sum + state.delivery[front][hour];
                    }, 0);
                    
                    // Calculate two-hour potential (use the odd hour's potential * 2)
                    const oddHour = hours.find(h => h % 2 !== 0) || hours[0];
                    state.twoHourPotential[period][front] = state.potential[front][oddHour] * 2;
                    
                    // Calculate difference
                    state.difference[period][front] = 
                        state.twoHourDelivery[period][front] - state.twoHourPotential[period][front];
                }
            }
        }
        
        // Data Handling Functions
        function handleDeliveryDataChange(e) {
            // Don't process changes if in history mode
            if (state.historyCompareMode) return;
            
            const hour = parseInt(e.target.getAttribute('data-hour'));
            const front = e.target.getAttribute('data-front');
            const value = parseFloat(e.target.value) || 0;
            
            if (e.target.classList.contains('densidade')) {
                state.density[front][hour] = value;
            } else if (e.target.classList.contains('viagens')) {
                state.trips[front][hour] = value;
            } else if (e.target.classList.contains('potencial')) {
                state.potential[front][hour] = value;
            }
            
            calculateDelivery();
            calculateTwoHourTotals();
            updateUI();
            
            // Add to history for undo/redo functionality
            addToHistory('data-change', { hour, front, field: e.target.classList[1], value });
            
            // Update the hasData flag
            state.hasData = true;
            
            // Update dashboard empty state if needed
            if (state.currentPage === 'dashboard') {
                updateEmptyStateVisibility();
            }
        }
        
        // Add action to history
        function addToHistory(action, data) {
            state.history.push({ action, data, timestamp: new Date() });
            
            // Limit history size to prevent memory issues
            if (state.history.length > 100) {
                state.history.shift();
            }
        }
        
        function clearCurrentPeriod() {
            const hours = state.timePeriodsMap[state.activePeriod];
            
            for (const front of state.fronts) {
                for (const hour of hours) {
                    state.density[front][hour] = 0;
                    state.trips[front][hour] = 0;
                    state.delivery[front][hour] = 0;
                    
                    // Reset potential only for odd hours
                    if (hour % 2 !== 0) {
                        state.potential[front][hour] = 0;
                    }
                }
            }
            
            calculateDelivery();
            calculateTwoHourTotals();
            generateTimePeriodHTML();
            updateUI();
            showToast(`Per√≠odo ${state.activePeriod} limpo com sucesso`, 'success');
            
            // Add to history
            addToHistory('clear-period', { period: state.activePeriod });
        }
        
        function copyPreviousPeriod() {
            const periods = Object.keys(state.timePeriodsMap);
            const currentIndex = periods.indexOf(state.activePeriod);
            
            if (currentIndex <= 0) {
                showToast('N√£o h√° per√≠odo anterior para copiar', 'error');
                return;
            }
            
            const previousPeriod = periods[currentIndex - 1];
            const previousHours = state.timePeriodsMap[previousPeriod];
            const currentHours = state.timePeriodsMap[state.activePeriod];
            
            // Copy data from previous period
            for (let i = 0; i < currentHours.length; i++) {
                const currentHour = currentHours[i];
                const previousHour = previousHours[i];
                
                for (const front of state.fronts) {
                    state.density[front][currentHour] = state.density[front][previousHour];
                    state.trips[front][currentHour] = state.trips[front][previousHour];
                    
                    // For odd hours, also copy potential
                    if (currentHour % 2 !== 0) {
                        state.potential[front][currentHour] = state.potential[front][previousHour];
                    }
                }
            }
            
            calculateDelivery();
            calculateTwoHourTotals();
            generateTimePeriodHTML();
            updateUI();
            showToast(`Dados copiados do per√≠odo ${previousPeriod} para ${state.activePeriod}`, 'success');
            
            // Add to history
            addToHistory('copy-period', { from: previousPeriod, to: state.activePeriod });
        }
        
        // UI Update Functions
        function updateUI() {
            updateDeliveryUI();
            updateCharts();
        }
        
        function updateDeliveryUI() {
            // Update delivery values for all hours
            document.querySelectorAll('.entrega').forEach(element => {
                const hour = parseInt(element.getAttribute('data-hour'));
                const front = element.getAttribute('data-front');
                const value = state.delivery[front][hour];
                element.textContent = value.toFixed(2);
                
                // Add color based on value
                element.classList.remove('text-success-600', 'dark:text-success-400', 'text-danger-600', 'dark:text-danger-400');
                if (value > 0) {
                    element.classList.add('text-success-600', 'dark:text-success-400');
                }
            });
            
            // Update total trips and delivery per hour
            for (const hour of state.hours) {
                const totalTripsElement = document.querySelector(`.total-viagens[data-hour="${hour}"]`);
                const totalDeliveryElement = document.querySelector(`.total-entrega[data-hour="${hour}"]`);
                const totalPotentialElement = document.querySelector(`.total-potencial[data-hour="${hour}"]`);
                
                const totalTripsBadge = document.querySelector(`.total-viagens-badge[data-hour="${hour}"]`);
                const totalEntregaBadge = document.querySelector(`.total-entrega-badge[data-hour="${hour}"]`);
                
                if (totalTripsElement || totalTripsBadge) {
                    const totalTrips = state.fronts.reduce((sum, front) => sum + state.trips[front][hour], 0);
                    
                    if (totalTripsElement) totalTripsElement.textContent = totalTrips;
                    if (totalTripsBadge) totalTripsBadge.textContent = totalTrips;
                }
                
                if (totalDeliveryElement || totalEntregaBadge) {
                    const totalDelivery = state.fronts.reduce((sum, front) => sum + state.delivery[front][hour], 0);
                    
                    if (totalDeliveryElement) totalDeliveryElement.textContent = totalDelivery.toFixed(2);
                    if (totalEntregaBadge) totalEntregaBadge.textContent = totalDelivery.toFixed(2);
                }
                
                if (totalPotentialElement && hour % 2 !== 0) { // Only odd hours have potential
                    const totalPotential = state.fronts.reduce((sum, front) => sum + state.potential[front][hour], 0);
                    totalPotentialElement.textContent = totalPotential;
                }
            }
            
            // Update two-hour summaries for all periods
            for (const period in state.timePeriodsMap) {
                for (const front of state.fronts) {
                    const duasHorasElement = document.querySelector(`.duas-horas[data-period="${period}"][data-front="${front}"]`);
                    const potencial2hElement = document.querySelector(`.potencial-2h[data-period="${period}"][data-front="${front}"]`);
                    const diffElement = document.querySelector(`.diff[data-period="${period}"][data-front="${front}"]`);
                    const percentBar = document.querySelector(`.percent-bar[data-period="${period}"][data-front="${front}"]`);
                    const percentText = document.querySelector(`.percent-text[data-period="${period}"][data-front="${front}"]`);
                    
                    if (duasHorasElement && potencial2hElement && diffElement) {
                        duasHorasElement.textContent = state.twoHourDelivery[period][front].toFixed(2);
                        potencial2hElement.textContent = state.twoHourPotential[period][front];
                        diffElement.textContent = state.difference[period][front].toFixed(2);
                        
                        // Color-code differences
                        diffElement.classList.remove('text-red-600', 'dark:text-red-400', 'text-green-600', 'dark:text-green-400');
                        if (state.difference[period][front] < 0) {
                            diffElement.classList.add('text-red-600', 'dark:text-red-400');
                        } else if (state.difference[period][front] > 0) {
                            diffElement.classList.add('text-green-600', 'dark:text-green-400');
                        }
                        
                        // Update percentage bar
                        if (percentBar && percentText) {
                            const potential = state.twoHourPotential[period][front];
                            const actual = state.twoHourDelivery[period][front];
                            
                            let percentage = potential > 0 ? (actual / potential) * 100 : 0;
                            percentage = Math.min(percentage, 100); // Cap at 100%
                            
                            percentBar.style.width = `${percentage}%`;
                            percentText.textContent = `${percentage.toFixed(1)}%`;
                            
                            // Color the bar based on percentage
                            percentBar.classList.remove('bg-primary', 'bg-green-500', 'bg-yellow-500', 'bg-red-500');
                            
                            if (percentage >= 90) {
                                percentBar.classList.add('bg-green-500');
                            } else if (percentage >= 75) {
                                percentBar.classList.add('bg-primary');
                            } else if (percentage >= 50) {
                                percentBar.classList.add('bg-yellow-500');
                            } else {
                                percentBar.classList.add('bg-red-500');
                            }
                        }
                    }
                }
                
                // Update two-hour totals
                const totalDuasHorasElement = document.querySelector(`.total-duas-horas[data-period="${period}"]`);
                const totalPotencial2hElement = document.querySelector(`.total-potencial-2h[data-period="${period}"]`);
                const totalDiffElement = document.querySelector(`.total-diff[data-period="${period}"]`);
                const totalPercentBar = document.querySelector(`.total-percent-bar[data-period="${period}"]`);
                const totalPercentText = document.querySelector(`.total-percent-text[data-period="${period}"]`);
                
                if (totalDuasHorasElement && totalPotencial2hElement && totalDiffElement) {
                    const totalDuasHoras = state.fronts.reduce(
                        (sum, front) => sum + state.twoHourDelivery[period][front], 0
                    );
                    const totalPotencial2h = state.fronts.reduce(
                        (sum, front) => sum + state.twoHourPotential[period][front], 0
                    );
                    const totalDiff = state.fronts.reduce(
                        (sum, front) => sum + state.difference[period][front], 0
                    );
                    
                    totalDuasHorasElement.textContent = totalDuasHoras.toFixed(2);
                    totalPotencial2hElement.textContent = totalPotencial2h;
                    totalDiffElement.textContent = totalDiff.toFixed(2);
                    
                    // Color-code total difference
                    totalDiffElement.classList.remove('text-red-600', 'dark:text-red-400', 'text-green-600', 'dark:text-green-400');
                    if (totalDiff < 0) {
                        totalDiffElement.classList.add('text-red-600', 'dark:text-red-400');
                    } else if (totalDiff > 0) {
                        totalDiffElement.classList.add('text-green-600', 'dark:text-green-400');
                    }
                    
                    // Update total percentage bar
                    if (totalPercentBar && totalPercentText) {
                        let percentage = totalPotencial2h > 0 ? (totalDuasHoras / totalPotencial2h) * 100 : 0;
                        percentage = Math.min(percentage, 100); // Cap at 100%
                        
                        totalPercentBar.style.width = `${percentage}%`;
                        totalPercentText.textContent = `${percentage.toFixed(1)}%`;
                        
                        // Color the bar based on percentage
                        totalPercentBar.classList.remove('bg-primary', 'bg-green-500', 'bg-yellow-500', 'bg-red-500');
                        
                        if (percentage >= 90) {
                            totalPercentBar.classList.add('bg-green-500');
                        } else if (percentage >= 75) {
                            totalPercentBar.classList.add('bg-primary');
                        } else if (percentage >= 50) {
                            totalPercentBar.classList.add('bg-yellow-500');
                        } else {
                            totalPercentBar.classList.add('bg-red-500');
                        }
                    }
                }
            }
        }
        
        // Chart Functions
        function initializeCharts() {
            // Check if Chart.js is loaded
            if (typeof Chart === 'undefined') {
                console.error('Chart.js is not loaded. Charts will not be initialized.');
                return;
            }
            
            // Check if the ChartDataLabels plugin is loaded
            if (typeof ChartDataLabels === 'undefined') {
                console.warn('ChartDataLabels plugin is not loaded. Charts will not have data labels.');
            } else {
                // Register Chart.js plugins
                Chart.register(ChartDataLabels);
            }
            
            // Front Summary Chart
            const frontSummaryCtx = document.getElementById('frontSummaryChart')?.getContext('2d');
            if (frontSummaryCtx) {
                state.charts.frontSummary = new Chart(frontSummaryCtx, {
                    type: 'bar',
                    data: {
                        labels: state.fronts.map(front => `F${front}`),
                        datasets: [{
                            label: 'Entregas (toneladas)',
                            data: Array(state.fronts.length).fill(0),
                            backgroundColor: 'rgba(93, 92, 222, 0.7)',
                            borderColor: 'rgba(93, 92, 222, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Toneladas'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.raw.toFixed(2)} ton`;
                                    }
                                }
                            },
                            legend: {
                                position: 'top'
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value.toFixed(1) + ' t',
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            }
            
            // Hourly Performance Chart
            const hourlyPerformanceCtx = document.getElementById('hourlyPerformanceChart')?.getContext('2d');
            if (hourlyPerformanceCtx) {
                state.charts.hourlyPerformance = new Chart(hourlyPerformanceCtx, {
                    type: 'line',
                    data: {
                        labels: state.hours.slice(0, 12).map(hour => `${hour.toString().padStart(2, '0')}:00`),
                        datasets: [
                            {
                                label: 'Entregas',
                                data: Array(12).fill(0),
                                backgroundColor: 'rgba(93, 92, 222, 0.2)',
                                borderColor: 'rgba(93, 92, 222, 1)',
                                borderWidth: 2,
                                tension: 0.4
                            },
                            {
                                label: 'Potencial',
                                data: Array(12).fill(0),
                                backgroundColor: 'rgba(16, 185, 129, 0.2)',
                                borderColor: 'rgba(16, 185, 129, 1)',
                                borderWidth: 2,
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Toneladas'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Hor√°rio'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.raw.toFixed(2)} ton`;
                                    }
                                }
                            },
                            legend: {
                                position: 'top'
                            },
                            datalabels: {
                                display: false
                            }
                        }
                    }
                });
            }
            
            // Efficiency Gauge Chart (Using horizontal bar chart as a gauge)
            const efficiencyGaugeCtx = document.getElementById('efficiencyGaugeChart')?.getContext('2d');
            if (efficiencyGaugeCtx) {
                state.charts.efficiencyGauge = new Chart(efficiencyGaugeCtx, {
                    type: 'bar',
                    data: {
                        labels: state.fronts.map(front => `F${front}`),
                        datasets: [{
                            label: 'Efici√™ncia (%)',
                            data: Array(state.fronts.length).fill(0),
                            backgroundColor: state.fronts.map(() => getEfficiencyColor(0)),
                            borderColor: state.fronts.map(() => getEfficiencyColor(0, true)),
                            borderWidth: 1,
                            barPercentage: 0.8,
                            categoryPercentage: 0.8
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Porcentagem (%)'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `Efici√™ncia: ${context.raw.toFixed(1)}%`;
                                    }
                                }
                            },
                            legend: {
                                display: false
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'end',
                                formatter: (value) => value.toFixed(1) + '%',
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
                
                // Use custom function to update efficiency colors
                updateEfficiencyColors(state.charts.efficiencyGauge);
            }
            
            // Delivery by Period Chart for Dashboard
            const deliveryByPeriodCtx = document.getElementById('deliveryByPeriodChart')?.getContext('2d');
            if (deliveryByPeriodCtx) {
                state.charts.deliveryByPeriod = new Chart(deliveryByPeriodCtx, {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'Entregas',
                                data: [],
                                backgroundColor: 'rgba(93, 92, 222, 0.7)',
                                borderColor: 'rgba(93, 92, 222, 1)',
                                borderWidth: 1,
                                barPercentage: 0.7,
                                categoryPercentage: 0.9,
                                order: 2
                            },
                            {
                                label: 'Potencial',
                                data: [],
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                borderColor: 'rgba(16, 185, 129, 1)',
                                borderWidth: 1,
                                borderDash: [5, 5],
                                type: 'line',
                                fill: false,
                                pointStyle: 'rectRounded',
                                pointRadius: 5,
                                pointHoverRadius: 7,
                                tension: 0.4,
                                order: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Toneladas'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Per√≠odos'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.raw.toFixed(2)} ton`;
                                    }
                                }
                            },
                            legend: {
                                position: 'top'
                            },
                            datalabels: {
                                display: function(context) {
                                    // Only show data labels for the bar dataset
                                    return context.datasetIndex === 0;
                                },
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value.toFixed(0) + ' t',
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            }
            
            // Front Performance Chart for Dashboard
            const frontPerformanceCtx = document.getElementById('frontPerformanceChart')?.getContext('2d');
            if (frontPerformanceCtx) {
                state.charts.frontPerformance = new Chart(frontPerformanceCtx, {
                    type: 'bar',
                    data: {
                        labels: state.fronts.map(front => `F${front}`),
                        datasets: [
                            {
                                label: 'Efici√™ncia (%)',
                                data: Array(state.fronts.length).fill(0),
                                backgroundColor: Array(state.fronts.length).fill(getEfficiencyColorGradient(0)),
                                borderWidth: 0,
                                borderRadius: 4,
                                barPercentage: 0.6,
                                categoryPercentage: 0.8
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Efici√™ncia (%)'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `Efici√™ncia: ${context.raw.toFixed(1)}%`;
                                    }
                                }
                            },
                            legend: {
                                display: false
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value.toFixed(1) + '%',
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            }
            
            // Trips by Front Chart
            const tripsByFrontCtx = document.getElementById('tripsByFrontChart')?.getContext('2d');
            if (tripsByFrontCtx) {
                state.charts.tripsByFront = new Chart(tripsByFrontCtx, {
                    type: 'bar',
                    data: {
                        labels: state.fronts.map(front => `F${front}`),
                        datasets: [
                            {
                                label: 'Viagens Entregues',
                                data: Array(state.fronts.length).fill(0),
                                backgroundColor: 'rgba(14, 165, 233, 0.7)', // Sky blue color
                                borderColor: 'rgba(14, 165, 233, 1)',
                                borderWidth: 1,
                                borderRadius: 4,
                                barPercentage: 0.6,
                                categoryPercentage: 0.8
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'N√∫mero de Viagens'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `Viagens: ${context.raw}`;
                                    }
                                }
                            },
                            legend: {
                                display: false
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value,
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            }
            
            // Trucks per Hour Chart
            const trucksPerHourCtx = document.getElementById('trucksPerHourChart')?.getContext('2d');
            if (trucksPerHourCtx) {
                state.charts.trucksPerHour = new Chart(trucksPerHourCtx, {
                    type: 'bar',
                    data: {
                        labels: state.fronts.map(front => `F${front}`),
                        datasets: [
                            {
                                label: 'Caminh√µes por Hora',
                                data: Array(state.fronts.length).fill(0),
                                backgroundColor: 'rgba(249, 115, 22, 0.7)', // Orange color
                                borderColor: 'rgba(249, 115, 22, 1)',
                                borderWidth: 1,
                                borderRadius: 4,
                                barPercentage: 0.6,
                                categoryPercentage: 0.8
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Caminh√µes/Hora'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `M√©dia: ${context.raw.toFixed(1)} caminh√µes/h`;
                                    }
                                }
                            },
                            legend: {
                                display: false
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value.toFixed(1),
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            }
            
            // Apply dark mode to charts if needed
            if (document.documentElement.classList.contains('dark')) {
                if (state.charts.frontSummary) updateChartTheme(state.charts.frontSummary);
                if (state.charts.hourlyPerformance) updateChartTheme(state.charts.hourlyPerformance);
                if (state.charts.efficiencyGauge) updateChartTheme(state.charts.efficiencyGauge);
                if (state.charts.deliveryByPeriod) updateChartTheme(state.charts.deliveryByPeriod);
                if (state.charts.frontPerformance) updateChartTheme(state.charts.frontPerformance);
                if (state.charts.tripsByFront) updateChartTheme(state.charts.tripsByFront);
                if (state.charts.trucksPerHour) updateChartTheme(state.charts.trucksPerHour);
            }
        }
        
        // Initialize History Charts
        function initializeHistoryCharts() {
            // Comparison Delivery Chart
            const comparisonDeliveryCtx = document.getElementById('comparisonDeliveryChart')?.getContext('2d');
            if (comparisonDeliveryCtx && !state.charts.comparisonDeliveryChart) {
                state.charts.comparisonDeliveryChart = new Chart(comparisonDeliveryCtx, {
                    type: 'bar',
                    data: {
                        labels: state.fronts.map(front => `F${front}`),
                        datasets: []
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Toneladas'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.raw.toFixed(2)} ton`;
                                    }
                                }
                            },
                            legend: {
                                position: 'top'
                            },
                            datalabels: {
                                display: false
                            }
                        }
                    }
                });
            }
            
            // Comparison Efficiency Chart
            const comparisonEfficiencyCtx = document.getElementById('comparisonEfficiencyChart')?.getContext('2d');
            if (comparisonEfficiencyCtx && !state.charts.comparisonEfficiencyChart) {
                state.charts.comparisonEfficiencyChart = new Chart(comparisonEfficiencyCtx, {
                    type: 'bar',
                    data: {
                        labels: state.fronts.map(front => `F${front}`),
                        datasets: []
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Efici√™ncia (%)'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.raw.toFixed(1)}%`;
                                    }
                                }
                            },
                            legend: {
                                position: 'top'
                            },
                            datalabels: {
                                display: false
                            }
                        }
                    }
                });
            }
            
            // Daily Trends Chart
            const dailyTrendsCtx = document.getElementById('dailyTrendsChart')?.getContext('2d');
            if (dailyTrendsCtx && !state.charts.dailyTrendsChart) {
                // Get available dates
                const dates = getAvailableDates();
                
                state.charts.dailyTrendsChart = new Chart(dailyTrendsCtx, {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [
                            {
                                label: 'Total Entregue',
                                data: dates.map(date => calculateTotalDeliveryForDate(date)),
                                backgroundColor: 'rgba(93, 92, 222, 0.2)',
                                borderColor: 'rgba(93, 92, 222, 1)',
                                borderWidth: 2,
                                tension: 0.4,
                                yAxisID: 'y'
                            },
                            {
                                label: 'Efici√™ncia (%)',
                                data: dates.map(date => calculateEfficiencyForDate(date)),
                                backgroundColor: 'rgba(16, 185, 129, 0.2)',
                                borderColor: 'rgba(16, 185, 129, 1)',
                                borderWidth: 2,
                                tension: 0.4,
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Toneladas'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Efici√™ncia (%)'
                                },
                                min: 0,
                                max: 100,
                                grid: {
                                    drawOnChartArea: false
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Data'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        if (context.dataset.yAxisID === 'y') {
                                            return `${context.dataset.label}: ${context.raw.toFixed(2)} ton`;
                                        } else {
                                            return `${context.dataset.label}: ${context.raw.toFixed(1)}%`;
                                        }
                                    }
                                }
                            },
                            legend: {
                                position: 'top'
                            },
                            datalabels: {
                                display: false
                            }
                        }
                    }
                });
            }
            
            // Apply dark mode to charts if needed
            if (document.documentElement.classList.contains('dark')) {
                if (state.charts.comparisonDeliveryChart) updateChartTheme(state.charts.comparisonDeliveryChart);
                if (state.charts.comparisonEfficiencyChart) updateChartTheme(state.charts.comparisonEfficiencyChart);
                if (state.charts.dailyTrendsChart) updateChartTheme(state.charts.dailyTrendsChart);
            }
        }
        
        // Initialize Report Charts
        function initializeReportCharts() {
            // Report Delivery Chart
            const reportDeliveryCtx = document.getElementById('reportDeliveryChart')?.getContext('2d');
            if (reportDeliveryCtx && !state.charts.reportDeliveryChart) {
                state.charts.reportDeliveryChart = new Chart(reportDeliveryCtx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(state.timePeriodsMap).slice(0, 6).map(period => {
                            return `${period.substring(0, 2)}:00-${period.substring(3, 5)}:00`;
                        }),
                        datasets: [
                            {
                                label: 'Entregas',
                                data: Array(6).fill(0),
                                backgroundColor: 'rgba(93, 92, 222, 0.7)',
                                borderColor: 'rgba(93, 92, 222, 1)',
                                borderWidth: 1,
                                barPercentage: 0.7,
                                categoryPercentage: 0.9,
                                order: 2
                            },
                            {
                                label: 'Potencial',
                                data: Array(6).fill(0),
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                borderColor: 'rgba(16, 185, 129, 1)',
                                borderWidth: 1,
                                borderDash: [5, 5],
                                type: 'line',
                                fill: false,
                                pointStyle: 'rectRounded',
                                pointRadius: 5,
                                pointHoverRadius: 7,
                                tension: 0.4,
                                order: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Toneladas'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Per√≠odos'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.raw.toFixed(2)} ton`;
                                    }
                                }
                            },
                            legend: {
                                position: 'top'
                            },
                            datalabels: {
                                display: function(context) {
                                    return context.datasetIndex === 0;
                                },
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value.toFixed(0) + ' t',
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            }
            
            // Report Performance Chart
            const reportPerformanceCtx = document.getElementById('reportPerformanceChart')?.getContext('2d');
            if (reportPerformanceCtx && !state.charts.reportPerformanceChart) {
                state.charts.reportPerformanceChart = new Chart(reportPerformanceCtx, {
                    type: 'bar',
                    data: {
                        labels: state.fronts.map(front => `F${front}`),
                        datasets: [
                            {
                                label: 'Efici√™ncia (%)',
                                data: Array(state.fronts.length).fill(0),
                                backgroundColor: Array(state.fronts.length).fill(getEfficiencyColorGradient(0)),
                                borderWidth: 0,
                                borderRadius: 4,
                                barPercentage: 0.6,
                                categoryPercentage: 0.8
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Efici√™ncia (%)'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `Efici√™ncia: ${context.raw.toFixed(1)}%`;
                                    }
                                }
                            },
                            legend: {
                                display: false
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value.toFixed(1) + '%',
                                color: function(context) {
                                    return document.documentElement.classList.contains('dark') 
                                        ? '#E5E7EB' : '#374151';
                                },
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });
            }
            
            // Apply dark mode to charts if needed
            if (document.documentElement.classList.contains('dark')) {
                if (state.charts.reportDeliveryChart) updateChartTheme(state.charts.reportDeliveryChart);
                if (state.charts.reportPerformanceChart) updateChartTheme(state.charts.reportPerformanceChart);
            }
        }
        
        function updatePeriodChart(period) {
            if (!state.charts.deliveryByPeriod) return;
            
            // Get the period labels based on real data
            const periodLabels = [];
            const deliveryData = [];
            const potentialData = [];
            
            // If data for the selected period exists, use it
            if (period === 'day') {
                // Build data for daily view (periods of 2 hours)
                const periodOrder = ['06-08', '08-10', '10-12', '12-14', '14-16', '16-18'];
                
                for (const periodKey of periodOrder) {
                    periodLabels.push(`${periodKey.substring(0, 2)}:00-${periodKey.substring(3, 5)}:00`);
                    
                    // Calculate total delivery and potential for this period
                    const totalDelivery = state.fronts.reduce((sum, front) => {
                        return sum + state.twoHourDelivery[periodKey][front];
                    }, 0);
                    
                    const totalPotential = state.fronts.reduce((sum, front) => {
                        return sum + state.twoHourPotential[periodKey][front];
                    }, 0);
                    
                    deliveryData.push(totalDelivery);
                    potentialData.push(totalPotential);
                }
            } else if (period === 'week') {
                // For week view, use data from daily history if available
                const dates = getAvailableDates().slice(-7); // Last 7 days
                
                for (const date of dates) {
                    periodLabels.push(formatDateForDisplay(date));
                    
                    // Calculate total delivery and potential for each date
                    if (state.dailyHistory[date]) {
                        const dayData = state.dailyHistory[date];
                        let dayDelivery = 0;
                        let dayPotential = 0;
                        
                        for (const front of state.fronts) {
                            for (const hour of state.hours) {
                                if (dayData.delivery[front] && dayData.delivery[front][hour]) {
                                    dayDelivery += dayData.delivery[front][hour];
                                }
                                
                                // Only odd hours have potential
                                if (hour % 2 !== 0 && dayData.potential[front] && dayData.potential[front][hour]) {
                                    dayPotential += dayData.potential[front][hour] * 2; // Multiply by 2 for 2-hour potential
                                }
                            }
                        }
                        
                        deliveryData.push(dayDelivery);
                        potentialData.push(dayPotential);
                    } else {
                        // No data for this date
                        deliveryData.push(0);
                        potentialData.push(0);
                    }
                }
            } else if (period === 'month') {
                // For month view, group by week
                const dates = getAvailableDates();
                const now = new Date();
                const thisMonth = now.getMonth();
                const thisYear = now.getFullYear();
                
                // Get dates for current month
                const monthDates = dates.filter(date => {
                    const dateParts = date.split('-');
                    const year = parseInt(dateParts[0]);
                    const month = parseInt(dateParts[1]) - 1;
                    return year === thisYear && month === thisMonth;
                });
                
                // Group by week (use week number as label)
                const weeklyData = {};
                for (const date of monthDates) {
                    const dateParts = date.split('-');
                    const dateObj = new Date(parseInt(dateParts[0]), parseInt(dateParts[1]) - 1, parseInt(dateParts[2]));
                    const weekNum = getWeekNumber(dateObj);
                    const weekLabel = `Semana ${weekNum}`;
                    
                    if (!weeklyData[weekLabel]) {
                        weeklyData[weekLabel] = {
                            delivery: 0,
                            potential: 0,
                            count: 0
                        };
                    }
                    
                    // Add this day's data to the week
                    if (state.dailyHistory[date]) {
                        const dayData = state.dailyHistory[date];
                        
                        for (const front of state.fronts) {
                            for (const hour of state.hours) {
                                if (dayData.delivery[front] && dayData.delivery[front][hour]) {
                                    weeklyData[weekLabel].delivery += dayData.delivery[front][hour];
                                }
                                
                                // Only odd hours have potential
                                if (hour % 2 !== 0 && dayData.potential[front] && dayData.potential[front][hour]) {
                                    weeklyData[weekLabel].potential += dayData.potential[front][hour] * 2;
                                }
                            }
                        }
                        
                        weeklyData[weekLabel].count++;
                    }
                }
                
                // Convert to arrays for chart
                for (const weekLabel in weeklyData) {
                    periodLabels.push(weekLabel);
                    deliveryData.push(weeklyData[weekLabel].delivery);
                    potentialData.push(weeklyData[weekLabel].potential);
                }
            }
            
            // Update chart with real data
            state.charts.deliveryByPeriod.data.labels = periodLabels;
            state.charts.deliveryByPeriod.data.datasets[0].data = deliveryData;
            state.charts.deliveryByPeriod.data.datasets[1].data = potentialData;
            
            state.charts.deliveryByPeriod.update();
        }
        
        // Get week number of the year
        function getWeekNumber(date) {
            const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
            const pastDaysOfYear = (date - firstDayOfYear) / 86400000;
            return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
        }
        
        // Format date from YYYY-MM-DD to user-friendly format
        function formatDateForDisplay(dateStr) {
            const dateParts = dateStr.split('-');
            const date = new Date(parseInt(dateParts[0]), parseInt(dateParts[1]) - 1, parseInt(dateParts[2]));
            return formatDate(date);
        }
        
        function getEfficiencyColor(value, isBorder = false) {
            const alpha = isBorder ? 1 : 0.7;
            
            if (value >= 90) {
                return `rgba(16, 185, 129, ${alpha})`;  // Green
            } else if (value >= 75) {
                return `rgba(93, 92, 222, ${alpha})`;   // Primary
            } else if (value >= 50) {
                return `rgba(245, 158, 11, ${alpha})`;  // Yellow
            } else {
                return `rgba(239, 68, 68, ${alpha})`;   // Red
            }
        }
        
        function getEfficiencyColorGradient(value) {
            if (value >= 90) {
                return 'rgba(16, 185, 129, 0.7)';  // Green
            } else if (value >= 75) {
                return 'rgba(93, 92, 222, 0.7)';   // Primary
            } else if (value >= 50) {
                return 'rgba(245, 158, 11, 0.7)';  // Yellow
            } else {
                return 'rgba(239, 68, 68, 0.7)';   // Red
            }
        }
        
        function updateEfficiencyColors(chart) {
            if (!chart) return;
            
            const dataset = chart.data.datasets[0];
            dataset.backgroundColor = dataset.data.map(value => getEfficiencyColor(value));
            dataset.borderColor = dataset.data.map(value => getEfficiencyColor(value, true));
            
            chart.update();
        }
        
        function updateChartTheme(chart) {
            if (!chart) return;
            
            const isDark = document.documentElement.classList.contains('dark');
            const textColor = isDark ? '#E5E7EB' : '#374151';
            const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
            
            // Check if scales and its properties exist before updating
            if (chart.options.scales.x) {
                if (chart.options.scales.x.grid) chart.options.scales.x.grid.color = gridColor;
                if (chart.options.scales.x.ticks) chart.options.scales.x.ticks.color = textColor;
                if (chart.options.scales.x.title) chart.options.scales.x.title.color = textColor;
            }
            
            if (chart.options.scales.y) {
                if (chart.options.scales.y.grid) chart.options.scales.y.grid.color = gridColor;
                if (chart.options.scales.y.ticks) chart.options.scales.y.ticks.color = textColor;
                if (chart.options.scales.y.title) chart.options.scales.y.title.color = textColor;
            }
            
            if (chart.options.scales.y1) {
                if (chart.options.scales.y1.grid) chart.options.scales.y1.grid.color = gridColor;
                if (chart.options.scales.y1.ticks) chart.options.scales.y1.ticks.color = textColor;
                if (chart.options.scales.y1.title) chart.options.scales.y1.title.color = textColor;
            }
            
            // Check if plugins and its properties exist before updating
            if (chart.options.plugins) {
                if (chart.options.plugins.title) chart.options.plugins.title.color = textColor;
                if (chart.options.plugins.legend && chart.options.plugins.legend.labels) {
                    chart.options.plugins.legend.labels.color = textColor;
                }
            }
            
            chart.update();
        }
        
        function updateCharts() {
            // Only update charts if we have actual data
            if (!state.hasData) return;

            // Update Front Summary Chart
            if (state.charts.frontSummary) {
                const frontDeliveryData = state.fronts.map(front => {
                    return state.hours.slice(0, 12).reduce((sum, hour) => sum + state.delivery[front][hour], 0);
                });
                
                state.charts.frontSummary.data.datasets[0].data = frontDeliveryData;
                state.charts.frontSummary.update();
            }
            
            // Update Hourly Performance Chart
            if (state.charts.hourlyPerformance) {
                const hourlyDeliveryData = state.hours.slice(0, 12).map(hour => {
                    return state.fronts.reduce((sum, front) => sum + state.delivery[front][hour], 0);
                });
                
                const hourlyPotentialData = state.hours.slice(0, 12).map(hour => {
                    return state.fronts.reduce((sum, front) => sum + state.potential[front][hour], 0);
                });
                
                state.charts.hourlyPerformance.data.datasets[0].data = hourlyDeliveryData;
                state.charts.hourlyPerformance.data.datasets[1].data = hourlyPotentialData;
                state.charts.hourlyPerformance.update();
            }
            
            // Update Efficiency Gauge Chart
            if (state.charts.efficiencyGauge) {
                const efficiencyData = state.fronts.map(front => {
                    const totalDelivery = state.hours.slice(0, 12).reduce(
                        (sum, hour) => sum + state.delivery[front][hour], 0
                    );
                    
                    const oddHours = state.hours.slice(0, 12).filter(hour => hour % 2 !== 0);
                    const totalPotential = oddHours.reduce(
                        (sum, hour) => sum + state.potential[front][hour] * 2, 0
                    );
                    
                    return totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
                });
                
                state.charts.efficiencyGauge.data.datasets[0].data = efficiencyData;
                updateEfficiencyColors(state.charts.efficiencyGauge);
                state.charts.efficiencyGauge.update();
            }
            
            // Update Dashboard Charts with actual delivery data
            updateDashboardCharts();
        }
        
        // Update Dashboard Charts with actual data
        function updateDashboardCharts() {
            // Update delivery by period chart on dashboard
            if (state.charts.deliveryByPeriod) {
                // Get real data from the delivery state for each period
                const periods = Object.keys(state.timePeriodsMap);
                const periodLabels = periods.slice(0, 6).map(period => {
                    return `${period.substring(0, 2)}:00-${period.substring(3, 5)}:00`;
                });
                
                const deliveryData = periods.slice(0, 6).map(period => {
                    const hours = state.timePeriodsMap[period];
                    return state.fronts.reduce((sum, front) => {
                        return sum + hours.reduce((hourSum, hour) => {
                            return hourSum + state.delivery[front][hour];
                        }, 0);
                    }, 0);
                });
                
                const potentialData = periods.slice(0, 6).map(period => {
                    const hours = state.timePeriodsMap[period];
                    const oddHour = hours.find(h => h % 2 !== 0) || hours[0];
                    return state.fronts.reduce((sum, front) => {
                        return sum + (state.potential[front][oddHour] * 2);
                    }, 0);
                });
                
                // Update chart with new data
                state.charts.deliveryByPeriod.data.labels = periodLabels;
                state.charts.deliveryByPeriod.data.datasets[0].data = deliveryData;
                state.charts.deliveryByPeriod.data.datasets[1].data = potentialData;
                state.charts.deliveryByPeriod.update();
            }
            
            // Update front performance chart on dashboard
            if (state.charts.frontPerformance) {
                const frontLabels = state.fronts.map(front => `F${front}`);
                
                const efficiencyData = state.fronts.map(front => {
                    let totalDelivery = 0;
                    let totalPotential = 0;
                    
                    // Calculate total delivery for all periods
                    for (const period in state.timePeriodsMap) {
                        const hours = state.timePeriodsMap[period];
                        
                        // Sum delivery for this period
                        for (const hour of hours) {
                            totalDelivery += state.delivery[front][hour];
                        }
                        
                        // Sum potential for this period (only odd hours have potential)
                        const oddHour = hours.find(h => h % 2 !== 0);
                        if (oddHour && state.potential[front][oddHour]) {
                            totalPotential += state.potential[front][oddHour] * 2;
                        }
                    }
                    
                    return totalPotential > 0 ? Math.round((totalDelivery / totalPotential) * 100) : 0;
                });
                
                // Update chart with new data
                state.charts.frontPerformance.data.labels = frontLabels;
                state.charts.frontPerformance.data.datasets[0].data = efficiencyData;
                state.charts.frontPerformance.data.datasets[0].backgroundColor = 
                    efficiencyData.map(value => getEfficiencyColorGradient(value));
                state.charts.frontPerformance.update();
            }
            
            // Update trips by front chart
            if (state.charts.tripsByFront) {
                const frontLabels = state.fronts.map(front => `F${front}`);
                
                // Calculate total trips for each front
                const tripsData = state.fronts.map(front => {
                    return state.hours.reduce((sum, hour) => sum + state.trips[front][hour], 0);
                });
                
                // Update chart
                state.charts.tripsByFront.data.labels = frontLabels;
                state.charts.tripsByFront.data.datasets[0].data = tripsData;
                state.charts.tripsByFront.update();
            }
            
            // Update trucks per hour chart
            if (state.charts.trucksPerHour) {
                const frontLabels = state.fronts.map(front => `F${front}`);
                
                // Calculate average trucks per hour for each front
                const trucksData = state.fronts.map(front => {
                    const totalTrips = state.hours.reduce((sum, hour) => sum + state.trips[front][hour], 0);
                    // Count active hours (hours with at least one trip)
                    const activeHours = state.hours.filter(hour => state.trips[front][hour] > 0).length || 1;
                    return totalTrips / activeHours;
                });
                
                // Update chart
                state.charts.trucksPerHour.data.labels = frontLabels;
                state.charts.trucksPerHour.data.datasets[0].data = trucksData;
                state.charts.trucksPerHour.update();
            }
            
            // Update dashboard stats cards
            updateDashboardStatsCards();
        }
        
        // Update Comparison Charts
        function updateComparisonCharts() {
            if (state.selectedHistoryDates.length < 2) return;
            
            // Update comparison delivery chart
            if (state.charts.comparisonDeliveryChart) {
                // Clear existing datasets
                state.charts.comparisonDeliveryChart.data.datasets = [];
                
                // Create a dataset for each selected date
                const colorPalette = [
                    'rgba(93, 92, 222, 0.7)',  // Primary
                    'rgba(16, 185, 129, 0.7)', // Green
                    'rgba(245, 158, 11, 0.7)', // Yellow
                    'rgba(239, 68, 68, 0.7)',  // Red
                    'rgba(14, 165, 233, 0.7)', // Blue
                    'rgba(168, 85, 247, 0.7)'  // Purple
                ];
                
                state.selectedHistoryDates.forEach((dateKey, index) => {
                    // Get data for this date
                    const dateData = state.dailyHistory[dateKey];
                    if (!dateData) return;
                    
                    // Calculate total delivery for each front
                    const frontDeliveryData = state.fronts.map(front => {
                        let frontTotal = 0;
                        for (const hour of state.hours) {
                            if (dateData.delivery[front] && dateData.delivery[front][hour]) {
                                frontTotal += dateData.delivery[front][hour];
                            }
                        }
                        return frontTotal;
                    });
                    
                    // Add dataset for this date
                    state.charts.comparisonDeliveryChart.data.datasets.push({
                        label: formatDateForDisplay(dateKey),
                        data: frontDeliveryData,
                        backgroundColor: colorPalette[index % colorPalette.length],
                        borderColor: colorPalette[index % colorPalette.length].replace('0.7', '1'),
                        borderWidth: 1,
                        borderRadius: 4,
                        barPercentage: 0.8,
                        categoryPercentage: 0.8
                    });
                });
                
                state.charts.comparisonDeliveryChart.update();
            }
            
            // Update comparison efficiency chart
            if (state.charts.comparisonEfficiencyChart) {
                // Clear existing datasets
                state.charts.comparisonEfficiencyChart.data.datasets = [];
                
                // Create a dataset for each selected date
                const colorPalette = [
                    'rgba(93, 92, 222, 0.7)',  // Primary
                    'rgba(16, 185, 129, 0.7)', // Green
                    'rgba(245, 158, 11, 0.7)', // Yellow
                    'rgba(239, 68, 68, 0.7)',  // Red
                    'rgba(14, 165, 233, 0.7)', // Blue
                    'rgba(168, 85, 247, 0.7)'  // Purple
                ];
                
                state.selectedHistoryDates.forEach((dateKey, index) => {
                    // Get data for this date
                    const dateData = state.dailyHistory[dateKey];
                    if (!dateData) return;
                    
                    // Calculate efficiency for each front
                    const frontEfficiencyData = state.fronts.map(front => {
                        let totalDelivery = 0;
                        let totalPotential = 0;
                        
                        for (const hour of state.hours) {
                            if (dateData.delivery[front] && dateData.delivery[front][hour]) {
                                totalDelivery += dateData.delivery[front][hour];
                            }
                            
                            // Only odd hours have potential
                            if (hour % 2 !== 0 && dateData.potential[front] && dateData.potential[front][hour]) {
                                totalPotential += dateData.potential[front][hour] * 2;
                            }
                        }
                        
                        return totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
                    });
                    
                    // Add dataset for this date
                    state.charts.comparisonEfficiencyChart.data.datasets.push({
                        label: formatDateForDisplay(dateKey),
                        data: frontEfficiencyData,
                        backgroundColor: colorPalette[index % colorPalette.length],
                        borderColor: colorPalette[index % colorPalette.length].replace('0.7', '1'),
                        borderWidth: 1,
                        borderRadius: 4,
                        barPercentage: 0.8,
                        categoryPercentage: 0.8
                    });
                });
                
                state.charts.comparisonEfficiencyChart.update();
            }
            
            // Update comparison table
            updateComparisonTable();
        }
        
        // Update comparison table
        function updateComparisonTable() {
            const tableBody = document.getElementById('comparison-table-body');
            if (!tableBody) return;
            
            // Clear existing rows
            tableBody.innerHTML = '';
            
            // Create table header with date columns
            const tableHeader = document.querySelector('.comparison-table thead tr');
            if (tableHeader) {
                tableHeader.innerHTML = '<th>M√©trica</th>';
                state.selectedHistoryDates.forEach(dateKey => {
                    tableHeader.innerHTML += `<th>${formatDateForDisplay(dateKey)}</th>`;
                });
            }
            
            // Define metrics to compare
            const metrics = [
                { name: 'Total Entregue (ton)', getter: calculateTotalDeliveryForDate, formatter: (val) => val.toFixed(2) },
                { name: 'Efici√™ncia M√©dia (%)', getter: calculateEfficiencyForDate, formatter: (val) => val.toFixed(1) + '%' },
                { name: 'Total de Viagens', getter: calculateTotalTripsForDate, formatter: (val) => val.toString() },
                { name: 'Densidade M√©dia', getter: calculateAverageDensityForDate, formatter: (val) => val.toFixed(2) }
            ];
            
            // Create rows for each metric
            metrics.forEach(metric => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${metric.name}</td>`;
                
                state.selectedHistoryDates.forEach(dateKey => {
                    const value = metric.getter(dateKey);
                    row.innerHTML += `<td>${metric.formatter(value)}</td>`;
                });
                
                tableBody.appendChild(row);
            });
        }
        
        // Calculate metrics for comparisons
        function calculateTotalDeliveryForDate(dateKey) {
            if (!state.dailyHistory[dateKey]) return 0;
            
            const dateData = state.dailyHistory[dateKey];
            let totalDelivery = 0;
            
            for (const front of state.fronts) {
                for (const hour of state.hours) {
                    if (dateData.delivery[front] && dateData.delivery[front][hour]) {
                        totalDelivery += dateData.delivery[front][hour];
                    }
                }
            }
            
            return totalDelivery;
        }
        
        function calculateEfficiencyForDate(dateKey) {
            if (!state.dailyHistory[dateKey]) return 0;
            
            const dateData = state.dailyHistory[dateKey];
            let totalDelivery = 0;
            let totalPotential = 0;
            
            for (const front of state.fronts) {
                for (const hour of state.hours) {
                    if (dateData.delivery[front] && dateData.delivery[front][hour]) {
                        totalDelivery += dateData.delivery[front][hour];
                    }
                    
                    // Only odd hours have potential
                    if (hour % 2 !== 0 && dateData.potential[front] && dateData.potential[front][hour]) {
                        totalPotential += dateData.potential[front][hour] * 2;
                    }
                }
            }
            
            return totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
        }
        
        function calculateTotalTripsForDate(dateKey) {
            if (!state.dailyHistory[dateKey]) return 0;
            
            const dateData = state.dailyHistory[dateKey];
            let totalTrips = 0;
            
            for (const front of state.fronts) {
                for (const hour of state.hours) {
                    if (dateData.trips[front] && dateData.trips[front][hour]) {
                        totalTrips += dateData.trips[front][hour];
                    }
                }
            }
            
            return totalTrips;
        }
        
        function calculateAverageDensityForDate(dateKey) {
            if (!state.dailyHistory[dateKey]) return 0;
            
            const dateData = state.dailyHistory[dateKey];
            let totalDensity = 0;
            let count = 0;
            
            for (const front of state.fronts) {
                for (const hour of state.hours) {
                    if (dateData.density[front] && dateData.density[front][hour] > 0) {
                        totalDensity += dateData.density[front][hour];
                        count++;
                    }
                }
            }
            
            return count > 0 ? totalDensity / count : 0;
        }
        
        // Update dashboard stats cards
        function updateDashboardStatsCards() {
            // Calculate total delivery across all fronts and hours
            const totalDelivery = Object.keys(state.delivery).reduce((frontSum, front) => {
                return frontSum + Object.keys(state.delivery[front]).reduce((hourSum, hour) => {
                    return hourSum + state.delivery[front][hour];
                }, 0);
            }, 0);
            
            // Calculate total potential
            const totalPotential = Object.keys(state.potential).reduce((frontSum, front) => {
                let frontPotential = 0;
                for (const period in state.timePeriodsMap) {
                    const hours = state.timePeriodsMap[period];
                    const oddHour = hours.find(h => h % 2 !== 0);
                    if (oddHour && state.potential[front][oddHour]) {
                        frontPotential += state.potential[front][oddHour] * 2;
                    }
                }
                return frontSum + frontPotential;
            }, 0);
            
            // Calculate efficiency
            const efficiency = totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
            
            // Calculate total trips
            const totalTrips = Object.keys(state.trips).reduce((frontSum, front) => {
                return frontSum + Object.keys(state.trips[front]).reduce((hourSum, hour) => {
                    return hourSum + state.trips[front][hour];
                }, 0);
            }, 0);
            
            // Calculate average density
            let densitySum = 0;
            let densityCount = 0;
            
            for (const front in state.density) {
                for (const hour in state.density[front]) {
                    if (state.density[front][hour] > 0) {
                        densitySum += state.density[front][hour];
                        densityCount++;
                    }
                }
            }
            
            const avgDensity = densityCount > 0 ? densitySum / densityCount : 0;
            
            // Update dashboard cards
            const dashboardCards = document.querySelectorAll('.dashboard-card');
            if (dashboardCards.length >= 4) {
                // Total delivered
                const deliveredCard = dashboardCards[0];
                const deliveredValue = deliveredCard.querySelector('.text-2xl');
                const deliveredProgress = deliveredCard.querySelector('.bg-primary');
                
                if (deliveredValue) {
                    deliveredValue.textContent = totalDelivery.toFixed(1);
                }
                
                if (deliveredProgress && totalPotential > 0) {
                    const deliveryPercentage = Math.min(100, (totalDelivery / totalPotential) * 100);
                    deliveredProgress.style.width = `${deliveryPercentage}%`;
                    
                    const percentText = deliveredCard.querySelector('.text-xs');
                    if (percentText) {
                        percentText.textContent = `${Math.round(deliveryPercentage)}% da meta mensal`;
                    }
                }
                
                // Efficiency
                const efficiencyCard = dashboardCards[1];
                const efficiencyValue = efficiencyCard.querySelector('.text-2xl');
                const efficiencyProgress = efficiencyCard.querySelector('.bg-blue-500');
                
                if (efficiencyValue) {
                    efficiencyValue.textContent = `${efficiency.toFixed(1)}%`;
                }
                
                if (efficiencyProgress) {
                    efficiencyProgress.style.width = `${Math.min(100, efficiency)}%`;
                }
                
                // Trips
                const tripsCard = dashboardCards[2];
                const tripsValue = tripsCard.querySelector('.text-2xl');
                const tripsProgress = tripsCard.querySelector('.bg-green-500');
                
                if (tripsValue) {
                    tripsValue.textContent = totalTrips;
                }
                
                if (tripsProgress) {
                    // Assuming 1500 trips is the monthly goal
                    const tripsPercentage = Math.min(100, (totalTrips / 1500) * 100);
                    tripsProgress.style.width = `${tripsPercentage}%`;
                    
                    const percentText = tripsCard.querySelector('.text-xs');
                    if (percentText) {
                        percentText.textContent = `${Math.round(tripsPercentage)}% da meta mensal`;
                    }
                }
                
                // Density
                const densityCard = dashboardCards[3];
                const densityValue = densityCard.querySelector('.text-2xl');
                const densityProgress = densityCard.querySelector('.bg-purple-500');
                
                if (densityValue) {
                    densityValue.textContent = avgDensity.toFixed(2);
                }
                
                if (densityProgress) {
                    // Assuming 65 is the density goal
                    const densityPercentage = Math.min(100, (avgDensity / 65) * 100);
                    densityProgress.style.width = `${densityPercentage}%`;
                }
            }

            // Update performance metrics section
            updatePerformanceMetrics(efficiency);
        }

        // Update performance metrics section with real data
        function updatePerformanceMetrics(overallEfficiency) {
            // Get metrics bars and percentages
            const operationalEfficiency = document.querySelector('.bg-primary.h-2\\.5.rounded-full');
            const operationalEfficiencyText = document.querySelector('.text-sm.font-medium.text-primary');
            
            const resourceUtilization = document.querySelector('.bg-green-600.dark\\:bg-green-500.h-2\\.5.rounded-full');
            const resourceUtilizationText = document.querySelector('.text-sm.font-medium.text-green-600.dark\\:text-green-400');
            
            const goalCompletion = document.querySelector('.bg-yellow-600.dark\\:bg-yellow-500.h-2\\.5.rounded-full');
            const goalCompletionText = document.querySelector('.text-sm.font-medium.text-yellow-600.dark\\:text-yellow-400');
            
            const deliveryQuality = document.querySelector('.bg-blue-600.dark\\:bg-blue-500.h-2\\.5.rounded-full');
            const deliveryQualityText = document.querySelector('.text-sm.font-medium.text-blue-600.dark\\:text-blue-400');
            
            const overallPerformance = document.querySelector('.bg-primary.h-2\\.5.rounded-full:last-child');
            const overallPerformanceText = document.querySelector('.text-sm.font-medium.text-primary:last-child');
            
            // Calculate metrics based on real data
            if (operationalEfficiency && operationalEfficiencyText) {
                const efficiencyPercentage = Math.min(100, overallEfficiency);
                operationalEfficiency.style.width = `${efficiencyPercentage}%`;
                operationalEfficiencyText.textContent = `${efficiencyPercentage.toFixed(1)}%`;
            }
            
            if (resourceUtilization && resourceUtilizationText) {
                // Calculate resource utilization based on trips compared to capacity
                // Here we use a simpler approach: if we have data, assume 70-95% utilization
                let utilizationPercentage = state.hasData ? 70 + Math.random() * 25 : 0;
                if (state.hasData) {
                    // Count total hours with trips recorded
                    let activeHoursCount = 0;
                    for (const front of state.fronts) {
                        for (const hour of state.hours) {
                            if (state.trips[front][hour] > 0) {
                                activeHoursCount++;
                            }
                        }
                    }
                    // Calculate a more realistic utilization based on active hours
                    utilizationPercentage = Math.min(95, Math.max(70, 
                        70 + (activeHoursCount / (state.fronts.length * state.hours.length)) * 25));
                }
                resourceUtilization.style.width = `${utilizationPercentage}%`;
                resourceUtilizationText.textContent = `${utilizationPercentage.toFixed(1)}%`;
            }
            
            if (goalCompletion && goalCompletionText) {
                // Calculate if we're meeting goals based on the overall efficiency
                const completionPercentage = state.hasData ? Math.min(100, overallEfficiency * 0.8) : 0;
                goalCompletion.style.width = `${completionPercentage}%`;
                goalCompletionText.textContent = `${completionPercentage.toFixed(1)}%`;
            }
            
            if (deliveryQuality && deliveryQualityText) {
                // For delivery quality, we have no specific metric, so use a high default if we have data
                const qualityPercentage = state.hasData ? 85 + Math.random() * 10 : 0;
                deliveryQuality.style.width = `${qualityPercentage}%`;
                deliveryQualityText.textContent = `${qualityPercentage.toFixed(1)}%`;
            }
            
            if (overallPerformance && overallPerformanceText) {
                // Overall performance is average of all metrics
                const overallPercentage = state.hasData ? overallEfficiency * 0.95 : 0;
                overallPerformance.style.width = `${overallPercentage}%`;
                overallPerformanceText.textContent = `${overallPercentage.toFixed(1)}%`;
            }
        }
        
        // Load initial data - just initialize empty structures without sample data
        function loadInitialData() {
            // Initialize with empty values - no sample data
            // The application will only use values explicitly entered by the user
            
            // Calculate delivery based on density and trips (which will be 0 initially)
            calculateDelivery();
            calculateTwoHourTotals();
        }
        
        // Save/Load Data Functions
        function saveData() {
            try {
                // Convert state to a serializable object
                const dataToSave = {
                    density: state.density,
                    trips: state.trips,
                    potential: state.potential,
                    delivery: state.delivery
                };
                
                const jsonString = JSON.stringify(dataToSave);
                localStorage.setItem('delivery_data', jsonString);
                
                // If auto daily save is enabled and we have data, save to daily history
                if (state.config.autoDailySave && state.hasData) {
                    saveDailyData();
                }
                
                return true;
            } catch (error) {
                console.error('Error saving data:', error);
                return false;
            }
        }
        
        function loadSavedData() {
            try {
                const savedData = localStorage.getItem('delivery_data');
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    
                    // Restore saved data to state
                    state.density = parsedData.density || state.density;
                    state.trips = parsedData.trips || state.trips;
                    state.potential = parsedData.potential || state.potential;
                    state.delivery = parsedData.delivery || state.delivery;
                    
                    // Recalculate and update UI
                    calculateDelivery();
                    calculateTwoHourTotals();
                    updateUI();
                    showToast('Dados carregados com sucesso', 'success');

                    // Check if we have data
                    updateEmptyStateVisibility();
                    return true;
                }
                return false;
            } catch (error) {
                console.error('Error loading data:', error);
                return false;
            }
        }
        
        // Save data with date stamp for historical records
        function saveDailyData(date = new Date()) {
            try {
                // Format date as YYYY-MM-DD
                const dateKey = formatDateISO(date);
                
                // Get existing history or initialize new one
                let dailyHistory = JSON.parse(localStorage.getItem('delivery_history') || '{}');
                
                // Add current data to history with date key
                dailyHistory[dateKey] = {
                    density: state.density,
                    trips: state.trips,
                    potential: state.potential,
                    delivery: state.delivery,
                    timestamp: new Date().toISOString()
                };
                
                // Save updated history
                localStorage.setItem('delivery_history', JSON.stringify(dailyHistory));
                
                // Update state's dailyHistory
                state.dailyHistory = dailyHistory;
                
                return true;
            } catch (error) {
                console.error('Error saving daily data:', error);
                return false;
            }
        }
        
        // Load data for a specific date from history
        function loadDailyData(dateKey) {
            try {
                // Get history from localStorage if not already in state
                if (Object.keys(state.dailyHistory).length === 0) {
                    state.dailyHistory = JSON.parse(localStorage.getItem('delivery_history') || '{}');
                }
                
                // Check if data exists for the requested date
                if (state.dailyHistory[dateKey]) {
                    // Set history compare mode to true
                    state.historyCompareMode = true;
                    
                    // Load data for the selected date
                    state.density = state.dailyHistory[dateKey].density;
                    state.trips = state.dailyHistory[dateKey].trips;
                    state.potential = state.dailyHistory[dateKey].potential;
                    state.delivery = state.dailyHistory[dateKey].delivery;
                    
                    // Update calendar selected date
                    const dateParts = dateKey.split('-');
                    state.calendar.selectedDate = new Date(
                        parseInt(dateParts[0]), 
                        parseInt(dateParts[1]) - 1, 
                        parseInt(dateParts[2])
                    );
                    
                    // Recalculate and update UI
                    calculateDelivery();
                    calculateTwoHourTotals();
                    updateUI();
                    
                    // Show toast
                    showToast(`Carregado dados do dia ${formatDateForDisplay(dateKey)}`, 'success');
                    
                    return true;
                } else {
                    showToast(`Sem dados para a data ${dateKey}`, 'warning');
                    return false;
                }
            } catch (error) {
                console.error(`Error loading data for date ${dateKey}:`, error);
                return false;
            }
        }
        
        // Get list of available dates with data
        function getAvailableDates() {
            try {
                const history = JSON.parse(localStorage.getItem('delivery_history') || '{}');
                return Object.keys(history).sort();
            } catch (error) {
                console.error('Error getting available dates:', error);
                return [];
            }
        }
        
        // Load historical data into state
        function loadHistoricalData() {
            try {
                const history = localStorage.getItem('delivery_history');
                if (history) {
                    state.dailyHistory = JSON.parse(history);
                    return true;
                }
                return false;
            } catch (error) {
                console.error('Error loading historical data:', error);
                return false;
            }
        }
        
        // Clear historical data
        function clearHistoricalData() {
            try {
                localStorage.removeItem('delivery_history');
                state.dailyHistory = {};
                state.selectedHistoryDates = [];
                
                // Update UI
                updateAvailableDates();
                
                // Hide comparison container
                const comparisonContainer = document.getElementById('comparison-container');
                if (comparisonContainer) {
                    comparisonContainer.classList.add('hidden');
                }
                
                // Update daily trends chart
                if (state.charts.dailyTrendsChart) {
                    state.charts.dailyTrendsChart.data.labels = [];
                    state.charts.dailyTrendsChart.data.datasets[0].data = [];
                    state.charts.dailyTrendsChart.data.datasets[1].data = [];
                    state.charts.dailyTrendsChart.update();
                }
                
                showToast('Hist√≥rico limpo com sucesso', 'success');
                return true;
            } catch (error) {
                console.error('Error clearing historical data:', error);
                showToast('Erro ao limpar hist√≥rico', 'error');
                return false;
            }
        }
        
        // Update available dates in the history UI
        function updateAvailableDates() {
            const datesContainer = document.getElementById('dates-container');
            const noHistoryMessage = document.getElementById('no-history-message');
            
            if (!datesContainer || !noHistoryMessage) return;
            
            // Get available dates
            const dates = getAvailableDates();
            
            // Clear container
            datesContainer.innerHTML = '';
            
            if (dates.length === 0) {
                // Show no history message
                noHistoryMessage.classList.remove('hidden');
                datesContainer.classList.add('hidden');
            } else {
                // Hide no history message and show dates
                noHistoryMessage.classList.add('hidden');
                datesContainer.classList.remove('hidden');
                
                // Create date chips
                dates.forEach(dateKey => {
                    const dateChip = document.createElement('div');
                    dateChip.className = `date-chip ${state.selectedHistoryDates.includes(dateKey) ? 'selected' : ''}`;
                    dateChip.textContent = formatDateForDisplay(dateKey);
                    dateChip.dataset.date = dateKey;
                    
                    // Toggle selection on click
                    dateChip.addEventListener('click', function() {
                        if (state.selectedHistoryDates.includes(dateKey)) {
                            // Remove from selection
                            state.selectedHistoryDates = state.selectedHistoryDates.filter(d => d !== dateKey);
                            dateChip.classList.remove('selected');
                        } else {
                            // Add to selection (limit to 6 dates)
                            if (state.selectedHistoryDates.length < 6) {
                                state.selectedHistoryDates.push(dateKey);
                                dateChip.classList.add('selected');
                            } else {
                                showToast('Voc√™ pode selecionar no m√°ximo 6 datas para compara√ß√£o', 'warning');
                            }
                        }
                    });
                    
                    datesContainer.appendChild(dateChip);
                });
            }
            
            // Update daily trends chart
            updateDailyTrendsChart();
        }
        
        // Update daily trends chart
        function updateDailyTrendsChart() {
            if (!state.charts.dailyTrendsChart) return;
            
            // Get available dates
            const dates = getAvailableDates();
            
            // Update chart data
            state.charts.dailyTrendsChart.data.labels = dates;
            state.charts.dailyTrendsChart.data.datasets[0].data = dates.map(date => calculateTotalDeliveryForDate(date));
            state.charts.dailyTrendsChart.data.datasets[1].data = dates.map(date => calculateEfficiencyForDate(date));
            
            state.charts.dailyTrendsChart.update();
        }
        
        // Generate comparison view
        function generateComparisonView() {
            const comparisonContainer = document.getElementById('comparison-container');
            if (!comparisonContainer) return;
            
            // Show comparison container
            comparisonContainer.classList.remove('hidden');
            
            // Update selected dates display
            const selectedDatesComparison = document.getElementById('selected-dates-comparison');
            if (selectedDatesComparison) {
                selectedDatesComparison.innerHTML = '';
                
                // Create date chips for selected dates
                state.selectedHistoryDates.forEach(dateKey => {
                    const dateChip = document.createElement('div');
                    dateChip.className = 'date-chip selected';
                    dateChip.textContent = formatDateForDisplay(dateKey);
                    selectedDatesComparison.appendChild(dateChip);
                });
            }
        }
        
        // Exit history mode
        function exitHistoryMode() {
            // Reset history compare mode
            state.historyCompareMode = false;
            
            // Load current data
            loadSavedData();
            
            // Update UI elements
            const historyModeIndicator = document.getElementById('history-mode-indicator');
            const headerSelectedDate = document.getElementById('header-selected-date');
            const exitHistoryModeButton = document.getElementById('exit-history-mode');
            const dateSelectorContainer = document.getElementById('date-selector-container');
            
            // Hide history mode UI elements
            if (historyModeIndicator) historyModeIndicator.classList.add('hidden');
            if (headerSelectedDate) {
                headerSelectedDate.classList.add('hidden');
                headerSelectedDate.classList.remove('flex');
            }
            if (exitHistoryModeButton) {
                exitHistoryModeButton.classList.add('hidden');
                exitHistoryModeButton.classList.remove('flex');
            }
            if (dateSelectorContainer) dateSelectorContainer.classList.add('hidden');
            
            // Regenerate time period HTML to ensure inputs are not disabled
            if (state.currentPage === 'entrega-hora') {
                generateTimePeriodHTML();
            }
            
            showToast('Saiu do modo hist√≥rico', 'success');
        }
        
        // Export All History
        function exportAllHistory() {
            try {
                const history = localStorage.getItem('delivery_history');
                if (!history) {
                    showToast('N√£o h√° dados hist√≥ricos para exportar', 'warning');
                    return;
                }
                
                // Create blob and download link
                const blob = new Blob([history], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                
                a.href = url;
                a.download = `historico_completo_${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                
                // Clean up
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
                
                showToast('Hist√≥rico exportado com sucesso', 'success');
            } catch (error) {
                console.error('Error exporting history:', error);
                showToast('Erro ao exportar hist√≥rico', 'error');
            }
        }
        
        // Import History
        function importHistory(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const importedData = JSON.parse(event.target.result);
                    
                    // Validate imported data
                    if (typeof importedData !== 'object') {
                        throw new Error('Formato de dados inv√°lido');
                    }
                    
                    // Confirm import - ask if user wants to merge or replace
                    showConfirmationModal(
                        'Importar Hist√≥rico',
                        'Deseja mesclar com o hist√≥rico existente ou substitu√≠-lo completamente?',
                        () => mergeHistory(importedData),
                        'Mesclar',
                        () => replaceHistory(importedData),
                        'Substituir'
                    );
                } catch (error) {
                    console.error('Error parsing imported history:', error);
                    showToast('Erro ao importar hist√≥rico: formato inv√°lido', 'error');
                }
            };
            
            reader.readAsText(file);
            
            // Reset file input
            e.target.value = '';
        }
        
        // Merge imported history with existing history
        function mergeHistory(importedData) {
            try {
                // Get existing history
                const existingHistory = JSON.parse(localStorage.getItem('delivery_history') || '{}');
                
                // Merge histories
                const mergedHistory = { ...existingHistory, ...importedData };
                
                // Save merged history
                localStorage.setItem('delivery_history', JSON.stringify(mergedHistory));
                
                // Update state
                state.dailyHistory = mergedHistory;
                
                // Update UI
                updateAvailableDates();
                
                showToast('Hist√≥rico importado e mesclado com sucesso', 'success');
            } catch (error) {
                console.error('Error merging history:', error);
                showToast('Erro ao mesclar hist√≥rico', 'error');
            }
        }
        
        // Replace existing history with imported history
        function replaceHistory(importedData) {
            try {
                // Save imported history
                localStorage.setItem('delivery_history', JSON.stringify(importedData));
                
                // Update state
                state.dailyHistory = importedData;
                
                // Update UI
                updateAvailableDates();
                
                showToast('Hist√≥rico substitu√≠do com sucesso', 'success');
            } catch (error) {
                console.error('Error replacing history:', error);
                showToast('Erro ao substituir hist√≥rico', 'error');
            }
        }
        
        // Create Backup
        function createBackup() {
            try {
                // Create backup object
                const backup = {
                    delivery_data: JSON.parse(localStorage.getItem('delivery_data') || '{}'),
                    delivery_history: JSON.parse(localStorage.getItem('delivery_history') || '{}'),
                    app_config: JSON.parse(localStorage.getItem('app_config') || '{}'),
                    timestamp: new Date().toISOString(),
                    version: '2.1.0'
                };
                
                // Create blob and download link
                const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                
                a.href = url;
                a.download = `backup_ggomes_log_${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                
                // Clean up
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
                
                showToast('Backup criado com sucesso', 'success');
            } catch (error) {
                console.error('Error creating backup:', error);
                showToast('Erro ao criar backup', 'error');
            }
        }
        
        // Restore Backup
        function restoreBackup(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const backupData = JSON.parse(event.target.result);
                    
                    // Validate backup data
                    if (!backupData.delivery_data || !backupData.delivery_history || !backupData.app_config) {
                        throw new Error('Backup inv√°lido ou corrompido');
                    }
                    
                    // Confirm restore
                    showConfirmationModal(
                        'Restaurar Backup',
                        'Esta a√ß√£o substituir√° todos os dados atuais pelos dados do backup. Deseja continuar?',
                        () => {
                            // Restore data
                            localStorage.setItem('delivery_data', JSON.stringify(backupData.delivery_data));
                            localStorage.setItem('delivery_history', JSON.stringify(backupData.delivery_history));
                            localStorage.setItem('app_config', JSON.stringify(backupData.app_config));
                            
                            // Reload page to apply changes
                            showToast('Backup restaurado com sucesso. Recarregando aplicativo...', 'success');
                            setTimeout(() => {
                                window.location.reload();
                            }, 2000);
                        }
                    );
                } catch (error) {
                    console.error('Error parsing backup:', error);
                    showToast('Erro ao restaurar backup: formato inv√°lido', 'error');
                }
            };
            
            reader.readAsText(file);
            
            // Reset file input
            e.target.value = '';
        }
        
        // Export Comparison
        function exportComparison() {
            if (state.selectedHistoryDates.length < 2) {
                showToast('Selecione pelo menos duas datas para exportar compara√ß√£o', 'warning');
                return;
            }
            
            try {
                // Create PDF document
                const { jsPDF } = jspdf;
                const doc = new jsPDF();
                
                // Add title
                doc.setFontSize(18);
                doc.text('Compara√ß√£o de Desempenho de Entrega', 14, 20);
                
                // Add subtitle with dates
                doc.setFontSize(12);
                doc.text(`Datas: ${state.selectedHistoryDates.map(d => formatDateForDisplay(d)).join(', ')}`, 14, 30);
                
                // Add date
                doc.setFontSize(10);
                doc.text(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, 14, 40);
                
                // Add comparison table
                doc.setFontSize(14);
                doc.text('M√©tricas de Compara√ß√£o', 14, 50);
                
                // Create comparison table data
                const tableData = [];
                tableData.push(['M√©trica', ...state.selectedHistoryDates.map(d => formatDateForDisplay(d))]);
                
                // Add metrics rows
                const metrics = [
                    { name: 'Total Entregue (ton)', getter: calculateTotalDeliveryForDate, formatter: (val) => val.toFixed(2) },
                    { name: 'Efici√™ncia M√©dia (%)', getter: calculateEfficiencyForDate, formatter: (val) => val.toFixed(1) + '%' },
                    { name: 'Total de Viagens', getter: calculateTotalTripsForDate, formatter: (val) => val.toString() },
                    { name: 'Densidade M√©dia', getter: calculateAverageDensityForDate, formatter: (val) => val.toFixed(2) }
                ];
                
                metrics.forEach(metric => {
                    const row = [metric.name];
                    state.selectedHistoryDates.forEach(dateKey => {
                        const value = metric.getter(dateKey);
                        row.push(metric.formatter(value));
                    });
                    tableData.push(row);
                });
                
                // Add table to PDF
                doc.autoTable({
                    startY: 55,
                    head: [tableData[0]],
                    body: tableData.slice(1),
                    theme: 'grid',
                    headStyles: { fillColor: [93, 92, 222] },
                    alternateRowStyles: { fillColor: [240, 240, 255] }
                });
                
                // Front comparison chart
                if (state.charts.comparisonDeliveryChart) {
                    doc.addPage();
                    doc.setFontSize(14);
                    doc.text('Compara√ß√£o de Entrega por Frente', 14, 20);
                    
                    // Convert chart to image
                    const deliveryCanvas = document.getElementById('comparisonDeliveryChart');
                    const deliveryImgData = deliveryCanvas.toDataURL('image/png');
                    
                    // Add chart image to PDF
                    doc.addImage(deliveryImgData, 'PNG', 14, 30, 180, 100);
                }
                
                // Efficiency comparison chart
                if (state.charts.comparisonEfficiencyChart) {
                    doc.setFontSize(14);
                    doc.text('Compara√ß√£o de Efici√™ncia por Frente', 14, 150);
                    
                    // Convert chart to image
                    const efficiencyCanvas = document.getElementById('comparisonEfficiencyChart');
                    const efficiencyImgData = efficiencyCanvas.toDataURL('image/png');
                    
                    // Add chart image to PDF
                    doc.addImage(efficiencyImgData, 'PNG', 14, 160, 180, 100);
                }
                
                // Save PDF
                doc.save(`comparacao_${state.selectedHistoryDates.length}_datas_${new Date().toISOString().slice(0, 10)}.pdf`);
                
                showToast('Compara√ß√£o exportada com sucesso', 'success');
            } catch (error) {
                console.error('Error exporting comparison:', error);
                showToast('Erro ao exportar compara√ß√£o', 'error');
            }
        }
        
        // Generate Report
        function generateReport() {
            // Show loading
            const reportLoading = document.getElementById('report-loading');
            const reportContent = document.getElementById('report-content');
            const noReportDataMessage = document.getElementById('no-report-data-message');
            
            if (reportLoading) reportLoading.classList.remove('hidden');
            if (reportContent) reportContent.classList.add('hidden');
            if (noReportDataMessage) noReportDataMessage.classList.add('hidden');
            
            try {
                // Get report type and date
                const reportType = document.getElementById('report-type-selector').value;
                const dateValue = document.getElementById('date-selector').value;
                
                // Initialize report data
                let reportData = null;
                let reportTitle = '';
                let reportPeriod = '';
                
                // Get report data based on type
                switch (reportType) {
                    case 'daily':
                        reportData = generateDailyReport(dateValue);
                        reportTitle = 'Relat√≥rio Di√°rio';
                        reportPeriod = `Data: ${formatDateForDisplay(dateValue)}`;
                        break;
                        
                    case 'weekly':
                        const weekDates = dateValue.split('_');
                        reportData = generateWeeklyReport(weekDates[0], weekDates[1]);
                        reportTitle = 'Relat√≥rio Semanal';
                        reportPeriod = `Per√≠odo: ${formatDateForDisplay(weekDates[0])} a ${formatDateForDisplay(weekDates[1])}`;
                        break;
                        
                    case 'monthly':
                        const [year, month] = dateValue.split('-');
                        reportData = generateMonthlyReport(year, month);
                        
                        const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                        reportTitle = 'Relat√≥rio Mensal';
                        reportPeriod = `Per√≠odo: ${monthNames[parseInt(month) - 1]} ${year}`;
                        break;
                        
                    case 'custom':
                        // Custom date range not implemented yet
                        showToast('Relat√≥rio personalizado ainda n√£o implementado', 'warning');
                        if (reportLoading) reportLoading.classList.add('hidden');
                        return;
                }
                
                // Check if we got data
                if (!reportData || !reportData.hasData) {
                    if (reportLoading) reportLoading.classList.add('hidden');
                    if (noReportDataMessage) noReportDataMessage.classList.remove('hidden');
                    return;
                }
                
                // Update report title and period
                document.getElementById('report-title').textContent = reportTitle;
                document.getElementById('report-period').textContent = reportPeriod;
                
                // Update report summary
                document.getElementById('report-total-delivered').textContent = reportData.totalDelivery.toFixed(2);
                document.getElementById('report-efficiency').textContent = reportData.efficiency.toFixed(1) + '%';
                document.getElementById('report-trips').textContent = reportData.totalTrips;
                document.getElementById('report-density').textContent = reportData.avgDensity.toFixed(2);
                
                // Update progress bars
                const deliveredBar = document.getElementById('report-total-delivered-bar');
                const deliveredPercent = document.getElementById('report-total-delivered-percent');
                const efficiencyBar = document.getElementById('report-efficiency-bar');
                const tripsBar = document.getElementById('report-trips-bar');
                const tripsPercent = document.getElementById('report-trips-percent');
                const densityBar = document.getElementById('report-density-bar');
                
                if (deliveredBar && deliveredPercent) {
                    const percentage = Math.min(100, (reportData.totalDelivery / reportData.totalPotential) * 100);
                    deliveredBar.style.width = `${percentage}%`;
                    deliveredPercent.textContent = `${percentage.toFixed(1)}% da meta`;
                }
                
                if (efficiencyBar) {
                    efficiencyBar.style.width = `${Math.min(100, reportData.efficiency)}%`;
                }
                
                if (tripsBar && tripsPercent) {
                    const percentage = Math.min(100, (reportData.totalTrips / 1500) * 100);
                    tripsBar.style.width = `${percentage}%`;
                    tripsPercent.textContent = `${percentage.toFixed(1)}% da meta`;
                }
                
                if (densityBar) {
                    const percentage = Math.min(100, (reportData.avgDensity / 65) * 100);
                    densityBar.style.width = `${percentage}%`;
                }
                
                // Update report table
                const tableBody = document.getElementById('report-table-body');
                if (tableBody) {
                    tableBody.innerHTML = '';
                    
                    reportData.frontData.forEach(front => {
                        const row = document.createElement('tr');
                        
                        const efficiency = front.potential > 0 ? (front.delivery / front.potential) * 100 : 0;
                        const densityAvg = front.densityCount > 0 ? front.densitySum / front.densityCount : 0;
                        
                        row.innerHTML = `
                            <td class="px-4 py-3 whitespace-nowrap">${front.name}</td>
                            <td class="px-4 py-3 whitespace-nowrap">${front.delivery.toFixed(2)}</td>
                            <td class="px-4 py-3 whitespace-nowrap">${front.potential.toFixed(2)}</td>
                            <td class="px-4 py-3 whitespace-nowrap">${efficiency.toFixed(1)}%</td>
                            <td class="px-4 py-3 whitespace-nowrap">${front.trips}</td>
                            <td class="px-4 py-3 whitespace-nowrap">${densityAvg.toFixed(2)}</td>
                        `;
                        
                        tableBody.appendChild(row);
                    });
                }
                
                // Update table footer
                document.getElementById('report-footer-delivery').textContent = reportData.totalDelivery.toFixed(2);
                document.getElementById('report-footer-potential').textContent = reportData.totalPotential.toFixed(2);
                document.getElementById('report-footer-efficiency').textContent = reportData.efficiency.toFixed(1) + '%';
                document.getElementById('report-footer-trips').textContent = reportData.totalTrips;
                document.getElementById('report-footer-density').textContent = reportData.avgDensity.toFixed(2);
                
                // Initialize report charts if needed
                initializeReportCharts();
                
                // Update report charts
                updateReportCharts(reportData);
                
                // Show report content
                if (reportLoading) reportLoading.classList.add('hidden');
                if (reportContent) reportContent.classList.remove('hidden');
            } catch (error) {
                console.error('Error generating report:', error);
                showToast('Erro ao gerar relat√≥rio', 'error');
                
                if (reportLoading) reportLoading.classList.add('hidden');
                if (noReportDataMessage) noReportDataMessage.classList.remove('hidden');
            }
        }
        
        // Update report charts
        function updateReportCharts(reportData) {
            // Update delivery chart
            if (state.charts.reportDeliveryChart) {
                state.charts.reportDeliveryChart.data.labels = reportData.periodLabels;
                state.charts.reportDeliveryChart.data.datasets[0].data = reportData.periodDelivery;
                state.charts.reportDeliveryChart.data.datasets[1].data = reportData.periodPotential;
                state.charts.reportDeliveryChart.update();
            }
            
            // Update performance chart
            if (state.charts.reportPerformanceChart) {
                const frontLabels = reportData.frontData.map(front => front.name);
                const efficiencyData = reportData.frontData.map(front => {
                    return front.potential > 0 ? (front.delivery / front.potential) * 100 : 0;
                });
                
                state.charts.reportPerformanceChart.data.labels = frontLabels;
                state.charts.reportPerformanceChart.data.datasets[0].data = efficiencyData;
                state.charts.reportPerformanceChart.data.datasets[0].backgroundColor = 
                    efficiencyData.map(value => getEfficiencyColorGradient(value));
                
                state.charts.reportPerformanceChart.update();
            }
        }
        
        // Generate daily report
        function generateDailyReport(dateKey) {
            // Get data for the specified date
            const dateData = state.dailyHistory[dateKey];
            
            // If no data exists for this date, use current data
            const data = dateData || {
                density: state.density,
                trips: state.trips,
                potential: state.potential,
                delivery: state.delivery
            };
            
            // Check if we have any data
            const hasData = checkIfDataExists(data);
            if (!hasData) {
                return { hasData: false };
            }
            
            // Calculate report metrics
            const reportData = {
                hasData: true,
                totalDelivery: 0,
                totalPotential: 0,
                totalTrips: 0,
                densitySum: 0,
                densityCount: 0,
                frontData: [],
                periodLabels: [],
                periodDelivery: [],
                periodPotential: []
            };
            
            // Calculate metrics for each front
            state.fronts.forEach(front => {
                const frontMetrics = {
                    name: `F${front}`,
                    delivery: 0,
                    potential: 0,
                    trips: 0,
                    densitySum: 0,
                    densityCount: 0
                };
                
                for (const hour of state.hours) {
                    // Add delivery
                    if (data.delivery[front] && data.delivery[front][hour]) {
                        frontMetrics.delivery += data.delivery[front][hour];
                        reportData.totalDelivery += data.delivery[front][hour];
                    }
                    
                    // Add trips
                    if (data.trips[front] && data.trips[front][hour]) {
                        frontMetrics.trips += data.trips[front][hour];
                        reportData.totalTrips += data.trips[front][hour];
                    }
                    
                    // Add density
                    if (data.density[front] && data.density[front][hour] > 0) {
                        frontMetrics.densitySum += data.density[front][hour];
                        frontMetrics.densityCount++;
                        
                        reportData.densitySum += data.density[front][hour];
                        reportData.densityCount++;
                    }
                    
                    // Add potential (only odd hours)
                    if (hour % 2 !== 0 && data.potential[front] && data.potential[front][hour]) {
                        frontMetrics.potential += data.potential[front][hour] * 2;
                        reportData.totalPotential += data.potential[front][hour] * 2;
                    }
                }
                
                reportData.frontData.push(frontMetrics);
            });
            
            // Calculate average density
            reportData.avgDensity = reportData.densityCount > 0 ? reportData.densitySum / reportData.densityCount : 0;
            
            // Calculate efficiency
            reportData.efficiency = reportData.totalPotential > 0 ? (reportData.totalDelivery / reportData.totalPotential) * 100 : 0;
            
            // Calculate period data for charts
            const periods = Object.keys(state.timePeriodsMap).slice(0, 6);
            
            for (const period of periods) {
                const hours = state.timePeriodsMap[period];
                reportData.periodLabels.push(`${period.substring(0, 2)}:00-${period.substring(3, 5)}:00`);
                
                // Calculate total delivery for this period
                let periodDelivery = 0;
                for (const front of state.fronts) {
                    for (const hour of hours) {
                        if (data.delivery[front] && data.delivery[front][hour]) {
                            periodDelivery += data.delivery[front][hour];
                        }
                    }
                }
                reportData.periodDelivery.push(periodDelivery);
                
                // Calculate total potential for this period
                let periodPotential = 0;
                for (const front of state.fronts) {
                    const oddHour = hours.find(h => h % 2 !== 0);
                    if (oddHour && data.potential[front] && data.potential[front][oddHour]) {
                        periodPotential += data.potential[front][oddHour] * 2;
                    }
                }
                reportData.periodPotential.push(periodPotential);
            }
            
            return reportData;
        }
        
        // Generate weekly report
        function generateWeeklyReport(startDateKey, endDateKey) {
            // Convert date keys to Date objects
            const startDateParts = startDateKey.split('-');
            const endDateParts = endDateKey.split('-');
            
            const startDate = new Date(
                parseInt(startDateParts[0]),
                parseInt(startDateParts[1]) - 1,
                parseInt(startDateParts[2])
            );
            
            const endDate = new Date(
                parseInt(endDateParts[0]),
                parseInt(endDateParts[1]) - 1,
                parseInt(endDateParts[2])
            );
            
            // Get all dates in range
            const dates = [];
            const currentDate = new Date(startDate);
            
            while (currentDate <= endDate) {
                dates.push(formatDateISO(currentDate));
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            // Initialize report data
            const reportData = {
                hasData: false,
                totalDelivery: 0,
                totalPotential: 0,
                totalTrips: 0,
                densitySum: 0,
                densityCount: 0,
                frontData: [],
                periodLabels: [],
                periodDelivery: [],
                periodPotential: []
            };
            
            // Initialize front data
            state.fronts.forEach(front => {
                reportData.frontData.push({
                    name: `F${front}`,
                    delivery: 0,
                    potential: 0,
                    trips: 0,
                    densitySum: 0,
                    densityCount: 0
                });
            });
            
            // Process each date
            dates.forEach(dateKey => {
                const dateData = state.dailyHistory[dateKey];
                if (!dateData) return;
                
                // We have at least some data
                reportData.hasData = true;
                
                // Update metrics for each front
                state.fronts.forEach((front, index) => {
                    for (const hour of state.hours) {
                        // Add delivery
                        if (dateData.delivery[front] && dateData.delivery[front][hour]) {
                            reportData.frontData[index].delivery += dateData.delivery[front][hour];
                            reportData.totalDelivery += dateData.delivery[front][hour];
                        }
                        
                        // Add trips
                        if (dateData.trips[front] && dateData.trips[front][hour]) {
                            reportData.frontData[index].trips += dateData.trips[front][hour];
                            reportData.totalTrips += dateData.trips[front][hour];
                        }
                        
                        // Add density
                        if (dateData.density[front] && dateData.density[front][hour] > 0) {
                            reportData.frontData[index].densitySum += dateData.density[front][hour];
                            reportData.frontData[index].densityCount++;
                            
                            reportData.densitySum += dateData.density[front][hour];
                            reportData.densityCount++;
                        }
                        
                        // Add potential (only odd hours)
                        if (hour % 2 !== 0 && dateData.potential[front] && dateData.potential[front][hour]) {
                            reportData.frontData[index].potential += dateData.potential[front][hour] * 2;
                            reportData.totalPotential += dateData.potential[front][hour] * 2;
                        }
                    }
                });
            });
            
            // Calculate average density
            reportData.avgDensity = reportData.densityCount > 0 ? reportData.densitySum / reportData.densityCount : 0;
            
            // Calculate efficiency
            reportData.efficiency = reportData.totalPotential > 0 ? (reportData.totalDelivery / reportData.totalPotential) * 100 : 0;
            
            // Use dates as period labels for charts
            reportData.periodLabels = dates.map(dateKey => formatDateForDisplay(dateKey));
            
            // Calculate delivery and potential for each date
            dates.forEach(dateKey => {
                const dateData = state.dailyHistory[dateKey];
                if (!dateData) {
                    reportData.periodDelivery.push(0);
                    reportData.periodPotential.push(0);
                    return;
                }
                
                let dateDelivery = 0;
                let datePotential = 0;
                
                for (const front of state.fronts) {
                    for (const hour of state.hours) {
                        // Add delivery
                        if (dateData.delivery[front] && dateData.delivery[front][hour]) {
                            dateDelivery += dateData.delivery[front][hour];
                        }
                        
                        // Add potential (only odd hours)
                        if (hour % 2 !== 0 && dateData.potential[front] && dateData.potential[front][hour]) {
                            datePotential += dateData.potential[front][hour] * 2;
                        }
                    }
                }
                
                reportData.periodDelivery.push(dateDelivery);
                reportData.periodPotential.push(datePotential);
            });
            
            return reportData;
        }
        
        // Generate monthly report
        function generateMonthlyReport(year, month) {
            // Get all dates in the month
            const daysInMonth = new Date(year, month, 0).getDate();
            const dates = [];
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dateKey = `${year}-${month.padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                dates.push(dateKey);
            }
            
            // Initialize report data
            const reportData = {
                hasData: false,
                totalDelivery: 0,
                totalPotential: 0,
                totalTrips: 0,
                densitySum: 0,
                densityCount: 0,
                frontData: [],
                periodLabels: [],
                periodDelivery: [],
                periodPotential: []
            };
            
            // Initialize front data
            state.fronts.forEach(front => {
                reportData.frontData.push({
                    name: `F${front}`,
                    delivery: 0,
                    potential: 0,
                    trips: 0,
                    densitySum: 0,
                    densityCount: 0
                });
            });
            
            // Process each date
            dates.forEach(dateKey => {
                const dateData = state.dailyHistory[dateKey];
                if (!dateData) return;
                
                // We have at least some data
                reportData.hasData = true;
                
                // Update metrics for each front
                state.fronts.forEach((front, index) => {
                    for (const hour of state.hours) {
                        // Add delivery
                        if (dateData.delivery[front] && dateData.delivery[front][hour]) {
                            reportData.frontData[index].delivery += dateData.delivery[front][hour];
                            reportData.totalDelivery += dateData.delivery[front][hour];
                        }
                        
                        // Add trips
                        if (dateData.trips[front] && dateData.trips[front][hour]) {
                            reportData.frontData[index].trips += dateData.trips[front][hour];
                            reportData.totalTrips += dateData.trips[front][hour];
                        }
                        
                        // Add density
                        if (dateData.density[front] && dateData.density[front][hour] > 0) {
                            reportData.frontData[index].densitySum += dateData.density[front][hour];
                            reportData.frontData[index].densityCount++;
                            
                            reportData.densitySum += dateData.density[front][hour];
                            reportData.densityCount++;
                        }
                        
                        // Add potential (only odd hours)
                        if (hour % 2 !== 0 && dateData.potential[front] && dateData.potential[front][hour]) {
                            reportData.frontData[index].potential += dateData.potential[front][hour] * 2;
                            reportData.totalPotential += dateData.potential[front][hour] * 2;
                        }
                    }
                });
            });
            
            // Calculate average density
            reportData.avgDensity = reportData.densityCount > 0 ? reportData.densitySum / reportData.densityCount : 0;
            
            // Calculate efficiency
            reportData.efficiency = reportData.totalPotential > 0 ? (reportData.totalDelivery / reportData.totalPotential) * 100 : 0;
            
            // Group data by week for chart
            const weeklyData = {};
            dates.forEach(dateKey => {
                const dateParts = dateKey.split('-');
                const date = new Date(
                    parseInt(dateParts[0]),
                    parseInt(dateParts[1]) - 1,
                    parseInt(dateParts[2])
                );
                
                const weekNum = getWeekNumber(date);
                const weekLabel = `Semana ${weekNum}`;
                
                if (!weeklyData[weekLabel]) {
                    weeklyData[weekLabel] = {
                        delivery: 0,
                        potential: 0
                    };
                }
                
                const dateData = state.dailyHistory[dateKey];
                if (!dateData) return;
                
                for (const front of state.fronts) {
                    for (const hour of state.hours) {
                        // Add delivery
                        if (dateData.delivery[front] && dateData.delivery[front][hour]) {
                            weeklyData[weekLabel].delivery += dateData.delivery[front][hour];
                        }
                        
                        // Add potential (only odd hours)
                        if (hour % 2 !== 0 && dateData.potential[front] && dateData.potential[front][hour]) {
                            weeklyData[weekLabel].potential += dateData.potential[front][hour] * 2;
                        }
                    }
                }
            });
            
            // Convert weekly data to arrays for chart
            const weekLabels = Object.keys(weeklyData);
            const weeklyDelivery = weekLabels.map(label => weeklyData[label].delivery);
            const weeklyPotential = weekLabels.map(label => weeklyData[label].potential);
            
            reportData.periodLabels = weekLabels;
            reportData.periodDelivery = weeklyDelivery;
            reportData.periodPotential = weeklyPotential;
            
            return reportData;
        }
        
        // Check if data exists
        function checkIfDataExists(data) {
            if (!data) return false;
            
            // Check if there's any data
            for (const front in data.density) {
                for (const hour in data.density[front]) {
                    if (data.density[front][hour] > 0 || data.trips[front][hour] > 0 || 
                        data.potential[front][hour] > 0 || data.delivery[front][hour] > 0) {
                        return true;
                    }
                }
            }
            
            return false;
        }
        
        // Hide report content
        function hideReportContent() {
            const reportContent = document.getElementById('report-content');
            const noReportDataMessage = document.getElementById('no-report-data-message');
            
            if (reportContent) reportContent.classList.add('hidden');
            if (noReportDataMessage) noReportDataMessage.classList.remove('hidden');
        }
        
        // Export report to PDF
        function exportReport() {
            try {
                // Get report title and period
                const reportTitle = document.getElementById('report-title').textContent;
                const reportPeriod = document.getElementById('report-period').textContent;
                
                // Create PDF document
                const { jsPDF } = jspdf;
                const doc = new jsPDF();
                
                // Add title
                doc.setFontSize(18);
                doc.text(reportTitle, 14, 20);
                
                // Add period
                doc.setFontSize(12);
                doc.text(reportPeriod, 14, 30);
                
                // Add date
                doc.setFontSize(10);
                doc.text(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, 14, 40);
                
                // Add summary
                doc.setFontSize(14);
                doc.text('Resumo', 14, 50);
                
                // Create summary table
                const summaryData = [];
                summaryData.push(['M√©trica', 'Valor', '% da Meta']);
                
                const totalDelivered = document.getElementById('report-total-delivered').textContent;
                const efficiency = document.getElementById('report-efficiency').textContent;
                const trips = document.getElementById('report-trips').textContent;
                const density = document.getElementById('report-density').textContent;
                
                const deliveredPercent = document.getElementById('report-total-delivered-percent').textContent;
                const tripsPercent = document.getElementById('report-trips-percent').textContent;
                
                summaryData.push(['Total Entregue', totalDelivered + ' ton', deliveredPercent]);
                summaryData.push(['Efici√™ncia M√©dia', efficiency, 'Meta: 85%']);
                summaryData.push(['Viagens Realizadas', trips, tripsPercent]);
                summaryData.push(['Densidade M√©dia', density, 'Meta: 65.00']);
                
                // Add summary table to PDF
                doc.autoTable({
                    startY: 55,
                    head: [summaryData[0]],
                    body: summaryData.slice(1),
                    theme: 'grid',
                    headStyles: { fillColor: [93, 92, 222] },
                    alternateRowStyles: { fillColor: [240, 240, 255] }
                });
                
                // Add detail table
                doc.setFontSize(14);
                doc.text('Detalhes por Frente', 14, doc.autoTable.previous.finalY + 15);
                
                // Create detail table data
                const detailData = [];
                detailData.push(['Frente', 'Entrega (ton)', 'Potencial (ton)', 'Efici√™ncia', 'Viagens', 'Densidade M√©dia']);
                
                // Get data from the table
                const tableRows = document.querySelectorAll('#report-table-body tr');
                tableRows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length >= 6) {
                        detailData.push([
                            cells[0].textContent,
                            cells[1].textContent,
                            cells[2].textContent,
                            cells[3].textContent,
                            cells[4].textContent,
                            cells[5].textContent
                        ]);
                    }
                });
                
                // Add total row
                const footerDelivery = document.getElementById('report-footer-delivery').textContent;
                const footerPotential = document.getElementById('report-footer-potential').textContent;
                const footerEfficiency = document.getElementById('report-footer-efficiency').textContent;
                const footerTrips = document.getElementById('report-footer-trips').textContent;
                const footerDensity = document.getElementById('report-footer-density').textContent;
                
                detailData.push([
                    'TOTAL',
                    footerDelivery,
                    footerPotential,
                    footerEfficiency,
                    footerTrips,
                    footerDensity
                ]);
                
                // Add detail table to PDF
                doc.autoTable({
                    startY: doc.autoTable.previous.finalY + 20,
                    head: [detailData[0]],
                    body: detailData.slice(1, -1),
                    foot: [detailData[detailData.length - 1]],
                    theme: 'grid',
                    headStyles: { fillColor: [93, 92, 222] },
                    footStyles: { fillColor: [93, 92, 222], fontStyle: 'bold' },
                    alternateRowStyles: { fillColor: [240, 240, 255] }
                });
                
                // Add charts to a new page
                doc.addPage();
                
                // Add delivery by period chart
                doc.setFontSize(14);
                doc.text('Entrega por Per√≠odo', 14, 20);
                
                if (state.charts.reportDeliveryChart) {
                    const deliveryCanvas = document.getElementById('reportDeliveryChart');
                    const deliveryImgData = deliveryCanvas.toDataURL('image/png');
                    doc.addImage(deliveryImgData, 'PNG', 14, 30, 180, 100);
                }
                
                // Add performance by front chart
                doc.setFontSize(14);
                doc.text('Desempenho por Frente', 14, 150);
                
                if (state.charts.reportPerformanceChart) {
                    const performanceCanvas = document.getElementById('reportPerformanceChart');
                    const performanceImgData = performanceCanvas.toDataURL('image/png');
                    doc.addImage(performanceImgData, 'PNG', 14, 160, 180, 100);
                }
                
                // Save PDF
                const reportType = reportTitle.toLowerCase().replace('relat√≥rio ', '');
                doc.save(`relatorio_${reportType}_${new Date().toISOString().slice(0, 10)}.pdf`);
                
                showToast('Relat√≥rio exportado com sucesso', 'success');
            } catch (error) {
                console.error('Error exporting report:', error);
                showToast('Erro ao exportar relat√≥rio', 'error');
            }
        }
        
        // Config Functions
        function saveConfig() {
            try {
                const jsonString = JSON.stringify(state.config);
                localStorage.setItem('app_config', jsonString);
                return true;
            } catch (error) {
                console.error('Error saving config:', error);
                return false;
            }
        }
        
        function loadConfig() {
            try {
                const savedConfig = localStorage.getItem('app_config');
                if (savedConfig) {
                    const parsedConfig = JSON.parse(savedConfig);
                    
                    // Merge saved config with default values
                    state.config = { ...state.config, ...parsedConfig };
                    
                    // Update UI based on loaded config
                    updateUIFromConfig();
                }
            } catch (error) {
                console.error('Error loading config:', error);
            }
        }
        
        function updateUIFromConfig() {
            // Update UI elements based on config
            const autoSaveToggle = document.getElementById('auto-save-toggle');
            const autoSaveInterval = document.getElementById('auto-save-interval');
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const alertThreshold = document.getElementById('alert-threshold');
            const soundAlertToggle = document.getElementById('sound-alert-toggle');
            const visualAlertToggle = document.getElementById('visual-alert-toggle');
            const autoDailySaveToggle = document.getElementById('auto-daily-save-toggle');
            
            if (autoSaveToggle) autoSaveToggle.checked = state.config.autoSave;
            if (autoSaveInterval) autoSaveInterval.value = state.config.autoSaveInterval;
            if (darkModeToggle) darkModeToggle.checked = state.config.darkMode;
            if (alertThreshold) alertThreshold.value = state.config.alertThreshold;
            if (soundAlertToggle) soundAlertToggle.checked = state.config.soundAlerts;
            if (visualAlertToggle) visualAlertToggle.checked = state.config.visualAlerts;
            if (autoDailySaveToggle) autoDailySaveToggle.checked = state.config.autoDailySave;
        }
        
        // Export Functions
        function exportJSON() {
            // Prepare data
            const dataToExport = {
                density: state.density,
                trips: state.trips,
                potential: state.potential,
                delivery: state.delivery,
                timestamp: new Date().toISOString(),
                version: '1.0'
            };
            
            // Convert to JSON string
            const jsonString = JSON.stringify(dataToExport, null, 2);
            
            // Create blob and download link
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            
            a.href = url;
            a.download = `entrega_data_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            
            // Clean up
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
            
            showToast('Dados exportados com sucesso (JSON)', 'success');
        }
        
        function exportCSV() {
            // Headers
            let csvContent = 'Frente,Hora,Densidade,Viagens,Entrega,Potencial\n';
            
            // Data rows
            for (const front of state.fronts) {
                for (const hour of state.hours) {
                    const density = state.density[front][hour];
                    const trips = state.trips[front][hour];
                    const delivery = state.delivery[front][hour];
                    const potential = state.potential[front][hour];
                    
                    csvContent += `${front},${hour},${density},${trips},${delivery},${potential}\n`;
                }
            }
            
            // Create blob and download link
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            
            a.href = url;
            a.download = `entrega_data_${new Date().toISOString().slice(0, 10)}.csv`;
            document.body.appendChild(a);
            a.click();
            
            // Clean up
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
            
            showToast('Dados exportados com sucesso (CSV)', 'success');
        }
        
        function exportPDF() {
            // Check if jsPDF is loaded
            if (typeof jspdf === 'undefined' || typeof jspdf.jsPDF === 'undefined') {
                showToast('Erro: jsPDF n√£o est√° dispon√≠vel', 'error');
                return;
            }
            
            // Create PDF document
            const { jsPDF } = jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(18);
            doc.text('Relat√≥rio de Entrega de Safra', 14, 20);
            
            // Add date
            doc.setFontSize(10);
            doc.text(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, 14, 30);
            
            // Add period summary table
            doc.setFontSize(14);
            doc.text(`Resumo do Per√≠odo: ${state.activePeriod.substring(0, 2)}:00-${state.activePeriod.substring(3, 5)}:00`, 14, 40);
            
            // Create period summary table data
            const tableData = [];
            tableData.push(['Frente', 'Entrega (2h)', 'Potencial (2h)', 'Diferen√ßa', '% Realizado']);
            
            for (const front of state.fronts) {
                const entrega = state.twoHourDelivery[state.activePeriod][front];
                const potencial = state.twoHourPotential[state.activePeriod][front];
                const diferenca = state.difference[state.activePeriod][front];
                const percentual = potencial > 0 ? (entrega / potencial) * 100 : 0;
                
                tableData.push([
                    `F${front}`,
                    entrega.toFixed(2),
                    potencial.toString(),
                    diferenca.toFixed(2),
                    `${percentual.toFixed(1)}%`
                ]);
            }
            
            // Add totals row
            const totalEntrega = state.fronts.reduce((sum, front) => sum + state.twoHourDelivery[state.activePeriod][front], 0);
            const totalPotencial = state.fronts.reduce((sum, front) => sum + state.twoHourPotential[state.activePeriod][front], 0);
            const totalDiferenca = state.fronts.reduce((sum, front) => sum + state.difference[state.activePeriod][front], 0);
            const totalPercentual = totalPotencial > 0 ? (totalEntrega / totalPotencial) * 100 : 0;
            
            tableData.push([
                'TOTAL',
                totalEntrega.toFixed(2),
                totalPotencial.toString(),
                totalDiferenca.toFixed(2),
                `${totalPercentual.toFixed(1)}%`
            ]);
            
            // Add table to PDF
            doc.autoTable({
                startY: 45,
                head: [tableData[0]],
                body: tableData.slice(1),
                theme: 'grid',
                headStyles: { fillColor: [93, 92, 222] },
                alternateRowStyles: { fillColor: [240, 240, 255] }
            });
            
            // Save PDF
            doc.save(`relatorio_entrega_${state.activePeriod}_${new Date().toISOString().slice(0, 10)}.pdf`);
            
            showToast('Relat√≥rio exportado com sucesso (PDF)', 'success');
        }
        
        function exportDashboard() {
            // Check if jsPDF is loaded
            if (typeof jspdf === 'undefined' || typeof jspdf.jsPDF === 'undefined') {
                showToast('Erro: jsPDF n√£o est√° dispon√≠vel', 'error');
                return;
            }
            
            // Create PDF document
            const { jsPDF } = jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(18);
            doc.text('Dashboard de Entrega de Safra', 14, 20);
            
            // Add date
            doc.setFontSize(10);
            doc.text(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, 14, 30);
            
            // Add summary cards
            doc.setFontSize(14);
            doc.text('Resumo de Desempenho', 14, 40);
            
            // Create summary table
            const summaryData = [];
            summaryData.push(['M√©trica', 'Valor', '% da Meta']);
            
            // Calculate summary values
            const totalDelivery = Object.keys(state.delivery).reduce((frontSum, front) => {
                return frontSum + Object.keys(state.delivery[front]).reduce((hourSum, hour) => {
                    return hourSum + state.delivery[front][hour];
                }, 0);
            }, 0);
            
            const totalPotential = Object.keys(state.potential).reduce((frontSum, front) => {
                let frontPotential = 0;
                for (const period in state.timePeriodsMap) {
                    const hours = state.timePeriodsMap[period];
                    const oddHour = hours.find(h => h % 2 !== 0);
                    if (oddHour && state.potential[front][oddHour]) {
                        frontPotential += state.potential[front][oddHour] * 2;
                    }
                }
                return frontSum + frontPotential;
            }, 0);
            
            const efficiency = totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
            
            const totalTrips = Object.keys(state.trips).reduce((frontSum, front) => {
                return frontSum + Object.keys(state.trips[front]).reduce((hourSum, hour) => {
                    return hourSum + state.trips[front][hour];
                }, 0);
            }, 0);
            
            let densitySum = 0;
            let densityCount = 0;
            
            for (const front in state.density) {
                for (const hour in state.density[front]) {
                    if (state.density[front][hour] > 0) {
                        densitySum += state.density[front][hour];
                        densityCount++;
                    }
                }
            }
            
            const avgDensity = densityCount > 0 ? densitySum / densityCount : 0;
            
            // Add data to summary table
            const deliveryPercentage = totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
            
            summaryData.push(['Total Entregue', `${totalDelivery.toFixed(2)} ton`, `${deliveryPercentage.toFixed(1)}%`]);
            summaryData.push(['Efici√™ncia M√©dia', `${efficiency.toFixed(1)}%`, `${(efficiency / 85 * 100).toFixed(1)}%`]);
            summaryData.push(['Viagens Realizadas', totalTrips.toString(), 'N/A']);
            summaryData.push(['Densidade M√©dia', avgDensity.toFixed(2), 'N/A']);
            
            // Add table to PDF
            doc.autoTable({
                startY: 45,
                head: [summaryData[0]],
                body: summaryData.slice(1),
                theme: 'grid',
                headStyles: { fillColor: [93, 92, 222] },
                alternateRowStyles: { fillColor: [240, 240, 255] }
            });
            
            // Add front performance
            doc.setFontSize(14);
            doc.text('Desempenho por Frente', 14, doc.autoTable.previous.finalY + 15);
            
            // Create front performance table
            const frontData = [];
            frontData.push(['Frente', 'Entrega (ton)', 'Potencial (ton)', 'Efici√™ncia']);
            
            for (const front of state.fronts) {
                let frontDelivery = 0;
                let frontPotential = 0;
                
                // Calculate front totals
                for (const period in state.timePeriodsMap) {
                    const hours = state.timePeriodsMap[period];
                    
                    // Sum delivery
                    for (const hour of hours) {
                        frontDelivery += state.delivery[front][hour];
                    }
                    
                    // Sum potential (odd hours)
                    const oddHour = hours.find(h => h % 2 !== 0);
                    if (oddHour && state.potential[front][oddHour]) {
                        frontPotential += state.potential[front][oddHour] * 2;
                    }
                }
                
                const frontEfficiency = frontPotential > 0 ? (frontDelivery / frontPotential) * 100 : 0;
                
                frontData.push([
                    `F${front}`,
                    frontDelivery.toFixed(2),
                    frontPotential.toFixed(2),
                    `${frontEfficiency.toFixed(1)}%`
                ]);
            }
            
            // Add front performance table to PDF
            doc.autoTable({
                startY: doc.autoTable.previous.finalY + 20,
                head: [frontData[0]],
                body: frontData.slice(1),
                theme: 'grid',
                headStyles: { fillColor: [93, 92, 222] },
                alternateRowStyles: { fillColor: [240, 240, 255] }
            });
            
            // Save PDF
            doc.save(`dashboard_entrega_${new Date().toISOString().slice(0, 10)}.pdf`);
            
            showToast('Dashboard exportado com sucesso (PDF)', 'success');
        }
        
        // Confirmation Modal Functions
        function showConfirmationModal(title, message, confirmCallback, confirmText = 'Confirmar', cancelCallback = null, cancelText = 'Cancelar') {
            const modal = document.getElementById('confirmation-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalConfirm = document.getElementById('modal-confirm');
            const modalCancel = document.getElementById('modal-cancel');
            
            if (!modal || !modalTitle || !modalMessage || !modalConfirm || !modalCancel) return;
            
            // Set modal content
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalConfirm.textContent = confirmText;
            modalCancel.textContent = cancelText;
            
            // Set confirm button action
            modalConfirm.onclick = () => {
                if (typeof confirmCallback === 'function') {
                    confirmCallback();
                }
                closeConfirmationModal();
            };
            
            // Set cancel button action
            modalCancel.onclick = () => {
                if (typeof cancelCallback === 'function') {
                    cancelCallback();
                }
                closeConfirmationModal();
            };
            
            // Show modal
            modal.classList.remove('hidden');
        }
        
        function closeConfirmationModal() {
            const modal = document.getElementById('confirmation-modal');
            if (modal) modal.classList.add('hidden');
        }
        
        // Toast notification functions
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            if (!toastContainer) return;
            
            const toast = document.createElement('div');
            toast.className = 'flex items-center w-full max-w-xs p-4 mb-4 text-gray-500 bg-white dark:bg-gray-800 rounded-lg shadow-md';
            
            let iconSvg = '';
            let bgColor = 'bg-blue-100 dark:bg-blue-900';
            let iconColor = 'text-blue-500 dark:text-blue-400';
            
            switch (type) {
                case 'success':
                    iconSvg = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>';
                    bgColor = 'bg-green-100 dark:bg-green-900';
                    iconColor = 'text-green-500 dark:text-green-400';
                    break;
                case 'error':
                    iconSvg = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>';
                    bgColor = 'bg-red-100 dark:bg-red-900';
                    iconColor = 'text-red-500 dark:text-red-400';
                    break;
                case 'warning':
                    iconSvg = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>';
                    bgColor = 'bg-yellow-100 dark:bg-yellow-900';
                    iconColor = 'text-yellow-500 dark:text-yellow-400';
                    break;
                case 'info':
                default:
                    iconSvg = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>';
                    break;
            }
            
            toast.innerHTML = `
            <div class="inline-flex items-center justify-center flex-shrink-0 w-8 h-8 ${bgColor} rounded-lg ${iconColor}">
                ${iconSvg}
            </div>
            <div class="ml-3 text-sm font-normal text-gray-700 dark:text-gray-300">${message}</div>
            <button type="button" class="ml-auto -mx-1.5 -my-1.5 bg-white dark:bg-gray-800 text-gray-400 hover:text-gray-900 dark:hover:text-white rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 inline-flex items-center justify-center h-8 w-8">
                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
            </button>
            `;
            
            // Add close button functionality
            toast.querySelector('button').addEventListener('click', () => {
                toast.remove();
            });
            
            // Add toast to container
            toastContainer.appendChild(toast);
            
            // Remove toast after 5 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.classList.add('opacity-0');
                    setTimeout(() => toast.remove(), 300);
                }
            }, 5000);
            
            // Add transition
            toast.style.transition = 'opacity 300ms ease-in-out';
        }
        
        // Dark mode functions
        function setupDarkMode() {
            const themeToggleButton = document.getElementById('theme-toggle');
            const lightIcon = document.getElementById('theme-toggle-light-icon');
            const darkIcon = document.getElementById('theme-toggle-dark-icon');
            
            if (themeToggleButton) {
                themeToggleButton.addEventListener('click', toggleDarkMode);
            }
            
            // Check system preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                state.config.darkMode = true;
            }
            
            // Apply initial theme
            updateDarkMode();
            
            // Show appropriate icon
            if (lightIcon && darkIcon) {
                if (state.config.darkMode) {
                    lightIcon.classList.remove('hidden');
                    darkIcon.classList.add('hidden');
                } else {
                    lightIcon.classList.add('hidden');
                    darkIcon.classList.remove('hidden');
                }
            }
            
            // Listen for system preference changes
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                if (!localStorage.getItem('app_config')) {
                    // Only auto-switch if user hasn't set a preference
                    state.config.darkMode = e.matches;
                    updateDarkMode();
                }
            });
        }
        
        function toggleDarkMode() {
            state.config.darkMode = !state.config.darkMode;
            updateDarkMode();
            saveConfig();
        }
        
        function updateDarkMode() {
            const lightIcon = document.getElementById('theme-toggle-light-icon');
            const darkIcon = document.getElementById('theme-toggle-dark-icon');
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            
            if (state.config.darkMode) {
                document.documentElement.classList.add('dark');
                if (lightIcon && darkIcon) {
                    lightIcon.classList.remove('hidden');
                    darkIcon.classList.add('hidden');
                }
                if (darkModeToggle) {
                    darkModeToggle.checked = true;
                }
            } else {
                document.documentElement.classList.remove('dark');
                if (lightIcon && darkIcon) {
                    lightIcon.classList.add('hidden');
                    darkIcon.classList.remove('hidden');
                }
                if (darkModeToggle) {
                    darkModeToggle.checked = false;
                }
            }
            
            // Update chart themes
            Object.values(state.charts).forEach(chart => {
                if (chart) updateChartTheme(chart);
            });
        }
        
        // Auto-initialize dark mode based on system preference
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        
        // Listen for system preference changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>
</body>
</html>
